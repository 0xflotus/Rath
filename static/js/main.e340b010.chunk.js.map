{"version":3,"sources":["workers/dashboard.worker.js","workers/cluster.worker.js","workers/combineFields.worker.js","workers/fieldsSummary.worker.js","workers/groupFields.worker.js","workers/dev.worker.js","assets/kanaries-lite.png","assets/rath-glasses.png","service.ts","actions.ts","state.tsx","utils/fileParser.ts","utils/transform.ts","utils/useComposeState.tsx","components/preference.tsx","queries/featureVis.ts","queries/targetVis.ts","queries/baseVis.ts","queries/index.ts","visBuilder/vegaBase.tsx","../../visual-insights/build/esm/utils/common.js","../../visual-insights/build/esm/specification.js","../../visual-insights/build/esm/ml/cluster/kruskal.js","../../visual-insights/build/esm/sampling/index.js","../../visual-insights/build/esm/insights/dev.js","../../visual-insights/build/esm/cleaner/index.js","plugins/visSummary/index.tsx","plugins/visSummary/description.tsx","pages/gallery/association/digDimension.tsx","pages/gallery/association/index.tsx","pages/gallery/search/index.tsx","pages/gallery/index.tsx","pages/notebook/distributionChart.tsx","pages/notebook/fieldAnalysis.tsx","pages/notebook/subspaces.tsx","pages/notebook/cluster.tsx","pages/notebook/index.tsx","components/table.tsx","components/fieldConfig.tsx","pages/dataSource/clean.ts","pages/dataSource/useDataSource.tsx","utils/deepcopy.ts","pages/dataSource/index.tsx","pages/dashBoard/indicatorCard.tsx","components/react-vega.tsx","pages/dashBoard/combinedChart.tsx","pages/dashBoard/index.tsx","components/simpleTick.tsx","components/radarChart.tsx","pages/dev/index.tsx","components/userSettings.tsx","App.tsx","serviceWorker.js","index.js"],"names":["module","exports","Worker","__webpack_public_path__","server","workerService","worker","data","Promise","resolve","reject","postMessage","onmessage","e","onerror","success","message","error","getFieldsSummaryService","dataSource","fields","useServer","a","async","fieldSummaryList","fetch","method","headers","body","JSON","stringify","res","json","result","Error","console","fieldsSummaryWorker","terminate","getGroupFieldsService","ans","groupedData","newFields","groupFieldsWorker","combineFieldsService","dimensions","measures","operator","subspaceList","combineFieldsWorker","clusterMeasures","maxGroupNumber","combinedSpaces","viewSpaces","spaces","map","v","i","index","clusterWorker","generateDashBoard","subspaces","dashBoardList","dashBoardGeneratorWorker","univariateSummary","select","updateState","params","state","filter","field","type","name","f","originSummary","fieldWithTypeList","includes","fieldName","groupedResult","newBIFields","groupedField","find","newDimensions","groupedSummary","draft","cookedDataSource","summary","origin","grouped","loading","concat","subspaceSearch","subspaceSearching","orderedDimensions","d","target","g","entropy","Infinity","sort","b","cookedDimensions","cookedMeasures","selectedDimensions","slice","Math","round","length","topK","dimensionSize","actions","extractInsights","gallery","univariateResult","getDashBoard","dashBoard","getViewSpaces","space","matrix","correlationMatrix","log","setAutoFreeze","initState","beCool","currentPage","rawData","subspacePercentSize","GloalStateContext","createContext","GlobalStateProvider","children","useState","setState","stateHolder","useRef","getters","dimScores","useMemo","maxEntropy","useGetters","useCallback","stateUpdater","nextState","produce","draftState","current","dispatch","actionName","Provider","value","useGlobalState","useContext","csvLoader","file","Papa","parse","complete","results","row","record","forEach","jsonLoader","reader","FileReader","readAsText","onload","ev","transNumber","num","isNaN","Number","useComposeState","checkboxStyles","root","marginTop","aggregationList","key","text","PreferencePanel","props","show","onUpdateConfig","onClose","config","aggregator","setAggregator","defaultAggregated","setDefaultAggregated","defaultStack","setDefaultStack","useEffect","Panel","isOpen","PanelType","smallFixedFar","onDismiss","headerText","closeButtonAriaLabel","onRenderFooterContent","PrimaryButton","onClick","Label","Stack","verticalFill","tokens","childrenGap","padding","ComboBox","selectedKey","label","allowFreeform","autoComplete","options","onChange","option","Checkbox","styles","checked","isChecked","featureVis","query","fieldTypeDict","getFieldSemanticType","semanticType","shouldFieldAggregate","geomType","fieldType","getFieldType","markType","geomTypeMap","xType","position","yType","colorType","color","xAgg","yAgg","adjustColorField","opacity","size","autosize","mark","selection","sl","encodings","undefined","encoding","x","bin","maxbins","aggregate","y","column","facets","shape","targetVis","repeat","highFacets","columns","spec","interval","line","point","density","BaseChart","schema","fieldFeatures","container","aggregatedMeasures","mea","op","as","table","asFields","page","adjustField","aggField","targetField","fieldMap","width","values","basicSpec","tooltip","channel","stack","transform","groupby","dim","Boolean","sliderSpec","brush","vconcat","baseVis","embed","ref","deepcopy","memberCount","counter","Map","member","has","set","get","entries","geomTypes","area","path","findBestField","fieldRankList","choosen","aestheticMapping","dimFields","visualElements","priority","fieldLeft","typeIndex","channelList","push","specification","aggData","dimIndex","dimMembers","geom","turnAdjMatrix2List","edges","j","abs","parents","n","union","n1","n2","p1","p2","findWithEffect","sizes","unionWithEffect","size1","size2","kruskalMST","groupNumber","threshold","edgesInMST","m","groups","inCutEdge","edge","Set","cluster","groupMaxSize","limitSize","kruskalWithLimitSize","kruskal","meas","meaIndex","reservoirSampling","sampleSpace","len","pos","random","uniformSampling","sampleIndexes","seed","linearCongruentialGenerator","floor","DefaultIWorker","dropNullColumn","keepFields","finalFields","dropNull","keep","every","isFieldNumeric","toString","isNullValue","useMode","fieldNames","countMap","modeMap","keys","members","max","maxPos","newDataSource","simpleClean","StoryTeller","spaceList","isTeachingBubbleVisible","setIsTeachingBubbleVisible","sortedFieldsScores","mostInfluencedDimension","sp","some","bestMeasure","measuresInView","min","minPos","countDiffField","join","DefaultButton","id","TeachingBubble","calloutProps","directionalHint","DirectionalHint","bottomCenter","isWide","hasCloseIcon","headline","source","VisDescription","measuresRelatedScore","measures1","measures2","meaSet","meaSet1","meaSet2","meaVec1","meaVec2","score","sqrt","useDigDimension","interestedViewSpace","fieldScores","relatedSpaces","subDim","rankedRelatedSpaces","measureSimilarity","relatedScore","spaceFieldScores","Association","digDimensionProps","onSelectView","visualConfig","relatedCharts","className","view","currentSpace","dimensions1","dimensions2","dim1","style","border","margin","overflow","fontSize","horizontal","IconButton","iconProps","iconName","title","VisCard","styled","div","PageLinkButton","SearchPage","targetViewSpaces","setTargetViewSpaces","fuse","Fuse","setCurrentPage","maxPageNumber","ceil","minVisPage","maxVisPage","itemRange","visPageRange","Array","gotoPage","lastPage","p","nextPage","usePageController","specList","SearchBox","placeholder","onSearch","newValue","search","underlined","pivotList","itemKey","Gallery","pivotIndex","setPivotIndex","insightBoard","fieldConfig","configPanel","dataConfig","pageStatus","setPageStatus","showAssociation","setShowAssociation","setVisualConfig","setViewSpaces","dataView","setDataView","pageNo","then","viewState","subspace","paddingTop","Pivot","onLinkClick","item","pivot","PivotItem","ProgressIndicator","description","marginBottom","ariaLabel","dir","SpinButton","step","labelPosition","Position","end","onValidate","onIncrement","onDecrement","incrementButtonAriaLabel","decrementButtonAriaLabel","allowDisabledFocus","findIndex","DistributionChart","chart","hasIndex","test","memberName","exec","left","sortBy","background","height","axis","minWidth","maxWidth","getIconNameByFieldType","FieldAnalsis","entropyRange","originEntropy","s","onRenderCompactCard","toFixed","distribution","onRenderExpandedCard","DetailsList","compact","items","selectionMode","SelectionMode","none","onRenderItemColumn","expandingCardProps","renderData","compactCardHeight","expandedCardHeight","fieldContent","bgColor","Icon","range","chroma","scale","domain","rgb","bgColorStr","fontColorStr","HoverCard","expandedCardOpenDelay","instantOpenOnClick","boxShadow","backgroundColor","encodeArr","arr","Subspaces","onSpaceChange","curIndex","setCurIndex","spaceChart","relationChart","targetSpace","measureName","measureValue","on","reverse","condition","addEventListener","datum","correlation","scheme","ClusterBoard","adjMatrix","onFocusGroup","clusterResult","Cluster","kruskalWithFullMST","treeData","nodes","group","NoteBook","isAggregated","setIsAggregated","clusterState","setClusterState","setMeasuresInView","usedSubspaceList","measInView","Slider","disabled","valueFormat","showValue","Toggle","defaultChecked","onText","offText","DataTable","maxHeight","FieldPanel","setFields","updateFieldType","cleanMethodList","useDataSource","cleanMethod","Transform","preparedData","Cleaner","cleanData","SampleKey","SampleOptions","reservoir","DataSourceBoard","setCleanMethod","fixUnicodeField","setFixUnicodeField","sampleMethod","setSampleMethod","sampleSize","setSampleSize","dataSetting","fileEle","labelId","useId","commandBarList","click","onExtractInsights","Callout","role","gapSpace","setInitialFocus","hidden","required","ChoiceGroup","defaultSelectedKey","ariaLabelledBy","val","multiple","accept","display","files","tmpFields","FileLoader","Sampling","Object","fixedRecord","CommandBar","overflowButtonProps","fontWeight","Card","IndicatorCard","datalib","parts","split","replace","numberWithCommas","ReactVega","signalHandler","setView","addSignalListener","removeSignalListener","change","vega","changeset","remove","insert","resize","runAsync","CombinedChart","globalFilters","setGlobalFilters","chartStateList","setChartStateList","chartSpecList","board","dataFields","specIndex","vegaSpec","vsourceList","filters","isRange","ds","overflowY","float","minHeight","list","nextList","DashBoardPage","dashBoardIndex","setDashBoardIndex","Separator","overflowX","SimpleTick","calculate","layer","RadarChart","keyField","valueField","viewData","category","ruleData","contains","signals","update","scales","signal","zero","nice","domainMin","encode","enter","marks","zindex","from","facet","interpolate","stroke","strokeWidth","fill","fillOpacity","align","baseline","x2","y2","Tag","DashBoard","ColorMap","outlier","trend","arrEqual","arr1","arr2","DevPage","insightViewSpace","setInsightViewSpace","sigThreshold","setSigThreshold","setLoading","chartIndex","setChartIndex","viewSpaceList","significance","relatedViews","ansSpace","InsightViewWorker","getInsightViewSpace","start","UserSettings","setShow","ActionButton","bottomLeftEdge","App","withGlasses","pivotKey","href","src","RathCoolLogo","RathLogo","alt","headersOnly","window","location","hostname","match","initializeIcons","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.e340b010.chunk.js","sourcesContent":["module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"7d30fd3bf3047d027de2.worker.js\");\n};","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"6ebf17f13dfdd6fd3bd9.worker.js\");\n};","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"cb14984d24fb28d152f6.worker.js\");\n};","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"54f2ee6df56e4927ebe1.worker.js\");\n};","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"a052c681f648b70eb30e.worker.js\");\n};","module.exports = function() {\n  return new Worker(__webpack_public_path__ + \"bc74de91d580f3ba8252.worker.js\");\n};","module.exports = \"data:image/png;base64,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\"","module.exports = __webpack_public_path__ + \"static/media/rath-glasses.4a15bb11.png\";","import { DataSource,  Field, FieldType, OperatorType } from './global';\n/* eslint import/no-webpack-loader-syntax:0 */\n// @ts-ignore\n// eslint-disable-next-line\nimport dashBoardGeneratorWorker from './workers/dashboard.worker';\n/* eslint import/no-webpack-loader-syntax:0 */\n// @ts-ignore\n// eslint-disable-next-line\nimport clusterWorker from './workers/cluster.worker';\n/* eslint import/no-webpack-loader-syntax:0 */\n// @ts-ignore\n// eslint-disable-next-line\nimport combineFieldsWorker from './workers/combineFields.worker';\n/* eslint import/no-webpack-loader-syntax:0 */\n// @ts-ignore\n// eslint-disable-next-line\nimport fieldsSummaryWorker from './workers/fieldsSummary.worker';\n/* eslint import/no-webpack-loader-syntax:0 */\n// @ts-ignore\n// eslint-disable-next-line\nimport groupFieldsWorker from './workers/groupFields.worker';\n/* eslint import/no-webpack-loader-syntax:0 */\n// @ts-ignore\n// eslint-disable-next-line\nimport InsightViewWorker from './workers/dev.worker';\nimport { InsightSpace } from 'visual-insights/build/esm/insights/dev';\n\nlet server = '//lobay.moe:8443';\n\nif (process.env.NODE_ENV !== 'production') {\n  console.log('using dev server');\n  server = '//localhost:8000';\n}\n\ninterface SuccessResult<T> {\n  success: true;\n  data: T;\n}\ninterface FailResult<T> {\n  success: false;\n  message: string;\n}\n\ntype Result<T> = SuccessResult<T> | FailResult<T>;\n\nfunction workerService<T, R> (worker: Worker, data: R): Promise<Result<T>> {\n  return new Promise<Result<T>>((resolve, reject) => {\n    worker.postMessage(data);\n    worker.onmessage = (e: MessageEvent) => {\n      resolve(e.data)\n    }\n    worker.onerror = (e: ErrorEvent) => {\n      reject({\n        success: false,\n        message: e.error\n      })\n    }\n  })\n}\n\nexport interface View {\n  groups: string[][];\n  detail: [string[], any, number[][]];\n  score: number;\n}\n\n/**\n * statistic description for a field\n */\nexport interface FieldSummary {\n  fieldName: string;\n  entropy: number;\n  maxEntropy: number;\n  distribution: Array<{ memberName: string; count: number }>\n  type: FieldType\n}\nexport async function getFieldsSummaryService (dataSource: DataSource, fields: string[] | Field[], useServer?: boolean): Promise<FieldSummary[]> {\n  let fieldSummaryList: FieldSummary[] = [];\n  if (useServer) {\n    try {\n      const res = await fetch(server + '/api/service/fieldsSummary', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          dataSource,\n          fields\n        })\n      })\n      const result: Result<FieldSummary[]> = await res.json();\n      if (result.success === true) {\n        fieldSummaryList = result.data;\n      } else {\n        throw new Error('[fields summary failed]' + result.message)\n      }\n    } catch (error) {\n      console.error(error)\n    }\n  } else {\n    const worker = new fieldsSummaryWorker();\n    const result = await workerService<FieldSummary[], any>(worker, { dataSource, fields });\n    if (result.success === true) {\n      fieldSummaryList = result.data;\n    } else {\n      throw new Error('[fields summary failed]' + result.message)\n    }\n    worker.terminate()\n  }\n  return fieldSummaryList\n}\n\ninterface GroupFieldsResponse {\n  groupedData: DataSource;\n  newFields: Field[];\n  fields: Field[];\n}\nexport async function getGroupFieldsService (dataSource: DataSource, fields: Field[], useServer?: boolean): Promise<GroupFieldsResponse> {\n  let ans: GroupFieldsResponse = {\n    groupedData: [],\n    newFields: [],\n    fields: []\n  };\n  if (useServer) {\n    try {\n      const res = await fetch(server + '/api/service/groupFields', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          dataSource,\n          fields\n        })\n      })\n      const result: Result<GroupFieldsResponse> = await res.json();\n      if (result.success === true) {\n        ans = result.data;\n      } else {\n        throw new Error('[group fields failed]' + result.message)\n      }\n    } catch (error) {\n      console.error(error)\n    }\n  } else {\n    const worker = new groupFieldsWorker();\n    const result = await workerService<GroupFieldsResponse, any>(worker, { dataSource, fields });\n    if (result.success === true) {\n      ans = result.data;\n    } else {\n      throw new Error('[group fields failed]' + result.message)\n    }\n    worker.terminate();\n  }\n  return ans;\n}\n\nexport interface Subspace {\n  score: number;\n  dimensions: string[];\n  measures: Array<{name: string; value: number}>;\n  correlationMatrix: number[][];\n}\nexport async function combineFieldsService (dataSource: DataSource, dimensions: string[], measures: string[], operator: OperatorType, useServer?: boolean): Promise<Subspace[]> {\n  let subspaceList: Subspace[] = [];\n  if (useServer) {\n    try {\n      const res = await fetch(server + '/api/service/combineFields', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          dataSource,\n          dimensions,\n          measures,\n          operator\n        })\n      })\n      const result: Result<Subspace[]> = await res.json();\n      if (result.success === true) {\n        subspaceList = result.data;\n      } else {\n        throw new Error('[combine fields failed]' + result.message)\n      }\n    } catch (error) {\n      console.error(error)\n    }\n  } else {\n    const worker = new combineFieldsWorker();\n    const result = await workerService<Subspace[], any>(worker, { dataSource, dimensions, measures, operator });\n    if (result.success === true) {\n      subspaceList = result.data;\n    } else {\n      throw new Error('[combine fields failed]' + result.message)\n    }\n    worker.terminate()\n  }\n  return subspaceList\n}\n\nexport interface ViewCombinedSpace {\n  dimensions: string[];\n  measures: Array<{name: string; value: number}>;\n  matrix: number[][];\n}\n\nexport interface ViewSpace {\n  index: number;\n  dimensions: string[];\n  measures: string[];\n  score: number;\n}\n\nexport async function clusterMeasures (maxGroupNumber: number, combinedSpaces: ViewCombinedSpace[], useServer?: boolean): Promise<ViewSpace[]> {\n  let viewSpaces: ViewSpace[] = [];\n  if (useServer) {\n    try {\n      const res = await fetch(server + '/api/service/clusterMeasures', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          maxGroupNumber,\n          spaces: combinedSpaces\n        })\n      });\n      const result: Result<ViewSpace[]> = await res.json();\n      if (result.success === true) {\n        viewSpaces = result.data.map((v, i) => {\n          return {\n            ...v,\n            index: i\n          }\n        });\n      } else {\n        throw new Error('[cluster measures]' + result.message)\n      }\n    } catch (error) {\n      console.error(error)\n    }\n  } else {\n    const worker = new clusterWorker();\n    const result = await workerService<ViewSpace[], any>(worker, { maxGroupNumber, spaces: combinedSpaces });\n    if (result.success === true) {\n      viewSpaces = result.data.map((v, i) => {\n        return {\n          ...v,\n          index: i\n        }\n      });\n    } else {\n      throw new Error('[cluster measures]' + result.message)\n    }\n    worker.terminate();\n  }\n  return viewSpaces;\n}\n\ninterface ViewInDashBoard {\n  type: string;\n  dimensions: string[];\n  measures: string[];\n}\n\nexport type DashBoard = ViewInDashBoard[];\n\nexport async function generateDashBoard (dataSource: DataSource, dimensions: string[], measures: string[], subspaces: Subspace[], useServer?: boolean): Promise<DashBoard[]> {\n  let dashBoardList: DashBoard[] = [];\n  if (useServer) {\n    try {\n      const res =  await fetch(server + '/api/service/generateDashBoard', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          dataSource,\n          dimensions,\n          measures,\n          subspaces\n        })\n      });\n      const result = await res.json();\n      if (result.success) {\n        dashBoardList = result.data;\n      } else {\n        throw new Error('[generateDashBoard]' + result.message);\n      }\n    } catch (error) {\n      console.error(error)\n    }\n  } else {\n    const worker = new dashBoardGeneratorWorker();\n    const result = await workerService<DashBoard[], any>(worker, {\n        dataSource,\n        dimensions,\n        measures,\n        subspaces\n      });\n    if (result.success) {\n      dashBoardList = result.data;\n    } else {\n      throw new Error('[generateDashBoard]' + result.message);\n    }\n    worker.terminate()\n  }\n  \n  return dashBoardList;\n}\n\nexport async function getInsightViewSpace (dataSource: DataSource, dimensions: string[], measures: string[]): Promise<InsightSpace[]> {\n  let ansSpace: InsightSpace[] = [];\n  try {\n    const worker = new InsightViewWorker();\n    const result = await workerService<InsightSpace[], any>(worker, {\n      dataSource,\n      dimensions,\n      measures\n    });\n    if (result.success) {\n      ansSpace = result.data;\n    } else {\n      throw new Error('[getInsightViewSpace]' + result.message);\n    }\n    worker.terminate();\n  } catch (error) {\n    console.error(error);\n  }\n  return ansSpace;\n}","import { DataSource, BIField, Field, OperatorType } from \"./global\";\nimport {\n  getFieldsSummaryService,\n  FieldSummary,\n  getGroupFieldsService,\n  combineFieldsService,\n  generateDashBoard,\n  ViewSpace,\n  Subspace,\n  clusterMeasures\n} from \"./service\";\nimport { GlobalState, StateUpdater } from './state';\n\n\n\ntype Action<T> = (select: () => GlobalState, updateState: (updater:StateUpdater<GlobalState>) => void, params: T) => any;\n\n\nconst univariateSummary: Action<{dataSource: DataSource; fields: BIField[]}> = async (select, updateState, params) => {\n  const { dataSource, fields } = params;\n  const state = select();\n  const dimensions = fields\n    .filter(field => field.type === \"dimension\")\n    .map(field => field.name);\n  const measures = fields\n    .filter(field => field.type === \"measure\")\n    .map(field => field.name);\n  // updateState(draft => { draft.loading.univariateSummary = true })\n  try {\n    /**\n     * get summary of the orignal dataset(fields without grouped)\n     */\n    const originSummary = await getFieldsSummaryService(\n      dataSource,\n      fields.map(f => f.name),\n      state.useServer\n    );\n    // todo only group dimension.\n    let fieldWithTypeList: Field[] = originSummary\n      ? originSummary\n          .filter(f => dimensions.includes(f.fieldName))\n          .map(f => {\n            return {\n              name: f.fieldName,\n              type: f.type\n            };\n          })\n      : [];\n    /**\n     * bug:\n     * should not group measures!!!\n     */\n    const groupedResult = await getGroupFieldsService(\n      dataSource,\n      fieldWithTypeList,\n      state.useServer\n    );\n    const { groupedData, newFields } = groupedResult\n      ? groupedResult\n      : { groupedData: dataSource, newFields: fieldWithTypeList };\n    /**\n     * `newBIFields` shares the same length (size) with fields.\n     * It repalces some of the fields with high entropy with a grouped new field.\n     * newBIFields does not contain field before grouped.\n     */\n    const newBIFields: BIField[] = fields.map(field => {\n      let groupedField = newFields.find(\n        f => f.name === field.name + \"(group)\"\n      );\n      return {\n        name: groupedField ? groupedField.name : field.name,\n        type: field.type\n      };\n    });\n    const newDimensions: string[] = newBIFields\n      .filter(f => f.type === \"dimension\")\n      .map(f => f.name);\n\n    /**\n     * groupedSummary only contains newFields generated during `groupFieldsService`.\n     */\n    const groupedSummary = await getFieldsSummaryService(\n      groupedData,\n      newFields,\n      state.useServer\n    );\n    \n    updateState(draft => {\n      draft.cookedDataSource = groupedData;\n      draft.summary = {\n        origin: originSummary || [],\n        grouped: groupedSummary || []\n      }\n      draft.loading.univariateSummary = false;\n    });\n    // setFields(newBIFields);\n    // tmp solutions\n    let summary = (groupedSummary || []).concat(originSummary || []);\n    return {\n      groupedData,\n      summary,\n      newDimensions,\n      measures\n    }\n    // await SubspaceSeach(groupedData, summary, newDimensions, measures, \"sum\");\n  } catch (error) {\n    updateState(draft => {\n      draft.loading.univariateSummary = false;\n    });\n  }\n}\n\n\n\ninterface SubspaceSeachParams {\n  groupedData: DataSource;\n  summary: FieldSummary[];\n  dimensions: string[];\n  measures: string[];\n  operator: OperatorType\n}\nconst subspaceSearch: Action<SubspaceSeachParams> = async (select, updateState, params) => {\n  const { groupedData: dataSource, summary, dimensions, measures, operator } = params;\n  const state = select();\n  updateState(draft => {\n    draft.loading.subspaceSearching = true;\n  });\n  let orderedDimensions: Array<{ name: string; entropy: number }> = [];\n  orderedDimensions = dimensions.map(d => {\n    let target = summary.find(g => g.fieldName === d);\n    return {\n      name: d,\n      entropy: target ? target.entropy : Infinity\n    };\n  });\n\n  orderedDimensions.sort((a, b) => a.entropy - b.entropy);\n  updateState(draft => {\n    draft.cookedDimensions = orderedDimensions.map(d => d.name);\n    draft.cookedMeasures = measures;\n  });\n  const selectedDimensions = orderedDimensions\n    .map(d => d.name)\n    .slice(\n      0,\n      Math.round(orderedDimensions.length * state.topK.dimensionSize)\n    );\n  try {\n    const subspaceList = await combineFieldsService(\n      dataSource,\n      selectedDimensions,\n      measures,\n      operator,\n      state.useServer\n    );\n    if (subspaceList) {\n      updateState(draft => {\n        draft.subspaceList = subspaceList;\n      });\n    }\n    updateState(draft => {\n      draft.loading.subspaceSearching = false;\n    });\n  } catch (error) {\n    updateState(draft => {\n      draft.loading.subspaceSearching = false;\n    });\n  }\n}\n\ninterface GetViewSpacesProps {\n  subspaceList: Subspace[];\n  maxGroupNumber: number;\n  useServer: boolean;\n}\nconst getViewSpaces: Action<GetViewSpacesProps> = async (select, updateState, params) => {\n  const { subspaceList, maxGroupNumber, useServer } = params;\n  let viewSpaces: ViewSpace[] = [];\n  try {\n    viewSpaces = await clusterMeasures(\n      maxGroupNumber,\n      subspaceList.map(space => {\n        return {\n          dimensions: space.dimensions,\n          measures: space.measures,\n          matrix: space.correlationMatrix\n        };\n      }),\n      useServer\n    )\n    updateState(draft => {\n      draft.viewSpaces = viewSpaces\n    })\n  } catch (error) {\n    console.log(error)\n  }\n}\n\nconst extractInsights: Action<{dataSource: DataSource; fields: BIField[]}> = async (state, updateState, params) => {\n  const { dataSource, fields } = params;\n  updateState(draft => {\n    draft.loading.gallery = true\n  })\n  try {\n    const univariateResult = await univariateSummary(state, updateState, {\n      dataSource, fields\n    });\n      if (univariateResult) {\n        const {\n          groupedData,\n          summary,\n          newDimensions,\n          measures\n        } = univariateResult;\n        await subspaceSearch(state, updateState, {\n          groupedData, summary, dimensions: newDimensions, measures, operator: \"sum\"\n        });\n      }\n  } catch (error) {\n  } finally {\n    updateState(draft => {\n      draft.loading.gallery = false\n      draft.loading.gallery = false\n    })\n  }\n}\n\nconst getDashBoard: Action<{dataSource: DataSource, dimensions: string[], measures: string[]}> = async (select, updateState, params) => {\n  const state = select();\n  const { dataSource, dimensions, measures } = params;\n  updateState(draft => {\n    draft.loading.dashBoard = true\n  })\n  try {\n    const dashBoardList = await generateDashBoard(dataSource, dimensions, measures, state.subspaceList, state.useServer)\n    updateState(draft => {\n      draft.dashBoardList = dashBoardList;\n    })\n  } catch (error) {\n    console.error(error)\n  } finally {\n    updateState(draft => {\n      draft.loading.dashBoard = false\n    })\n  }\n}\nconst actions = {\n  univariateSummary,\n  subspaceSearch,\n  extractInsights,\n  getDashBoard,\n  getViewSpaces\n}\nexport type Actions =  typeof actions\n\ntype valueof<T> = T[keyof T]\n\ntype Foo = Parameters<typeof subspaceSearch> // ReturnType\nexport type Test = valueof<{  [key in keyof Actions]: {\n  name: key,\n  params: Parameters<Actions[key]>[2]\n}}>\n\nexport default actions;\n","import produce, { Draft, setAutoFreeze } from 'immer';\nimport React, { useState, useMemo, createContext, useContext, useCallback, useRef } from 'react';\nimport { DataSource, BIField, Field } from './global';\nimport { Subspace, FieldSummary, ViewSpace, DashBoard } from './service';\nimport actions, { Test } from './actions';\n\nsetAutoFreeze(false)\n\nexport interface GlobalState {\n  /**\n   * useless but cool.\n   */\n  beCool: boolean;\n  /**\n   * `currentPage` is the current page number of visualization in explore board.\n   */\n  currentPage: number;\n  /**\n   * use server to complete computing task, if not, use web worker.\n   */\n  useServer: boolean;\n  /**\n   * raw data is fetched and parsed data or uploaded data without any other changes.\n   * computed value `dataSource` will be calculated \n   */\n  rawData: DataSource;\n  /**\n   * fields contains fields with `dimension` or `measure` type.\n   * currently, this kind of type is not computed property unlike 'quantitative', 'nominal'...\n   * This is defined by user's purpose or domain knowledge.\n   */\n  fields: BIField[];\n  /**\n   * dataSource been cleaned and grouped which is readly for exploration.\n   */\n  cookedDataSource: DataSource;\n  cookedDimensions: string[];\n  cookedMeasures: string[];\n  /**\n   * subspaceList is ordered list by it score.\n   */\n  // subspaceList: Subspace[]\n  /**\n   * loading status for some service\n   * todo: \n   * manage the loading status in pages intead of globally.\n   */\n  loading: {\n    univariateSummary: boolean;\n    subspaceSearching: boolean;\n    gallery: boolean;\n    dashBoard: boolean;\n  };\n  \n  topK: {\n    /**\n     * top k percent subspace it will fetch.\n     */\n    subspacePercentSize: number;\n    dimensionSize: number;\n  }\n  maxGroupNumber: number;\n  subspaceList: Subspace[];\n  summary: {\n    origin: FieldSummary[];\n    grouped: FieldSummary[];\n  };\n  viewSpaces: ViewSpace[];\n  dashBoardList: DashBoard[];\n}\n\ninterface Getters {\n  /**\n   * `dataSource` is computed data based on fields' property(dimension or measure).\n   * sometimes, uploaded data contains contains some measure field but they are parsed into string value, which is raw data.\n   * dataSource transform these fields into what they should be for future computation.\n   * This is usually happened when a csv file is uploaded.\n   */\n  dimScores: [string, number, number, Field][]\n}\nexport type StateUpdater<S> = (draftState: Draft<S>) => void\n\n// function createStore<S>(initState: S) {\n//   const [state, setState] = useState<S>(initState)\n\n//   return function useGlobalState(): [S, (stateUpdater: StateUpdater<S>) => void] {\n//     const updateState = (stateUpdater: StateUpdater<S>) => {\n//       const nextState = produce<S>(state, draftState => stateUpdater(draftState))\n//       setState(nextState)\n//     }\n//     return [state, updateState]\n//   }\n// }\n\nconst initState: GlobalState = {\n  beCool: false,\n  currentPage: 0,\n  useServer: false,\n  fields: [],\n  rawData: [],\n  cookedDataSource: [],\n  cookedDimensions: [],\n  cookedMeasures: [],\n  loading: {\n    univariateSummary: false,\n    subspaceSearching: false,\n    gallery: false,\n    dashBoard: false,\n  },\n  topK: {\n    subspacePercentSize: 0.3,\n    dimensionSize: 0.72\n  },\n  maxGroupNumber: 4,\n  subspaceList: [],\n  summary: {\n    origin: [],\n    grouped: []\n  },\n  viewSpaces: [],\n  dashBoardList: []\n};\ntype Dispatch<T> = (actionName: string, params: T) => void;\ntype valueof<T> = T[keyof T]\nconst GloalStateContext = createContext<[GlobalState, (updater:StateUpdater<GlobalState>) => void, <P extends Test>(actionName: P['name'], params: P['params']) => void, Getters]>(null!)\nfunction useGetters(state: GlobalState) {\n  const dimScores = useMemo<[string, number, number, Field][]>(() => {\n    return [...state.summary.origin, ...state.summary.grouped].map(field => {\n      return [\n        field.fieldName,\n        field.entropy,\n        field.maxEntropy,\n        { name: field.fieldName, type: field.type }\n      ];\n    });\n  }, [state.summary])\n\n  const getters: Getters = {\n    dimScores\n  }\n\n  return getters;\n}\nexport function GlobalStateProvider({ children }: { children: React.ReactNode }) {\n  const [state, setState] = useState<GlobalState>(initState);\n  const stateHolder = useRef<GlobalState>(initState);\n\n  const getters = useGetters(state);\n  const updateState = useCallback((stateUpdater: StateUpdater<GlobalState>) => {\n    setState(state => {\n      const nextState = produce<GlobalState>(state, draftState => stateUpdater(draftState))\n      stateHolder.current = nextState;\n      return nextState;\n    })\n  }, [setState])\n  const dispatch: <P extends Test>(actionName: P['name'], params: P['params']) => void = useCallback((actionName, params) => {\n    if (typeof actions[actionName] === 'function') {\n      function select (): GlobalState {\n        return stateHolder.current\n      }\n      // todo: fix the any type\n      \n      actions[actionName](select, updateState, params as any);\n      // actions['subspaceSearch'](state, updateState, params)\n    }\n  }, [updateState])\n\n\n\n  return (\n    <GloalStateContext.Provider value={[state, updateState, dispatch, getters]}>\n      {children}\n    </GloalStateContext.Provider>\n  )\n}\nexport function useGlobalState() {\n  return useContext(GloalStateContext)\n}","import { Record, DataSource } from '../global';\nimport Papa from 'papaparse';\n\nexport function csvLoader (file: File) {\n  return new Promise<DataSource>((resolve, reject) => {\n    Papa.parse(file, {\n      complete (results, file) {\n        let data: string[][] = results.data;\n        let fields: string[] = data[0];\n        let rawData = data.slice(1).map(row => {\n          let record: Record = {};\n          fields.forEach((field, index) => {\n            record[field] = row[index]\n          })\n          return record\n        })\n        resolve(rawData)\n      },\n      error (error, file) {\n        reject(error)\n      }\n    })\n  })\n}\n\nexport function jsonLoader (file: File): Promise<DataSource> {\n  return new Promise((resolve, reject) => {\n    let reader = new FileReader()\n    reader.readAsText(file)\n    reader.onload = (ev) => {\n      if (ev.target) {\n        try {\n          const rawData: DataSource = JSON.parse(ev.target.result as string);\n          resolve(rawData);\n        } catch (error) {\n          reject(error)\n        }\n      } else {\n        reject(ev)\n      }\n    }\n    reader.onerror = reject\n  })\n}","export function transNumber(num: any): number | null {\n  if (isNaN(num)) {\n    return null\n  }\n  return Number(num)\n}","import { useState, useCallback } from 'react';\nimport produce, { Draft } from 'immer';\n/**\n * @param S type of the composed state\n */\nexport type StateUpdater<S> = (draftState: Draft<S>) => void\n/**\n * \n * @param initState\n * useComposeState helps you manage several state together, provided with immutable state change api\n * \n * example:\n * ```js\n * const [state, setState] = useComposeState({foo: 12, bar: { foo: 20}})\n * setState(draft => {\n *  draft.bar.foo = 100;\n * })\n * ```\n */\nexport default function useComposeState<S>(initState: S): [S, (stateUpdater: StateUpdater<S>) => void] {\n  const [state, setState] = useState<S>(initState)\n  const updateState = useCallback((stateUpdater: StateUpdater<S>) => {\n    setState(state => {\n      const nextState = produce<S>(state, draftState => stateUpdater(draftState))\n      return nextState\n    })\n  }, [setState])\n  return [state, updateState]\n}","import React, { useState, useEffect } from 'react';\nimport { PrimaryButton, Stack, Checkbox, Panel, PanelType, ComboBox, Label } from 'office-ui-fabric-react';\nimport { Aggregator } from '../global';\nconst checkboxStyles = () => {\n  return {\n    root: {\n      marginTop: '10px'\n    }\n  };\n}\n\n// todo: import aggregators list from cube-core\nconst aggregationList: Array<{ key: Aggregator; text: string }> = [\n  { key: 'sum', text: 'Sum' },\n  { key: 'count', text: 'Count' },\n  { key: 'mean', text: 'Mean' }\n]\nexport interface PreferencePanelConfig {\n  aggregator: Aggregator;\n  defaultAggregated: boolean;\n  defaultStack: boolean\n}\nexport interface PreferencePanelProps {\n  show: boolean;\n  onUpdateConfig: (props: PreferencePanelConfig) => void;\n  onClose: () => void;\n  config: PreferencePanelConfig\n}\n\nconst PreferencePanel: React.FC<PreferencePanelProps> = (props) => {\n  const {\n    show = false,\n    onUpdateConfig,\n    onClose,\n    config\n  } = props;\n  \n  const [aggregator, setAggregator] = useState<Aggregator>('sum');\n  const [defaultAggregated, setDefaultAggregated] = useState(true);\n  const [defaultStack, setDefaultStack] = useState(true);\n  \n  useEffect(() => {\n    const { aggregator, defaultAggregated, defaultStack } = config;\n    setAggregator(aggregator);\n    setDefaultAggregated(defaultAggregated);\n    setDefaultStack(defaultStack);\n  }, [config, show])\n  \n  const onRenderFooterContent = () => <div>\n    <PrimaryButton onClick={() => { onUpdateConfig({ aggregator, defaultAggregated, defaultStack }) }}>\n      Save\n    </PrimaryButton>\n  </div>\n  \n  return <Panel\n    isOpen={show}\n    type={PanelType.smallFixedFar}\n    onDismiss={onClose}\n    headerText=\"Preference\"\n    closeButtonAriaLabel=\"Close\"\n    onRenderFooterContent={onRenderFooterContent}\n  >\n    <Label>Preference</Label>\n    <Stack verticalFill tokens={{ childrenGap: 50, padding: 6}}>\n      <ComboBox\n        selectedKey={aggregator}\n        label=\"Aggregator\"\n        allowFreeform={true}\n        autoComplete=\"on\"\n        options={aggregationList}\n        onChange={(e, option) => {option && setAggregator(option.key as Aggregator)}}\n      />\n      <Checkbox styles={checkboxStyles} label=\"measurement aggregation\" checked={defaultAggregated} onChange={(e, isChecked) => {setDefaultAggregated(isChecked || false)}} />\n      <Checkbox styles={checkboxStyles} label=\"measurement stack\" checked={defaultStack} onChange={(e, isChecked) => {setDefaultStack(isChecked || false)}} />\n    </Stack>\n  </Panel>\n}\n\nexport default PreferencePanel;","import { Specification, FieldType } from \"visual-insights/src/commonTypes\";\nimport { geomTypeMap, DataField } from './index';\n\nexport function featureVis(query: Specification, fields: DataField[]) {\n  console.log({ query, fields })\n  // bug: sometimes there are fields in query but not in fields\n  let fieldTypeDict: {[key: string]: DataField} = {};\n  for (let field of fields) {\n    fieldTypeDict[field.name] = field\n  }\n\n  function getFieldSemanticType(field: string): FieldType {\n    return fieldTypeDict[field] ? fieldTypeDict[field].semanticType : \"nominal\";\n  }\n  function getFieldType(field: string): DataField['type'] {\n    return fieldTypeDict[field] ? fieldTypeDict[field].type : 'dimension'\n  }\n  \n  function shouldFieldAggregate(\n    field: string,\n    geomType: string\n  ): boolean {\n    if (geomType === \"point\") {\n      return false;\n    }\n    const fieldType = getFieldSemanticType(field);\n    if (geomType === 'rect') {\n      return fieldType !== 'quantitative'\n    }\n    if (fieldType === \"quantitative\" && getFieldType(field) === 'measure') {\n      return true;\n    }\n    return false;\n  }\n\n  let markType =\n        query.geomType![0] && geomTypeMap[query.geomType![0]]\n          ? geomTypeMap[query.geomType![0]]\n          : query.geomType![0];\n      const xType = getFieldSemanticType(query.position![0]);\n      const yType = getFieldSemanticType(query.position![1]);\n      const colorType = getFieldSemanticType(query.color![0]);\n      const xAgg = shouldFieldAggregate(query.position![0], markType);\n      const yAgg = shouldFieldAggregate(query.position![1], markType);\n\n      let adjustColorField = query.color![0];\n      if (markType === 'rect') {\n        if (query.color![0] && colorType !== 'quantitative') {\n          markType = 'point';\n        } else if (query.opacity![0] && query.size![0]) {\n          adjustColorField = query.size![0] || query.opacity![0];\n        }\n      }\n      return {\n        data: { name: \"dataSource\" },\n        autosize: {\n          type: \"pad\"\n        },\n        mark: markType,\n        selection: {\n          sl: {\n            type: markType === \"bar\" ? \"single\" : \"interval\",\n            encodings: markType === \"bar\" ? [\"x\"] : undefined\n          }\n        },\n        encoding: {\n          x: query.position![0] && {\n            field: query.position![0],\n            type: getFieldSemanticType(query.position![0]),\n            bin: markType === 'rect' && xType === 'quantitative' && { maxbins: 20 },\n            aggregate: markType !== 'rect' && xAgg && 'sum'\n          },\n          y: query.position![1] && {\n            field: query.position![1],\n            type: getFieldSemanticType(query.position![1]),\n            bin: markType === 'rect' && yType === 'quantitative' && { maxbins: 20 },\n            aggregate: markType !== 'rect' && yAgg && 'sum',\n          },\n          size: query.size![0] && {\n            field: query.size![0],\n            type: getFieldSemanticType(query.size![0])\n          },\n          column: query.facets![0] && {\n            field: query.facets![0],\n            type: getFieldSemanticType(query.facets![0])\n          },\n          row: query.facets![1] && {\n            field: query.facets![1],\n            type: getFieldSemanticType(query.facets![1])\n          },\n          opacity: query.opacity![0] && {\n            field: query.opacity![0],\n            type: getFieldSemanticType(query.opacity![0])\n          },\n          shape: query.shape![0] && {\n            field: query.shape![0],\n            type: getFieldSemanticType(query.shape![0])\n          },\n          color: (adjustColorField || markType === 'rect') && {\n            field: adjustColorField,\n            aggregate: markType === 'rect' && getFieldSemanticType(adjustColorField) === 'quantitative' && (adjustColorField ? 'sum' : 'count'),\n            type: adjustColorField && getFieldSemanticType(adjustColorField)\n          }\n        }\n      };\n\n}","import { Specification, FieldType } from \"visual-insights/src/commonTypes\";\nimport { geomTypeMap, DataField } from './index';\n\nexport function targetVis(query: Specification, fields: DataField[]) {\n  let fieldTypeDict: {[key: string]: DataField} = {};\n  for (let field of fields) {\n    fieldTypeDict[field.name] = field\n  }\n\n  function getFieldSemanticType(field: string): FieldType {\n    return fieldTypeDict[field].semanticType || \"nominal\";\n  }\n  function getFieldType(field: string): DataField['type'] {\n    return fieldTypeDict[field].type || 'dimension'\n  }\n  \n  function shouldFieldAggregate(\n    field: string,\n    geomType: string\n  ): boolean {\n    if (geomType === \"point\") {\n      return false;\n    }\n    const fieldType = getFieldSemanticType(field);\n    if (geomType === 'rect') {\n      return fieldType !== 'quantitative'\n    }\n    if (fieldType === \"quantitative\" && getFieldType(field) === 'measure') {\n      return true;\n    }\n    return false;\n  }\n\n  let markType =\n        query.geomType![0] && geomTypeMap[query.geomType![0]]\n          ? geomTypeMap[query.geomType![0]]\n          : query.geomType![0];\n      const xType = getFieldSemanticType(query.position![0]);\n      const yType = getFieldSemanticType(query.position![1]);\n      const colorType = getFieldSemanticType(query.color![0]);\n      const xAgg = shouldFieldAggregate(query.position![0], markType);\n      const yAgg = shouldFieldAggregate(query.position![1], markType);\n      let repeat: string[] = [query.position![1]];\n      if (query.highFacets) {\n        repeat = repeat.concat(query.highFacets!.filter(f => getFieldSemanticType(f) === 'quantitative'))\n      }\n      let adjustColorField = query.color![0];\n      if (markType === 'rect') {\n        if (query.color![0] && colorType !== 'quantitative') {\n          markType = 'point';\n        } else if (query.opacity![0] && query.size![0]) {\n          adjustColorField = query.size![0] || query.opacity![0];\n        }\n      }\n      return {\n        config: {\n          repeat: { columns: 5 }\n        },\n        data: { name: \"dataSource\" },\n        autosize: {\n          type: \"pad\"\n        },\n        repeat,\n        spec: {\n          mark: markType,\n          selection: {\n            sl: {\n              type: markType === \"bar\" ? \"single\" : \"interval\",\n              encodings: markType === \"bar\" ? [\"x\"] : undefined\n            }\n          },\n          encoding: {\n            x: query.position![0] && {\n              field: query.position![0],\n              type: getFieldSemanticType(query.position![0]),\n              bin: markType === 'rect' && xType === 'quantitative' && { maxbins: 20 },\n              aggregate: markType !== 'rect' && xAgg && 'sum'\n            },\n            y: repeat[0] && {\n              field: { repeat: 'repeat' },\n              type: getFieldSemanticType(repeat[0]),\n              bin: markType === 'rect' && yType === 'quantitative' && { maxbins: 20 },\n              aggregate: markType !== 'rect' && yAgg && 'sum',\n              // scale: mustDefineScale && !yAgg ? { domain: filedDomains[repeat[0]] } : undefined\n            },\n            size: query.size![0] && {\n              field: query.size![0],\n              type: getFieldSemanticType(query.size![0])\n            },\n            opacity: query.opacity![0] && {\n              field: query.opacity![0],\n              type: getFieldSemanticType(query.opacity![0])\n            },\n            shape: query.shape![0] && {\n              field: query.shape![0],\n              type: getFieldSemanticType(query.shape![0])\n            },\n            color: (adjustColorField || markType === 'rect') && {\n              field: adjustColorField,\n              aggregate: markType === 'rect' && getFieldSemanticType(adjustColorField) === 'quantitative' && (adjustColorField ? 'sum' : 'count'),\n              type: adjustColorField && getFieldSemanticType(adjustColorField)\n            }\n          }\n        }\n      };\n\n}","import { Specification } from \"visual-insights/build/esm/commonTypes\";\nimport { DataSource, Field, FieldType } from \"../global\";\nexport const geomTypeMap: { [key: string]: any } = {\n  interval: \"bar\",\n  line: \"line\",\n  point: \"point\",\n  // density: 'rect'\n  density: \"point\"\n};\n\nexport function baseVis(\n  query: Specification,\n  dataSource: DataSource,\n  dimensions: string[],\n  measures: string[],\n  aggregatedMeasures: Array<{op: string; field: string; as: string}>,\n  fieldFeatures: Field[],\n  defaultAggregated?: boolean,\n  defaultStack?: boolean,\n  \n) {\n  const {\n    position = [],\n    color = [],\n    size = [],\n    facets = [],\n    opacity = [],\n    geomType = [],\n    page = []\n  } = query;\n\n  function adjustField(fieldName: string): string {\n    if (defaultAggregated && measures.includes(fieldName)) {\n      let aggField = aggregatedMeasures.find(mea => {\n        return mea.field === fieldName;\n      });\n      return aggField ? aggField.as : fieldName;\n    }\n    return fieldName;\n  }\n  \n  function getFieldType(field: string): FieldType {\n    let targetField = fieldFeatures.find(f => f.name === field);\n    return targetField ? targetField.type : \"nominal\";\n  }\n\n  let chartWidth = 600; //container.current ? container.current.offsetWidth * 0.8 : 600;\n  const fieldMap: any = {\n    x: position[0],\n    y: position[1],\n    color: color[0],\n    size: size[0],\n    opacity: opacity[0],\n    row: facets[0],\n    column: facets[1]\n  };\n  let spec: any = {\n    width: chartWidth,\n    data: {\n      values: dataSource\n    }\n  };\n  let basicSpec: any = {\n    width: chartWidth,\n    mark: {\n      type:\n        geomType[0] && geomTypeMap[geomType[0]]\n          ? geomTypeMap[geomType[0]]\n          : geomType[0],\n      tooltip: true\n    },\n    encoding: {}\n  };\n  for (let channel in fieldMap) {\n    if (fieldMap[channel]) {\n      basicSpec.encoding[channel] = {\n        field: adjustField(fieldMap[channel]),\n        type: getFieldType(fieldMap[channel])\n      };\n      if (\n        [\"x\", \"y\"].includes(channel) &&\n        getFieldType(fieldMap[channel]) === \"quantitative\" &&\n        !defaultStack\n      ) {\n        basicSpec.encoding[channel].stack = null;\n      }\n    }\n  }\n  if (!defaultStack && opacity.length === 0) {\n    basicSpec.encoding.opacity = { value: 0.7 };\n  }\n  if (page.length === 0) {\n    spec = {\n      ...spec,\n      ...basicSpec\n    };\n  } else if (page.length > 0) {\n    basicSpec.transform = [\n      { filter: { selection: \"brush\" } },\n      defaultAggregated\n        ? {\n            aggregate: aggregatedMeasures,\n            groupby: dimensions.filter(dim => dim !== page[0])\n          }\n        : null\n    ].filter(Boolean);\n    let sliderSpec = {\n      width: chartWidth,\n      mark: \"tick\",\n      selection: { brush: { encodings: [\"x\"], type: \"interval\" } },\n      encoding: {\n        x: { field: page[0], type: getFieldType(page[0]) }\n      }\n    };\n    spec.vconcat = [basicSpec, sliderSpec];\n  }\n  return spec;\n}\n","import { FieldType } from \"visual-insights/src/commonTypes\";\nimport { featureVis } from './featureVis'\nimport { targetVis } from './targetVis';\nimport { baseVis } from './baseVis';\n\nexport const geomTypeMap: {[key: string]: any} = {\n  interval: 'bar',\n  line: 'line',\n  point: 'point',\n  density: 'rect'\n}\n\nexport interface DataField {\n  name: string;\n  semanticType: FieldType;\n  type: 'dimension' | 'measure';\n}\n\nexport { featureVis, targetVis, baseVis }","import React, { useEffect, useRef, useMemo } from 'react';\nimport aggregate from 'cube-core';\nimport embed from 'vega-embed';\nimport { DataSource, Field } from '../global'\nimport { baseVis } from '../queries/index';\nexport const geomTypeMap: {[key: string]: any} = {\n  interval: 'bar',\n  line: 'line',\n  point: 'point',\n  // density: 'rect'\n  density: 'point'\n}\nexport interface Specification {\n  position?: string[];\n  color?: string[];\n  opacity?: string[];\n  size?: string[];\n  shape?: string[];\n  geomType?: string[];\n  facets?: string[];\n  page?: string[];\n  filter?: string[]\n}\ninterface BaseChartProps {\n  defaultAggregated: boolean;\n  defaultStack: boolean;\n  aggregator: 'sum' | 'mean' | 'count';\n  dataSource: DataSource;\n  dimensions: string[];\n  measures: string[];\n  fieldFeatures: Field[];\n  schema: Specification;\n}\n\nconst BaseChart: React.FC<BaseChartProps> = (props) => {\n  const {\n    defaultAggregated,\n    defaultStack,\n    aggregator,\n    dataSource = [],\n    dimensions = [],\n    measures = [],\n    schema = {},\n    fieldFeatures = []\n  } = props;\n\n  const container = useRef<HTMLDivElement>(null);\n  const aggregatedMeasures = useMemo(() => {\n    return measures.map(mea => {\n      return {\n        op: aggregator,\n        field: mea,\n        as: `${mea}_${aggregator}`\n      }\n    })\n  }, [measures, aggregator])\n\n  let table = useMemo(() => {\n    if (!defaultAggregated) {\n      return dataSource\n    }\n    return aggregate({ dataSource, dimensions, measures, operator: aggregator, asFields: aggregatedMeasures.map(mea => mea.as)})\n  }, [defaultAggregated, dataSource, dimensions, measures, aggregator, aggregatedMeasures])\n\n  useEffect(() => {\n    if (container.current !== null) {\n      if (schema.position && schema.position.length > 0 && schema.geomType && schema.geomType.length > 0) {\n        let spec = baseVis(schema, table, dimensions, measures, aggregatedMeasures, fieldFeatures, defaultAggregated, defaultStack);\n        embed(container.current, spec);\n      }\n    }\n  }, [schema, table, dimensions, measures, aggregatedMeasures, fieldFeatures, defaultAggregated, defaultStack])\n  return <div ref={container}></div>\n}\n\nexport default BaseChart;","const JOIN_SYMBOL = '_';\nconst MAGIC_NUMBER = 5;\nfunction deepcopy(data) {\n    return JSON.parse(JSON.stringify(data));\n}\nfunction isFieldCategory(dataSource, fieldName) {\n    return dataSource.every(record => {\n        return typeof record[fieldName] === 'string'\n            || typeof record[fieldName] === 'undefined'\n            || record[fieldName] === null;\n    });\n}\nfunction isFieldContinous(dataSource, fieldName) {\n    return dataSource.every(record => {\n        return typeof record[fieldName] === 'number'\n            || typeof record[fieldName] === 'undefined'\n            || record[fieldName] === null;\n    });\n}\nfunction isFieldNumeric(dataSource, fieldName) {\n    return dataSource.every(record => {\n        return !isNaN(record[fieldName])\n            || typeof record[fieldName] === 'undefined'\n            || record[fieldName] === null;\n    });\n}\nfunction isFieldTime(dataSource, fieldName) {\n    return dataSource.every(record => {\n        // todo: tmp solotion here.\n        if (Number(record[fieldName]) >= 1800 && Number(record[fieldName]) <= 2200) {\n            return true;\n        }\n        return (!isNaN(Date.parse(record[fieldName]))\n            && typeof record[fieldName] === 'string'\n            && /^[0-9]{0,4}[-/][0-9]{0,2}([-/][0-9]{0,2}$)?/.test(record[fieldName]))\n            || typeof record[fieldName] === 'undefined'\n            || record[fieldName] === null;\n    });\n}\nfunction aggregate({ dataSource, fields, bys, method = 'sum' }) {\n    let tmp = [];\n    for (let by of bys) {\n        let map = new Map();\n        for (let record of dataSource) {\n            let key = JSON.stringify(fields.map(field => record[field]));\n            if (!map.has(key)) {\n                map.set(key, 0);\n            }\n            map.set(key, map.get(key) + record[by]);\n        }\n        for (let [key, value] of map) {\n            let row = {\n                index: key,\n                [by]: value\n            };\n            let dims = JSON.parse(key);\n            for (let i = 0; i < fields.length; i++) {\n                row[fields[i]] = dims[i];\n            }\n            tmp.push(row);\n        }\n    }\n    let ans = new Map();\n    for (let record of tmp) {\n        if (!ans.has(record.index)) {\n            ans.set(record.index, {});\n        }\n        ans.set(record.index, { ...ans.get(record.index), ...record });\n    }\n    return [...ans.values()];\n}\nfunction memberCount(dataSource, field) {\n    const counter = new Map();\n    for (let row of dataSource) {\n        let member = row[field];\n        if (!counter.has(member)) {\n            counter.set(member, 0);\n        }\n        counter.set(member, counter.get(member) + 1);\n    }\n    return [...counter.entries()];\n}\nfunction groupContinousField({ dataSource, field, newField = `${field}(con-group)`, groupNumber }) {\n    // const members = memberCount(dataSource, field);\n    // todo: outlier detection\n    const values = dataSource.map(item => item[field]);\n    const max = Math.max(...values); // Number.EPSILON * ;\n    const min = Math.min(...values);\n    const segWidth = (max - min) / groupNumber;\n    let ranges = [];\n    for (let i = 0; i < groupNumber; i++) {\n        let left = min + i * segWidth;\n        let right = min + (i + 1) * segWidth;\n        ranges.push([left, right]);\n    }\n    ranges[0][0] = -Infinity;\n    ranges[ranges.length - 1][1] = Infinity;\n    let precision = Math.max(1, Math.log10(Math.abs(min)) - Math.log10(segWidth)) + 1;\n    for (let i = 0; i < dataSource.length; i++) {\n        let record = dataSource[i];\n        let rangeIndex = ranges.findIndex(r => (r[0] <= record[field] && record[field] < r[1]));\n        let range = ranges[rangeIndex];\n        if (typeof range !== 'undefined') {\n            record[newField] = `${rangeIndex + 1}:[${Number(range[0].toPrecision(precision))}, ${Number(range[1].toPrecision(precision))})`;\n        }\n        else {\n            record[newField] = 'null';\n        }\n    }\n    return dataSource;\n}\nfunction groupCategoryField({ dataSource, field, newField = `${field}(cat-group)`, groupNumber }) {\n    // auto category should obey Power law distrubution.\n    let members = memberCount(dataSource, field);\n    members.sort((a, b) => b[1] - a[1]);\n    let sum = members.map(v => v[1]);\n    groupNumber = members.length;\n    for (let i = sum.length - 2; i >= 0; i--) {\n        sum[i] = sum[i + 1] + sum[i];\n    }\n    for (let i = 0; i < members.length - 2; i++) {\n        // strict mode\n        // if (members[i][1] >= sum[i + 1] && members[i + 1][1] < sum[i + 2]) {\n        if (members[i][1] * MAGIC_NUMBER >= sum[i + 1] && members[i + 1][1] / MAGIC_NUMBER < sum[i + 2]) {\n            groupNumber = i + 2;\n            break;\n        }\n    }\n    // groupNumber = Math.max(Math.round(Math.sqrt(members.length)), groupNumber)\n    if (groupNumber === members.length) {\n        return dataSource.map(record => {\n            return {\n                ...record,\n                [newField]: record[field]\n            };\n        });\n    }\n    let set = new Set();\n    for (let i = groupNumber - 1; i < members.length; i++) {\n        set.add(members[i][0]);\n    }\n    for (let record of dataSource) {\n        if (set.has(record[field])) {\n            record[newField] = 'others';\n        }\n        else {\n            record[newField] = record[field];\n        }\n    }\n    return dataSource;\n}\n/**\n * Kullback–Leibler divergence\n * @param p1List\n * @param p2List\n *\n */\nfunction DKL(p1List, p2List) {\n    let sum = 0;\n    const len = Math.max(p1List.length, p2List.length);\n    for (let i = 0; i < len; i++) {\n        let p1 = p1List[i] || 0;\n        let p2 = p2List[i] || 0;\n        sum += p1 * Math.log2(p1 / p2);\n    }\n    return sum;\n}\nfunction isFieldUnique(dataSource, field) {\n    let set = new Set();\n    let validCount = 0;\n    let len = dataSource.length;\n    for (let i = 0; i < len; i++) {\n        if (dataSource[i][field] !== undefined && dataSource[i][field] !== null && dataSource[i][field] !== '') {\n            validCount++;\n            set.add(dataSource[i][field]);\n        }\n    }\n    if (set.size === validCount)\n        return true;\n    return false;\n}\nexport { deepcopy, memberCount, groupCategoryField, groupContinousField, aggregate, isFieldCategory, isFieldContinous, isFieldTime, isFieldNumeric, JOIN_SYMBOL, DKL, isFieldUnique };\n","import { \n// isFieldCategory,\n// isFieldContinous,\nmemberCount } from './utils/index';\nfunction getVisualElements() {\n    return {\n        position: 2,\n        color: 1,\n        size: 1,\n        shape: 1,\n        opacity: 1,\n        facets: 2,\n        page: 1,\n        filter: 1,\n        highFacets: 1000\n    };\n}\nconst geomTypes = {\n    interval: [0, 10],\n    line: [11, Infinity],\n    area: [11, Infinity],\n    point: [0, 1000],\n    path: [0, 100],\n    density: [1001, Infinity]\n};\nfunction findBestField(type, fieldRankList) {\n    for (let i = fieldRankList.length - 1; i >= 0; i--) {\n        if (fieldRankList[i].type === type && !fieldRankList[i].choosen) {\n            return fieldRankList[i];\n        }\n    }\n    return false;\n}\n/**\n *\n * @param dimFields ranked dimension by entropy. asc\n * todo: not clear enough implementation for using asc and desc\n */\nfunction aestheticMapping(dimFields) {\n    let spec = {};\n    let visualElements = getVisualElements();\n    let fieldRankList = dimFields.map(field => {\n        return {\n            ...field,\n            choosen: false\n        };\n    });\n    const priority = [\n        ['quantitative', ['position', 'size', 'color', 'highFacets', 'opacity', 'page', 'filter']],\n        ['temporal', ['position', 'page', 'filter']],\n        ['ordinal', ['position', 'color', 'opacity', 'facets', 'size', 'page', 'filter', 'highFacets']],\n        ['nominal', ['position', 'color', 'facets', 'shape', 'page', 'filter', 'hightFacets']],\n    ];\n    let fieldLeft = fieldRankList.length;\n    for (let typeIndex = 0; typeIndex < priority.length && fieldLeft > 0; typeIndex++) {\n        let type = priority[typeIndex][0];\n        let channelList = priority[typeIndex][1];\n        for (let i = 0; i < channelList.length && fieldLeft > 0; i++) {\n            let channel = channelList[i];\n            let field;\n            while (visualElements[channel] > 0 && (field = findBestField(type, fieldRankList))) {\n                if (typeof spec[channel] === 'undefined') {\n                    spec[channel] = [];\n                }\n                spec[channel].push(field.name);\n                visualElements[channel]--;\n                fieldLeft--;\n                field.choosen = true;\n            }\n        }\n    }\n    return spec;\n}\n// todo (P1):\n// don't use dimScores: FieldImpurity.\n// it's a structure with redundency design.\nfunction specification(dimScores, aggData, dimensions, measures) {\n    let rankedFields = dimScores.sort((a, b) => a[1] - b[1]).map(dim => dim[3]);\n    let spec = aestheticMapping(rankedFields);\n    // todo: design a better rule for choosing geom type.\n    if (spec.position && spec.position.length === 2) {\n        if ((dimensions.includes(spec.position[0]) && measures.includes(spec.position[1])) ||\n            (dimensions.includes(spec.position[1]) && measures.includes(spec.position[0]))) {\n            const dimIndex = dimensions.includes(spec.position[0]) ? 0 : 1;\n            const dim = spec.position[dimIndex];\n            const mea = spec.position[(dimIndex + 1) % 2];\n            spec.position = [dim, mea];\n            const dimMembers = memberCount(aggData, dim);\n            spec.geomType = ['interval', 'line', 'area'].filter(geom => {\n                return dimMembers.length >= geomTypes[geom][0] && dimMembers.length <= geomTypes[geom][1];\n            });\n            let x = dimScores.find(dim => dim[0] === spec.position[0])[3];\n            let y = dimScores.find(dim => dim[0] === spec.position[1])[3];\n            if (x.type === 'nominal' || y.type === 'nominal') {\n                spec.geomType = ['interval'];\n            }\n        }\n        else {\n            // ['point', 'path', 'heatmap']\n            spec.geomType = ['point', 'density'].filter(geom => {\n                return aggData.length >= geomTypes[geom][0] && aggData.length <= geomTypes[geom][1];\n            });\n        }\n    }\n    return { schema: spec, aggData };\n}\nexport default specification;\n","/**\n *\n * @param matrix adjmatrix\n */\nfunction turnAdjMatrix2List(matrix) {\n    // only for the special matrix here(corelational matrix)\n    let edges = [];\n    for (let i = 0; i < matrix.length; i++) {\n        for (let j = i + 1; j < matrix[i].length; j++) {\n            edges.push([[i, j], Math.abs(matrix[i][j])]);\n        }\n    }\n    return edges;\n}\nfunction find(parents, n) {\n    return parents[n] === n ? n : parents[n] = find(parents, parents[n]);\n}\nfunction union(parents, n1, n2) {\n    let p1 = find(parents, n1);\n    let p2 = find(parents, n2);\n    parents[p1] = p2;\n    // I'm too tired. this is just a tmp lazy solution.... will be fixed later.\n    // may check and prove whether it's necessary.\n    find(parents, n1);\n    find(parents, n2);\n}\nfunction findWithEffect(parents, sizes, n) {\n    if (parents[n] === n) {\n        return n;\n    }\n    parents[n] = findWithEffect(parents, sizes, parents[n]);\n    sizes[n] = sizes[parents[n]];\n    return parents[n];\n}\nfunction unionWithEffect(parents, sizes, n1, n2) {\n    let p1 = findWithEffect(parents, sizes, n1);\n    let p2 = findWithEffect(parents, sizes, n2);\n    let size1 = sizes[p1];\n    let size2 = sizes[p2];\n    parents[p1] = p2;\n    sizes[p1] = sizes[p2] = size1 + size2;\n    findWithEffect(parents, sizes, n1);\n    findWithEffect(parents, sizes, n2);\n}\n/**\n * maxiumn spanning tree\n * @param matrix adjmatrix\n * @param groupNumber number of group generated by clustering\n */\nfunction kruskal(matrix, groupNumber, threshold = 0) {\n    const edges = turnAdjMatrix2List(matrix);\n    edges.sort((a, b) => b[1] - a[1]);\n    const parents = matrix.map((m, i) => i);\n    for (let edge of edges) {\n        if (find(parents, edge[0][0]) !== find(parents, edge[0][1])) {\n            union(parents, edge[0][0], edge[0][1]);\n        }\n        for (let i = 0; i < parents.length; i++) {\n            parents[i] = find(parents, i);\n        }\n        let set = new Set(parents);\n        if (set.size <= groupNumber || edge[1] < threshold) {\n            break;\n        }\n    }\n    let groups = new Map();\n    for (let i = 0; i < parents.length; i++) {\n        if (!groups.has(parents[i])) {\n            groups.set(parents[i], []);\n        }\n        groups.get(parents[i]).push(i);\n    }\n    return groups;\n}\n// todo: delete kruskal with limit size, use largest size to limit it(uncontrolled group number but better), need discuss.\n/**\n *\n * @param matrix\n * @param limitSize max size of each group\n */\nfunction kruskalWithLimitSize(matrix, limitSize) {\n    const edges = turnAdjMatrix2List(matrix);\n    edges.sort((a, b) => b[1] - a[1]);\n    const parents = matrix.map((m, i) => i);\n    const sizes = matrix.map(() => 1);\n    for (let edge of edges) {\n        if (findWithEffect(parents, sizes, edge[0][0]) !== findWithEffect(parents, sizes, edge[0][1])) {\n            if (sizes[edge[0][0]] + sizes[edge[0][1]] > limitSize) {\n                continue;\n            }\n            unionWithEffect(parents, sizes, edge[0][0], edge[0][1]);\n        }\n        for (let i = 0; i < parents.length; i++) {\n            parents[i] = findWithEffect(parents, sizes, i);\n        }\n        let set = new Set(parents);\n        if (set.size === 1) {\n            break;\n        }\n    }\n    let groups = new Map();\n    for (let i = 0; i < parents.length; i++) {\n        if (!groups.has(parents[i])) {\n            groups.set(parents[i], []);\n        }\n        groups.get(parents[i]).push(i);\n    }\n    return groups;\n}\nexport function kruskalMSTWithLimitSize(matrix, limitSize = 4) {\n    const edges = turnAdjMatrix2List(matrix);\n    edges.sort((a, b) => b[1] - a[1]);\n    const edgesInMST = [];\n    const parents = matrix.map((m, i) => i);\n    const cloneParents = matrix.map((m, i) => i);\n    const sizes = matrix.map(() => 1);\n    for (let edge of edges) {\n        if (findWithEffect(parents, sizes, edge[0][0]) !== findWithEffect(parents, sizes, edge[0][1])) {\n            if (sizes[edge[0][0]] + sizes[edge[0][1]] > limitSize) {\n                if (find(cloneParents, edge[0][0]) !== find(cloneParents, edge[0][1])) {\n                    edgesInMST.push([edge[0], edge[1], true]);\n                    union(cloneParents, edge[0][0], edge[0][1]);\n                }\n                continue;\n            }\n            unionWithEffect(parents, sizes, edge[0][0], edge[0][1]);\n            // fuck typescript\n            // edgesInMST.push([...edge, inCutEdge]);\n            edgesInMST.push([edge[0], edge[1], false]);\n        }\n        for (let i = 0; i < parents.length; i++) {\n            parents[i] = findWithEffect(parents, sizes, i);\n            cloneParents[i] = find(cloneParents, i);\n        }\n        let set = new Set(parents);\n        if (set.size === 1) {\n            break;\n        }\n    }\n    return { edgesInMST, groups: parents };\n}\n/**\n *\n * @param matrix\n * @param groupNumber number of group generated by clustering\n */\nexport function kruskalMST(matrix, groupNumber = 4, threshold = 0) {\n    const edges = turnAdjMatrix2List(matrix);\n    edges.sort((a, b) => b[1] - a[1]);\n    const edgesInMST = [];\n    const parents = matrix.map((m, i) => i);\n    let groups = [...parents];\n    let inCutEdge = false;\n    for (let edge of edges) {\n        if (find(parents, edge[0][0]) !== find(parents, edge[0][1])) {\n            union(parents, edge[0][0], edge[0][1]);\n            // fuck typescript\n            // edgesInMST.push([...edge, inCutEdge]);\n            edgesInMST.push([edge[0], edge[1], inCutEdge]);\n        }\n        for (let i = 0; i < parents.length; i++) {\n            parents[i] = find(parents, i);\n        }\n        let set = new Set(parents);\n        // TODO:\n        // + use kruskalMST instead of kruskal.\n        if (set.size <= groupNumber || edge[1] < threshold) {\n            inCutEdge = true;\n        }\n        else {\n            groups = [...parents];\n        }\n        if (set.size === 1) {\n            break;\n        }\n    }\n    return { edgesInMST, groups };\n}\nfunction cluster({ matrix, measures, method = 'kruskal', groupMaxSize = 4, limitSize = false, threshold = 0 }) {\n    // const groups = kruskal({ matrix, groupMaxSize });\n    let groups;\n    if (limitSize) {\n        groups = kruskalWithLimitSize(matrix, groupMaxSize);\n    }\n    else {\n        groups = kruskal(matrix, groupMaxSize, threshold);\n    }\n    let ans = [];\n    for (let meas of groups.values()) {\n        ans.push(meas.map(meaIndex => measures[meaIndex]));\n    }\n    return ans;\n}\nexport default cluster;\n","/**\n * todo reservoir sampling is better to support stream data\n * Algorithm R:\n * Vitter, Jeffrey S. (1 March 1985). \"Random sampling with a reservoir\" (PDF). ACM Transactions on Mathematical Software. 11 (1): 37–57. CiteSeerX 10.1.1.138.784. doi:10.1145/3147.3165.\n */\nexport function reservoirSampling(dataSource, size = 500) {\n    if (dataSource.length <= size)\n        return dataSource;\n    let sampleSpace = dataSource.slice(0, size);\n    let len = dataSource.length;\n    for (let i = size + 1; i < len; i++) {\n        let pos = Math.round(Math.random() * i);\n        if (pos < size) {\n            sampleSpace[pos] = dataSource[i];\n        }\n    }\n    return sampleSpace;\n}\nfunction linearCongruentialGenerator(size, seed) {\n    if (size === 0)\n        return [];\n    const m = 2147483647;\n    const a = 1103515245;\n    const c = 12345;\n    let ans = [seed];\n    for (let i = 1; i < size; i++) {\n        ans.push(((ans[i - 1] * a + c) % m));\n    }\n    return ans.map(v => v / m);\n}\nexport function uniformSampling(dataSource, size) {\n    let sampleIndexes = linearCongruentialGenerator(size, Math.random() * 2147483647);\n    let ans = [];\n    for (let i = 0; i < size; i++) {\n        let index = Math.floor(sampleIndexes[i] * size) % size;\n        ans.push(dataSource[index]);\n    }\n    return ans;\n}\n","import { getMeaSetsBasedOnClusterGroups, getDimClusterGroups } from './subspaces';\nimport { CrammersVThreshold, PearsonCorrelation } from './config';\nimport { Outier } from '../ml/index';\nimport { getCombination, linearMapPositive } from '../statistics/index';\nimport { CHANNEL } from '../constant';\nimport { entropy, normalize } from '../statistics/index';\nimport aggregate from 'cube-core';\nimport { oneDLinearRegression } from '../statistics/index';\nimport { GroupIntention } from \"./intention/groups\";\nconst SPLITER = '=;=';\nfunction crossGroups(dimensionGroups, measureGroups) {\n    let viewSpaces = [];\n    for (let dimensions of dimensionGroups) {\n        for (let measures of measureGroups) {\n            viewSpaces.push({\n                dimensions,\n                measures\n            });\n        }\n    }\n    return viewSpaces;\n}\nfunction getDimSetsFromClusterGroups(groups) {\n    let dimSets = [];\n    for (let group of groups) {\n        let combineDimSet = getCombination(group, 1, CHANNEL.maxDimensionNumber);\n        dimSets.push(...combineDimSet);\n    }\n    return dimSets;\n}\nfunction getCombinationFromClusterGroups(groups, limitSize = CHANNEL.maxDimensionNumber) {\n    let fieldSets = [];\n    for (let group of groups) {\n        let combineFieldSet = getCombination(group, 1, limitSize);\n        fieldSets.push(...combineFieldSet);\n    }\n    return fieldSets;\n}\nexport const getGeneralIntentionSpace = async function (aggData, dimensions, measures) {\n    let score = 0;\n    let significance = 0;\n    for (let mea of measures) {\n        let fL = aggData.map(r => r[mea]);\n        let pL = normalize(linearMapPositive(fL));\n        let value = entropy(pL);\n        score += value;\n        significance += value / Math.log2(fL.length);\n    }\n    score /= measures.length;\n    significance /= measures.length;\n    significance = 1 - significance;\n    return {\n        dimensions,\n        measures,\n        type: 'default_general',\n        score,\n        impurity: score,\n        significance,\n        order: 'asc'\n    };\n};\nexport const getOutlierIntentionSpace = async function getOutlierIntentionSpace(aggData, dimensions, measures) {\n    let iForest = new Outier.IsolationForest([], measures, aggData);\n    iForest.buildIsolationForest();\n    let scoreList = iForest.estimateOutierScore();\n    let maxIndex = 0;\n    let score = 0;\n    for (let i = 0; i < scoreList.length; i++) {\n        if (scoreList[i] > score) {\n            score = scoreList[i];\n            maxIndex = i;\n        }\n    }\n    let des = {};\n    dimensions.concat(measures).forEach(mea => { des[mea] = aggData[maxIndex][mea]; });\n    return {\n        dimensions,\n        measures,\n        score,\n        significance: score,\n        order: 'desc',\n        description: des\n    };\n};\nexport const getTrendIntentionSpace = async function (aggData, dimensions, measures) {\n    if (dimensions.length !== 1)\n        return null;\n    let orderedData = [...aggData];\n    orderedData.sort((a, b) => {\n        if (a[dimensions[0]] > b[dimensions[0]])\n            return 1;\n        if (a[dimensions[0]] === b[dimensions[0]])\n            return 0;\n        if (a[dimensions[0]] < b[dimensions[0]])\n            return -1;\n    });\n    let score = 0;\n    for (let mea of measures) {\n        let linearModel = new oneDLinearRegression(orderedData, dimensions[0], mea);\n        linearModel.normalizeDimensions(dimensions);\n        score += linearModel.significance();\n    }\n    score /= measures.length;\n    return {\n        dimensions,\n        measures,\n        score,\n        significance: score,\n        order: 'desc'\n    };\n};\nexport const getGroupIntentionSpace = async function (aggData, dimensions, measures) {\n    if (dimensions.length < 2)\n        return null;\n    let score = 0;\n    let groupIntention = new GroupIntention({\n        dataSource: aggData,\n        dimensions,\n        measures,\n        K: 8\n    });\n    score = groupIntention.getSignificance(measures.concat(dimensions.slice(0, -1)), dimensions.slice(-1));\n    return {\n        dimensions,\n        measures,\n        score,\n        significance: score,\n        order: 'desc'\n    };\n};\n// export const IntentionWorkerCollection: Map<string, IntentionWorker> = new Map();\nexport var DefaultIWorker;\n(function (DefaultIWorker) {\n    DefaultIWorker[\"outlier\"] = \"default_outlier\";\n    DefaultIWorker[\"cluster\"] = \"default_group\";\n    DefaultIWorker[\"trend\"] = \"default_trend\";\n})(DefaultIWorker || (DefaultIWorker = {}));\nexport class IntentionWorkerCollection {\n    constructor() {\n        this.workers = new Map();\n    }\n    register(name, iWorker) {\n        if (this.workers.has(name)) {\n            throw new Error(`There has been a worker named: ${name} already.`);\n        }\n        else {\n            this.workers.set(name, [true, iWorker]);\n        }\n    }\n    enable(name, status) {\n        if (!this.workers.has(name)) {\n            throw new Error(`Intention Worker \"${name}\" does not exist.`);\n        }\n        else {\n            let iWorkerWithStatus = this.workers.get(name);\n            iWorkerWithStatus[0] = status;\n            this.workers.set(name, iWorkerWithStatus);\n        }\n    }\n    each(func) {\n        for (let [name, iWorker] of this.workers) {\n            if (iWorker[0]) {\n                func(iWorker[1], name);\n            }\n        }\n    }\n    static init(props = { withDefaultIWorkers: true }) {\n        const { withDefaultIWorkers = true } = props;\n        if (!IntentionWorkerCollection.colletion) {\n            IntentionWorkerCollection.colletion = new IntentionWorkerCollection();\n            if (withDefaultIWorkers) {\n                IntentionWorkerCollection.colletion.register(DefaultIWorker.outlier, getOutlierIntentionSpace);\n                IntentionWorkerCollection.colletion.register(DefaultIWorker.cluster, getGroupIntentionSpace);\n                IntentionWorkerCollection.colletion.register(DefaultIWorker.trend, getTrendIntentionSpace);\n            }\n        }\n        for (let key in DefaultIWorker) {\n            IntentionWorkerCollection.colletion.enable(DefaultIWorker[key], withDefaultIWorkers);\n        }\n        return IntentionWorkerCollection.colletion;\n    }\n}\nexport async function getIntentionSpaces(cubePool, viewSpaces, Collection) {\n    let ansSpace = [];\n    for (let space of viewSpaces) {\n        const { dimensions, measures } = space;\n        let key = dimensions.join(SPLITER);\n        if (cubePool.has(key)) {\n            let aggData = cubePool.get(key);\n            let generalSpace = await getGeneralIntentionSpace(aggData, dimensions, measures);\n            Collection.each(async (iWorker, name) => {\n                let iSpace = await iWorker(aggData, dimensions, measures);\n                if (iSpace !== null) {\n                    iSpace.type = name;\n                    iSpace.impurity = generalSpace.impurity;\n                    ansSpace.push(iSpace);\n                }\n            });\n        }\n    }\n    return ansSpace;\n}\nexport async function getVisSpaces(props) {\n    const { dataSource, dimensions, measures, collection, dimension_correlation_threshold = CrammersVThreshold, measure_correlation_threshold = PearsonCorrelation.strong, max_dimension_num_in_view = 3, max_measure_num_in_view = 3, } = props;\n    // 1. get dimension cluster groups.\n    // 2. get measure cluster groups.\n    // 3. get dimension groups * measure groups = subspaces + aggregate\n    // 4. calculate each subspace intention score (entropy, outlier, trend for temporal & oridinal field)\n    // 5. filter each intend subspaces with threadshold\n    // 6.manage those spaces / order them.\n    let visableDimensions = dimensions; //.filter(dim => !isFieldUnique(dataSource, dim));\n    let dimensionGroups = getDimClusterGroups(dataSource, visableDimensions, dimension_correlation_threshold);\n    // let dimensionSets = getDimSetsFromClusterGroups(dimensionGroups);\n    let dimensionSets = getCombinationFromClusterGroups(dimensionGroups, max_dimension_num_in_view);\n    let measureGroups = getMeaSetsBasedOnClusterGroups(dataSource, measures, measure_correlation_threshold);\n    let measureSets = getCombinationFromClusterGroups(measureGroups, max_measure_num_in_view);\n    let viewSpaces = crossGroups(dimensionSets, measureSets);\n    let cubePool = new Map();\n    // for (let group of dimensionGroups) {\n    // todo: similar cuboids computation using cube-core\n    let t0 = new Date().getTime();\n    for (let group of dimensionSets) {\n        let key = group.join(SPLITER);\n        let aggData = aggregate({\n            dataSource,\n            dimensions: group,\n            measures,\n            asFields: measures,\n            operator: 'sum'\n        });\n        cubePool.set(key, aggData);\n    }\n    let t1 = new Date().getTime();\n    console.log('cube cost', t1 - t0);\n    cubePool.set('*', dataSource);\n    const usedCollection = collection || IntentionWorkerCollection.init();\n    ;\n    // usedCollection.enable(DefaultIWorker.cluster, false);\n    let ansSpace = await getIntentionSpaces(cubePool, viewSpaces, usedCollection);\n    return ansSpace;\n}\n","import { deepcopy, isFieldNumeric, memberCount } from '../utils/index';\nfunction dropNullColumn(dataSource, fields) {\n    let keepFields = fields.map(() => false);\n    for (let record of dataSource) {\n        for (let i = 0; i < fields.length; i++) {\n            let field = fields[i];\n            if (typeof record[field] !== 'undefined' && record[field] !== '' && record[field] !== null) {\n                keepFields[i] = true;\n            }\n        }\n    }\n    let finalFields = fields.filter((field, index) => {\n        return keepFields[index];\n    });\n    return {\n        fields: finalFields,\n        dataSource: dataSource.map(record => {\n            let ans = {};\n            for (let field of finalFields) {\n                ans[field] = record[field];\n            }\n            return ans;\n        })\n    };\n}\nfunction dropNull(dataSource, dimensions, measures) {\n    let data = [];\n    for (let record of dataSource) {\n        let keep = true;\n        for (let dim of dimensions) {\n            if (typeof record[dim] === 'undefined' || record[dim] === '' || record[dim] === null) {\n                keep = false;\n            }\n        }\n        for (let mea of measures) {\n            if (typeof record[mea] !== 'number') {\n                keep = false;\n            }\n        }\n        if (keep) {\n            data.push(record);\n        }\n    }\n    for (let dim of dimensions) {\n        if (isFieldNumeric(data, dim)) {\n            let members = memberCount(data, dim);\n            if (members.length > 20) {\n                data.forEach(record => {\n                    record[dim] = Number(record[dim]) || 0;\n                });\n            }\n            else {\n                data.forEach(record => {\n                    record[dim] = (Number(record[dim]) || 0).toString();\n                });\n            }\n        }\n    }\n    return data;\n}\nfunction isNullValue(value) {\n    return ['', null, undefined].includes(value);\n}\n/**\n * use mode of one field to replace its null value\n * @param dataSource\n * @param fieldNames name list of fields you want to clean with useMode function.\n * problem: some field may regard the null value as the most common value... sad : (.\n * I am dead.\n */\nfunction useMode(dataSource, fieldNames) {\n    /**\n     * map to count each member's times of apperance in fields.\n     */\n    const countMap = new Map();\n    /**\n     * map to get the mode member of each field.\n     */\n    const modeMap = new Map();\n    for (let fieldName of fieldNames) {\n        countMap.set(fieldName, new Map());\n        modeMap.set(fieldName, 0);\n    }\n    for (let record of dataSource) {\n        for (let fieldName of fieldNames) {\n            let counter = countMap.get(fieldName);\n            if (!isNullValue(record[fieldName])) {\n                if (!counter.has(record[fieldName])) {\n                    counter.set(record[fieldName], 0);\n                }\n                counter.set(record[fieldName], counter.get(record[fieldName]) + 1);\n            }\n        }\n    }\n    for (let key of countMap.keys()) {\n        let counter = countMap.get(key);\n        let members = [...counter.entries()];\n        let max = 0;\n        let maxPos = 0;\n        for (let i = 0; i < members.length; i++) {\n            let member = members[i];\n            if (member[1] > max) {\n                max = member[1];\n                maxPos = i;\n            }\n        }\n        modeMap.set(key, members[maxPos][0]);\n    }\n    const newDataSource = deepcopy(dataSource);\n    for (let record of newDataSource) {\n        for (let fieldName of fieldNames) {\n            if (isNullValue(record[fieldName])) {\n                record[fieldName] = modeMap.get(fieldName);\n            }\n        }\n    }\n    return newDataSource;\n}\nfunction simpleClean(dataSource, dimensions, measures) {\n    const newDataSource = deepcopy(dataSource);\n    for (let record of dataSource) {\n        for (let dim of dimensions) {\n            if (isNullValue(record[dim])) {\n                record[dim] = 'null';\n            }\n        }\n        for (let mea of measures) {\n            if (isNullValue(record[mea])) {\n                record[mea] = 0;\n            }\n        }\n    }\n    return newDataSource;\n}\nexport { simpleClean, dropNull, useMode, dropNullColumn };\n","import React, { useMemo, useState } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport { Subspace } from '../../service';\nimport { DefaultButton, TeachingBubble, DirectionalHint } from 'office-ui-fabric-react';\n\nimport './index.css';\nimport { Field } from '../../global';\nimport { Specification } from '../../visBuilder/vegaBase';\n\ninterface StoryTellerProps {\n  lang?: 'zh' | 'en';\n  dimScores: Array<[string, number, number, Field]>;\n  space: Subspace;\n  spaceList: Subspace[];\n  dimensions: string[];\n  measures: string[];\n  schema: Specification\n}\n\nconst StoryTeller: React.FC<StoryTellerProps> = (props) => {\n  const { space, dimensions = [], measures = [], dimScores = [], spaceList = [], schema } = props;\n  const [isTeachingBubbleVisible, setIsTeachingBubbleVisible] = useState(false);\n\n  const sortedFieldsScores = useMemo<Array<[string, number, number, Field]>>(() => {\n    return [...dimScores].sort((a, b) => a[1] - b[1]);\n  }, [dimScores])\n  const mostInfluencedDimension = useMemo<string | undefined>(() => {\n    if (typeof space === 'undefined') return;\n    for (let sp of spaceList) {\n      if (sp.dimensions.some(dim => {\n        return space.dimensions.includes(dim)\n      })) {\n        return sp.dimensions.find(dim => {\n          return space.dimensions.includes(dim)\n        })\n      }\n    }\n  }, [space, spaceList])\n  const bestMeasure = useMemo<string | undefined>(() => {\n    if (typeof space === 'undefined') return;\n    const measuresInView = space.measures.filter(mea => measures.includes(mea.name));\n    let min = Infinity;\n    let minPos = 0;\n    for (let i = 0; i < measuresInView.length; i++) {\n      if (measuresInView[i].value < min) {\n        min = measuresInView[i].value;\n        minPos = i;\n      }\n    }\n    return measuresInView[minPos].name;\n  }, [measures, space])\n\n  const countDiffField = useMemo<string | undefined>(() => {\n    let ans = sortedFieldsScores.find(dim => dimensions.includes(dim[0]));\n    return ans ? ans[0] : undefined;\n  }, [sortedFieldsScores, dimensions])\n  const result = `\n  ${ schema && schema.position ? `Current chart mainly focus on the relationship between ***${schema.position[0]}*** and ***${schema.position[1]}***` : ''}\n  ${ dimensions.length > 1 ? `+ DataSource is grouped by ***${dimensions.join(', ')}***, measures(indicators) will propose strong difference of distribution between each other.` : '' }\n  ${ measures.length > 1 ? `+ ***${measures.join(', ')}***are strongly related to each other` : '' }\n  ${ countDiffField ? `+ The distribution of member countings of ***${countDiffField}*** seems to contain more orders and patterns.` : '' }\n  ${ mostInfluencedDimension ? `+ ***${mostInfluencedDimension}*** has great influence on aggregated measure values.` : '' }\n  ${ bestMeasure ? `+ ***${bestMeasure}*** is more likely to have patterns according to its distribution.` : '' }\n  \\`\\`\\\n  `\n  return (\n    <div>\n      <DefaultButton id=\"vis-summary\" text=\"Summary\" onClick={() => { setIsTeachingBubbleVisible(true) }} />\n      {isTeachingBubbleVisible ? (\n          <div>\n            <TeachingBubble\n              calloutProps={{ directionalHint: DirectionalHint.bottomCenter }}\n              isWide={true}\n              hasCloseIcon={true}\n              closeButtonAriaLabel=\"Close\"\n              target={'#vis-summary'}\n              onDismiss={() => { setIsTeachingBubbleVisible(false) }}\n              headline=\"Chart Description\"\n            >\n              <ReactMarkdown source={result} />\n            </TeachingBubble>\n          </div>\n        ) : null}\n    </div>\n  )\n}\n\nexport default StoryTeller","import React, { useMemo } from 'react';\nimport ReactMarkdown from 'react-markdown';\nimport { Subspace } from '../../service';\n\nimport './index.css';\nimport { Field } from '../../global';\nimport { Specification } from '../../visBuilder/vegaBase';\n\ninterface VisDescriptionProps {\n  lang?: 'zh' | 'en';\n  dimScores: Array<[string, number, number, Field]>;\n  space: Subspace;\n  spaceList: Subspace[];\n  dimensions: string[];\n  measures: string[];\n  schema: Specification\n}\n\nconst VisDescription: React.FC<VisDescriptionProps> = (props) => {\n  const { space, dimensions = [], measures = [], dimScores = [], spaceList = [], schema } = props;\n\n  const sortedFieldsScores = useMemo<Array<[string, number, number, Field]>>(() => {\n    return [...dimScores].sort((a, b) => a[1] - b[1]);\n  }, [dimScores])\n  const mostInfluencedDimension = useMemo<string | undefined>(() => {\n    if (typeof space === 'undefined') return;\n    for (let sp of spaceList) {\n      if (sp.dimensions.some(dim => {\n        return space.dimensions.includes(dim)\n      })) {\n        return sp.dimensions.find(dim => {\n          return space.dimensions.includes(dim)\n        })\n      }\n    }\n  }, [space, spaceList])\n  const bestMeasure = useMemo<string | undefined>(() => {\n    if (typeof space === 'undefined') return;\n    const measuresInView = space.measures.filter(mea => measures.includes(mea.name));\n    let min = Infinity;\n    let minPos = 0;\n    for (let i = 0; i < measuresInView.length; i++) {\n      if (measuresInView[i].value < min) {\n        min = measuresInView[i].value;\n        minPos = i;\n      }\n    }\n    return measuresInView[minPos].name;\n  }, [measures, space])\n\n  const countDiffField = useMemo<string | undefined>(() => {\n    let ans = sortedFieldsScores.find(dim => dimensions.includes(dim[0]));\n    return ans ? ans[0] : undefined;\n  }, [sortedFieldsScores, dimensions])\n  const result = `\n  ${ schema && schema.position ? `Current chart mainly focus on the relationship between ***${schema.position[0]}*** and ***${schema.position[1]}***` : ''}\n  ${ dimensions.length > 1 ? `+ DataSource is grouped by ***${dimensions.join(', ')}***, measures(indicators) will propose strong difference of distribution between each other.` : '' }\n  ${ measures.length > 1 ? `+ ***${measures.join(', ')}***are strongly related to each other` : '' }\n  ${ countDiffField ? `+ The distribution of member countings of ***${countDiffField}*** seems to contain more orders and patterns.` : '' }\n  ${ mostInfluencedDimension ? `+ ***${mostInfluencedDimension}*** has great influence on aggregated measure values.` : '' }\n  ${ bestMeasure ? `+ ***${bestMeasure}*** is more likely to have patterns according to its distribution.` : '' }\n  \\`\\`\\\n  `\n  return (\n    <ReactMarkdown source={result} />\n  )\n}\n\nexport default VisDescription","import { useMemo } from 'react';\nimport { ViewSpace } from '../../../service';\nimport { Field, DataSource } from '../../../global';\nimport { specification } from 'visual-insights';\nimport { PreferencePanelConfig } from '../../../components/preference';\nconst similarityThrehold = 0.2;\nconst topKRelatedSpace = 5;\n\nfunction measuresRelatedScore (measures1: string[], measures2: string[]) {\n  let meaSet = new Set([...measures1, ...measures2])\n  let meaSet1 = new Set(measures1)\n  let meaSet2 = new Set(measures2)\n  let meaVec1: number[] = [];\n  let meaVec2: number[] = [];\n  for (let mea of meaSet) {\n    meaVec1.push(Number(meaSet1.has(mea)))\n    meaVec2.push(Number(meaSet2.has(mea)))\n  }\n  let score = 0;\n  for (let i = 0; i < meaVec1.length; i++) {\n    score += meaVec1[i] * meaVec2[i];\n  }\n  score /= (Math.sqrt(measures1.length) * Math.sqrt(measures2.length))\n  // console.log(measures1, measures2, score)\n  return score;\n}\ninterface RelatedViewSpace extends ViewSpace {\n  relatedScore: number;\n}\nexport interface DigDimensionProps {\n  /**\n   * we suppose that viewSpaces here is a ranked space list\n   */\n  viewSpaces: ViewSpace[];\n  interestedViewSpace: ViewSpace;\n  fieldScores: Array<[string, number, number, Field]>;\n  dataSource: DataSource;\n  visualConfig: PreferencePanelConfig\n}\n\nfunction useDigDimension(props: DigDimensionProps) {\n  const { viewSpaces, interestedViewSpace, fieldScores, dataSource } = props;\n  const relatedSpaces = useMemo<ViewSpace[]>(() => {\n    let ans: ViewSpace[] = []\n    for (let space of viewSpaces) {\n      if (space.dimensions.length > interestedViewSpace.dimensions.length && space.dimensions.length - interestedViewSpace.dimensions.length <= 2) {\n        let isSubset = interestedViewSpace.dimensions.every(subDim => {\n          return space.dimensions.find(dim => subDim === dim)\n        })\n        if (isSubset) {\n          ans.push(space)\n        }\n      }\n    }\n    return ans;\n  }, [interestedViewSpace, viewSpaces])\n  const rankedRelatedSpaces = useMemo(() => {\n    let ans: RelatedViewSpace[] = [];\n    for (let space of relatedSpaces) {\n      let measureSimilarity = measuresRelatedScore(interestedViewSpace.measures, space.measures);\n      if (measureSimilarity > similarityThrehold) {\n        // console.log({ measureSimilarity })\n        ans.push({\n          ...space,\n          relatedScore: space.score / Math.sqrt(measureSimilarity)\n        })\n      }\n    }\n    return ans.sort((a, b) => a.relatedScore - b.relatedScore);\n  }, [relatedSpaces, interestedViewSpace.measures]);\n\n  const viewList = useMemo(() => {\n    const ans = rankedRelatedSpaces.slice(0, topKRelatedSpace).map(space => {\n      let spaceFieldScores = fieldScores.filter(field => {\n        return space.dimensions.includes(field[0]) || space.measures.includes(field[0])\n      })\n      return {\n        ...space,\n        schema: specification(spaceFieldScores, dataSource, space.dimensions, space.measures).schema\n      };\n    })\n    return ans;\n  }, [rankedRelatedSpaces, fieldScores, dataSource])\n\n  return viewList\n}\n\nexport default useDigDimension;\n","import React from \"react\";\nimport VisDescription from \"../../../plugins/visSummary/description\";\nimport useDigDimension, { DigDimensionProps } from \"./digDimension\";\nimport BaseChart from \"../../../visBuilder/vegaBase\";\nimport { Subspace } from \"../../../service\";\nimport { IconButton, Stack } from \"office-ui-fabric-react\";\n\nfunction isDimensionEqual(dimensions1: string[], dimensions2: string[]) {\n  if (dimensions1.length !== dimensions2.length) {\n    return false;\n  }\n  return dimensions1.every(dim1 => {\n    return dimensions2.includes(dim1);\n  });\n}\ninterface AssociationProps {\n  digDimensionProps: DigDimensionProps;\n  subspaceList: Subspace[];\n  onSelectView: (index: number) => void\n}\nconst Association: React.FC<AssociationProps> = props => {\n  const { digDimensionProps, subspaceList, onSelectView } = props;\n  const { dataSource, visualConfig, fieldScores } = digDimensionProps;\n  const relatedCharts = useDigDimension(digDimensionProps);\n  const fieldFeatures = fieldScores.map(f => f[3]);\n  return (\n    <div>\n      <div className=\"ms-Grid\">\n        {relatedCharts.map((view, i) => {\n          let currentSpace = subspaceList.find(space => {\n            return isDimensionEqual(space.dimensions, view.dimensions);\n          });\n          return (\n            <div key={`associate-row-${i}`}\n              className=\"ms-Grid-row\"\n              style={{\n                border: \"solid 1px #bfbfbf\",\n                margin: \"1em\",\n                padding: \"1em\"\n              }}\n            >\n              <div\n                className=\"ms-Grid-col ms-sm6 ms-md8 ms-lg9\"\n                style={{ overflow: 'auto' }}\n              >\n                <BaseChart\n                  aggregator={visualConfig.aggregator}\n                  defaultAggregated={view.schema.geomType && view.schema.geomType.includes(\"point\") ? false : true}\n                  defaultStack={visualConfig.defaultStack}\n                  dimensions={view.dimensions}\n                  measures={view.measures}\n                  dataSource={dataSource}\n                  schema={view.schema}\n                  fieldFeatures={fieldFeatures}\n                />\n              </div>\n              <div\n                className=\"ms-Grid-col ms-sm6 ms-md4 ms-lg3\"\n                style={{ fontSize: 14, color: \"#8a8886\", overflow: \"auto\" }}\n              >\n                <div>\n                  \n                  <Stack tokens={{ childrenGap: 8 }} horizontal>\n                    <IconButton iconProps={{ iconName: 'Lightbulb' }} title=\"Interested\" onClick={() => {\n                      onSelectView(view.index)\n                    }} />\n                  </Stack>\n                </div>\n                {currentSpace && (\n                  <VisDescription\n                    dimensions={view.dimensions}\n                    measures={view.measures}\n                    dimScores={fieldScores}\n                    space={currentSpace}\n                    spaceList={subspaceList}\n                    schema={view.schema}\n                  />\n                )}\n              </div>\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n};\n\nexport default Association;\n","import React, { useState, useEffect, useMemo } from 'react';\nimport { SearchBox } from 'office-ui-fabric-react';\nimport { useGlobalState } from '../../../state';\nimport Fuse, { FuseOptions } from 'fuse.js';\nimport { specification } from 'visual-insights';\nimport { ViewSpace } from '../../../service';\nimport BaseChart from \"../../../visBuilder/vegaBase\";\nimport styled from 'styled-components';\n\nconst VisCard = styled.div`\n  padding: 1rem;\n  overflow-x: auto;\n  margin: 1rem;\n`\n\nconst PageLinkButton = styled.a`\n  margin-right: 1rem;\n  cursor: pointer;\n  color: rgb(16, 110, 190);\n`\n\nconst PAGE_SIZE = 4;\nconst PAGE_OFFSET = 2;\n\nfunction usePageController (size: number) {\n  const [currentPage, setCurrentPage] = useState(0);\n\n  useEffect(() => {\n    setCurrentPage(0)\n  }, [size])\n  const maxPageNumber = Math.ceil(size / PAGE_SIZE);\n  const gotoPage = (num: number) => {\n    let fixPageNum = (num + maxPageNumber) % maxPageNumber;\n    setCurrentPage(fixPageNum)\n  }\n\n  const lastPage = () => {\n    setCurrentPage(p => (p + maxPageNumber - 1) % maxPageNumber)\n  }\n  const nextPage = () => {\n    setCurrentPage(p => (p + maxPageNumber + 1) % maxPageNumber)\n  }\n  const minVisPage = Math.max(currentPage - PAGE_OFFSET, 0);\n  const maxVisPage = Math.min(currentPage + PAGE_OFFSET, maxPageNumber);\n  const itemRange = useMemo(() => {\n    return [currentPage * PAGE_SIZE, Math.min((currentPage + 1) * PAGE_SIZE, size)]\n  }, [size, currentPage])\n  const visPageRange = [...new Array(maxVisPage - minVisPage + 1)].map((n, i) => minVisPage + i)\n  return {\n    currentPage,\n    visPageRange,\n    itemRange,\n    gotoPage,\n    lastPage,\n    nextPage\n  }\n}\n\nconst SearchPage: React.FC = props => {\n  const [state, , dispatch, getters] = useGlobalState();\n  const [targetViewSpaces, setTargetViewSpaces] = useState<ViewSpace[]>([]);\n  const { subspaceList, viewSpaces, maxGroupNumber, useServer } = state;\n  const { dimScores } = getters;\n\n  useEffect(() => {\n    dispatch('getViewSpaces', {\n      subspaceList,\n      maxGroupNumber,\n      useServer\n    })\n  }, [subspaceList, maxGroupNumber, useServer, dispatch])\n\n  const fuse = useMemo(() => {\n    const options: FuseOptions<ViewSpace> = {\n      keys: [\n        'dimensions',\n        'measures'\n      ]\n    }\n    return new Fuse(viewSpaces, options)\n  }, [viewSpaces])\n  const searchHandler = (newValue: string) => {\n    const result: any[] = fuse.search(newValue)\n    setTargetViewSpaces(result);\n  }\n\n  const {  currentPage, visPageRange, itemRange, gotoPage, lastPage, nextPage } = usePageController(targetViewSpaces.length);\n\n  const specList = useMemo(() => {\n    return targetViewSpaces.slice(itemRange[0], itemRange[1]).map(space => {\n      const { dimensions, measures } = space;\n      const fieldScores = dimScores.filter(field => {\n        return dimensions.includes(field[0]) || measures.includes(field[0]);\n      });\n      let { schema } = specification(\n        fieldScores,\n        state.cookedDataSource,\n        dimensions,\n        measures\n      );\n      return {\n        schema,\n        fieldFeatures: fieldScores.map(f => f[3]),\n        aggData: state.cookedDataSource,\n        dimensions,\n        measures\n      }\n    })\n  }, [state.cookedDataSource, targetViewSpaces, itemRange, dimScores])\n  \n  return (\n    <div>\n      <SearchBox\n        placeholder=\"Search\"\n        onSearch={searchHandler}\n        underlined={true}\n      />\n      <p className=\"state-description\">{targetViewSpaces.length} results are found. current page is {currentPage + 1}</p>\n      <div>\n        <PageLinkButton onClick={lastPage}>Last Page</PageLinkButton>\n        {\n          targetViewSpaces.length > 0 && visPageRange.map(n => <PageLinkButton key={`page-btn-${n}`} onClick={() => { gotoPage(n) }}>{ n + 1 }</PageLinkButton>)\n        }\n        <PageLinkButton onClick={nextPage}>Next Page</PageLinkButton>\n      </div>\n      <div>\n        {specList.map((spec, index) => (\n          <VisCard key={`result-${index}`}>\n            <BaseChart\n              aggregator={\"sum\"}\n              defaultAggregated={true}\n              defaultStack={true}\n              dimensions={spec.dimensions}\n              measures={spec.measures}\n              dataSource={spec.aggData}\n              schema={spec.schema}\n              fieldFeatures={spec.fieldFeatures}\n            />\n          </VisCard>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nexport default SearchPage\n","import React, { useEffect, useState, useMemo } from \"react\";\nimport {\n  DefaultButton,\n  IconButton,\n  Stack,\n  ProgressIndicator,\n  SpinButton,\n  Pivot,\n  PivotItem\n} from \"office-ui-fabric-react\";\nimport { Position } from \"office-ui-fabric-react/lib/utilities/positioning\";\nimport PreferencePanel, {\n  PreferencePanelConfig\n} from \"../../components/preference\";\nimport { useComposeState } from \"../../utils/index\";\nimport BaseChart, { Specification } from \"../../visBuilder/vegaBase\";\nimport { DataSource, Field } from \"../../global\";\nimport { specification } from \"visual-insights\";\nimport VisSummary from \"../../plugins/visSummary/index\";\nimport { useGlobalState } from \"../../state\";\nimport Association from \"./association/index\";\nimport {\n  Subspace,\n  clusterMeasures,\n  ViewSpace,\n  FieldSummary\n} from \"../../service\";\nimport SearchBoard from \"./search/index\";\n\nconst pivotList = [\n  'Rank List',\n  'Search'\n].map((page, index) => {\n  return { title: page, itemKey: 'pivot-' + index}\n});\n\ninterface PageStatus {\n  show: {\n    insightBoard: boolean;\n    configPanel: boolean;\n    fieldConfig: boolean;\n    dataConfig: boolean;\n  };\n}\ninterface DataView {\n  schema: Specification;\n  aggData: DataSource;\n  fieldFeatures: Field[];\n  dimensions: string[];\n  measures: string[];\n}\n\ninterface GalleryProps {\n  subspaceList: Subspace[];\n  /**\n   * dataSource here should be cookedData.\n   */\n  dataSource: DataSource;\n  summary: {\n    origin: FieldSummary[];\n    grouped: FieldSummary[];\n  };\n}\n\nconst Gallery: React.FC<GalleryProps> = props => {\n  const { dataSource, summary, subspaceList } = props;\n  const [currentPage, setCurrentPage] = useState(0);\n  const [pivotIndex, setPivotIndex] = useState(pivotList[0].itemKey);\n  const [state, updateState] = useGlobalState();\n  const [pageStatus, setPageStatus] = useComposeState<PageStatus>({\n    show: {\n      insightBoard: false,\n      fieldConfig: false,\n      configPanel: false,\n      dataConfig: false\n    }\n  });\n  const [showAssociation, setShowAssociation] = useState(false);\n  const [visualConfig, setVisualConfig] = useState<PreferencePanelConfig>({\n    aggregator: \"sum\",\n    defaultAggregated: true,\n    defaultStack: true\n  });\n  const [viewSpaces, setViewSpaces] = useState<ViewSpace[]>([]);\n\n  const [dataView, setDataView] = useState<DataView>({\n    schema: {\n      position: [],\n      color: [],\n      opacity: [],\n      geomType: []\n    },\n    fieldFeatures: [],\n    aggData: [],\n    dimensions: [],\n    measures: []\n  });\n\n  const gotoPage = (pageNo: number) => {\n    setCurrentPage(pageNo);\n  };\n\n  useEffect(() => {\n    updateState(draft => {\n      draft.loading.gallery = true;\n    });\n    // todo:\n    // should group number be the same for different subspaces?\n    clusterMeasures(\n      state.maxGroupNumber,\n      subspaceList.map(space => {\n        return {\n          dimensions: space.dimensions,\n          measures: space.measures,\n          matrix: space.correlationMatrix\n        };\n      }),\n      state.useServer\n    ).then(viewSpaces => {\n      setViewSpaces(viewSpaces);\n      updateState(draft => {\n        draft.loading.gallery = false;\n      });\n    });\n  }, [subspaceList, dataSource, state.maxGroupNumber, state.useServer, updateState]);\n\n  const dimScores = useMemo<[string, number, number, Field][]>(() => {\n    return [...summary.origin, ...summary.grouped].map(field => {\n      return [\n        field.fieldName,\n        field.entropy,\n        field.maxEntropy,\n        { name: field.fieldName, type: field.type }\n      ];\n    });\n  }, [summary.origin, summary.grouped]);\n\n  useEffect(() => {\n    const viewState = viewSpaces[currentPage];\n    if (viewState) {\n      const { dimensions, measures } = viewState;\n      try {\n        // todo: find the strict confition instead of using try catch\n        const fieldScores = dimScores.filter(field => {\n          return dimensions.includes(field[0]) || measures.includes(field[0]);\n        });\n        const { schema } = specification(\n          fieldScores,\n          dataSource,\n          dimensions,\n          measures\n        );\n        setDataView({\n          schema,\n          fieldFeatures: fieldScores.map(f => f[3]),\n          aggData: dataSource,\n          dimensions,\n          measures\n        });\n        // ugly code\n        // todo:\n        // implement this in specification\n        // + check geomType\n        // + check geom number and aggregated geom number\n        if (\n          schema.geomType &&\n          (schema.geomType.includes(\"point\") ||\n            schema.geomType.includes(\"density\"))\n        ) {\n          setVisualConfig(config => {\n            return {\n              ...config,\n              defaultAggregated: false\n            };\n          });\n        } else {\n          setVisualConfig(config => {\n            return {\n              ...config,\n              defaultAggregated: true\n            };\n          });\n        }\n      } catch (error) {\n        console.log(error);\n      }\n    }\n  }, [viewSpaces, currentPage, dataSource, dimScores]);\n  const currentSpace = useMemo<Subspace>(() => {\n    return subspaceList.find(subspace => {\n      return subspace.dimensions.join(\",\") === dataView.dimensions.join(\",\");\n    })!;\n  }, [subspaceList, dataView]);\n  useEffect(() => {\n    setShowAssociation(false);\n  }, [currentPage]);\n  return (\n    <div className=\"content-container\">\n      <PreferencePanel\n        show={pageStatus.show.configPanel}\n        config={visualConfig}\n        onUpdateConfig={config => {\n          setVisualConfig(config);\n          setPageStatus(draft => {\n            draft.show.configPanel = false;\n          });\n        }}\n        onClose={() => {\n          setPageStatus(draft => {\n            draft.show.configPanel = false;\n          });\n        }}\n      />\n\n      <div className=\"card\" style={{ paddingTop: '0.2rem' }}>\n        <Pivot\n          selectedKey={pivotIndex}\n          onLinkClick={item => {\n            item && setPivotIndex(item.props.itemKey!)\n          }}\n        >\n          {\n            pivotList.map(pivot => (\n              <PivotItem headerText={pivot.title} key={pivot.itemKey} itemKey={pivot.itemKey} />\n            ))\n          }\n        </Pivot>\n        {(state.loading.gallery ||\n          state.loading.subspaceSearching ||\n          state.loading.univariateSummary) && (\n          <ProgressIndicator description=\"calculating\" />\n        )}\n        {pivotIndex === pivotList[0].itemKey && (\n          <div>\n            <h2 style={{ marginBottom: 0 }}>\n              Visual Insights{\" \"}\n              <IconButton\n                iconProps={{ iconName: \"Settings\" }}\n                title=\"Preference\"\n                ariaLabel=\"preference\"\n                onClick={() => {\n                  setPageStatus(draft => {\n                    draft.show.configPanel = true;\n                  });\n                }}\n              />\n              <IconButton\n                iconProps={{ iconName: \"Lightbulb\" }}\n                title=\"Dig In\"\n                ariaLabel=\"digIn\"\n                onClick={() => {\n                  setShowAssociation(true);\n                }}\n              />\n            </h2>\n            <p className=\"state-description\">\n              Details of the recommendation process can be seen in{\" \"}\n              <b>NoteBook</b> Board. You can adjust some of the parameters and\n              operators and see how it influence recommendation results.\n            </p>\n            <p className=\"state-description\">\n              Try to use the setting button beside the \"visual insight\" title to\n              adjust the visualization settings to get a view you prefer better.\n            </p>\n            <div className=\"ms-Grid\" dir=\"ltr\">\n              <div className=\"ms-Grid-row\">\n                <div\n                  className=\"ms-Grid-col ms-sm6 ms-md8 ms-lg3\"\n                  style={{ overflow: \"auto\" }}\n                >\n                  <div style={{ marginBottom: \"1rem\" }}>\n                    <SpinButton\n                      label={\"Current Page\"}\n                      value={(currentPage + 1).toString()}\n                      min={0}\n                      max={viewSpaces.length}\n                      step={1}\n                      iconProps={{ iconName: \"Search\" }}\n                      labelPosition={Position.end}\n                      // tslint:disable:jsx-no-lambda\n                      onValidate={(value: string) => {\n                        gotoPage((Number(value) - 1) % viewSpaces.length);\n                      }}\n                      onIncrement={() => {\n                        gotoPage((currentPage + 1) % viewSpaces.length);\n                      }}\n                      onDecrement={() => {\n                        gotoPage(\n                          (currentPage - 1 + viewSpaces.length) %\n                            viewSpaces.length\n                        );\n                      }}\n                      incrementButtonAriaLabel={\"Increase value by 1\"}\n                      decrementButtonAriaLabel={\"Decrease value by 1\"}\n                    />\n                  </div>\n                  <p className=\"state-description\">\n                    Page No. {currentPage + 1} of {viewSpaces.length}\n                  </p>\n                  <Stack horizontal tokens={{ childrenGap: 20 }}>\n                    <DefaultButton\n                      text=\"Last\"\n                      onClick={() => {\n                        gotoPage(\n                          (currentPage - 1 + viewSpaces.length) %\n                            viewSpaces.length\n                        );\n                      }}\n                      allowDisabledFocus\n                    />\n                    <DefaultButton\n                      text=\"Next\"\n                      onClick={() => {\n                        gotoPage((currentPage + 1) % viewSpaces.length);\n                      }}\n                      allowDisabledFocus\n                    />\n                  </Stack>\n                  <h3>Specification</h3>\n                  <pre>{JSON.stringify(dataView.schema, null, 2)}</pre>\n                  <VisSummary\n                    dimensions={dataView.dimensions}\n                    measures={dataView.measures}\n                    dimScores={dimScores}\n                    space={currentSpace}\n                    spaceList={subspaceList}\n                    schema={dataView.schema}\n                  />\n                </div>\n                <div\n                  className=\"ms-Grid-col ms-sm6 ms-md4 ms-lg9\"\n                  style={{ overflow: \"auto\" }}\n                >\n                  <BaseChart\n                    aggregator={visualConfig.aggregator}\n                    defaultAggregated={visualConfig.defaultAggregated}\n                    defaultStack={visualConfig.defaultStack}\n                    dimensions={dataView.dimensions}\n                    measures={dataView.measures}\n                    dataSource={dataView.aggData}\n                    schema={dataView.schema}\n                    fieldFeatures={dataView.fieldFeatures}\n                  />\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n        {pivotIndex === pivotList[1].itemKey && <SearchBoard />}\n      </div>\n\n      {pivotIndex === pivotList[0].itemKey && showAssociation && (\n        <div className=\"card\">\n          <h2> Related Views </h2>\n          <Association\n            onSelectView={index => {\n              let pos = viewSpaces.findIndex(v => v.index === index);\n              if (pos > -1) {\n                gotoPage(pos);\n              }\n            }}\n            subspaceList={subspaceList}\n            digDimensionProps={{\n              visualConfig,\n              dataSource,\n              viewSpaces,\n              fieldScores: dimScores,\n              interestedViewSpace: viewSpaces[currentPage]\n            }}\n          />\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default Gallery;\n","import React, { useRef, useEffect } from 'react';\nimport embed from 'vega-embed';\nimport { FieldType, DataSource } from '../../global';\nexport interface DistributionChartProps {\n  fieldType: FieldType;\n  x: string;\n  y: string;\n  dataSource: DataSource\n}\n\nconst DistributionChart: React.FC<DistributionChartProps> = (props) => {\n  const chart = useRef<HTMLDivElement>(null);\n  const { x, y, dataSource, fieldType } = props;\n    useEffect(() => {\n      if (chart.current) {\n        let values: typeof dataSource = [];\n        let hasIndex = false;\n        if (fieldType === 'ordinal' && dataSource.some(member => {\n          return /(\\[|\\()-?([0-9.]+|Infinity),\\s*([0-9.]+|Infinity)(\\]|\\))/.test(member.memberName)\n        })) {\n          values = dataSource.map(member => {\n            hasIndex = true;\n            let result = /(\\[|\\()(?<left>-?([0-9.]+|Infinity)),\\s*([0-9.]+|Infinity)(\\]|\\))/.exec(member.memberName);\n            \n            return {\n              ...member,\n              index: result === null ? member.name : Number(result.groups!.left)\n            }\n          })\n        } else {\n          values = dataSource\n        }\n        let sortBy: string | undefined | any = undefined;\n        if (fieldType === 'nominal') {\n          sortBy = '-y'\n        } else if (fieldType === 'ordinal' && hasIndex) {\n          sortBy = { field: 'index' }\n        }\n        embed(chart.current, {\n          background: '#fff',\n          data: {\n            values\n          },\n          height: 120,\n          width: 200,\n          mark: ['quantitative', 'temporal'].includes(fieldType) ? 'line' : 'bar',\n          encoding: {\n            x: {\n              field: x,\n              axis: dataSource.length > 16 ? null : undefined,\n              type: fieldType, sort: sortBy\n            },\n            y: { field: y, type: 'quantitative', aggregate: 'sum' }\n          }\n        }, {\n          actions: false\n        })\n      }\n    }, [x, y, dataSource, fieldType])\n  return <div ref={chart}></div>\n}\n\nexport default DistributionChart;","import React, { useMemo } from 'react';\nimport { DetailsList, SelectionMode, IColumn, Icon, HoverCard, IExpandingCardProps } from 'office-ui-fabric-react';\nimport chroma from 'chroma-js';\nimport { FieldSummary } from '../../service';\nimport DistributionChart from './distributionChart';\nimport { FieldType, Record } from '../../global';\n\nimport './fieldAnalysis.css';\n\n// todo: distribution info\n\ninterface FieldAnalsisProps {\n  originSummary: FieldSummary[];\n  groupedSummary: FieldSummary[];\n}\nconst columns: IColumn[] = [\n  {\n    key: 'fieldName',\n    name: 'fieldName',\n    fieldName: 'fieldName',\n    minWidth: 70,\n    maxWidth: 150\n  },\n  {\n    key: 'type',\n    name: 'type',\n    fieldName: 'type',\n    minWidth: 50\n  },\n  {\n    key: 'entropy',\n    name: 'entropy',\n    fieldName: 'entropy',\n    minWidth: 120\n  },\n  {\n    key: 'maxEntropy',\n    name: 'maxEntropy',\n    fieldName: 'maxEntropy',\n    minWidth: 120\n  }\n];\nfunction getIconNameByFieldType (type: string): string {\n  switch (type) {\n    case 'nominal':\n      return 'TextField';\n    case 'quantitative':\n      return 'NumberField';\n    case 'ordinal':\n      return 'Breadcrumb';\n    case 'temporal':\n      return 'EventDate';\n    default:\n      return ''\n  }\n}\n\nfunction getValueColor (value: number, range: [number, number]): [number, number, number] {\n  return chroma.scale('YlGnBu').domain([range[1], range[0]])(value).rgb();\n}\n\n/**\n * \n * @param color rgb array\n * algorithm provided by https://stackoverflow.com/questions/1855884/determine-font-color-based-on-background-color\n */\nfunction contrastColor(color: [number, number, number]): [number, number, number] {\n  let luminance = (0.299 * color[0] + 0.587 * color[1] + 0.114 * color[2]) / 255;\n  return luminance > 0.5 ? [0, 0, 0] : [255, 255, 255]\n}\nconst FieldAnalsis: React.FC<FieldAnalsisProps> = (props) => {\n\n  const { originSummary, groupedSummary } = props;\n\n  const entropyRange = useMemo<[number, number]>(() => {\n    const originEntropy = originSummary.map(s => s.maxEntropy);\n    return [0, Math.max(...originEntropy)];\n  }, [originSummary])\n\n  const onRenderCompactCard = (item: Record) => {\n    return (\n      <div className=\"field-hover-card\">\n        <h2>{item.fieldName}</h2>\n        <div>Field entropy is { Number(item.entropy).toFixed(2) }</div>\n        <div className=\"chart-vertical-margin-container\" >\n          <DistributionChart x=\"memberName\" y=\"count\" fieldType={item.type as FieldType} dataSource={item.distribution} />\n        </div>\n        \n      </div>\n    )\n  }\n  const onRenderExpandedCard = (item: Record) => {\n    const name = item.fieldName;\n    const target = groupedSummary.find(s => s.fieldName === name + '(group)')\n    return (\n      <div className=\"field-hover-card\">\n        {\n          target ? <div>\n            <h3>{target.fieldName}</h3>\n            <div>Field entropy is { Number(target.entropy).toFixed(2) }</div>\n            <div className=\"chart-vertical-margin-container\">\n              <DistributionChart x=\"memberName\" y=\"count\" fieldType={target.type as FieldType} dataSource={target.distribution} />\n            </div>\n          </div> : <div>This field is not grouped.</div>\n        }\n      </div>\n    )\n  }\n\n\n\n  const renderItemColumn = (item: Record, index?: number, column?: IColumn) => {\n    if (column !== undefined) {\n      const name = item.fieldName;\n      const target = groupedSummary.find(s => s.fieldName === name + '(group)')\n      const expandingCardProps: IExpandingCardProps = {\n        onRenderCompactCard,\n        onRenderExpandedCard,\n        renderData: item,\n        compactCardHeight: 320,\n        expandedCardHeight: target ? 320 : 40\n      }\n      const fieldContent = item[column.fieldName!];\n      let bgColor: [number, number, number] = [255, 255, 255];\n      switch (column.key) {\n        case 'type':\n          return <div>\n            <Icon iconName={getIconNameByFieldType(fieldContent)} /> {fieldContent}\n          </div>\n        case 'entropy':\n        case 'maxEntropy':\n          bgColor = getValueColor(item[column.key], entropyRange);\n          let bgColorStr = `rgb(${bgColor.join(',')})`\n          let fontColorStr = `rgb(${contrastColor(bgColor).join(',')})`\n          return (\n            <HoverCard expandedCardOpenDelay={800} expandingCardProps={expandingCardProps} instantOpenOnClick={true}>\n              <div style={{ boxShadow: `${bgColorStr} 0px 0px 0px 10px`, backgroundColor: bgColorStr, color: fontColorStr }}>{fieldContent}</div>\n            </HoverCard>\n          )\n        default:\n          return <HoverCard expandedCardOpenDelay={800} expandingCardProps={expandingCardProps} instantOpenOnClick={true}>\n          <div>{fieldContent}</div>\n        </HoverCard>\n      }\n    }\n  }\n\n  // const onRenderRow: IRenderFunction<any> = (props) => {\n  //   const customStyles: Partial<IDetailsRowStyles> = {};\n  //   customStyles.root = { backgroundColor: getValueColor(props.item['entropy'], entropyRange), color: '#fff' }\n  //   return <DetailsRow {...props} styles={customStyles} />;\n  // };\n\n  return <DetailsList compact={true} columns={columns} items={originSummary} selectionMode={SelectionMode.none} onRenderItemColumn={renderItemColumn} />\n}\n\nexport default FieldAnalsis;","import React, { useRef, useMemo, useEffect, useState } from 'react';\nimport { Subspace } from '../../service';\nimport embed from 'vega-embed';\nimport { DataSource } from '../../global';\n\nfunction encodeArr (arr: any[]): string {\n  return arr.join(',')\n}\ninterface SubspacesProps {\n  subspaceList: Subspace[];\n  onSpaceChange: (dimensions: string[], measures: string[], matrix: number[][]) => void\n}\nconst Subspaces: React.FC<SubspacesProps> = (props) => {\n  const { subspaceList, onSpaceChange } = props;\n  const [curIndex, setCurIndex] = useState(0);\n  const spaceChart = useRef<HTMLDivElement>(null)\n  const relationChart = useRef<HTMLDivElement>(null)\n  // const subspaces = useMemo<IndexSubspace[]>(() => {\n  //   return subspaceList.map((space, index) => {\n  //     return {\n  //       ...space,\n  //       index\n  //     }\n  //   })\n  // }, [subspaceList]);\n  useEffect(() => {\n    let index = subspaceList.length - 1;\n    if (index > -1) {\n      let targetSpace = subspaceList[index];\n      onSpaceChange(targetSpace.dimensions, targetSpace.measures.map(m => m.name), targetSpace.correlationMatrix);\n      setCurIndex(index);\n    }\n  }, [subspaceList, onSpaceChange])\n\n  const values = useMemo<DataSource>(() => {\n    let ans = [];\n    // todos:\n    // the fold operation here is a tmp solution. it is designed when I don't there is a api in vega to handle event listener.\n    // the fold operation here can caused a wasted of time and space.\n    // I suggested to divied it into two charts and connect the logic throgh a state manager outside the charts.\n    for (let i = 0; i < subspaceList.length; i++) {\n      let space = subspaceList[i];\n      let dimensions = encodeArr(space.dimensions)\n      for (let { name, value } of space.measures) {\n        let record: any = {\n          test: i,\n          score: space.score,\n          dimensions,\n          measureName: name,\n          measureValue: value,\n        };\n        ans.push(record)\n      }\n    }\n    return ans\n  }, [subspaceList])\n  useEffect(() => {\n    if (spaceChart.current && subspaceList.length > 0) {\n      embed(spaceChart.current, {\n        data: {\n          values\n        },\n        vconcat: [\n          {\n            mark: 'rect',\n            selection: {\n              dim: {\n                type: 'single',\n                on: 'click',\n                encodings: ['y']\n              }\n            },\n            encoding: {\n              x: { field: 'measureName', type: 'nominal' },\n              y: {\n                field: 'dimensions',\n                type: 'ordinal',\n                sort: { field: 'score' }\n              },\n              color: { field: 'measureValue', type: 'quantitative', aggregate: 'mean', scale: { reverse: true } },\n              opacity: {\n                condition: {selection: 'dim', value: 1},\n                value: 0.72\n              },\n            }\n          }\n        ]\n      }).then(res => {\n        res.view.addEventListener('click', function (e, item) {\n          if (item) {\n            /**\n             * record is the data record(defiend in `values`) the event contains.\n             */\n            let record = item.datum;\n            let index = subspaceList.findIndex(space => encodeArr(space.dimensions) === record.dimensions)\n\n            if (index > -1) {\n              let targetSpace = subspaceList[index];\n              onSpaceChange(targetSpace.dimensions, targetSpace.measures.map(m => m.name), targetSpace.correlationMatrix);\n              setCurIndex(index);\n            }\n          }\n        })\n      })\n    }\n    // eslint-disable-next-line\n  }, [subspaceList, values])\n  useEffect(() => {\n    let space = subspaceList[curIndex];\n    if (relationChart.current && subspaceList.length > 0 && space) {\n      let matrix: DataSource = [];\n      \n      for (let i = 0; i < space.correlationMatrix.length; i++) {\n          for (let j = 0; j < space.correlationMatrix[i].length; j++) {\n            matrix.push({\n              x: space.measures[i].name,\n              y: space.measures[j].name,\n              correlation: space.correlationMatrix[i][j]\n            })\n          }\n        }\n      embed(relationChart.current, {\n        data: {\n          values: matrix\n        },\n        mark: 'rect',\n        encoding: {\n          x: { field: 'x', type: 'nominal' },\n          y: { field: 'y', type: 'nominal' },\n          color: { field: 'correlation', type: 'quantitative', aggregate: 'mean' , scale: { scheme: 'redyellowgreen', domain: [-1, 1] } }\n        }\n      })\n    }\n    \n  }, [subspaceList, curIndex])\n  return <div>\n    <div ref={spaceChart}></div>\n    <div ref={relationChart}></div>\n  </div>\n}\n\nexport default Subspaces;","import React, { useEffect, useMemo, useRef } from 'react';\nimport { Cluster } from 'visual-insights';\nimport { useGlobalState } from '../../state';\nimport embed from 'vega-embed';\n// cluster should be used for small graph because the number of measure is limited. \n// Browser may be more likely crashed by other algorithm or data structure or memory used in the whole analysis pipline.\n/**\n * adjMatrix and measures share a common index system;\n */\ninterface ClusterBoardProps {\n  adjMatrix: number[][];\n  measures: string[];\n  onFocusGroup: (measuresInView: string[]) => void;\n}\n\ninterface VegaEdge {\n  source: number | string;\n  target: number | string;\n  value: number;\n  inCutEdge: boolean;\n}\ninterface VegaNode {\n  name: string;\n  index: number;\n  value: number;\n  group: number;\n}\ninterface TreeData { \n  nodes: VegaNode[];\n  edges: VegaEdge[]\n}\nconst ClusterBoard: React.FC<ClusterBoardProps> = (props) => {\n  const { adjMatrix, measures, onFocusGroup } = props;\n  const [state, ] = useGlobalState();\n  const chart = useRef<HTMLDivElement>(null);\n  // const groups = useMemo<string[][]>(() => {\n  //   return clusterMeasures({\n  //     matrix: adjMatrix,\n  //     measures,\n  //   })\n  // }, [adjMatrix, measures]);\n  const clusterResult = useMemo(() => {\n    /**\n     * todo: \n     * maxGroupNumber = the measures length / max visual channel for measure.\n     */\n    let { edgesInMST, groups } = Cluster.kruskalWithFullMST(adjMatrix, state.maxGroupNumber);\n    return { edgesInMST, groups }\n  }, [adjMatrix, state.maxGroupNumber])\n  const treeData = useMemo<TreeData>(() => {\n    let { edgesInMST, groups } = clusterResult;\n    const edges: VegaEdge[] = edgesInMST.map(edge => {\n      return {\n        source: edge[0][0],\n        target: edge[0][1],\n        value: 1 / edge[1],\n        inCutEdge: edge[2]\n      }\n    });\n    const nodes: VegaNode[] = [];\n    for (let i = 0; i < groups.length; i++) {\n      nodes.push({\n        name: measures[i],\n        index: i,\n        value: 1,\n        group: groups[i]\n      })\n    }\n    return {\n      nodes,\n      edges\n    }\n  }, [measures, clusterResult])\n  useEffect(() => {\n    if (chart.current && measures.length > 0) {\n      embed(chart.current, {\n        \"$schema\": \"https://vega.github.io/schema/vega/v5.json\",\n        \"width\": 700,\n        \"height\": 500,\n        \"padding\": 0,\n        \"autosize\": \"none\",\n      \n        \"signals\": [\n          { \"name\": \"cx\", \"update\": \"width / 2\" },\n          { \"name\": \"cy\", \"update\": \"height / 2\" },\n          {\n            \"description\": \"State variable for active node fix status.\",\n            \"name\": \"fix\", \"value\": false,\n            \"on\": [\n              {\n                \"events\": \"text:mouseout[!event.buttons], window:mouseup\",\n                \"update\": \"false\"\n              },\n              {\n                \"events\": \"text:mouseover\",\n                \"update\": \"fix || true\"\n              },\n              {\n                \"events\": \"[text:mousedown, window:mouseup] > window:mousemove!\",\n                \"update\": \"xy()\",\n                \"force\": true\n              }\n            ]\n          },\n          {\n            \"description\": \"Graph node most recently interacted with.\",\n            \"name\": \"node\", \"value\": null,\n            \"on\": [\n              {\n                \"events\": \"text:mouseover\",\n                \"update\": \"fix === true ? item() : node\"\n              }\n            ]\n          },\n          {\n            \"description\": \"Flag to restart Force simulation upon data changes.\",\n            \"name\": \"restart\", \"value\": false,\n            \"on\": [\n              {\"events\": {\"signal\": \"fix\"}, \"update\": \"fix && fix.length\"}\n            ]\n          }\n        ],\n      \n        \"data\": [\n          {\n            \"name\": \"node-data\",\n            values: treeData.nodes,\n          },\n          {\n            \"name\": \"link-data\",\n            values: treeData.edges\n          }\n        ],\n      \n        \"scales\": [\n          {\n            \"name\": \"color\",\n            \"type\": \"ordinal\",\n            \"domain\": {\"data\": \"node-data\", \"field\": \"group\"},\n            \"range\": {\"scheme\": \"tableau20\"}\n          },\n          {\n            \"name\": \"colorEdge\",\n            \"type\": \"quantize\",\n            \"domain\": {\"data\": \"link-data\", \"field\": \"value\"},\n            \"range\": {\"scheme\": \"viridis\"}\n          }\n        ],\n      \n        \"marks\": [\n          {\n            \"name\": \"nodes\",\n            \"type\": \"text\",\n            \"zindex\": 1,\n      \n            \"from\": {\"data\": \"node-data\"},\n            \"on\": [\n              {\n                \"trigger\": \"fix\",\n                \"modify\": \"node\",\n                \"values\": \"fix === true ? {fx: node.x, fy: node.y} : {fx: fix[0], fy: fix[1]}\"\n              },\n              {\n                \"trigger\": \"!fix\",\n                \"modify\": \"node\", \"values\": \"{fx: null, fy: null}\"\n              }\n            ],\n      \n            \"encode\": {\n              \"enter\": {\n                \"fill\": {\"scale\": \"color\", \"field\": \"group\"},\n                \"text\": {\"field\": \"name\"},\n                \"fontSize\": {\"value\": 14},\n                \"fontWeight\": {\"value\": 600}\n              },\n              \"update\": {\n                \"cursor\": {\"value\": \"pointer\"}\n              }\n            },\n      \n            \"transform\": [\n              {\n                \"type\": \"force\",\n                \"iterations\": 300,\n                \"restart\": {\"signal\": \"restart\"},\n                \"signal\": \"force\",\n                \"forces\": [\n                  {\"force\": \"center\", \"x\": {\"signal\": \"cx\"}, \"y\": {\"signal\": \"cy\"}},\n                  {\"force\": \"collide\" },\n                  {\"force\": \"nbody\" },\n                  {\"force\": \"link\", \"links\": \"link-data\" }\n                ]\n              }\n            ]\n          },\n          {\n            \"type\": \"path\",\n            \"from\": {\"data\": \"link-data\"},\n            \"interactive\": false,\n            \"encode\": {\n              \"update\": {\n                \"stroke\": {\n                  \"scale\": \"colorEdge\",\n                  \"field\": \"value\"\n                },\n                \"strokeWidth\": {\"value\": 0.8},\n                \"opacity\": {\"value\": 0.5}\n              },\n            },\n            \"transform\": [\n              {\n                \"type\": \"linkpath\",\n                \"require\": {\"signal\": \"force\"},\n                \"shape\": \"line\",\n                \"sourceX\": \"datum.source.x\", \"sourceY\": \"datum.source.y\",\n                \"targetX\": \"datum.target.x\", \"targetY\": \"datum.target.y\"\n              }\n            ]\n          }\n        ]\n      }).then(res => {\n        res.view.addEventListener('click', function (e, item) {\n          if (item) {\n            let record = item.datum;\n            let group = record.group;\n            let measuresInView = measures.filter((mea, index) => {\n              return clusterResult.groups[index] === group\n            });\n            onFocusGroup(measuresInView);\n          }\n        })\n      })\n    }\n  }, [treeData, measures, clusterResult.groups, onFocusGroup])\n  return <div ref={chart}>\n  </div>\n}\n\nexport default ClusterBoard;","import React, { useMemo, useState, useEffect, useCallback } from 'react';\nimport { DataSource, Field } from '../../global';\nimport FieldAnalysisBoard from './fieldAnalysis';\nimport Subspaces from './subspaces';\nimport { FieldSummary, Subspace, combineFieldsService } from '../../service';\nimport ClusterBoard from './cluster';\nimport { specification } from 'visual-insights';\nimport { ProgressIndicator, Toggle, Slider } from 'office-ui-fabric-react';\nimport { useGlobalState } from '../../state';\nimport VegaBase from '../../visBuilder/vegaBase';\nimport './index.css';\nconst maxMeasureInView = 4;\ninterface NoteBookProps {\n  dataSource: DataSource;\n  // dimScores: [string, number, number, Field][],\n  summary: {\n    origin: FieldSummary[];\n    grouped: FieldSummary[]\n  };\n  subspaceList: Subspace[]\n}\ninterface ClusterState {\n  measures: string[];\n  dimensions: string[];\n  matrix: number[][];\n}\nconst NoteBook: React.FC<NoteBookProps> = (props) => {\n  const { summary, subspaceList, dataSource } = props;\n  const [state, updateState] = useGlobalState();\n  const [isAggregated, setIsAggregated] = useState(true);\n  \n  const [clusterState, setClusterState] = useState<ClusterState>({\n    measures: [],\n    dimensions: [],\n    matrix: []\n  })\n\n  const [measuresInView, setMeasuresInView] = useState<string[]>([]);\n\n\n  // todo:\n  // should be updated after designing new specification api\n  const dimScores = useMemo<[string, number, number, Field][]>(() => {\n    return [...summary.origin, ...summary.grouped].map(field => {\n      return [field.fieldName, field.entropy, field.maxEntropy, { name: field.fieldName, type: field.type }]\n    });\n  }, [summary.origin, summary.grouped])\n\n  const spec = useMemo(() => {\n    const { dimensions } = clusterState;\n    // todo\n    // this condition is not strict enough. dimScores should share same elements with dimensions and measures.\n    // maybe use try catch in future\n    try {\n      /**\n       * fieldScores is the scores info for the dims and meas in current view.\n       * dimensions should get the grouped new field.\n       * measures shall never use the grouped field.\n       */\n      const fieldScores = dimScores.filter(field => {\n        return dimensions.includes(field[0]) || measuresInView.includes(field[0])\n      })\n      const { schema } = specification(fieldScores, dataSource, dimensions, measuresInView)\n      return schema;\n    } catch (error) {\n      console.log(error)\n      return {\n        position: []\n      }\n    }\n\n  }, [dimScores, clusterState, dataSource, measuresInView])\n\n  const usedSubspaceList = useMemo<Subspace[]>(() => {\n    return subspaceList.slice(0, Math.round(subspaceList.length * state.topK.subspacePercentSize))\n  }, [subspaceList, state.topK.subspacePercentSize]);\n  useEffect(() => {\n    updateState(draft => {\n      draft.maxGroupNumber = Math.round(state.cookedMeasures.length / maxMeasureInView)\n    })\n  }, [state.cookedMeasures, updateState])\n\n  const onSpaceChange = useCallback((dimensions, measures, matrix) => {\n    setClusterState({\n      dimensions,\n      measures,\n      matrix\n    });\n  }, [setClusterState])\n\n  const onFocusGroup = useCallback(measInView => {\n    setMeasuresInView(measInView);\n  }, [])\n  return (\n    <div>\n      <h3 className=\"notebook header\">Univariate Summary</h3>\n      <p className=\"state-description\">\n        Hover your mouse over the fields and see the distails and entropy\n        reducing strategy.\n      </p>\n      {state.loading.univariateSummary && (\n        <ProgressIndicator description=\"analyzing\" />\n      )}\n      <div className=\"notebook content container\">\n        <FieldAnalysisBoard\n          originSummary={summary.origin}\n          groupedSummary={summary.grouped}\n        />\n      </div>\n\n      <h3 className=\"notebook header\">Subspace Searching</h3>\n      <p className=\"state-description\">\n        Try to choose one row(combination of dimensions) of the subspace and see\n        the changes of the processes below.\n      </p>\n      {state.loading.subspaceSearching && (\n        <ProgressIndicator description=\"analyzing\" />\n      )}\n      {!state.loading.univariateSummary && (\n        <Slider\n          disabled={state.loading.subspaceSearching}\n          value={state.topK.dimensionSize * 100}\n          label=\"top k percent dimension used\"\n          max={100}\n          valueFormat={(value: number) => `${value}%`}\n          showValue={true}\n          onChange={(value: number) => {\n            updateState(draft => {\n              draft.topK.dimensionSize = value / 100;\n              draft.loading.subspaceSearching = true;\n            });\n            const selectedDimensions = state.cookedDimensions.slice(\n              0,\n              Math.round((state.cookedDimensions.length * value) / 100)\n            );\n            combineFieldsService(\n              dataSource,\n              selectedDimensions,\n              state.cookedMeasures,\n              \"sum\",\n              state.useServer\n            ).then(subspaces => {\n              if (subspaces) {\n                updateState(draft => {\n                  draft.subspaceList = subspaces;\n                  draft.loading.subspaceSearching = false;\n                });\n              }\n            });\n          }}\n        />\n      )}\n      {!state.loading.univariateSummary && (\n        <Slider\n          disabled={state.loading.subspaceSearching}\n          value={state.topK.subspacePercentSize * 100}\n          label=\"top k percent subspace used\"\n          max={100}\n          valueFormat={(value: number) => `${value}%`}\n          showValue={true}\n          onChange={(value: number) => {\n            updateState(draft => {\n              draft.topK.subspacePercentSize = value / 100;\n            });\n          }}\n        />\n      )}\n      <div className=\"notebook content center container\">\n        <Subspaces\n          subspaceList={usedSubspaceList}\n          onSpaceChange={onSpaceChange}\n        />\n      </div>\n\n      <h3 className=\"notebook header\">Measurement Clustering</h3>\n      <p className=\"state-description\">\n        Try to choose one group to visualize them.\n      </p>\n      <Slider\n        label=\"Max Group Number\"\n        min={1}\n        max={state.cookedMeasures.length || 4}\n        step={1}\n        // defaultValue={clusterState.measures.length / 4}\n        value={state.maxGroupNumber}\n        showValue={true}\n        onChange={(value: number) => {\n          updateState(draft => {\n            draft.maxGroupNumber = value;\n          });\n        }}\n      />\n      <div className=\"notebook content center container\">\n        <ClusterBoard\n          adjMatrix={clusterState.matrix}\n          measures={clusterState.measures}\n          onFocusGroup={onFocusGroup}\n        />\n      </div>\n\n      <h3 className=\"notebook header\">Visualization</h3>\n      <p className=\"state-description\">\n        If there is no result here, try to click one group of measures in{\" \"}\n        <b>Clustering</b> process above.\n      </p>\n      <Toggle\n        checked={isAggregated}\n        label=\"aggregate measures\"\n        defaultChecked\n        onText=\"On\"\n        offText=\"Off\"\n        onChange={(e, checked: boolean | undefined) => {\n          setIsAggregated(!!checked);\n        }}\n      />\n      <div className=\"notebook content center container\">\n        <VegaBase\n          defaultAggregated={isAggregated}\n          defaultStack={true}\n          aggregator={\"sum\"}\n          schema={spec}\n          fieldFeatures={dimScores.map(dim => dim[3])}\n          dataSource={dataSource}\n          dimensions={clusterState.dimensions}\n          measures={measuresInView}\n        />\n      </div>\n    </div>\n  );\n}\n\nexport default NoteBook;","import React from 'react';\nimport { DetailsList, SelectionMode } from 'office-ui-fabric-react';\nimport { DataSource, BIField } from '../global';\nexport interface DataTableProps {\n  dataSource: DataSource,\n  fields: BIField[]\n}\nconst DataTable: React.FC<DataTableProps> = (props) => {\n  const { dataSource = [], fields = [] } = props;\n  let columns = fields.map(field => {\n    return {\n      key: field.name,\n      name: field.name,\n      fieldName: field.name,\n      minWidth: 70,\n      maxHeight: 90\n    }\n  });\n\n  return <div style={{maxHeight: 400, overflow: 'auto'}}>\n    <DetailsList items={dataSource} columns={columns} selectionMode={SelectionMode.none} />\n  </div>\n}\n\nexport default DataTable;","import React, { useState, useEffect } from 'react';\nimport { PrimaryButton, Panel, PanelType, Toggle } from 'office-ui-fabric-react';\n\nimport { BIField, BIFieldType } from '../global';\n\ninterface FieldPanelProps {\n  show: boolean;\n  onClose: () => void;\n  onUpdateConfig: (fields: BIField[]) => void;\n  fields: BIField[];\n}\nconst FieldPanel: React.FC<FieldPanelProps> = (props) => {\n  const {\n    show = false,\n    // fields = [],\n    onUpdateConfig,\n    onClose\n  } = props;\n  const [fields, setFields] = useState<BIField[]>([])\n  useEffect(() => {\n    setFields(props.fields)\n  }, [props.fields])\n  \n  function updateFieldType(field: BIField, type: BIFieldType) {\n    setFields(fields => {\n      return fields.map(f => {\n        if (field.name === f.name) {\n          return {\n            name: field.name,\n            type\n          }\n        } else {\n          return f\n        }\n      })\n    })\n  }\n\n  const onRenderFooterContent = () => <div>\n    <PrimaryButton onClick={() => { onUpdateConfig(fields); onClose(); }}>\n      Save\n    </PrimaryButton>\n  </div>\n  \n  return <Panel\n    isOpen={show}\n    type={PanelType.smallFixedFar}\n    onDismiss={onClose}\n    headerText=\"Meta Config\"\n    closeButtonAriaLabel=\"Close\"\n    onRenderFooterContent={onRenderFooterContent}\n  >\n    <div>\n      {\n        fields.map(field => <Toggle key={field.name} checked={field.type === 'dimension'} label={field.name} onText=\"dimension\" offText=\"measure\" onChange={(e, checked) => { updateFieldType(field, checked ? 'dimension' : 'measure')}} />)\n      }\n    </div>\n  </Panel>\n}\n\nexport default FieldPanel;\n","import { Cleaner } from 'visual-insights';\nimport { DataSource } from '../../global';\n\n// todo\n// cleanMethodList has redundency.\n// clean method type, cleanData(switch), cleanMethodList should be maintained in one structure.\nexport type CleanMethod = 'dropNull' | 'useMode' | 'simpleClean';\nexport function cleanData (dataSource: DataSource, dimensions: string[], measures: string[], method: CleanMethod): DataSource {\n  // hint: dropNull works really bad when we test titanic dataset.\n  // useMode fails when there are more null values than normal values;\n  switch (method) {\n    case 'dropNull':\n      return Cleaner.dropNull(dataSource, dimensions, measures);\n    case 'useMode':\n      // todo: bad props design\n      return Cleaner.useMode(dataSource, dimensions.concat(measures));  \n    case 'simpleClean':\n    default:\n      return Cleaner.simpleClean(dataSource, dimensions, measures);\n  }\n}\n\nexport const cleanMethodList: Array<{ key: CleanMethod; text: string }> = [\n  { key: 'dropNull', text: 'drop null records' },\n  { key: 'useMode', text: 'replace null with mode' },\n  { key: 'simpleClean', text: 'simple cleaning' }\n]\n","import { useMemo } from 'react';\nimport { BIField, DataSource, Record } from '../../global';\nimport { Transform } from '../../utils/index'\nimport {  cleanData,  CleanMethod } from './clean';\nimport { deepcopy } from '../../utils/index';\n\n\nexport function useDataSource (rawData: DataSource, fields: BIField[], cleanMethod: CleanMethod): [DataSource, DataSource] {\n  const dimensions = useMemo<string[]>(() => {\n    return fields.filter(field => field.type === 'dimension').map(field => field.name)\n  }, [fields])\n\n  const measures = useMemo<string[]>(() => {\n    return fields.filter(field => field.type === 'measure').map(field => field.name)\n  }, [fields])\n\n  const dataSource = useMemo<DataSource>(() => {\n    return rawData.map(row => {\n      let record: Record = {}\n      fields.forEach(field => {\n        record[field.name] = field.type === 'dimension' ? row[field.name] : Transform.transNumber(row[field.name])\n      })\n      return record\n    })\n  }, [rawData, fields])\n\n  const preparedData = useMemo<DataSource>(() => {\n    return cleanData(deepcopy(dataSource), dimensions, measures, cleanMethod);\n  }, [dimensions, measures, dataSource, cleanMethod])\n\n  return [dataSource, preparedData]\n}","// todo replace the deepcopy with a safe and faster one.\nexport default function deepcopy(dataSource: any) {\n  return JSON.parse(JSON.stringify(dataSource))\n}","import React, { useState, useRef } from \"react\";\nimport { useGlobalState } from \"../../state\";\nimport { FileLoader, useComposeState } from '../../utils/index';\nimport { ComboBox, PrimaryButton, IconButton, Callout, Stack, CommandBar, ChoiceGroup, IChoiceGroupOption, Slider, Label, Checkbox } from 'office-ui-fabric-react';\nimport DataTable from '../../components/table';\nimport FieldPanel from '../../components/fieldConfig';\nimport { DataSource,  BIField, Record } from '../../global';\nimport {  cleanMethodList, CleanMethod } from './clean';\nimport { Cleaner, Sampling } from 'visual-insights';\nimport { useDataSource } from './useDataSource';\nimport { useId } from '@uifabric/react-hooks';\n\nenum SampleKey {\n  none = 'none',\n  reservoir = 'reservoir',\n}\n\nconst SampleOptions = [\n  {\n    key: SampleKey.none,\n    text: 'none'\n  },\n  {\n    key: SampleKey.reservoir,\n    text: 'reservoir'\n  }\n];\n\ninterface PageStatus {\n  show: {\n    insightBoard: boolean;\n    configPanel: boolean;\n    fieldConfig: boolean;\n    dataConfig: boolean;\n  }\n}\n\ninterface DataSourceBoardProps {\n  onExtractInsights: () => void;\n}\n\nconst DataSourceBoard: React.FC<DataSourceBoardProps> = (props) => {\n  const [state,updateState, dispatch] = useGlobalState();\n  const [pageStatus, setPageStatus] = useComposeState<PageStatus>({\n    show: {\n      insightBoard: false,\n      fieldConfig: false,\n      configPanel: false,\n      dataConfig: false\n    }\n  })\n  const [cleanMethod, setCleanMethod] = useState<CleanMethod>('dropNull');\n  const [fixUnicodeField, setFixUnicodeField] = useState<boolean>(true);\n  const [sampleMethod, setSampleMethod] = useState<SampleKey>(SampleKey.none)\n  const [sampleSize, setSampleSize] = useState<number>(0.2);\n\n  const dataSetting = useRef<HTMLDivElement>(null);\n  const fileEle = useRef<HTMLInputElement>(null);\n\n  const [dataSource, preparedData] = useDataSource(state.rawData, state.fields, cleanMethod);\n\n  const labelId = useId('labelElement');\n\n  async function fileUploadHanlder () {\n    if (fileEle.current !== null && fileEle.current.files !== null) {\n      const file = fileEle.current.files[0];\n      /**\n       * tmpFields is fields cat by specific rules, the results is not correct sometimes, waitting for human's input\n       */\n      let tmpFields: BIField[] = [];\n      let rawData: DataSource = [];\n\n      if (file.type === 'text/csv' || file.type === 'application/vnd.ms-excel') {\n        rawData = await FileLoader.csvLoader(file);\n      } else if (file.type === 'application/json') {\n        rawData = await FileLoader.jsonLoader(file);\n      } else {\n        throw new Error(`unsupported file type=${file.type} `)\n      }\n      if (sampleMethod === SampleKey.reservoir) {\n        rawData = Sampling.reservoirSampling(rawData, Math.round(rawData.length * sampleSize));\n      }\n      rawData = Cleaner.dropNullColumn(rawData, Object.keys(rawData[0])).dataSource;\n      let keys = Object.keys(rawData[0]);\n      tmpFields = keys.map((fieldName, index) => {\n        return {\n          name: fieldName,\n          type: rawData.every(row => {\n            return !isNaN(row[fieldName]) || row[fieldName] === undefined;\n          }) ? 'measure' : 'dimension'\n        }\n      });\n      if (fixUnicodeField) {\n        tmpFields.forEach((f, i) => {\n          f.name = `${f.name}-rid-${i}`\n        })\n        rawData = rawData.map(record => {\n          let fixedRecord: Record = {};\n          for (let i = 0; i < keys.length; i++) {\n            fixedRecord[tmpFields[i].name] = record[keys[i]]\n          }\n          return fixedRecord\n        })\n      }\n      updateState(draft => {\n        draft.fields = tmpFields;\n        draft.rawData = rawData;\n      })\n      setPageStatus(draft => {\n        draft.show.dataConfig = false;\n      });\n    }\n  }\n  // const analysisHandler = startAnalysis(preparedData, state.fields);\n\n  const commandBarList = [\n    {\n      key: 'upload',\n      name: 'Upload',\n      iconProps: { iconName: 'Upload' },\n      onClick: () => {\n        if (fileEle.current) {\n          fileEle.current.click();\n        }\n      }\n    }\n  ]\n\n  return (\n    <div className=\"content-container\">\n      <FieldPanel\n        fields={state.fields}\n        show={pageStatus.show.fieldConfig}\n        onUpdateConfig={fields => {\n          updateState(draft => {\n            draft.fields = fields;\n          });\n        }}\n        onClose={() => {\n          setPageStatus(draft => {\n            draft.show.fieldConfig = false;\n          });\n        }}\n      />\n      <div className=\"card\">\n        <Stack horizontal>\n          <PrimaryButton\n            disabled={dataSource.length === 0}\n            iconProps={{ iconName: \"Financial\" }}\n            text=\"Extract Insights\"\n            onClick={() => {\n              dispatch(\"extractInsights\", {\n                dataSource: preparedData,\n                fields: state.fields\n              });\n              props.onExtractInsights();\n            }}\n          />\n          <div ref={dataSetting}>\n            <IconButton\n              iconProps={{ iconName: \"ExcelDocument\" }}\n              title=\"Upload\"\n              ariaLabel=\"upload data\"\n              onClick={() => {\n                setPageStatus(draft => {\n                  draft.show.dataConfig = true;\n                });\n              }}\n            />\n            <Callout\n              style={{ maxWidth: 300 }}\n              className=\"vi-callout-callout\"\n              role=\"alertdialog\"\n              gapSpace={0}\n              target={dataSetting.current}\n              onDismiss={() => {\n                setPageStatus(draft => {\n                  draft.show.dataConfig = false;\n                });\n              }}\n              setInitialFocus={true}\n              hidden={!pageStatus.show.dataConfig}\n            >\n              <div className=\"vi-callout-header\">\n                <p className=\"vi-callout-title\">Upload Your own dataset</p>\n              </div>\n              <div className=\"vi-callout-inner\">\n                <div className=\"vi-callout-content\">\n                  <p className=\"vi-callout-subTex\">\n                    .csv, .json are supportted.\n                  </p>\n                </div>\n                <div>\n                  <Checkbox\n                    label=\"Add unique ids for fields\"\n                    checked={fixUnicodeField}\n                    onChange={(\n                      ev?: React.FormEvent<HTMLElement>,\n                      checked?: boolean\n                    ) => {\n                      setFixUnicodeField(!!checked);\n                    }}\n                  />\n                  <Label id={labelId} required={true}>\n                    Sampling\n                  </Label>\n                  <ChoiceGroup\n                    defaultSelectedKey=\"B\"\n                    options={SampleOptions}\n                    selectedKey={sampleMethod}\n                    onChange={(\n                      ev: any,\n                      option: IChoiceGroupOption | undefined\n                    ) => {\n                      if (option) {\n                        setSampleMethod(option.key as SampleKey);\n                      }\n                    }}\n                    ariaLabelledBy={labelId}\n                  />\n                  {sampleMethod !== SampleKey.none && (\n                    <Slider\n                      label=\"sample size(percent)\"\n                      min={0}\n                      max={1}\n                      step={0.001}\n                      value={sampleSize}\n                      showValue={true}\n                      valueFormat={(value: number) =>\n                        `${(value * 100).toFixed(1)}%`\n                      }\n                      onChange={(val: number) => {\n                        setSampleSize(val);\n                      }}\n                    />\n                  )}\n                </div>\n                <div className=\"vi-callout-actions\">\n                  <input\n                    type=\"file\"\n                    ref={fileEle}\n                    multiple\n                    accept=\"*\"\n                    style={{ display: \"none\" }}\n                    onChange={fileUploadHanlder}\n                  />\n                  <CommandBar\n                    overflowButtonProps={{ name: \"More\" }}\n                    items={commandBarList}\n                  />\n                </div>\n              </div>\n            </Callout>\n          </div>\n          <IconButton\n            iconProps={{ iconName: \"Settings\" }}\n            title=\"Field Setting\"\n            ariaLabel=\"field setting\"\n            onClick={() => {\n              setPageStatus(draft => {\n                draft.show.fieldConfig = true;\n              });\n            }}\n          />\n        </Stack>\n        <div style={{ margin: \"20px 0px\" }}>\n          <ComboBox\n            styles={{ root: { maxWidth: \"180px\" } }}\n            selectedKey={cleanMethod}\n            label=\"Clean Method\"\n            allowFreeform={true}\n            autoComplete=\"on\"\n            options={cleanMethodList}\n            onChange={(e, option) => {\n              option && setCleanMethod(option.key as CleanMethod);\n            }}\n          />\n        </div>\n        <p style={{ fontSize: 12, fontWeight: 400, color: \"#595959\" }}>\n          Remember to adjust the fields' types and cleaning strategy before\n          extracting insights.\n        </p>\n        <i style={{ fontSize: 12, fontWeight: 300, color: \"#595959\" }}>\n          Number of records {preparedData.length}\n        </i>\n        <DataTable fields={state.fields} dataSource={preparedData} />\n      </div>\n    </div>\n  );\n};\n\nexport default DataSourceBoard;\n","import React, { useMemo } from \"react\";\nimport styled from \"styled-components\";\nimport { DataSource } from \"../../global\";\nimport datalib from \"datalib\";\n\nfunction numberWithCommas(x: number): string {\n  let parts = x.toString().split(\".\");\n  parts[0] = parts[0].replace(/\\B(?=(\\d{3})+(?!\\d))/g, \",\");\n  return parts.join(\".\");\n}\n\nconst Card = styled.div`\n  display: inline-block;\n  padding: 1rem;\n  border: 1px solid #f5f5f5;\n  margin: 1rem;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB',\n  'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif, 'Apple Color Emoji',\n  'Segoe UI Emoji', 'Segoe UI Symbol';\n  .indicator-card.header {\n    color: #8c8c8c;\n    margin-top: 0px;\n    margin-bottom: 0px;\n    font-size: 20px;\n    line-height: 28px;\n    font-weight: 400;\n  }\n  .indicator-card.content {\n    color: #0078d4;\n    font-size: 56px;\n    line-height: 64px;\n    font-weight: 400;\n    margin: 0px;\n  }\n`;\ninterface IndicatorProps {\n  dataSource: DataSource;\n  measures: string[];\n  operator?: 'sum' | 'mean' | 'max' | 'min';\n}\nconst IndicatorCard: React.FC<IndicatorProps> = props => {\n  const { dataSource = [], measures = [], operator = 'sum' } = props;\n  const value = useMemo(() => {\n    if (measures.length === 0 || dataSource.length === 0) {\n      return '-'\n    }\n    let ans = 0;\n    try {\n      ans = datalib[operator](dataSource.map(d => d[measures[0]]));\n    } catch (error) {\n      console.log('operator does not exist or not in vega/datalib.')\n    }\n    if (Math.abs(ans - Math.round(ans)) > 0.00001) {\n      ans = Number(ans.toFixed(2));\n    }\n    return numberWithCommas(ans);\n  }, [dataSource, measures, operator]);\n\n  return (\n    <Card>\n      <h4 className=\"indicator-card header\">{measures[0]} {operator && `(${operator})`}</h4>\n      <h1 className=\"indicator-card content\">{ value }</h1>\n    </Card>\n  );\n};\n\nexport default IndicatorCard;\n","import React, { useRef, useEffect, useState } from 'react';\nimport embed, { vega, Result } from 'vega-embed';\nimport { Spec } from 'vega';\n// import { Result } from 'vega-embed';\n\ninterface ReactVegaProps {\n  dataSource: any[];\n  spec: Spec;\n  signalHandler?: {\n    [key: string]: (name: any, value: any) => void\n  }\n}\nconst ReactVega: React.FC<ReactVegaProps> = props => {\n  const { spec, dataSource, signalHandler = {} } = props\n  const container = useRef<HTMLDivElement>(null);\n  const [view, setView] = useState<Result['view']>()\n  useEffect(() => {\n    if (container.current) {\n      embed(container.current, spec).then(res => {\n        setView(res.view);\n      })\n    }\n  }, [spec])\n  useEffect(() => {\n    if (view && signalHandler) {\n      for (let key in signalHandler) {\n        view.addSignalListener('sl', signalHandler[key]);\n      }\n    }\n    return () => {\n      if (view && signalHandler) {\n        for (let key in signalHandler) {\n          view.removeSignalListener('sl', signalHandler[key]);\n        }\n      }\n    }\n  }, [view, signalHandler])\n  useEffect(() => {\n    view && view.change('dataSource', vega.changeset().remove(() => true).insert(dataSource))\n    view && view.resize();\n    view && view.runAsync();\n  }, [view, dataSource])\n  return <div ref={container} />\n}\n\nexport default ReactVega;\n","import React, { useMemo, useEffect, useState } from \"react\";\nimport { DashBoard } from \"../../service\";\nimport { DataSource, Field } from \"../../global\";\nimport { specification } from \"visual-insights\";\nimport { useComposeState } from \"../../utils/index\";\nimport { IconButton } from \"office-ui-fabric-react\";\nimport IndicatorCard from \"./indicatorCard\";\nimport ReactVega from '../../components/react-vega';\nimport { DataField, featureVis, targetVis } from '../../queries/index';\n\nconst IndicatorCardType = \"indicator\" as const;\n\ninterface CombinedChartProps {\n  dashBoard: DashBoard;\n  dataSource: DataSource;\n  dimScores: [string, number, number, Field][];\n}\n\ninterface GlobalFilters {\n  [key: string]: any[];\n}\n\nconst CombinedChart: React.FC<CombinedChartProps> = props => {\n  const { dashBoard = [], dataSource = [], dimScores = [] } = props;\n  const [globalFilters, setGlobalFilters] = useComposeState<GlobalFilters>({});\n  const [chartStateList, setChartStateList] = useState<boolean[]>([]);\n  useEffect(() => {\n    setChartStateList(dashBoard.map(() => false));\n  }, [dashBoard]);\n\n  const chartSpecList = useMemo(() => {\n    if (!dashBoard || !dataSource || !dimScores) {\n      return [];\n    }\n    return dashBoard.map(board => {\n      const { dimensions, measures, type } = board;\n      const fieldScores = dimScores.filter(field => {\n        return dimensions.includes(field[0]) || measures.includes(field[0]);\n      });\n      let { schema } = specification(\n        fieldScores,\n        dataSource,\n        dimensions,\n        measures\n      );\n      schema.position = schema.position || [];\n      schema.color = schema.color || [];\n      schema.opacity = schema.opacity || [];\n      schema.size = schema.size || [];\n      schema.shape = schema.shape || [];\n      schema.geomType = schema.geomType || [];\n      schema.highFacets = schema.highFacets || [];\n      schema.facets = schema.facets || [];\n      return {\n        dimensions,\n        measures,\n        type,\n        schema\n      };\n    });\n  }, [dashBoard, dataSource, dimScores]);\n\n  const fieldFeatures = useMemo(() => {\n    return dimScores.map(dim => dim[3])\n  }, [dimScores]);\n\n  const specList = useMemo<any[]>(() => {\n    return chartSpecList.map((spec, index) => {\n      const { dimensions, measures, schema, type } = spec;\n      let dataFields: DataField[] = [];\n      for (let dim of dimensions) {\n        let targetField = fieldFeatures.find(f => f.name === dim);\n\n        dataFields.push({\n          name: dim,\n          semanticType: (targetField ? targetField.type : 'nominal'),\n          type: 'dimension'\n        })\n      }\n      for (let mea of measures) {\n        let targetField = fieldFeatures.find(f => f.name === mea);\n\n        dataFields.push({\n          name: mea,\n          semanticType: (targetField ? targetField.type : 'nominal'),\n          type: 'measure'\n        })\n      }\n    \n      if (type === \"target\" && measures.length === 1) {\n        return {\n          specIndex: index,\n          type: IndicatorCardType,\n          measures: measures,\n          operator: \"sum\"\n        };\n      }\n      let vegaSpec: any = {}\n      if (type === 'target') {\n        vegaSpec = targetVis(schema, dataFields)\n      }\n\n      if (type === 'feature') {\n        vegaSpec = featureVis(schema, dataFields)\n      }\n      vegaSpec.specIndex = index\n      return vegaSpec\n    }) as any;\n  }, [chartSpecList, fieldFeatures]);\n\n  const signalHandler = useMemo(() => {\n    return dashBoard.map((d, index) => {\n      return {\n        sl: (name: any, values: any) => {\n          if (chartStateList[index]) {\n            setGlobalFilters(draft => {\n              if (Object.keys(values).length === 0) {\n                for (let key in draft) {\n                  // delete draft[key]\n                  draft[key] = [];\n                }\n              } else {\n                for (let key in values) {\n                  draft[key] = values[key];\n                }\n              }\n            });\n          }\n        }\n      };\n    });\n  }, [dashBoard, chartStateList, setGlobalFilters]);\n\n  const vsourceList = useMemo<Array<DataSource>>(() => {\n    let ans = [];\n    const filters = Object.keys(globalFilters).map(fieldName => {\n      return {\n        fieldName: fieldName,\n        filter: globalFilters[fieldName],\n        // protentional risk\n        isRange:\n          globalFilters[fieldName].length === 2 &&\n          typeof globalFilters[fieldName][0] === \"number\" &&\n          typeof globalFilters[fieldName][1] === \"number\" &&\n          globalFilters[fieldName][0] < globalFilters[fieldName][1]\n      };\n    });\n    const ds = dataSource.filter(record => {\n      return filters.every(f => {\n        if (f.filter.length === 0) {\n          return true;\n        }\n        if (f.isRange) {\n          return (\n            record[f.fieldName] >= f.filter[0] &&\n            record[f.fieldName] <= f.filter[1]\n          );\n        } else {\n          return f.filter.includes(record[f.fieldName]);\n        }\n      });\n    });\n    for (let i = 0; i < dashBoard.length; i++) {\n      if (chartStateList[i]) {\n        ans.push(dataSource);\n        continue;\n      }\n      ans.push(ds);\n    }\n    return ans;\n  }, [\n    dashBoard,\n    globalFilters,\n    dataSource,\n    chartStateList\n  ]);\n  return (\n    <div>\n      <div>\n      {specList.filter(spec => spec.type === IndicatorCardType).map((spec, index) =>\n          <IndicatorCard\n            key={`ds-ind-chart-${index}`}\n            dataSource={vsourceList[spec.specIndex]}\n            measures={spec.measures}\n          />\n      )}\n      </div>\n      <div>\n      {specList.filter(spec => spec.type !== IndicatorCardType).map((spec, index) =>\n          <div\n            key={`ds-chart-${index}`}\n            style={{\n              display: 'inline-block',\n              padding: \"4px\",\n              margin: \"2px\",\n              height: \"380px\",\n              overflowY: \"auto\"\n            }}\n          >\n            <div\n              style={{ float: \"left\", minWidth: \"300px\", minHeight: \"300px\" }}\n            >\n              {/* <div ref={node => { rendererRef(node, spec.specIndex) }}></div> */}\n              <ReactVega\n                dataSource={vsourceList[spec.specIndex]}\n                spec={spec}\n                signalHandler={\n                  chartStateList[spec.specIndex] && (signalHandler[spec.specIndex] as any)\n                }\n              />\n            </div>\n            <div style={{ float: \"left\" }}>\n              <IconButton\n                title=\"use as filter\"\n                ariaLabel=\"use as filter\"\n                iconProps={{\n                  iconName: chartStateList[spec.specIndex] ? \"FilterSolid\" : \"Filter\"\n                }}\n                onClick={() => {\n                  setChartStateList(list => {\n                    let nextList = [...list];\n                    nextList[spec.specIndex] = !nextList[spec.specIndex];\n                    if (!nextList[spec.specIndex]) {\n                      setGlobalFilters(draft => {\n                        for (let key in draft) {\n                          draft[key] = [];\n                        }\n                      });\n                    }\n                    return nextList;\n                  });\n                }}\n              />\n            </div>\n          </div>\n      )}\n      </div>\n    </div>\n  );\n};\n\nexport default CombinedChart;\n","import React, { useState } from \"react\";\nimport { PrimaryButton, DefaultButton, Stack, Separator, ProgressIndicator } from \"office-ui-fabric-react\";\nimport { useGlobalState } from \"../../state\";\nimport CombinedChart from \"./combinedChart\";\n\nconst DashBoardPage: React.FC = props => {\n  const [state, , dispatch, getters] = useGlobalState();\n  const [dashBoardIndex, setDashBoardIndex] = useState(0);\n  const {\n    subspaceList,\n    cookedDataSource,\n    cookedDimensions,\n    cookedMeasures,\n    dashBoardList\n  } = state;\n  const { dimScores } = getters;\n  return (\n    <div className=\"content-container\">\n      <div className=\"card\">\n        <PrimaryButton\n          text=\"Generate Dashboard\"\n          disabled={subspaceList.length === 0}\n          iconProps={{ iconName: \"AreaChart\" }}\n          onClick={() => {\n            dispatch(\"getDashBoard\", {\n              dataSource: cookedDataSource,\n              dimensions: cookedDimensions,\n              measures: cookedMeasures\n            });\n          }}\n        />\n        { state.loading.dashBoard && <ProgressIndicator description=\"generating dashboard\" /> }\n        <Separator>current page no: {dashBoardIndex + 1} of {dashBoardList.length}</Separator>\n        <Stack horizontal tokens={{ childrenGap: 20 }}>\n          <DefaultButton\n            text=\"Last\"\n            onClick={() => {\n              setDashBoardIndex(index => (index + dashBoardList.length - 1) % dashBoardList.length)\n            }}\n            allowDisabledFocus\n          />\n          <DefaultButton\n            text=\"Next\"\n            onClick={() => {\n              setDashBoardIndex(index => (index + 1) % dashBoardList.length)\n            }}\n            allowDisabledFocus\n          />\n        </Stack>\n        <p className=\"state-description\">\n          Double click the chart with selection to clear selection(filter).\n        </p>\n        <div\n          style={{\n            overflowX: \"auto\",\n            margin: \"1rem\",\n            border: \"1px solid #e8e8e8\"\n          }}\n        >\n          {dashBoardList[dashBoardIndex] && dashBoardList[dashBoardIndex].length > 0 && (\n            <CombinedChart\n              dataSource={cookedDataSource}\n              dashBoard={dashBoardList[dashBoardIndex]}\n              dimScores={dimScores}\n            />\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default DashBoardPage;\n","import React, { useMemo } from 'react';\nimport { DataSource } from '../global';\nimport ReactVega from './react-vega';\n\ninterface SimpleTickProps {\n  x: string;\n  y: string;\n  threshold: number;\n  dataSource: DataSource\n}\nconst SimpleTick: React.FC<SimpleTickProps> = props => {\n  const { x, y, threshold, dataSource = [] } = props;\n  const spec = useMemo<any>(() => {\n    return {\n      width: 180,\n      height: 200,\n      data: {\n        name: 'dataSource'\n      },\n      transform: [\n        { calculate: threshold.toString(), as: 'threshold' }\n      ],\n      layer: [\n        {\n          mark: 'point',\n          encoding: {\n            x: {\n              field: x,\n              type: 'nominal'\n            },\n            y: {\n              field: y,\n              type: 'quantitative',\n              scale: {\n                domain: [0, 1]\n              }\n            }\n          }\n        },\n        {\n          mark: 'rule',\n          encoding: {\n            y: {\n              field: 'threshold',\n              type: 'quantitative'\n            },\n            color: {\n              value: 'red'\n            }\n          }\n        }\n      ]\n    }\n  }, [x, y, threshold])\n  return <div>\n    <ReactVega spec={spec} dataSource={dataSource} />\n  </div>;\n}\n\nexport default SimpleTick;","import React, { useRef, useEffect, useMemo } from 'react';\nimport embed from 'vega-embed';\nimport { scheme } from 'vega';\nimport { DefaultIWorker } from \"visual-insights/build/esm/insights/dev\";\n\nscheme('threshold', ['#1890ff', '#ffccc7']);\n\ninterface RadarChartProps {\n  keyField: string;\n  valueField: string;\n  dataSource: any[];\n  threshold: number;\n}\ninterface DataRecord {\n  key: string;\n  value: number;\n  category: 0 | 1;\n}\nconst RadarChart: React.FC<RadarChartProps> = props => {\n  const { keyField, valueField, dataSource = [], threshold } = props;\n  const container = useRef<HTMLDivElement>(null);\n  const viewData = useMemo(() => {\n    let data: DataRecord[] = dataSource.map(record => {\n      return {\n        key: record[keyField],\n        value: Math.round(record[valueField] * 1000) / 1000,\n        category: 0\n      }\n    });\n    Object.values(DefaultIWorker).forEach(type => {\n      if (!data.find(d => d.key === type)) {\n        data.push({\n          key: type,\n          value: 0,\n          category: 0\n        })\n      }\n    })\n    let ruleData: DataRecord[] = data.map(record => {\n      return {\n        key: record.key,\n        value: threshold,\n        category: 1\n      }\n    })\n    return data.concat(ruleData);\n  }, [keyField, valueField, dataSource, threshold])\n  useEffect(() => {\n    if (container.current) {\n      embed(container.current, {\n        width: 280,\n        height: 280,\n        padding: 50,\n        autosize: { type: \"none\", contains: \"padding\" },\n\n        signals: [{ name: \"radius\", update: \"width / 2\" }],\n\n        data: [\n          {\n            name: \"table\",\n            values: viewData\n          },\n          {\n            name: \"keys\",\n            source: \"table\",\n            transform: [\n              {\n                type: \"aggregate\",\n                groupby: [\"key\"]\n              }\n            ]\n          }\n        ],\n\n        scales: [\n          {\n            name: \"angular\",\n            type: \"point\",\n            range: { signal: \"[-PI, PI]\" },\n            padding: 0.5,\n            domain: { data: \"table\", field: \"key\" }\n          },\n          {\n            name: \"radial\",\n            type: \"linear\",\n            range: { signal: \"[0, radius]\" },\n            zero: true,\n            nice: false,\n            domain: [0, 1],\n            domainMin: 0\n          },\n          {\n            name: \"color\",\n            type: \"ordinal\",\n            domain: { data: \"table\", field: \"category\" },\n            range: { scheme: \"threshold\" }\n          }\n        ],\n\n        encode: {\n          enter: {\n            x: { signal: \"radius\" },\n            y: { signal: \"radius\" }\n          }\n        },\n\n        marks: [\n          {\n            type: \"group\",\n            name: \"categories\",\n            zindex: 1,\n            from: {\n              facet: { data: \"table\", name: \"facet\", groupby: [\"category\"] }\n            },\n            marks: [\n              {\n                type: \"line\",\n                name: \"category-line\",\n                from: { data: \"facet\" },\n                encode: {\n                  enter: {\n                    interpolate: { value: \"linear-closed\" },\n                    x: {\n                      signal:\n                        \"scale('radial', datum.value) * cos(scale('angular', datum.key))\"\n                    },\n                    y: {\n                      signal:\n                        \"scale('radial', datum.value) * sin(scale('angular', datum.key))\"\n                    },\n                    stroke: { scale: \"color\", field: \"category\" },\n                    strokeWidth: { value: 1 },\n                    fill: { scale: \"color\", field: \"category\" },\n                    fillOpacity: { value: 0.1 }\n                  }\n                }\n              },\n              {\n                type: \"text\",\n                name: \"value-text\",\n                from: { data: \"category-line\" },\n                encode: {\n                  enter: {\n                    x: { signal: \"datum.x\" },\n                    y: { signal: \"datum.y\" },\n                    text: { signal: \"datum.datum.value\" },\n                    align: { value: \"center\" },\n                    baseline: { value: \"middle\" },\n                    fill: { value: \"#262626\" }\n                  }\n                }\n              }\n            ]\n          },\n          {\n            type: \"rule\",\n            name: \"radial-grid\",\n            from: { data: \"keys\" },\n            zindex: 0,\n            encode: {\n              enter: {\n                x: { value: 0 },\n                y: { value: 0 },\n                x2: { signal: \"radius * cos(scale('angular', datum.key))\" },\n                y2: { signal: \"radius * sin(scale('angular', datum.key))\" },\n                stroke: { value: \"lightgray\" },\n                strokeWidth: { value: 1 }\n              }\n            }\n          },\n          {\n            type: \"text\",\n            name: \"key-label\",\n            from: { data: \"keys\" },\n            zindex: 1,\n            encode: {\n              enter: {\n                x: {\n                  signal: \"(radius + 5) * cos(scale('angular', datum.key))\"\n                },\n                y: {\n                  signal: \"(radius + 5) * sin(scale('angular', datum.key))\"\n                },\n                text: { field: \"key\" },\n                align: [\n                  {\n                    test: \"abs(scale('angular', datum.key)) > PI / 2\",\n                    value: \"right\"\n                  },\n                  {\n                    value: \"left\"\n                  }\n                ],\n                baseline: [\n                  {\n                    test: \"scale('angular', datum.key) > 0\",\n                    value: \"top\"\n                  },\n                  {\n                    test: \"scale('angular', datum.key) == 0\",\n                    value: \"middle\"\n                  },\n                  {\n                    value: \"bottom\"\n                  }\n                ],\n                fill: { value: \"black\" },\n                fontWeight: { value: \"bold\" }\n              }\n            }\n          },\n          {\n            type: \"line\",\n            name: \"outer-line\",\n            from: { data: \"radial-grid\" },\n            encode: {\n              enter: {\n                interpolate: { value: \"linear-closed\" },\n                x: { field: \"x2\" },\n                y: { field: \"y2\" },\n                stroke: { value: \"lightgray\" },\n                strokeWidth: { value: 1 }\n              }\n            }\n          }\n        ]\n      } as any, {\n        actions: false\n      });\n    }\n  }, [viewData]);\n  return <div ref={container}></div>\n}\n\nexport default RadarChart;\n","import React, { useState, useEffect, useMemo } from 'react';\nimport styled from 'styled-components';\nimport { InsightSpace, DefaultIWorker } from 'visual-insights/build/esm/insights/dev';\nimport { specification } from \"visual-insights\";\nimport { getInsightViewSpace } from '../../service';\nimport { PrimaryButton, SpinButton, Slider, ProgressIndicator } from \"office-ui-fabric-react\";\nimport PreferencePanel, {\n  PreferencePanelConfig\n} from \"../../components/preference\";\nimport BaseChart from \"../../visBuilder/vegaBase\";\nimport { Position } from \"office-ui-fabric-react/lib/utilities/positioning\";\n\nimport { useGlobalState } from \"../../state\";\nimport { useComposeState } from '../../utils';\nimport SimpleTick from '../../components/simpleTick';\nimport RadarChart from '../../components/radarChart';\n\nconst Tag = styled.div`\n  display: inline-block;\n  padding: 0.1em 0.3em;\n  margin: 0.2em;\n  border-radius: 3px;\n  color: #fff;\n  font-size: 12px;\n  background-color: ${props => props.color};\n`;\n\nconst DashBoard = styled.div`\n  display: flex;\n  div.left{\n    flex-basis: 300px;\n    flex-grow: 1;\n    border-right: 1px solid #f0f0f0;\n  }\n  div.right{\n    margin-left: 1em;\n    flex-grow: 8;\n  }\n  padding: 1em 0em;\n`\n\nconst ColorMap: {\n  [key: string]: string\n} = {\n  [DefaultIWorker.outlier]: '#cf1322',\n  [DefaultIWorker.trend]: '#7cb305',\n  'general': '#08979c',\n  [DefaultIWorker.cluster]: '#c41d7f'\n}\n\nfunction arrEqual (arr1: any[], arr2: any[]): boolean {\n  if (arr1.length !== arr2.length) {\n    return false;\n  }\n  for (let i = 0; i < arr1.length; i++) {\n    if (arr1[i] !== arr2[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\nconst DevPage: React.FC = props => {\n  const [insightViewSpace, setInsightViewSpace] = useState<InsightSpace[]>([]);\n  const [sigThreshold, setSigThreshold] = useState<number>(0.6);\n  const [loading, setLoading] = useState<boolean>(false);\n  const [visualConfig, setVisualConfig] = useState<PreferencePanelConfig>({\n    aggregator: \"sum\",\n    defaultAggregated: true,\n    defaultStack: true\n  });\n  const [pageStatus, setPageStatus] = useComposeState<{ show: { configPanel: boolean }}>({\n    show: {\n      configPanel: false\n    }\n  });\n  const [state, , dispatch, getters] = useGlobalState();\n  const [chartIndex, setChartIndex] = useState(0);\n  const {\n    cookedDataSource,\n    cookedDimensions,\n    cookedMeasures,\n    topK\n  } = state;\n  const { dimScores } = getters;\n  const viewSpaceList = useMemo(() => {\n    return insightViewSpace.filter(s => s.significance >= sigThreshold);\n  }, [insightViewSpace, sigThreshold])\n\n  const dataView = useMemo(() => {\n    if (viewSpaceList.length === 0) return null;\n    const { dimensions, measures } = viewSpaceList[chartIndex];\n    const fieldScores = dimScores.filter(field => {\n      return dimensions.includes(field[0]) || measures.includes(field[0]);\n    });\n    let { schema } = specification(\n      fieldScores,\n      cookedDataSource,\n      dimensions,\n      measures\n    );\n    return {\n      schema,\n      fieldFeatures: fieldScores.map(f => f[3]),\n      dimensions,\n      measures\n    }\n  }, [viewSpaceList, chartIndex, cookedDataSource])\n  const relatedViews = useMemo<InsightSpace[]>(() => {\n    if (dataView !== null) {\n      const { dimensions, measures } = dataView;\n      return insightViewSpace.filter(f => {\n        if (arrEqual(dimensions, f.dimensions) && arrEqual(measures, f.measures)) {\n          return true\n        }\n        return false\n      })\n    }\n    return []\n  }, [insightViewSpace, dataView])\n\n  useEffect(() => {\n    if (dataView === null) return;\n    const { schema } = dataView;\n    if (\n      schema.geomType &&\n      (schema.geomType.includes(\"point\") ||\n        schema.geomType.includes(\"density\"))\n    ) {\n      setVisualConfig(config => {\n        return {\n          ...config,\n          defaultAggregated: false\n        };\n      });\n    } else {\n      setVisualConfig(config => {\n        return {\n          ...config,\n          defaultAggregated: true\n        };\n      });\n    }\n  }, [dataView])\n  return (\n    <div className=\"content-container\">\n      <PreferencePanel\n        show={pageStatus.show.configPanel}\n        config={visualConfig}\n        onUpdateConfig={config => {\n          setVisualConfig(config);\n          setPageStatus(draft => {\n            draft.show.configPanel = false;\n          });\n        }}\n        onClose={() => {\n          setPageStatus(draft => {\n            draft.show.configPanel = false;\n          });\n        }}\n      />\n      {\n        cookedDataSource.length > 0 && <div className=\"card\">\n          <PrimaryButton\n            text=\"Get Insights\"\n            onClick={() => {\n              setLoading(true);\n              getInsightViewSpace(\n                cookedDataSource,\n                cookedDimensions.slice(0, cookedDimensions.length * topK.dimensionSize),\n                cookedMeasures\n              ).then(res => {\n                setInsightViewSpace(res);\n                setLoading(false);\n              });\n            }}\n          />\n          {loading && <ProgressIndicator description=\"generating dashboard\" />}\n\n          <DashBoard>\n            <div className=\"left\">\n              <SimpleTick\n                x=\"type\"\n                y=\"significance\"\n                dataSource={insightViewSpace}\n                threshold={sigThreshold}\n              />\n              <Slider\n                label=\"significance threshold\"\n                max={100}\n                value={sigThreshold * 100}\n                valueFormat={(value: number) => `${value}%`}\n                showValue={true}\n                onChange={(value: number) => {\n                  setSigThreshold(value / 100);\n                  setChartIndex(0);\n                }}\n              />\n              <p className=\"state-description\">\n                There are {viewSpaceList.length} of views of which insight\n                significance is no less than {(sigThreshold * 100).toFixed(2)} %\n              </p>\n            </div>\n            <div className=\"right\">\n              <div style={{ width: \"280px\" }}>\n                <SpinButton\n                  label={\"Current Index\"}\n                  value={(chartIndex + 1).toString()}\n                  min={0}\n                  max={viewSpaceList.length}\n                  step={1}\n                  iconProps={{ iconName: \"Search\" }}\n                  labelPosition={Position.start}\n                  // tslint:disable:jsx-no-lambda\n                  onValidate={(value: string) => {\n                    setChartIndex((Number(value) - 1) % viewSpaceList.length);\n                  }}\n                  onIncrement={() => {\n                    setChartIndex((chartIndex + 1) % viewSpaceList.length);\n                  }}\n                  onDecrement={() => {\n                    setChartIndex(\n                      (chartIndex - 1 + viewSpaceList.length) %\n                        viewSpaceList.length\n                    );\n                  }}\n                  incrementButtonAriaLabel={\"Increase value by 1\"}\n                  decrementButtonAriaLabel={\"Decrease value by 1\"}\n                />\n              </div>\n              <div style={{ display: \"flex\", padding: \"1em\" }}>\n                <RadarChart\n                  dataSource={relatedViews}\n                  threshold={sigThreshold}\n                  keyField=\"type\"\n                  valueField=\"significance\"\n                />\n                <div>\n                  {\n                    relatedViews.length > 0 && relatedViews.filter(view => view.significance >= sigThreshold).map((view, i) => (\n                      <Tag key={i} color={ColorMap[view.type as string]}>\n                        {view.type}\n                      </Tag>\n                    ))\n                  }\n                  {\n                    viewSpaceList[chartIndex] && <p className=\"state-description\">\n                        Dimensions are {viewSpaceList[chartIndex].dimensions}, and\n                        measures are {viewSpaceList[chartIndex].measures}. <br />\n                        There is a significance of \n                        {(viewSpaceList[chartIndex].significance * 100).toFixed(2)}%\n                        that there exits a {viewSpaceList[chartIndex].type} in the\n                        graph. <br />\n                        {JSON.stringify(viewSpaceList[chartIndex].description)}\n                      </p>\n                  }\n                </div>\n              </div>\n\n              <div></div>\n            </div>\n          </DashBoard>\n          {viewSpaceList.length > 0 && dataView !== null && (\n            <div>\n              <BaseChart\n                aggregator={visualConfig.aggregator}\n                defaultAggregated={visualConfig.defaultAggregated}\n                defaultStack={visualConfig.defaultStack}\n                dimensions={dataView.dimensions}\n                measures={dataView.measures}\n                dataSource={cookedDataSource}\n                schema={dataView.schema}\n                fieldFeatures={dataView.fieldFeatures}\n              />\n            </div>\n          )}\n        </div>\n      }\n      {\n        cookedDataSource.length === 0 && <div className=\"card\">\n          <p>\n            Dev Page now is testing for different types of insight worker.\n            <br />\n            If you see this hint, it means you have not upload dataSource or not click the 'extract insights' button\n             in dataSource page which will produce a cooked dataSource for dev page.\n          </p>\n        </div>\n      }\n    </div>\n  );\n}\n\nexport default DevPage;\n","import React, { useRef, useState } from \"react\";\nimport { Callout, ActionButton, Toggle, DirectionalHint } from \"office-ui-fabric-react\";\nimport { useGlobalState } from \"../state\";\n\nconst UserSettings: React.FC = props => {\n  const target = useRef<HTMLDivElement>(null);\n  const [show, setShow] = useState<boolean>(false);\n  const [state, updateState] = useGlobalState();\n  return (\n    <div>\n      <div ref={target}>\n        <ActionButton text=\"Preference\" iconProps={{ iconName: 'PlayerSettings' }} onClick={() => {setShow(true)}}></ActionButton>\n      </div>\n\n      {show && (\n        <Callout\n          target={target.current}\n          directionalHint={DirectionalHint.bottomLeftEdge}\n          onDismiss={() => {\n            setShow(false);\n          }}\n        >\n          <div style={{ padding: '1rem' }}>\n            <Toggle\n              label=\"Be Cool\"\n              checked={state.beCool}\n              onText=\"On\"\n              offText=\"Off\"\n              onChange={(\n                ev: React.MouseEvent<HTMLElement>,\n                checked?: boolean\n              ) => {\n                updateState(draft => {\n                  draft.beCool = checked || false;\n                });\n              }}\n            />\n            <Toggle\n              label=\"Use Server\"\n              disabled={true}\n              checked={state.useServer}\n              onText=\"On\"\n              offText=\"Off\"\n              onChange={(\n                ev: React.MouseEvent<HTMLElement>,\n                checked?: boolean\n              ) => {\n                updateState(draft => {\n                  draft.useServer = checked || false;\n                });\n              }}\n            />\n          </div>\n        </Callout>\n      )}\n    </div>\n  );\n};\n\nexport default UserSettings;\n\n","import React from \"react\";\nimport { useGlobalState, GlobalStateProvider } from \"./state\";\nimport { Pivot, PivotItem } from \"office-ui-fabric-react\";\nimport { useComposeState } from \"./utils/index\";\nimport \"./App.css\";\nimport RathLogo from './assets/kanaries-lite.png';\nimport RathCoolLogo from './assets/rath-glasses.png';\n\nimport Gallery from \"./pages/gallery/index\";\nimport NoteBook from \"./pages/notebook/index\";\nimport DataSourceBoard from \"./pages/dataSource/index\";\nimport DashBoardPage from './pages/dashBoard/index';\nimport DevPage from './pages/dev';\nimport UserSettings from './components/userSettings';\n\nconst pivotList = [\n  'DataSource',\n  'NoteBook',\n  'Explore',\n  'DashBoard',\n  'Dev'\n].map((page, index) => {\n  return { title: page, itemKey: 'pivot-' + (index + 1)}\n});\n\nconst getLogoSrc = (withGlasses: boolean) => {\n  return withGlasses\n    ? RathCoolLogo\n    : RathLogo;\n};\n\ninterface PageStatus {\n  show: {\n    insightBoard: boolean;\n    configPanel: boolean;\n    fieldConfig: boolean;\n    dataConfig: boolean;\n  };\n  current: {\n    pivotKey: string;\n  };\n}\n\nfunction App() {\n  const [state, ] = useGlobalState();\n  const [pageStatus, setPageStatus] = useComposeState<PageStatus>({\n    show: {\n      insightBoard: false,\n      fieldConfig: false,\n      configPanel: false,\n      dataConfig: false\n    },\n    current: {\n      pivotKey: pivotList[0].itemKey\n    }\n  });\n  return (\n    <div>\n      <div className=\"header-bar\">\n        <div className=\"ms-Grid-row\">\n          <div className=\"ms-Grid-col ms-sm6 ms-md4 ms-lg1\">\n            <a\n              // onClick={() => { window.location.reload(false); }}\n              href=\"https://github.com/ObservedObserver/visual-insights\"\n              className=\"logo\"\n            >\n              <img style={!state.beCool ? { width: '48px', marginTop: '4px' } : undefined} src={ getLogoSrc(state.beCool) } alt=\"rath\" />\n            </a>\n          </div>\n          <div className=\"ms-Grid-col ms-sm6 ms-md8 ms-lg8\">\n            <Pivot\n              selectedKey={pageStatus.current.pivotKey}\n              onLinkClick={item => {\n                item &&\n                  item.props.itemKey &&\n                  setPageStatus(draft => {\n                    draft.current.pivotKey = item.props.itemKey!;\n                  });\n              }}\n              headersOnly={true}\n            >\n              {pivotList.map(pivot => (\n                <PivotItem\n                  key={pivot.itemKey}\n                  headerText={pivot.title}\n                  itemKey={pivot.itemKey}\n                />\n              ))}\n            </Pivot>\n          </div>\n          <div className=\"ms-Grid-col ms-sm6 ms-md8 ms-lg3\">\n          <div className=\"header-toolbar\">\n              <UserSettings />\n            </div>\n          </div>\n        </div>\n      </div>\n      {pageStatus.current.pivotKey === \"pivot-3\" && (\n        <Gallery\n          subspaceList={state.subspaceList}\n          dataSource={state.cookedDataSource}\n          summary={state.summary}\n        />\n      )}\n      {pageStatus.current.pivotKey === \"pivot-1\" && <DataSourceBoard onExtractInsights={() => {\n        setPageStatus(draft => {\n          draft.current.pivotKey = \"pivot-2\";\n          draft.show.insightBoard = true;\n        });\n      }\n      } />}\n      {pageStatus.current.pivotKey === \"pivot-2\" && (\n        <div className=\"content-container\">\n          <div className=\"card\">\n            <NoteBook\n              summary={state.summary}\n              subspaceList={state.subspaceList}\n              dataSource={state.cookedDataSource}\n            />\n          </div>\n        </div>\n      )}\n      {\n        pageStatus.current.pivotKey === 'pivot-4' && <DashBoardPage />\n      }\n      {\n        pageStatus.current.pivotKey === 'pivot-5' && <DevPage />\n      }\n    </div>\n  );\n}\n\nexport default function() {\n  return (\n    <GlobalStateProvider>\n      <App />\n    </GlobalStateProvider>\n  );\n}\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport { initializeIcons } from '@uifabric/icons';\nimport * as serviceWorker from './serviceWorker';\ninitializeIcons();\nReactDOM.render(<App />, document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}