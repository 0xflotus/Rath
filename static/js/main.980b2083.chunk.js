(window.webpackJsonpfrontend=window.webpackJsonpfrontend||[]).push([[0],{142:function(e,t,n){},184:function(e,t,n){e.exports=n(301)},189:function(e,t,n){},191:function(e,t,n){},281:function(e,t,n){},282:function(e,t,n){},284:function(e,t){},285:function(e,t){},286:function(e,t){},287:function(e,t){},301:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"csvLoader",(function(){return F})),n.d(a,"jsonLoader",(function(){return T}));var r={};n.r(r),n.d(r,"transNumber",(function(){return L}));var o=n(1),i=n.n(o),c=n(31),s=n.n(c),u=(n(189),n(12)),l=n(3),m=n(73),d=n(9),f=n.n(d),p=n(33),g="//lobay.moe:8443";function v(e,t){var n,a,r;return f.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,o.next=3,f.a.awrap(fetch(g+"/api/service/fieldsSummary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataSource:e,fields:t})}));case 3:return n=o.sent,o.next=6,f.a.awrap(n.json());case 6:if(!0!==(a=o.sent).success){o.next=12;break}return r=a.data,o.abrupt("return",r);case 12:throw new Error("[fields summary failed]"+a.message);case 13:o.next=18;break;case 15:o.prev=15,o.t0=o.catch(0),console.error(o.t0);case 18:case"end":return o.stop()}}),null,null,[[0,15]])}function h(e,t){var n,a,r,o,i,c;return f.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,f.a.awrap(fetch(g+"/api/service/groupFields",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataSource:e,fields:t})}));case 3:return n=s.sent,s.next=6,f.a.awrap(n.json());case 6:if(!0!==(a=s.sent).success){s.next=12;break}return r=a.data,o=r.groupedData,i=r.newFields,c=r.fields,s.abrupt("return",{groupedData:o,newFields:i,fields:c});case 12:throw new Error("[group fields failed]"+a.message);case 13:s.next=18;break;case 15:s.prev=15,s.t0=s.catch(0),console.error(s.t0);case 18:case"end":return s.stop()}}),null,null,[[0,15]])}function y(e,t,n,a){var r,o,i;return f.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,f.a.awrap(fetch(g+"/api/service/combineFields",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataSource:e,dimensions:t,measures:n,operator:a})}));case 3:return r=c.sent,c.next=6,f.a.awrap(r.json());case 6:if(!0!==(o=c.sent).success){c.next=12;break}return i=o.data,c.abrupt("return",i);case 12:throw new Error("[combine fields failed]"+o.message);case 13:c.next=18;break;case 15:c.prev=15,c.t0=c.catch(0),console.error(c.t0);case 18:case"end":return c.stop()}}),null,null,[[0,15]])}function b(e,t,n,a){var r,o,i;return f.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return r=[],c.prev=1,c.next=4,f.a.awrap(fetch(g+"/api/service/generateDashBoard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataSource:e,dimensions:t,measures:n,subspaces:a})}));case 4:return o=c.sent,c.next=7,f.a.awrap(o.json());case 7:if(!(i=c.sent).success){c.next=12;break}r=i.data,c.next=13;break;case 12:throw new Error("[generateDashBoard]"+i.message);case 13:c.next=18;break;case 15:c.prev=15,c.t0=c.catch(1),console.error(c.t0);case 18:return c.abrupt("return",r);case 19:case"end":return c.stop()}}),null,null,[[1,15]])}var x=function(e,t,n){var a,r,o,i,c,s,u,l,m,d,p,g,y,b;return f.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.dataSource,r=n.fields,o=r.filter((function(e){return"dimension"===e.type})).map((function(e){return e.name})),i=r.filter((function(e){return"measure"===e.type})).map((function(e){return e.name})),e.prev=3,e.next=6,f.a.awrap(v(a,r.map((function(e){return e.name}))));case 6:return c=e.sent,s=c?c.filter((function(e){return o.includes(e.fieldName)})).map((function(e){return{name:e.fieldName,type:e.type}})):[],e.next=10,f.a.awrap(h(a,s));case 10:return u=e.sent,m=(l=u||{groupedData:a,newFields:s}).groupedData,d=l.newFields,p=r.map((function(e){var t=d.find((function(t){return t.name===e.name+"(group)"}));return{name:t?t.name:e.name,type:e.type}})),g=p.filter((function(e){return"dimension"===e.type})).map((function(e){return e.name})),e.next=16,f.a.awrap(v(m,d));case 16:return y=e.sent,t((function(e){e.cookedDataSource=m,e.summary={origin:c||[],grouped:y||[]},e.loading.univariateSummary=!1})),b=(y||[]).concat(c||[]),e.abrupt("return",{groupedData:m,summary:b,newDimensions:g,measures:i});case 22:e.prev=22,e.t0=e.catch(3),t((function(e){e.loading.univariateSummary=!1}));case 25:case"end":return e.stop()}}),null,null,[[3,22]])},E=function(e,t,n){var a,r,o,i,c,s,u,l;return f.a.async((function(m){for(;;)switch(m.prev=m.next){case 0:return a=n.groupedData,r=n.summary,o=n.dimensions,i=n.measures,c=n.operator,t((function(e){e.loading.subspaceSearching=!0})),s=[],(s=o.map((function(e){var t=r.find((function(t){return t.fieldName===e}));return{name:e,entropy:t?t.entropy:1/0}}))).sort((function(e,t){return e.entropy-t.entropy})),t((function(e){e.cookedDimensions=s.map((function(e){return e.name})),e.cookedMeasures=i})),u=s.map((function(e){return e.name})).slice(0,Math.round(s.length*e.topK.dimensionSize)),m.prev=7,m.next=10,f.a.awrap(y(a,u,i,c));case 10:(l=m.sent)&&t((function(e){e.subspaceList=l})),t((function(e){e.loading.subspaceSearching=!1})),m.next=18;break;case 15:m.prev=15,m.t0=m.catch(7),t((function(e){e.loading.subspaceSearching=!1}));case 18:case"end":return m.stop()}}),null,null,[[7,15]])},S={univariateSummary:x,subspaceSearch:E,extractInsights:function(e,t,n){var a,r,o,i,c,s,u;return f.a.async((function(l){for(;;)switch(l.prev=l.next){case 0:return a=n.dataSource,r=n.fields,t((function(e){e.loading.gallery=!0})),l.prev=2,l.next=5,f.a.awrap(x(0,t,{dataSource:a,fields:r}));case 5:if(!(o=l.sent)){l.next=10;break}return i=o.groupedData,c=o.summary,s=o.newDimensions,u=o.measures,l.next=10,f.a.awrap(E(e,t,{groupedData:i,summary:c,dimensions:s,measures:u,operator:"sum"}));case 10:l.next=14;break;case 12:l.prev=12,l.t0=l.catch(2);case 14:return l.prev=14,t((function(e){e.loading.gallery=!1,e.loading.gallery=!1})),l.finish(14);case 17:case"end":return l.stop()}}),null,null,[[2,12,14,17]])},getDashBoard:function(e,t,n){var a,r,o,i;return f.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:return a=n.dataSource,r=n.dimensions,o=n.measures,t((function(e){e.loading.dashBoard=!0})),c.prev=2,c.next=5,f.a.awrap(b(a,r,o,e.subspaceList));case 5:i=c.sent,t((function(e){e.dashBoardList=i})),c.next=12;break;case 9:c.prev=9,c.t0=c.catch(2),console.error(c.t0);case 12:return c.prev=12,t((function(e){e.loading.dashBoard=!1})),c.finish(12);case 15:case"end":return c.stop()}}),null,null,[[2,9,12,15]])}};Object(m.b)(!1);var j={currentPage:0,fields:[],rawData:[],cookedDataSource:[],cookedDimensions:[],cookedMeasures:[],loading:{univariateSummary:!1,subspaceSearching:!1,gallery:!1,dashBoard:!1},topK:{subspacePercentSize:.3,dimensionSize:.72},maxGroupNumber:4,subspaceList:[],summary:{origin:[],grouped:[]},viewSpaces:[],dashBoardList:[]},O=Object(o.createContext)(null);function w(e){var t=e.children,n=Object(o.useState)(j),a=Object(u.a)(n,2),r=a[0],c=a[1],s=function(e){return{dimScores:Object(o.useMemo)((function(){return[].concat(Object(l.a)(e.summary.origin),Object(l.a)(e.summary.grouped)).map((function(e){return[e.fieldName,e.entropy,e.maxEntropy,{name:e.fieldName,type:e.type}]}))}),[e.summary])}}(r),d=function(e){c((function(t){return Object(m.a)(t,(function(t){return e(t)}))}))};return i.a.createElement(O.Provider,{value:[r,d,function(e,t){"function"===typeof S[e]&&S[e](r,d,t)},s]},t)}function k(){return Object(o.useContext)(O)}var N=n(354),C=n(168),M=n(149),D=n.n(M);function F(e){return new Promise((function(t,n){D.a.parse(e,{complete:function(e,n){var a=e.data,r=a[0],o=a.slice(1).map((function(e){var t={};return r.forEach((function(n,a){t[n]=e[a]})),t}));t(o)},error:function(e,t){n(e)}})}))}function T(e){return new Promise((function(t,n){var a=new FileReader;a.readAsText(e),a.onload=function(e){if(e.target)try{var a=JSON.parse(e.target.result);t(a)}catch(r){n(r)}else n(e)},a.onerror=n}))}function L(e){return isNaN(e)?null:Number(e)}function P(e){var t=Object(o.useState)(e),n=Object(u.a)(t,2),a=n[0],r=n[1];return[a,function(e){var t=Object(m.a)(a,(function(t){return e(t)}));r(t)}]}n(191);var z=n(359),B=n(365),G=n(349),K=n(172),I=n(333),A=n(352),R=n(20),q=n(356),W=n(350),V=n(358),U=function(){return{root:{marginTop:"10px"}}},H=[{key:"sum",text:"Sum"},{key:"count",text:"Count"},{key:"mean",text:"Mean"}],J=function(e){var t=e.show,n=void 0!==t&&t,a=e.onUpdateConfig,r=e.onClose,c=e.config,s=Object(o.useState)("sum"),l=Object(u.a)(s,2),m=l[0],d=l[1],f=Object(o.useState)(!0),p=Object(u.a)(f,2),g=p[0],v=p[1],h=Object(o.useState)(!0),y=Object(u.a)(h,2),b=y[0],x=y[1];Object(o.useEffect)((function(){var e=c.aggregator,t=c.defaultAggregated,n=c.defaultStack;d(e),v(t),x(n)}),[c,n]);return i.a.createElement(A.a,{isOpen:n,type:R.a.smallFixedFar,onDismiss:r,headerText:"Preference",closeButtonAriaLabel:"Close",onRenderFooterContent:function(){return i.a.createElement("div",null,i.a.createElement(I.a,{onClick:function(){a({aggregator:m,defaultAggregated:g,defaultStack:b})}},"Save"))}},i.a.createElement(q.a,null,"Preference"),i.a.createElement(G.a,{verticalFill:!0,tokens:{childrenGap:50,padding:6}},i.a.createElement(W.a,{selectedKey:m,label:"Aggregator",allowFreeform:!0,autoComplete:"on",options:H,onChange:function(e,t){t&&d(t.key)}}),i.a.createElement(V.a,{styles:U,label:"measurement aggregation",checked:g,onChange:function(e,t){v(t||!1)}}),i.a.createElement(V.a,{styles:U,label:"measurement stack",checked:b,onChange:function(e,t){x(t||!1)}})))},Y=n(61),X=n.n(Y),$=n(43),_={interval:"bar",line:"line",point:"point",density:"point"},Q=function(e){var t=e.defaultAggregated,n=e.defaultStack,a=e.aggregator,r=e.dataSource,c=void 0===r?[]:r,s=e.dimensions,u=void 0===s?[]:s,l=e.measures,m=void 0===l?[]:l,d=e.schema,f=d.position,g=void 0===f?[]:f,v=d.color,h=void 0===v?[]:v,y=d.opacity,b=void 0===y?[]:y,x=d.size,E=void 0===x?[]:x,S=(d.shape,d.geomType),j=void 0===S?[]:S,O=d.facets,w=void 0===O?[]:O,k=d.page,N=void 0===k?[]:k,C=(d.filter,e.fieldFeatures),M=void 0===C?[]:C,D=Object(o.useRef)(null);function F(e){var t=M.find((function(t){return t.name===e}));return t?t.type:"nominal"}var T=m.map((function(e){return{op:a,field:e,as:"".concat(e,"_").concat(a)}})),L=t?X()({dataSource:c,dimensions:u,measures:m,operator:a,asFields:T.map((function(e){return e.as}))}):c;function P(e){if(t&&m.includes(e)){var n=T.find((function(t){return t.field===e}));return n?n.as:e}return e}return Object(o.useEffect)((function(){if(null!==D.current&&g.length>0&&j.length>0){var e=function(){var e={x:g[0],y:g[1],color:h[0],size:E[0],opacity:b[0],row:w[0],column:w[1]},a={width:600,data:{values:L}},r={width:600,mark:{type:j[0]&&_[j[0]]?_[j[0]]:j[0],tooltip:!0},encoding:{}};for(var o in e)e[o]&&(r.encoding[o]={field:P(e[o]),type:F(e[o])},["x","y"].includes(o)&&"quantitative"===F(e[o])&&!n&&(r.encoding[o].stack=null));if(n||0!==b.length||(r.encoding.opacity={value:.7}),0===N.length)a=Object(p.a)({},a,{},r);else if(N.length>0){r.transform=[{filter:{selection:"brush"}},t?{aggregate:T,groupby:u.filter((function(e){return e!==N[0]}))}:null].filter(Boolean);var i={width:600,mark:"tick",selection:{brush:{encodings:["x"],type:"interval"}},encoding:{x:{field:N[0],type:F(N[0])}}};a.vconcat=[r,i]}return a}();Object($.a)(D.current,e)}})),i.a.createElement("div",{ref:D})},Z=n(21),ee=n(96),te=n.n(ee),ne=n(353),ae=n(15),re=(n(142),function(e){var t=e.space,n=e.dimensions,a=void 0===n?[]:n,r=e.measures,c=void 0===r?[]:r,s=e.dimScores,m=void 0===s?[]:s,d=e.spaceList,f=void 0===d?[]:d,p=e.schema,g=Object(o.useState)(!1),v=Object(u.a)(g,2),h=v[0],y=v[1],b=Object(o.useMemo)((function(){return Object(l.a)(m).sort((function(e,t){return e[1]-t[1]}))}),[m]),x=Object(o.useMemo)((function(){if("undefined"!==typeof t){var e=!0,n=!1,a=void 0;try{for(var r,o=f[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var i=r.value;if(i.dimensions.some((function(e){return t.dimensions.includes(e)})))return i.dimensions.find((function(e){return t.dimensions.includes(e)}))}}catch(c){n=!0,a=c}finally{try{e||null==o.return||o.return()}finally{if(n)throw a}}}}),[]),E=Object(o.useMemo)((function(){if("undefined"!==typeof t){for(var e=t.measures.filter((function(e){return c.includes(e.name)})),n=1/0,a=0,r=0;r<e.length;r++)e[r].value<n&&(n=e[r].value,a=r);return e[a].name}}),[c,t]),S=Object(o.useMemo)((function(){var e=b.find((function(e){return a.includes(e[0])}));return e?e[0]:void 0}),[b,a]),j="\n  ".concat(p&&p.position?"Current chart mainly focus on the relationship between ***".concat(p.position[0],"*** and ***").concat(p.position[1],"***"):"","\n  ").concat(a.length>1?"+ DataSource is grouped by ***".concat(a.join(", "),"***, measures(indicators) will propose strong difference of distribution between each other."):"","\n  ").concat(c.length>1?"+ ***".concat(c.join(", "),"***are strongly related to each other"):"","\n  ").concat(S?"+ The distribution of member countings of ***".concat(S,"*** seems to contain more orders and patterns."):"","\n  ").concat(x?"+ ***".concat(x,"*** has great influence on aggregated measure values."):"","\n  ").concat(E?"+ ***".concat(E,"*** is more likely to have patterns according to its distribution."):"","\n  ``  ");return i.a.createElement("div",null,i.a.createElement(K.a,{id:"vis-summary",text:"Summary",onClick:function(){y(!0)}}),h?i.a.createElement("div",null,i.a.createElement(ne.a,{calloutProps:{directionalHint:ae.a.bottomCenter},isWide:!0,hasCloseIcon:!0,closeButtonAriaLabel:"Close",target:"#vis-summary",onDismiss:function(){y(!1)},headline:"Chart Description"},i.a.createElement(te.a,{source:j}))):null)}),oe=function(e){var t=e.space,n=e.dimensions,a=void 0===n?[]:n,r=e.measures,c=void 0===r?[]:r,s=e.dimScores,u=void 0===s?[]:s,m=e.spaceList,d=void 0===m?[]:m,f=e.schema,p=Object(o.useMemo)((function(){return Object(l.a)(u).sort((function(e,t){return e[1]-t[1]}))}),[u]),g=Object(o.useMemo)((function(){if("undefined"!==typeof t){var e=!0,n=!1,a=void 0;try{for(var r,o=d[Symbol.iterator]();!(e=(r=o.next()).done);e=!0){var i=r.value;if(i.dimensions.some((function(e){return t.dimensions.includes(e)})))return i.dimensions.find((function(e){return t.dimensions.includes(e)}))}}catch(c){n=!0,a=c}finally{try{e||null==o.return||o.return()}finally{if(n)throw a}}}}),[]),v=Object(o.useMemo)((function(){if("undefined"!==typeof t){for(var e=t.measures.filter((function(e){return c.includes(e.name)})),n=1/0,a=0,r=0;r<e.length;r++)e[r].value<n&&(n=e[r].value,a=r);return e[a].name}}),[c,t]),h=Object(o.useMemo)((function(){var e=p.find((function(e){return a.includes(e[0])}));return e?e[0]:void 0}),[p,a]),y="\n  ".concat(f&&f.position?"Current chart mainly focus on the relationship between ***".concat(f.position[0],"*** and ***").concat(f.position[1],"***"):"","\n  ").concat(a.length>1?"+ DataSource is grouped by ***".concat(a.join(", "),"***, measures(indicators) will propose strong difference of distribution between each other."):"","\n  ").concat(c.length>1?"+ ***".concat(c.join(", "),"***are strongly related to each other"):"","\n  ").concat(h?"+ The distribution of member countings of ***".concat(h,"*** seems to contain more orders and patterns."):"","\n  ").concat(g?"+ ***".concat(g,"*** has great influence on aggregated measure values."):"","\n  ").concat(v?"+ ***".concat(v,"*** is more likely to have patterns according to its distribution."):"","\n  ``  ");return i.a.createElement(te.a,{source:y})},ie=.2,ce=5;function se(e,t){var n=new Set([].concat(Object(l.a)(e),Object(l.a)(t))),a=new Set(e),r=new Set(t),o=[],i=[],c=!0,s=!1,u=void 0;try{for(var m,d=n[Symbol.iterator]();!(c=(m=d.next()).done);c=!0){var f=m.value;o.push(Number(a.has(f))),i.push(Number(r.has(f)))}}catch(v){s=!0,u=v}finally{try{c||null==d.return||d.return()}finally{if(s)throw u}}for(var p=0,g=0;g<o.length;g++)p+=o[g]*i[g];return p/=Math.sqrt(e.length)*Math.sqrt(t.length)}var ue=function(e){var t=e.viewSpaces,n=e.interestedViewSpace,a=e.fieldScores,r=e.dataSource,i=(e.visualConfig,Object(o.useMemo)((function(){var e=[],a=!0,r=!1,o=void 0;try{for(var i,c=function(){var t=i.value;t.dimensions.length>n.dimensions.length&&t.dimensions.length-n.dimensions.length<=2&&(n.dimensions.every((function(e){return t.dimensions.find((function(t){return e===t}))}))&&e.push(t))},s=t[Symbol.iterator]();!(a=(i=s.next()).done);a=!0)c()}catch(u){r=!0,o=u}finally{try{a||null==s.return||s.return()}finally{if(r)throw o}}return e}),[n,t])),c=Object(o.useMemo)((function(){var e=[],t=!0,a=!1,r=void 0;try{for(var o,c=i[Symbol.iterator]();!(t=(o=c.next()).done);t=!0){var s=o.value,u=se(n.measures,s.measures);u>ie&&e.push(Object(p.a)({},s,{relatedScore:s.score/Math.sqrt(u)}))}}catch(l){a=!0,r=l}finally{try{t||null==c.return||c.return()}finally{if(a)throw r}}return e.sort((function(e,t){return e.relatedScore-t.relatedScore}))}),[i]);return Object(o.useMemo)((function(){return c.slice(0,ce).map((function(e){var t=a.filter((function(t){return e.dimensions.includes(t[0])||e.measures.includes(t[0])}));return Object(p.a)({},e,{schema:Object(Z.d)(t,r,e.dimensions,e.measures).schema})}))}),[c,a])};var le=function(e){var t=e.digDimensionProps,n=e.subspaceList,a=e.onSelectView,r=t.dataSource,o=t.visualConfig,c=t.fieldScores,s=ue(t),u=c.map((function(e){return e[3]}));return i.a.createElement("div",null,i.a.createElement("div",{className:"ms-Grid"},s.map((function(e,t){var s=n.find((function(t){return n=t.dimensions,a=e.dimensions,n.length===a.length&&n.every((function(e){return a.includes(e)}));var n,a}));return i.a.createElement("div",{key:"associate-row-".concat(t),className:"ms-Grid-row",style:{border:"solid 1px #bfbfbf",margin:"1em",padding:"1em"}},i.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md8 ms-lg9",style:{overflow:"auto"}},i.a.createElement(Q,{aggregator:o.aggregator,defaultAggregated:!e.schema.geomType||!e.schema.geomType.includes("point"),defaultStack:o.defaultStack,dimensions:e.dimensions,measures:e.measures,dataSource:r,schema:e.schema,fieldFeatures:u})),i.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md4 ms-lg3",style:{fontSize:14,color:"#8a8886",overflow:"auto"}},i.a.createElement("div",null,i.a.createElement(G.a,{tokens:{childrenGap:8},horizontal:!0},i.a.createElement(B.a,{iconProps:{iconName:"Lightbulb"},title:"Interested",onClick:function(){a(e.index)}}))),s&&i.a.createElement(oe,{dimensions:e.dimensions,measures:e.measures,dimScores:c,space:s,spaceList:n,schema:e.schema})))}))))},me=function(e){var t=e.dataSource,n=e.summary,a=e.subspaceList,r=Object(o.useState)(0),c=Object(u.a)(r,2),s=c[0],m=c[1],d=k(),v=Object(u.a)(d,2),h=v[0],y=v[1],b=P({show:{insightBoard:!1,fieldConfig:!1,configPanel:!1,dataConfig:!1}}),x=Object(u.a)(b,2),E=x[0],S=x[1],j=Object(o.useState)(!1),O=Object(u.a)(j,2),w=O[0],N=O[1],C=Object(o.useState)({aggregator:"sum",defaultAggregated:!0,defaultStack:!0}),M=Object(u.a)(C,2),D=M[0],F=M[1],T=Object(o.useState)([]),L=Object(u.a)(T,2),I=L[0],A=L[1],R=Object(o.useState)({schema:{position:[],color:[],opacity:[],geomType:[]},fieldFeatures:[],aggData:[],dimensions:[],measures:[]}),q=Object(u.a)(R,2),W=q[0],V=q[1],U=function(e){m(e)};Object(o.useEffect)((function(){y((function(e){e.loading.gallery=!0})),function(e,t){var n,a,r;return f.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:return n=[],o.prev=1,o.next=4,f.a.awrap(fetch(g+"/api/service/clusterMeasures",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({maxGroupNumber:e,spaces:t})}));case 4:return a=o.sent,o.next=7,f.a.awrap(a.json());case 7:if(!0!==(r=o.sent).success){o.next=12;break}n=r.data.map((function(e,t){return Object(p.a)({},e,{index:t})})),o.next=13;break;case 12:throw new Error("[cluster measures]"+r.message);case 13:o.next=18;break;case 15:o.prev=15,o.t0=o.catch(1),console.error(o.t0);case 18:return o.abrupt("return",n);case 19:case"end":return o.stop()}}),null,null,[[1,15]])}(h.maxGroupNumber,a.map((function(e){return{dimensions:e.dimensions,measures:e.measures,matrix:e.correlationMatrix}}))).then((function(e){A(e),y((function(e){e.loading.gallery=!1}))}))}),[a,t,h.maxGroupNumber]);var H=Object(o.useMemo)((function(){return[].concat(Object(l.a)(n.origin),Object(l.a)(n.grouped)).map((function(e){return[e.fieldName,e.entropy,e.maxEntropy,{name:e.fieldName,type:e.type}]}))}),[n.origin,n.grouped]);Object(o.useEffect)((function(){var e=I[s];if(e){var n=e.dimensions,a=e.measures;try{var r=H.filter((function(e){return n.includes(e[0])||a.includes(e[0])})),o=Object(Z.d)(r,t,n,a).schema;V({schema:o,fieldFeatures:r.map((function(e){return e[3]})),aggData:t,dimensions:n,measures:a}),o.geomType&&(o.geomType.includes("point")||o.geomType.includes("density"))?F((function(e){return Object(p.a)({},e,{defaultAggregated:!1})})):F((function(e){return Object(p.a)({},e,{defaultAggregated:!0})}))}catch(i){console.log(i)}}}),[I,s]);var Y=Object(o.useMemo)((function(){return a.find((function(e){return e.dimensions.join(",")===W.dimensions.join(",")}))}),[a,s,W]);return Object(o.useEffect)((function(){N(!1)}),[s]),i.a.createElement("div",{className:"content-container"},i.a.createElement(J,{show:E.show.configPanel,config:D,onUpdateConfig:function(e){F(e),S((function(e){e.show.configPanel=!1}))},onClose:function(){S((function(e){e.show.configPanel=!1}))}}),i.a.createElement("div",{className:"card"},(h.loading.gallery||h.loading.subspaceSearching||h.loading.univariateSummary)&&i.a.createElement(z.a,{description:"calculating"}),i.a.createElement("h2",{style:{marginBottom:0}},"Visual Insights"," ",i.a.createElement(B.a,{iconProps:{iconName:"Settings"},title:"Preference",ariaLabel:"preference",onClick:function(){S((function(e){e.show.configPanel=!0}))}}),i.a.createElement(B.a,{iconProps:{iconName:"Lightbulb"},title:"Dig In",ariaLabel:"digIn",onClick:function(){N(!0)}})),i.a.createElement("p",{className:"state-description"},"Page No. ",s+1," of ",I.length),i.a.createElement("p",{className:"state-description"},"Details of the recommendation process can be seen in ",i.a.createElement("b",null,"NoteBook")," ","Board. You can adjust some of the parameters and operators and see how it influence recommendation results."),i.a.createElement("p",{className:"state-description"},'Try to use the setting button beside the "visual insight" title to adjust the visualization settings to get a view you prefer better.'),i.a.createElement("div",{className:"ms-Grid",dir:"ltr"},i.a.createElement("div",{className:"ms-Grid-row"},i.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md8 ms-lg3",style:{overflow:"auto"}},i.a.createElement(G.a,{horizontal:!0,tokens:{childrenGap:20}},i.a.createElement(K.a,{text:"Last",onClick:function(){U((s-1+I.length)%I.length)},allowDisabledFocus:!0}),i.a.createElement(K.a,{text:"Next",onClick:function(){U((s+1)%I.length)},allowDisabledFocus:!0})),i.a.createElement("h3",null,"Specification"),i.a.createElement("pre",null,JSON.stringify(W.schema,null,2)),i.a.createElement(re,{dimensions:W.dimensions,measures:W.measures,dimScores:H,space:Y,spaceList:a,schema:W.schema})),i.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md4 ms-lg9",style:{overflow:"auto"}},i.a.createElement(Q,{aggregator:D.aggregator,defaultAggregated:D.defaultAggregated,defaultStack:D.defaultStack,dimensions:W.dimensions,measures:W.measures,dataSource:W.aggData,schema:W.schema,fieldFeatures:W.fieldFeatures}))))),w&&i.a.createElement("div",{className:"card"},i.a.createElement("h2",null," Related Views "),i.a.createElement(le,{onSelectView:function(e){var t=I.findIndex((function(t){return t.index===e}));t>-1&&U(t)},subspaceList:a,digDimensionProps:{visualConfig:D,dataSource:t,viewSpaces:I,fieldScores:H,interestedViewSpace:I[s]}})))},de=n(355),fe=n(347),pe=n(344),ge=n(34),ve=n(162),he=n.n(ve),ye=n(171),be=function(e){var t=Object(o.useRef)(null),n=e.x,a=e.y,r=e.dataSource,c=e.fieldType;return Object(o.useEffect)((function(){if(t.current){var e=[],o=!1;e="ordinal"===c&&r.some((function(e){return/(\[|\()-?([0-9.]+|Infinity),\s*([0-9.]+|Infinity)(\]|\))/.test(e.memberName)}))?r.map((function(e){o=!0;var t=Object(ye.a)(/(\[|\()(\x2D?([\.0-9]+|Infinity)),[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*([\.0-9]+|Infinity)(\]|\))/,{left:2}).exec(e.memberName);return Object(p.a)({},e,{index:null===t?e.name:Number(t.groups.left)})})):r;var i=void 0;"nominal"===c?i="-y":"ordinal"===c&&o&&(i={field:"index"}),Object($.a)(t.current,{background:"#fff",data:{values:e},height:120,width:200,mark:["quantitative","temporal"].includes(c)?"line":"bar",encoding:{x:{field:n,axis:r.length>16?null:void 0,type:c,sort:i},y:{field:a,type:"quantitative",aggregate:"sum"}}},{actions:!1})}}),[n,a,r]),i.a.createElement("div",{ref:t})},xe=(n(281),[{key:"fieldName",name:"fieldName",fieldName:"fieldName",minWidth:70,maxWidth:150},{key:"type",name:"type",fieldName:"type",minWidth:50},{key:"entropy",name:"entropy",fieldName:"entropy",minWidth:120},{key:"maxEntropy",name:"maxEntropy",fieldName:"maxEntropy",minWidth:120}]);function Ee(e){switch(e){case"nominal":return"TextField";case"quantitative":return"NumberField";case"ordinal":return"Breadcrumb";case"temporal":return"EventDate";default:return""}}function Se(e){return(.299*e[0]+.587*e[1]+.114*e[2])/255>.5?[0,0,0]:[255,255,255]}var je=function(e){var t=e.originSummary,n=e.groupedSummary,a=Object(o.useMemo)((function(){var e=t.map((function(e){return e.maxEntropy}));return[0,Math.max.apply(Math,Object(l.a)(e))]}),[t]),r=function(e){return i.a.createElement("div",{className:"field-hover-card"},i.a.createElement("h2",null,e.fieldName),i.a.createElement("div",null,"Field entropy is ",Number(e.entropy).toFixed(2)),i.a.createElement("div",{className:"chart-vertical-margin-container"},i.a.createElement(be,{x:"memberName",y:"count",fieldType:e.type,dataSource:e.distribution})))},c=function(e){var t=e.fieldName,a=n.find((function(e){return e.fieldName===t+"(group)"}));return i.a.createElement("div",{className:"field-hover-card"},a?i.a.createElement("div",null,i.a.createElement("h3",null,a.fieldName),i.a.createElement("div",null,"Field entropy is ",Number(a.entropy).toFixed(2)),i.a.createElement("div",{className:"chart-vertical-margin-container"},i.a.createElement(be,{x:"memberName",y:"count",fieldType:a.type,dataSource:a.distribution}))):i.a.createElement("div",null,"This field is not grouped."))};return i.a.createElement(pe.a,{compact:!0,columns:xe,items:t,selectionMode:ge.b.none,onRenderItemColumn:function(e,t,o){if(void 0!==o){var s=e.fieldName,u=n.find((function(e){return e.fieldName===s+"(group)"})),l={onRenderCompactCard:r,onRenderExpandedCard:c,renderData:e,compactCardHeight:320,expandedCardHeight:u?320:40},m=e[o.fieldName],d=[255,255,255];switch(o.key){case"type":return i.a.createElement("div",null,i.a.createElement(de.a,{iconName:Ee(m)})," ",m);case"entropy":case"maxEntropy":g=e[o.key],v=a;Se(d=he.a.scale("YlGnBu").domain([v[1],v[0]])(g).rgb());var f="rgb(".concat(d.join(","),")"),p="rgb(".concat(Se(d).join(","),")");return i.a.createElement(fe.a,{expandedCardOpenDelay:800,expandingCardProps:l,instantOpenOnClick:!0},i.a.createElement("div",{style:{boxShadow:"".concat(f," 0px 0px 0px 10px"),backgroundColor:f,color:p}},m));default:return i.a.createElement(fe.a,{expandedCardOpenDelay:800,expandingCardProps:l,instantOpenOnClick:!0},i.a.createElement("div",null,m))}}var g,v}})};function Oe(e){return e.join(",")}var we=function(e){var t=e.subspaceList,n=e.onSpaceChange,a=Object(o.useState)(0),r=Object(u.a)(a,2),c=r[0],s=r[1],l=Object(o.useRef)(null),m=Object(o.useRef)(null),d=Object(o.useMemo)((function(){var e=0,n=1/0,a=!0,r=!1,o=void 0;try{for(var i,c=t[Symbol.iterator]();!(a=(i=c.next()).done);a=!0){var s=i.value,u=!0,l=!1,m=void 0;try{for(var d,f=s.measures[Symbol.iterator]();!(u=(d=f.next()).done);u=!0){var p=d.value,g=(p.name,p.value);e=Math.max(e,g),n=Math.min(n,g)}}catch(v){l=!0,m=v}finally{try{u||null==f.return||f.return()}finally{if(l)throw m}}}}catch(v){r=!0,o=v}finally{try{a||null==c.return||c.return()}finally{if(r)throw o}}return[n,e]}),[t]),f=Object(o.useMemo)((function(){for(var e=[],n=0;n<t.length;n++){var a=t[n],r=Oe(a.dimensions),o=!0,i=!1,c=void 0;try{for(var s,u=a.measures[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var l=s.value,m=l.name,d=l.value,f={test:n,score:a.score,dimensions:r,measureName:m,measureValue:d};e.push(f)}}catch(p){i=!0,c=p}finally{try{o||null==u.return||u.return()}finally{if(i)throw c}}}return e}),[t,d]);return Object(o.useEffect)((function(){l.current&&t.length>0&&Object($.a)(l.current,{data:{values:f},vconcat:[{mark:"rect",selection:{dim:{type:"single",on:"click",encodings:["y"]}},encoding:{x:{field:"measureName",type:"nominal"},y:{field:"dimensions",type:"ordinal",sort:{field:"score"}},color:{field:"measureValue",type:"quantitative",aggregate:"mean",scale:{reverse:!0}},opacity:{condition:{selection:"dim",value:1},value:.72}}}]}).then((function(e){e.view.addEventListener("click",(function(e,a){if(a){var r=a.datum,o=t.findIndex((function(e){return Oe(e.dimensions)===r.dimensions}));if(o>-1){var i=t[o];n(i.dimensions,i.measures.map((function(e){return e.name})),i.correlationMatrix),s(o)}}}))}))}),[t,f]),Object(o.useEffect)((function(){var e=t[c];if(m.current&&t.length>0&&e){for(var n=[],a=0;a<e.correlationMatrix.length;a++)for(var r=0;r<e.correlationMatrix[a].length;r++)n.push({x:e.measures[a].name,y:e.measures[r].name,correlation:e.correlationMatrix[a][r]});Object($.a)(m.current,{data:{values:n},mark:"rect",encoding:{x:{field:"x",type:"nominal"},y:{field:"y",type:"nominal"},color:{field:"correlation",type:"quantitative",aggregate:"mean",scale:{scheme:"redyellowgreen",domain:[-1,1]}}}})}}),[t,c]),i.a.createElement("div",null,i.a.createElement("div",{ref:l}),i.a.createElement("div",{ref:m}))},ke=function(e){var t=e.adjMatrix,n=e.measures,a=e.onFocusGroup,r=k(),c=Object(u.a)(r,2),s=c[0],l=(c[1],Object(o.useRef)(null)),m=Object(o.useMemo)((function(){var e=Object(Z.c)(t,s.maxGroupNumber);return{edgesInMST:e.edgesInMST,groups:e.groups}}),[t,s.maxGroupNumber]),d=Object(o.useMemo)((function(){for(var e=m.edgesInMST,t=m.groups,a=e.map((function(e){return{source:e[0][0],target:e[0][1],value:1/e[1],inCutEdge:e[2]}})),r=[],o=0;o<t.length;o++)r.push({name:n[o],index:o,value:1,group:t[o]});return{nodes:r,edges:a}}),[n,m]);return Object(o.useEffect)((function(){l.current&&n.length>0&&Object($.a)(l.current,{$schema:"https://vega.github.io/schema/vega/v5.json",width:700,height:500,padding:0,autosize:"none",signals:[{name:"cx",update:"width / 2"},{name:"cy",update:"height / 2"},{description:"State variable for active node fix status.",name:"fix",value:!1,on:[{events:"text:mouseout[!event.buttons], window:mouseup",update:"false"},{events:"text:mouseover",update:"fix || true"},{events:"[text:mousedown, window:mouseup] > window:mousemove!",update:"xy()",force:!0}]},{description:"Graph node most recently interacted with.",name:"node",value:null,on:[{events:"text:mouseover",update:"fix === true ? item() : node"}]},{description:"Flag to restart Force simulation upon data changes.",name:"restart",value:!1,on:[{events:{signal:"fix"},update:"fix && fix.length"}]}],data:[{name:"node-data",values:d.nodes},{name:"link-data",values:d.edges}],scales:[{name:"color",type:"ordinal",domain:{data:"node-data",field:"group"},range:{scheme:"tableau20"}},{name:"colorEdge",type:"quantize",domain:{data:"link-data",field:"value"},range:{scheme:"viridis"}}],marks:[{name:"nodes",type:"text",zindex:1,from:{data:"node-data"},on:[{trigger:"fix",modify:"node",values:"fix === true ? {fx: node.x, fy: node.y} : {fx: fix[0], fy: fix[1]}"},{trigger:"!fix",modify:"node",values:"{fx: null, fy: null}"}],encode:{enter:{fill:{scale:"color",field:"group"},text:{field:"name"},fontSize:{value:14},fontWeight:{value:600}},update:{cursor:{value:"pointer"}}},transform:[{type:"force",iterations:300,restart:{signal:"restart"},signal:"force",forces:[{force:"center",x:{signal:"cx"},y:{signal:"cy"}},{force:"collide"},{force:"nbody"},{force:"link",links:"link-data"}]}]},{type:"path",from:{data:"link-data"},interactive:!1,encode:{update:{stroke:{scale:"colorEdge",field:"value"},strokeWidth:{value:.8},opacity:{value:.5}}},transform:[{type:"linkpath",require:{signal:"force"},shape:"line",sourceX:"datum.source.x",sourceY:"datum.source.y",targetX:"datum.target.x",targetY:"datum.target.y"}]}]}).then((function(e){e.view.addEventListener("click",(function(e,t){if(t){var r=t.datum.group,o=n.filter((function(e,t){return m.groups[t]===r}));a(o)}}))}))}),[d,n]),i.a.createElement("div",{ref:l})},Ne=n(360),Ce=n(361),Me=(n(282),function(e){var t=e.summary,n=e.subspaceList,a=e.dataSource,r=k(),c=Object(u.a)(r,2),s=c[0],m=c[1],d=Object(o.useState)(!1),f=Object(u.a)(d,2),p=f[0],g=f[1],v=Object(o.useState)({measures:[],dimensions:[],matrix:[]}),h=Object(u.a)(v,2),b=h[0],x=h[1],E=Object(o.useState)([]),S=Object(u.a)(E,2),j=S[0],O=S[1],w=Object(o.useMemo)((function(){return[].concat(Object(l.a)(t.origin),Object(l.a)(t.grouped)).map((function(e){return[e.fieldName,e.entropy,e.maxEntropy,{name:e.fieldName,type:e.type}]}))}),[t.origin,t.grouped]),N=Object(o.useMemo)((function(){var e=b.dimensions;b.measures;try{var t=w.filter((function(t){return e.includes(t[0])||j.includes(t[0])}));return Object(Z.d)(t,a,e,j).schema}catch(n){return console.log(n),{position:[]}}}),[w,b,a,j]);return Object(o.useEffect)((function(){m((function(e){e.maxGroupNumber=Math.round(s.cookedMeasures.length/4)}))}),[s.cookedMeasures]),i.a.createElement("div",null,i.a.createElement("h3",{className:"notebook header"},"Univariate Summary"),i.a.createElement("p",{className:"state-description"},"Hover your mouse over the fields and see the distails and entropy reducing strategy."),s.loading.univariateSummary&&i.a.createElement(z.a,{description:"analyzing"}),i.a.createElement("div",{className:"notebook content container"},i.a.createElement(je,{originSummary:t.origin,groupedSummary:t.grouped})),i.a.createElement("h3",{className:"notebook header"},"Subspace Searching"),i.a.createElement("p",{className:"state-description"},"Try to choose one row(combination of dimensions) of the subspace and see the changes of the processes below."),s.loading.subspaceSearching&&i.a.createElement(z.a,{description:"analyzing"}),!s.loading.subspaceSearching&&i.a.createElement(Ne.a,{value:100*s.topK.dimensionSize,label:"top k percent dimension used",max:100,valueFormat:function(e){return"".concat(e,"%")},showValue:!0,onChange:function(e){m((function(t){t.topK.dimensionSize=e/100}));var t=s.cookedDimensions.slice(0,Math.round(s.cookedDimensions.length*e/100));y(a,t,s.cookedMeasures,"sum").then((function(e){e&&m((function(t){t.subspaceList=e}))}))}}),!s.loading.subspaceSearching&&i.a.createElement(Ne.a,{value:100*s.topK.subspacePercentSize,label:"top k percent subspace used",max:100,valueFormat:function(e){return"".concat(e,"%")},showValue:!0,onChange:function(e){m((function(t){t.topK.subspacePercentSize=e/100}))}}),i.a.createElement("div",{className:"notebook content center container"},i.a.createElement(we,{subspaceList:n.slice(0,Math.round(n.length*s.topK.subspacePercentSize)),onSpaceChange:function(e,t,n){x({dimensions:e,measures:t,matrix:n})}})),i.a.createElement("h3",{className:"notebook header"},"Measurement Clustering"),i.a.createElement("p",{className:"state-description"},"Try to choose one group to visualize them."),i.a.createElement(Ne.a,{label:"Max Group Number",min:1,max:s.cookedMeasures.length||4,step:1,value:s.maxGroupNumber,showValue:!0,onChange:function(e){m((function(t){t.maxGroupNumber=e}))}}),i.a.createElement("div",{className:"notebook content center container"},i.a.createElement(ke,{adjMatrix:b.matrix,measures:b.measures,onFocusGroup:function(e){O(e),console.log("view in measures",e)}})),i.a.createElement("h3",{className:"notebook header"},"Visualization"),i.a.createElement("p",{className:"state-description"},"If there is no result here, try to click one group of measures in ",i.a.createElement("b",null,"Clustering")," process above."),i.a.createElement(Ce.a,{checked:p,label:"aggregate measures",defaultChecked:!0,onText:"On",offText:"Off",onChange:function(e,t){g(!!t)}}),i.a.createElement("div",{className:"notebook content center container"},i.a.createElement(Q,{defaultAggregated:p,defaultStack:!0,aggregator:"sum",schema:N,fieldFeatures:w.map((function(e){return e[3]})),dataSource:a,dimensions:b.dimensions,measures:j})))}),De=n(170),Fe=n(351),Te=n(345),Le=function(e){var t=e.dataSource,n=void 0===t?[]:t,a=e.fields,r=(void 0===a?[]:a).map((function(e){return{key:e.name,name:e.name,fieldName:e.name,minWidth:70,maxHeight:90}}));return i.a.createElement("div",{style:{maxHeight:400,overflow:"auto"}},i.a.createElement(pe.a,{items:n,columns:r,selectionMode:ge.b.none}))},Pe=function(e){var t=e.show,n=void 0!==t&&t,a=e.onUpdateConfig,r=e.onClose,c=Object(o.useState)([]),s=Object(u.a)(c,2),l=s[0],m=s[1];Object(o.useEffect)((function(){m(e.fields)}),[e.fields]);return i.a.createElement(A.a,{isOpen:n,type:R.a.smallFixedFar,onDismiss:r,headerText:"Meta Config",closeButtonAriaLabel:"Close",onRenderFooterContent:function(){return i.a.createElement("div",null,i.a.createElement(I.a,{onClick:function(){a(l),r()}},"Save"))}},i.a.createElement("div",null,l.map((function(e){return i.a.createElement(Ce.a,{key:e.name,checked:"dimension"===e.type,label:e.name,onText:"dimension",offText:"measure",onChange:function(t,n){!function(e,t){m((function(n){return n.map((function(n){return e.name===n.name?{name:e.name,type:t}:n}))}))}(e,n?"dimension":"measure")}})}))))};var ze=[{key:"dropNull",text:"drop null records"},{key:"useMode",text:"replace null with mode"},{key:"simpleClean",text:"simple cleaning"}];function Be(e,t,n){var a=Object(o.useMemo)((function(){return t.filter((function(e){return"dimension"===e.type})).map((function(e){return e.name}))}),[t]),i=Object(o.useMemo)((function(){return t.filter((function(e){return"measure"===e.type})).map((function(e){return e.name}))}),[t]),c=Object(o.useMemo)((function(){return e.map((function(e){var n={};return t.forEach((function(t){n[t.name]="dimension"===t.type?e[t.name]:r.transNumber(e[t.name])})),n}))}),[e,t]),s=Object(o.useMemo)((function(){return function(e,t,n,a){switch(a){case"dropNull":return Z.a.dropNull(e,t,n);case"useMode":return Z.a.useMode(e,t.concat(n));case"simpleClean":default:return Z.a.simpleClean(e,t,n)}}(function(e){return JSON.parse(JSON.stringify(e))}(c),a,i,n)}),[a,i,c,n]);return[c,s]}var Ge,Ke=n(343);!function(e){e.none="none",e.reservoir="reservoir"}(Ge||(Ge={}));var Ie=[{key:Ge.none,text:"none"},{key:Ge.reservoir,text:"reservoir"}],Ae=function(e){var t=k(),n=Object(u.a)(t,3),r=n[0],c=n[1],s=n[2],l=P({show:{insightBoard:!1,fieldConfig:!1,configPanel:!1,dataConfig:!1}}),m=Object(u.a)(l,2),d=m[0],p=m[1],g=Object(o.useState)("dropNull"),v=Object(u.a)(g,2),h=v[0],y=v[1],b=Object(o.useState)(Ge.none),x=Object(u.a)(b,2),E=x[0],S=x[1],j=Object(o.useState)(.2),O=Object(u.a)(j,2),w=O[0],N=O[1],C=Object(o.useRef)(null),M=Object(o.useRef)(null),D=Be(r.rawData,r.fields,h),F=Object(u.a)(D,2),T=F[0],L=F[1],z=Object(Ke.a)("labelElement");var K=[{key:"upload",name:"Upload",iconProps:{iconName:"Upload"},onClick:function(){M.current&&M.current.click()}}];return i.a.createElement("div",{className:"content-container"},i.a.createElement(Pe,{fields:r.fields,show:d.show.fieldConfig,onUpdateConfig:function(e){c((function(t){t.fields=e}))},onClose:function(){p((function(e){e.show.fieldConfig=!1}))}}),i.a.createElement("div",{className:"card"},i.a.createElement(G.a,{horizontal:!0},i.a.createElement(I.a,{disabled:0===T.length,iconProps:{iconName:"Financial"},text:"Extract Insights",onClick:function(){s("extractInsights",{dataSource:L,fields:r.fields}),e.onExtractInsights()}}),i.a.createElement("div",{ref:C},i.a.createElement(B.a,{iconProps:{iconName:"ExcelDocument"},title:"Upload",ariaLabel:"upload data",onClick:function(){p((function(e){e.show.dataConfig=!0}))}}),i.a.createElement(De.a,{style:{maxWidth:300},className:"vi-callout-callout",role:"alertdialog",gapSpace:0,target:C.current,onDismiss:function(){p((function(e){e.show.dataConfig=!1}))},setInitialFocus:!0,hidden:!d.show.dataConfig},i.a.createElement("div",{className:"vi-callout-header"},i.a.createElement("p",{className:"vi-callout-title"},"Upload Your own dataset")),i.a.createElement("div",{className:"vi-callout-inner"},i.a.createElement("div",{className:"vi-callout-content"},i.a.createElement("p",{className:"vi-callout-subTex"},".csv, .json are supportted.")),i.a.createElement("div",null,i.a.createElement(q.a,{id:z,required:!0},"Sampling"),i.a.createElement(Fe.a,{defaultSelectedKey:"B",options:Ie,selectedKey:E,onChange:function(e,t){t&&S(t.key)},ariaLabelledBy:z}),E!==Ge.none&&i.a.createElement(Ne.a,{label:"sample size(percent)",min:0,max:1,step:.001,value:w,showValue:!0,valueFormat:function(e){return"".concat((100*e).toFixed(1),"%")},onChange:function(e){N(e)}})),i.a.createElement("div",{className:"vi-callout-actions"},i.a.createElement("input",{type:"file",ref:M,multiple:!0,accept:"*",style:{display:"none"},onChange:function(){var e,t,n;return f.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(null===M.current||null===M.current.files){r.next=22;break}if(e=M.current.files[0],t=[],n=[],"text/csv"!==e.type&&"application/vnd.ms-excel"!==e.type){r.next=10;break}return r.next=7,f.a.awrap(a.csvLoader(e));case 7:n=r.sent,r.next=17;break;case 10:if("application/json"!==e.type){r.next=16;break}return r.next=13,f.a.awrap(a.jsonLoader(e));case 13:n=r.sent,r.next=17;break;case 16:throw new Error("unsupported file type=".concat(e.type," "));case 17:E===Ge.reservoir&&(n=Z.b.reservoirSampling(n,Math.round(n.length*w))),n=Z.a.dropNullColumn(n,Object.keys(n[0])).dataSource,t=Object.keys(n[0]).map((function(e){return{name:e,type:n.every((function(t){return!isNaN(t[e])||void 0===t[e]}))?"measure":"dimension"}})),c((function(e){e.fields=t,e.rawData=n})),p((function(e){e.show.dataConfig=!1}));case 22:case"end":return r.stop()}}))}}),i.a.createElement(Te.a,{overflowButtonProps:{name:"More"},items:K}))))),i.a.createElement(B.a,{iconProps:{iconName:"Settings"},title:"Field Setting",ariaLabel:"field setting",onClick:function(){p((function(e){e.show.fieldConfig=!0}))}})),i.a.createElement("div",{style:{margin:"20px 0px"}},i.a.createElement(W.a,{styles:{root:{maxWidth:"180px"}},selectedKey:h,label:"Clean Method",allowFreeform:!0,autoComplete:"on",options:ze,onChange:function(e,t){t&&y(t.key)}})),i.a.createElement("p",{style:{fontSize:12,fontWeight:400,color:"#595959"}},"Remember to adjust the fields' types and cleaning strategy before extracting insights."),i.a.createElement("i",{style:{fontSize:12,fontWeight:300,color:"#595959"}},"Number of records ",L.length),i.a.createElement(Le,{fields:r.fields,dataSource:L})))},Re=n(362),qe=n(346),We=n(163),Ve=n(165),Ue=n(164),He=n.n(Ue);function Je(){var e=Object(We.a)(["\n  float: left;\n  padding: 1rem;\n  border: 1px solid #f5f5f5;\n  margin: 1rem;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB',\n  'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif, 'Apple Color Emoji',\n  'Segoe UI Emoji', 'Segoe UI Symbol';\n  .indicator-card.header {\n    color: #8c8c8c;\n    margin-top: 0px;\n    margin-bottom: 0px;\n    font-size: 20px;\n    line-height: 28px;\n    font-weight: 400;\n  }\n  .indicator-card.content {\n    color: #0078d4;\n    font-size: 56px;\n    line-height: 64px;\n    font-weight: 400;\n    margin: 0px;\n  }\n"]);return Je=function(){return e},e}var Ye=Ve.a.div(Je()),Xe=function(e){var t=e.dataSource,n=void 0===t?[]:t,a=e.measures,r=void 0===a?[]:a,c=e.operator,s=void 0===c?"sum":c,u=Object(o.useMemo)((function(){if(0===r.length||0===n.length)return"-";var e=0;try{e=He.a[s](n.map((function(e){return e[r[0]]})))}catch(t){console.log("operator does not exist or not in vega/datalib.")}return Math.abs(e-Math.round(e))>1e-5&&(e=Number(e.toFixed(2))),function(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}(e)}),[n,r]);return i.a.createElement(Ye,null,i.a.createElement("h4",{className:"indicator-card header"},r[0]," ",s&&"(".concat(s,")")),i.a.createElement("h1",{className:"indicator-card content"},u))};var $e=function(e){var t=e.dashBoard,n=e.dataSource,a=e.dimScores,r=P({}),c=Object(u.a)(r,2),s=c[0],m=c[1],d=Object(o.useState)([]),f=Object(u.a)(d,2),p=f[0],g=f[1];Object(o.useEffect)((function(){g(t.map((function(){return!1})))}),[t]);var v=Object(o.useMemo)((function(){for(var e=a.map((function(e){return e[0]})),t={},r=n.length,o=e.length,i=0;i<o;i++)if("quantitative"===a[i][3].type){var c=e[i];t[c]=[0,100];for(var s=1/0,u=-1/0,l=0;l<r;l++)s=Math.min(n[l][c],s),u=Math.max(n[l][c],u);t[c]=[s,u]}return t}),[n,a]),h=Object(o.useMemo)((function(){return t&&n&&a?t.map((function(e){var t=e.dimensions,r=e.measures,o=e.type,i=a.filter((function(e){return t.includes(e[0])||r.includes(e[0])})),c=Object(Z.d)(i,n,t,r).schema;return c.position=c.position||[],c.color=c.color||[],c.opacity=c.opacity||[],c.size=c.size||[],c.shape=c.shape||[],c.geomType=c.geomType||[],{dimensions:t,measures:r,type:o,schema:c}})):[]}),[t,n,a]),y=a.map((function(e){return e[3]}));function b(e){var t=y.find((function(t){return t.name===e}));return t?t.type:"nominal"}function x(e,t,n,a){return"point"!==a&&!("quantitative"!==b(e)||!n.includes(e))}var E=Object(o.useMemo)((function(){return h.map((function(e,t){e.dimensions;var n=e.measures,a=e.schema;if("target"===e.type&&1===n.length)return{type:"indicator",measures:n,operator:"sum"};var r=a.geomType[0]&&_[a.geomType[0]]?_[a.geomType[0]]:a.geomType[0],o=b(a.position[0]),i=b(a.position[1]),c=x(a.position[0],0,n,r),s=x(a.position[1],0,n,r),u="quantitative"===o&&"quantitative"===i;return{data:{name:"dataSource"},autosize:{type:"pad"},mark:r,selection:{sl:{type:"bar"===r?"single":"interval",encodings:"bar"===r?["x"]:void 0}},encoding:{x:a.position[0]&&{field:a.position[0],type:b(a.position[0]),aggregate:c&&"sum",scale:u&&!c?{domain:v[a.position[0]]}:void 0},y:a.position[1]&&{field:a.position[1],type:b(a.position[1]),aggregate:s&&"sum",scale:u&&!s?{domain:v[a.position[1]]}:void 0},size:a.size[0]&&{field:a.size[0],type:b(a.size[0])},opacity:a.opacity[0]&&{field:a.opacity[0],type:b(a.opacity[0])},shape:a.shape[0]&&{field:a.shape[0],type:b(a.shape[0])},color:a.color[0]&&{field:a.color[0],type:a.color[0]&&b(a.color[0])}}}}))}),[h,v]),S=Object(o.useMemo)((function(){return{dataSource:n}}),[n,E,a]),j=Object(o.useMemo)((function(){return t.map((function(e,t){return{sl:function(e,n){p[t]&&m((function(e){if(0===Object.keys(n).length)for(var t in e)e[t]=[];else for(var a in n)e[a]=n[a]}))}}}))}),[t,p,a,E]),O=Object(o.useMemo)((function(){for(var e=[],a=Object.keys(s).map((function(e){return{fieldName:e,filter:s[e],isRange:2===s[e].length&&"number"===typeof s[e][0]&&"number"===typeof s[e][1]&&s[e][0]<s[e][1]}})),r=0;r<t.length;r++)if(p[r])e.push(S);else{var o=n.filter((function(e){return a.every((function(t){return 0===t.filter.length||(t.isRange?e[t.fieldName]>=t.filter[0]&&e[t.fieldName]<=t.filter[1]:t.filter.includes(e[t.fieldName]))}))}));e.push({dataSource:o})}return e}),[t,s,n,p,E,S]);return i.a.createElement("div",null,E.map((function(e,t){return"indicator"===e.type?i.a.createElement(Xe,{key:"ds-chart-".concat(t),dataSource:O[t].dataSource,measures:e.measures}):i.a.createElement("div",{key:"ds-chart-".concat(t),style:{float:"left",padding:"4px",margin:"2px",height:"380px",overflowY:"auto"}},i.a.createElement("div",{style:{float:"left",minWidth:"300px",minHeight:"300px"}},i.a.createElement(qe.a,{data:O[t],spec:e,actions:!0,signalListeners:p[t]&&j[t]})),i.a.createElement("div",{style:{float:"left"}},i.a.createElement(B.a,{iconProps:{iconName:p[t]?"FilterSolid":"Filter"},onClick:function(){g((function(e){var n=Object(l.a)(e);return n[t]=!n[t],n}))}})))})))},_e=function(e){var t=k(),n=Object(u.a)(t,4),a=n[0],r=(n[1],n[2]),c=n[3],s=Object(o.useState)(0),l=Object(u.a)(s,2),m=l[0],d=l[1],f=a.subspaceList,p=a.cookedDataSource,g=a.cookedDimensions,v=a.cookedMeasures,h=a.dashBoardList,y=c.dimScores;return i.a.createElement("div",{className:"content-container"},i.a.createElement("div",{className:"card"},i.a.createElement(I.a,{text:"Generate Dashboard",disabled:0===f.length,iconProps:{iconName:"AreaChart"},onClick:function(){r("getDashBoard",{dataSource:p,dimensions:g,measures:v})}}),a.loading.dashBoard&&i.a.createElement(z.a,{description:"generating dashboard"}),i.a.createElement(Re.a,null,"current page no: ",m+1," of ",h.length),i.a.createElement(G.a,{horizontal:!0,tokens:{childrenGap:20}},i.a.createElement(K.a,{text:"Last",onClick:function(){d((function(e){return(e+h.length-1)%h.length}))},allowDisabledFocus:!0}),i.a.createElement(K.a,{text:"Next",onClick:function(){d((function(e){return(e+1)%h.length}))},allowDisabledFocus:!0})),i.a.createElement("p",{className:"state-description"},"Double click the chart with selection to clear selection(filter)."),i.a.createElement("div",{style:{overflowX:"auto",margin:"1rem",border:"1px solid #e8e8e8"}},h[m]&&h[m].length>0&&i.a.createElement($e,{dataSource:p,dashBoard:h[m],dimScores:y}))))},Qe=[{title:"DataSource",itemKey:"pivot-1"},{title:"NoteBook",itemKey:"pivot-2"},{title:"Explore",itemKey:"pivot-3"},{title:"DashBaord",itemKey:"pivot-4"}];function Ze(){var e=k(),t=Object(u.a)(e,2),n=t[0],a=(t[1],P({show:{insightBoard:!1,fieldConfig:!1,configPanel:!1,dataConfig:!1},current:{pivotKey:Qe[0].itemKey}})),r=Object(u.a)(a,2),o=r[0],c=r[1];return i.a.createElement("div",null,i.a.createElement("div",{className:"header-bar"},i.a.createElement("div",{className:"ms-Grid-row"},i.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md4 ms-lg1"},i.a.createElement("a",{href:"https://github.com/ObservedObserver/visual-insights",className:"logo"},i.a.createElement("img",{src:"https://chspace.oss-cn-hongkong.aliyuncs.com/logos/logo.png"}))),i.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md8 ms-lg11"},i.a.createElement(N.a,{selectedKey:o.current.pivotKey,onLinkClick:function(e){e&&e.props.itemKey&&c((function(t){t.current.pivotKey=e.props.itemKey}))},headersOnly:!0},Qe.map((function(e){return i.a.createElement(C.a,{key:e.itemKey,headerText:e.title,itemKey:e.itemKey})})))))),"pivot-3"===o.current.pivotKey&&i.a.createElement(me,{subspaceList:n.subspaceList,dataSource:n.cookedDataSource,summary:n.summary}),"pivot-1"===o.current.pivotKey&&i.a.createElement(Ae,{onExtractInsights:function(){c((function(e){e.current.pivotKey="pivot-3",e.show.insightBoard=!0}))}}),"pivot-2"===o.current.pivotKey&&i.a.createElement("div",{className:"content-container"},i.a.createElement("div",{className:"card"},i.a.createElement(Me,{summary:n.summary,subspaceList:n.subspaceList,dataSource:n.cookedDataSource}))),"pivot-4"===o.current.pivotKey&&i.a.createElement(_e,null))}var et=n(169);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));Object(et.a)(),s.a.render(i.a.createElement((function(){return i.a.createElement(w,null,i.a.createElement(Ze,null))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[184,1,2]]]);
//# sourceMappingURL=main.980b2083.chunk.js.map