(self.webpackJsonpfrontend=self.webpackJsonpfrontend||[]).push([[0],{128:function(e,t,n){},135:function(e,t,n){e.exports=function(){return new Worker(n.p+"6c9c09ce4422e8e00e69.worker.js")}},136:function(e,t,n){e.exports=function(){return new Worker(n.p+"308422012c78c5a42163.worker.js")}},137:function(e,t,n){e.exports=function(){return new Worker(n.p+"ebfe4187a9bd4301e2e9.worker.js")}},138:function(e,t,n){e.exports=function(){return new Worker(n.p+"a7fa28044adaf0bd915c.worker.js")}},139:function(e,t,n){e.exports=function(){return new Worker(n.p+"386bbcb7496e5493b6fb.worker.js")}},173:function(e,t,n){e.exports=n(292)},178:function(e,t,n){},180:function(e,t,n){},271:function(e,t,n){},272:function(e,t,n){},274:function(e,t){},275:function(e,t){},276:function(e,t){},277:function(e,t){},292:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"csvLoader",(function(){return Z})),n.d(r,"jsonLoader",(function(){return ee}));var a={};n.r(a),n.d(a,"transNumber",(function(){return te}));var o={};n.r(o),n.d(o,"simpleClean",(function(){return Ke})),n.d(o,"dropNull",(function(){return ze})),n.d(o,"useMode",(function(){return Ge})),n.d(o,"dropNullColumn",(function(){return Le}));var i={};n.r(i),n.d(i,"reservoirSampling",(function(){return Ie}));var c=n(1),s=n.n(c),u=n(25),l=n.n(u),m=(n(178),n(10)),f=n(3),d=n(63),p=n(9),v=n.n(p),g=n(14),y=n(5),h=n(135),b=n.n(h),x=n(136),O=n.n(x),j=n(137),E=n.n(j),S=n(138),w=n.n(S),k=n(139),N=n.n(k);function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function P(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(n,!0).forEach((function(t){Object(y.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var M="//lobay.moe:8443";function D(e,t){return new Promise((function(n,r){e.postMessage(t),e.onmessage=function(e){n(e.data)},e.onerror=function(e){r({success:!1,message:e.error})}}))}function F(e,t,n){return T.apply(this,arguments)}function T(){return(T=Object(g.a)(v.a.mark((function e(t,n,r){var a,o,i,c,s;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],!r){e.next=21;break}return e.prev=2,e.next=5,fetch(M+"/api/service/fieldsSummary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataSource:t,fields:n})});case 5:return o=e.sent,e.next=8,o.json();case 8:if(!0!==(i=e.sent).success){e.next=13;break}a=i.data,e.next=14;break;case 13:throw new Error("[fields summary failed]"+i.message);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),console.error(e.t0);case 19:e.next=31;break;case 21:return c=new w.a,e.next=24,D(c,{dataSource:t,fields:n});case 24:if(!0!==(s=e.sent).success){e.next=29;break}a=s.data,e.next=30;break;case 29:throw new Error("[fields summary failed]"+s.message);case 30:c.terminate();case 31:return e.abrupt("return",a);case 32:case"end":return e.stop()}}),e,null,[[2,16]])})))).apply(this,arguments)}function L(e,t,n){return z.apply(this,arguments)}function z(){return(z=Object(g.a)(v.a.mark((function e(t,n,r){var a,o,i,c,s;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a={groupedData:[],newFields:[],fields:[]},!r){e.next=21;break}return e.prev=2,e.next=5,fetch(M+"/api/service/groupFields",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataSource:t,fields:n})});case 5:return o=e.sent,e.next=8,o.json();case 8:if(!0!==(i=e.sent).success){e.next=13;break}a=i.data,e.next=14;break;case 13:throw new Error("[group fields failed]"+i.message);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),console.error(e.t0);case 19:e.next=31;break;case 21:return c=new N.a,e.next=24,D(c,{dataSource:t,fields:n});case 24:if(!0!==(s=e.sent).success){e.next=29;break}a=s.data,e.next=30;break;case 29:throw new Error("[group fields failed]"+s.message);case 30:c.terminate();case 31:return e.abrupt("return",a);case 32:case"end":return e.stop()}}),e,null,[[2,16]])})))).apply(this,arguments)}function B(e,t,n,r,a){return G.apply(this,arguments)}function G(){return(G=Object(g.a)(v.a.mark((function e(t,n,r,a,o){var i,c,s,u,l;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],!o){e.next=21;break}return e.prev=2,e.next=5,fetch(M+"/api/service/combineFields",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataSource:t,dimensions:n,measures:r,operator:a})});case 5:return c=e.sent,e.next=8,c.json();case 8:if(!0!==(s=e.sent).success){e.next=13;break}i=s.data,e.next=14;break;case 13:throw new Error("[combine fields failed]"+s.message);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),console.error(e.t0);case 19:e.next=31;break;case 21:return u=new E.a,e.next=24,D(u,{dataSource:t,dimensions:n,measures:r,operator:a});case 24:if(!0!==(l=e.sent).success){e.next=29;break}i=l.data,e.next=30;break;case 29:throw new Error("[combine fields failed]"+l.message);case 30:u.terminate();case 31:return e.abrupt("return",i);case 32:case"end":return e.stop()}}),e,null,[[2,16]])})))).apply(this,arguments)}function K(){return(K=Object(g.a)(v.a.mark((function e(t,n,r){var a,o,i,c,s;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],!r){e.next=21;break}return e.prev=2,e.next=5,fetch(M+"/api/service/clusterMeasures",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({maxGroupNumber:t,spaces:n})});case 5:return o=e.sent,e.next=8,o.json();case 8:if(!0!==(i=e.sent).success){e.next=13;break}a=i.data.map((function(e,t){return P({},e,{index:t})})),e.next=14;break;case 13:throw new Error("[cluster measures]"+i.message);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),console.error(e.t0);case 19:e.next=31;break;case 21:return c=new O.a,e.next=24,D(c,{maxGroupNumber:t,spaces:n});case 24:if(!0!==(s=e.sent).success){e.next=29;break}a=s.data.map((function(e,t){return P({},e,{index:t})})),e.next=30;break;case 29:throw new Error("[cluster measures]"+s.message);case 30:c.terminate();case 31:return e.abrupt("return",a);case 32:case"end":return e.stop()}}),e,null,[[2,16]])})))).apply(this,arguments)}function I(e,t,n,r,a){return q.apply(this,arguments)}function q(){return(q=Object(g.a)(v.a.mark((function e(t,n,r,a,o){var i,c,s,u,l;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=[],!o){e.next=21;break}return e.prev=2,e.next=5,fetch(M+"/api/service/generateDashBoard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataSource:t,dimensions:n,measures:r,subspaces:a})});case 5:return c=e.sent,e.next=8,c.json();case 8:if(!(s=e.sent).success){e.next=13;break}i=s.data,e.next=14;break;case 13:throw new Error("[generateDashBoard]"+s.message);case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(2),console.error(e.t0);case 19:e.next=31;break;case 21:return u=new b.a,e.next=24,D(u,{dataSource:t,dimensions:n,measures:r,subspaces:a});case 24:if(!(l=e.sent).success){e.next=29;break}i=l.data,e.next=30;break;case 29:throw new Error("[generateDashBoard]"+l.message);case 30:u.terminate();case 31:return e.abrupt("return",i);case 32:case"end":return e.stop()}}),e,null,[[2,16]])})))).apply(this,arguments)}var A=function(){var e=Object(g.a)(v.a.mark((function e(t,n,r){var a,o,i,c,s,u,l,m,f,d,p,g,y,h;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.dataSource,o=r.fields,i=o.filter((function(e){return"dimension"===e.type})).map((function(e){return e.name})),c=o.filter((function(e){return"measure"===e.type})).map((function(e){return e.name})),e.prev=3,e.next=6,F(a,o.map((function(e){return e.name})),t.useServer);case 6:return s=e.sent,u=s?s.filter((function(e){return i.includes(e.fieldName)})).map((function(e){return{name:e.fieldName,type:e.type}})):[],e.next=10,L(a,u,t.useServer);case 10:return l=e.sent,f=(m=l||{groupedData:a,newFields:u}).groupedData,d=m.newFields,p=o.map((function(e){var t=d.find((function(t){return t.name===e.name+"(group)"}));return{name:t?t.name:e.name,type:e.type}})),g=p.filter((function(e){return"dimension"===e.type})).map((function(e){return e.name})),e.next=16,F(f,d,t.useServer);case 16:return y=e.sent,n((function(e){e.cookedDataSource=f,e.summary={origin:s||[],grouped:y||[]},e.loading.univariateSummary=!1})),h=(y||[]).concat(s||[]),e.abrupt("return",{groupedData:f,summary:h,newDimensions:g,measures:c});case 22:e.prev=22,e.t0=e.catch(3),n((function(e){e.loading.univariateSummary=!1}));case 25:case"end":return e.stop()}}),e,null,[[3,22]])})));return function(t,n,r){return e.apply(this,arguments)}}(),W=function(){var e=Object(g.a)(v.a.mark((function e(t,n,r){var a,o,i,c,s,u,l,m;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.groupedData,o=r.summary,i=r.dimensions,c=r.measures,s=r.operator,n((function(e){e.loading.subspaceSearching=!0})),u=[],(u=i.map((function(e){var t=o.find((function(t){return t.fieldName===e}));return{name:e,entropy:t?t.entropy:1/0}}))).sort((function(e,t){return e.entropy-t.entropy})),n((function(e){e.cookedDimensions=u.map((function(e){return e.name})),e.cookedMeasures=c})),l=u.map((function(e){return e.name})).slice(0,Math.round(u.length*t.topK.dimensionSize)),e.prev=7,e.next=10,B(a,l,c,s,t.useServer);case 10:(m=e.sent)&&n((function(e){e.subspaceList=m})),n((function(e){e.loading.subspaceSearching=!1})),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(7),n((function(e){e.loading.subspaceSearching=!1}));case 18:case"end":return e.stop()}}),e,null,[[7,15]])})));return function(t,n,r){return e.apply(this,arguments)}}(),R=function(){var e=Object(g.a)(v.a.mark((function e(t,n,r){var a,o,i,c,s,u,l;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.dataSource,o=r.fields,n((function(e){e.loading.gallery=!0})),e.prev=2,e.next=5,A(t,n,{dataSource:a,fields:o});case 5:if(!(i=e.sent)){e.next=10;break}return c=i.groupedData,s=i.summary,u=i.newDimensions,l=i.measures,e.next=10,W(t,n,{groupedData:c,summary:s,dimensions:u,measures:l,operator:"sum"});case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(2);case 14:return e.prev=14,n((function(e){e.loading.gallery=!1,e.loading.gallery=!1})),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[2,12,14,17]])})));return function(t,n,r){return e.apply(this,arguments)}}(),V={univariateSummary:A,subspaceSearch:W,extractInsights:R,getDashBoard:function(){var e=Object(g.a)(v.a.mark((function e(t,n,r){var a,o,i,c;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.dataSource,o=r.dimensions,i=r.measures,n((function(e){e.loading.dashBoard=!0})),e.prev=2,e.next=5,I(a,o,i,t.subspaceList,t.useServer);case 5:c=e.sent,n((function(e){e.dashBoardList=c})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(2),console.error(e.t0);case 12:return e.prev=12,n((function(e){e.loading.dashBoard=!1})),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[2,9,12,15]])})));return function(t,n,r){return e.apply(this,arguments)}}()};Object(d.b)(!1);var J={currentPage:0,useServer:!1,fields:[],rawData:[],cookedDataSource:[],cookedDimensions:[],cookedMeasures:[],loading:{univariateSummary:!1,subspaceSearching:!1,gallery:!1,dashBoard:!1},topK:{subspacePercentSize:.3,dimensionSize:.72},maxGroupNumber:4,subspaceList:[],summary:{origin:[],grouped:[]},viewSpaces:[],dashBoardList:[]},H=Object(c.createContext)(null);function U(e){var t=e.children,n=Object(c.useState)(J),r=Object(m.a)(n,2),a=r[0],o=r[1],i=function(e){return{dimScores:Object(c.useMemo)((function(){return[].concat(Object(f.a)(e.summary.origin),Object(f.a)(e.summary.grouped)).map((function(e){return[e.fieldName,e.entropy,e.maxEntropy,{name:e.fieldName,type:e.type}]}))}),[e.summary])}}(a),u=function(e){o((function(t){return Object(d.a)(t,(function(t){return e(t)}))}))};return s.a.createElement(H.Provider,{value:[a,u,function(e,t){"function"===typeof V[e]&&V[e](a,u,t)},i]},t)}function Y(){return Object(c.useContext)(H)}var $=n(342),X=n(160),_=n(140),Q=n.n(_);function Z(e){return new Promise((function(t,n){Q.a.parse(e,{complete:function(e,n){var r=e.data,a=r[0],o=r.slice(1).map((function(e){var t={};return a.forEach((function(n,r){t[n]=e[r]})),t}));t(o)},error:function(e,t){n(e)}})}))}function ee(e){return new Promise((function(t,n){var r=new FileReader;r.readAsText(e),r.onload=function(e){if(e.target)try{var r=JSON.parse(e.target.result);t(r)}catch(a){n(a)}else n(e)},r.onerror=n}))}function te(e){return isNaN(e)?null:Number(e)}function ne(e){var t=Object(c.useState)(e),n=Object(m.a)(t,2),r=n[0],a=n[1];return[r,function(e){var t=Object(d.a)(r,(function(t){return e(t)}));a(t)}]}n(180);var re=n(346),ae=n(352),oe=n(341),ie=n(335),ce=n(163),se=n(13),ue=n(319),le=n(339),me=n(20),fe=n(344),de=n(336),pe=n(345),ve=function(){return{root:{marginTop:"10px"}}},ge=[{key:"sum",text:"Sum"},{key:"count",text:"Count"},{key:"mean",text:"Mean"}],ye=function(e){var t=e.show,n=void 0!==t&&t,r=e.onUpdateConfig,a=e.onClose,o=e.config,i=Object(c.useState)("sum"),u=Object(m.a)(i,2),l=u[0],f=u[1],d=Object(c.useState)(!0),p=Object(m.a)(d,2),v=p[0],g=p[1],y=Object(c.useState)(!0),h=Object(m.a)(y,2),b=h[0],x=h[1];Object(c.useEffect)((function(){var e=o.aggregator,t=o.defaultAggregated,n=o.defaultStack;f(e),g(t),x(n)}),[o,n]);return s.a.createElement(le.a,{isOpen:n,type:me.a.smallFixedFar,onDismiss:a,headerText:"Preference",closeButtonAriaLabel:"Close",onRenderFooterContent:function(){return s.a.createElement("div",null,s.a.createElement(ue.a,{onClick:function(){r({aggregator:l,defaultAggregated:v,defaultStack:b})}},"Save"))}},s.a.createElement(fe.a,null,"Preference"),s.a.createElement(ie.a,{verticalFill:!0,tokens:{childrenGap:50,padding:6}},s.a.createElement(de.a,{selectedKey:l,label:"Aggregator",allowFreeform:!0,autoComplete:"on",options:ge,onChange:function(e,t){t&&f(t.key)}}),s.a.createElement(pe.a,{styles:ve,label:"measurement aggregation",checked:v,onChange:function(e,t){g(t||!1)}}),s.a.createElement(pe.a,{styles:ve,label:"measurement stack",checked:b,onChange:function(e,t){x(t||!1)}})))},he=n(54),be=n.n(he),xe=n(29);function Oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var je={interval:"bar",line:"line",point:"point",density:"point"},Ee=function(e){var t=e.defaultAggregated,n=e.defaultStack,r=e.aggregator,a=e.dataSource,o=void 0===a?[]:a,i=e.dimensions,u=void 0===i?[]:i,l=e.measures,m=void 0===l?[]:l,f=e.schema,d=f.position,p=void 0===d?[]:d,v=f.color,g=void 0===v?[]:v,h=f.opacity,b=void 0===h?[]:h,x=f.size,O=void 0===x?[]:x,j=(f.shape,f.geomType),E=void 0===j?[]:j,S=f.facets,w=void 0===S?[]:S,k=f.page,N=void 0===k?[]:k,C=(f.filter,e.fieldFeatures),P=void 0===C?[]:C,M=Object(c.useRef)(null);function D(e){var t=P.find((function(t){return t.name===e}));return t?t.type:"nominal"}var F=m.map((function(e){return{op:r,field:e,as:"".concat(e,"_").concat(r)}})),T=t?be()({dataSource:o,dimensions:u,measures:m,operator:r,asFields:F.map((function(e){return e.as}))}):o;function L(e){if(t&&m.includes(e)){var n=F.find((function(t){return t.field===e}));return n?n.as:e}return e}function z(){var e={x:p[0],y:p[1],color:g[0],size:O[0],opacity:b[0],row:w[0],column:w[1]},r={width:600,data:{values:T}},a={width:600,mark:{type:E[0]&&je[E[0]]?je[E[0]]:E[0],tooltip:!0},encoding:{}};for(var o in e)e[o]&&(a.encoding[o]={field:L(e[o]),type:D(e[o])},["x","y"].includes(o)&&"quantitative"===D(e[o])&&!n&&(a.encoding[o].stack=null));if(n||0!==b.length||(a.encoding.opacity={value:.7}),0===N.length)r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Oe(n,!0).forEach((function(t){Object(y.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Oe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r,{},a);else if(N.length>0){a.transform=[{filter:{selection:"brush"}},t?{aggregate:F,groupby:u.filter((function(e){return e!==N[0]}))}:null].filter(Boolean);var i={width:600,mark:"tick",selection:{brush:{encodings:["x"],type:"interval"}},encoding:{x:{field:N[0],type:D(N[0])}}};r.vconcat=[a,i]}return r}return Object(c.useEffect)((function(){if(null!==M.current&&p.length>0&&E.length>0){var e=z();Object(xe.a)(M.current,e)}})),s.a.createElement("div",{ref:M})};function Se(e){return JSON.parse(JSON.stringify(e))}function we(e,t){var n=new Map,r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){var s=i.value[t];n.has(s)||n.set(s,0),n.set(s,n.get(s)+1)}}catch(u){a=!0,o=u}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return Object(f.a)(n.entries())}function ke(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var Ne={interval:[0,20],line:[21,1/0],area:[21,1/0],point:[0,1e3],path:[0,100],density:[1001,1/0]};function Ce(e,t){for(var n=t.length-1;n>=0;n--)if(t[n].type===e&&!t[n].choosen)return t[n];return!1}function Pe(e){for(var t={},n={position:2,color:1,size:1,shape:1,opacity:1,facets:2,page:1,filter:1,highFacets:1/0},r=e.map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ke(n,!0).forEach((function(t){Object(y.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ke(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{choosen:!1})})),a=[["quantitative",["position","size","opacity","color","page","filter","hightFacets"]],["temporal",["position","page","filter"]],["ordinal",["position","color","opacity","facets","size","page","filter","highFacets"]],["nominal",["position","color","facets","shape","page","filter","hightFacets"]]],o=r.length,i=0;i<a.length&&o>0;i++)for(var c=a[i][0],s=a[i][1],u=0;u<s.length&&o>0;u++)for(var l=s[u],m=void 0;n[l]>0&&(m=Ce(c,r));)"undefined"===typeof t[l]&&(t[l]=[]),t[l].push(m.name),n[l]--,o--,m.choosen=!0;return t}var Me=function(e,t,n,r){var a=Pe(e.sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[3]})));if(2===a.position.length)if(n.includes(a.position[0])&&r.includes(a.position[1])||n.includes(a.position[1])&&r.includes(a.position[0])){var o=n.includes(a.position[0])?0:1,i=a.position[o],c=a.position[(o+1)%2];a.position=[i,c];var s=we(t,i);a.geomType=["interval","line","area"].filter((function(e){return s.length>=Ne[e][0]&&s.length<=Ne[e][1]}));var u=e.find((function(e){return e[0]===a.position[0]}))[3],l=e.find((function(e){return e[0]===a.position[1]}))[3];"nominal"!==u.type&&"nominal"!==l.type||(a.geomType=["interval"])}else a.geomType=["point","density"].filter((function(e){return t.length>=Ne[e][0]&&t.length<=Ne[e][1]}));return{schema:a,aggData:t}};function De(e){for(var t=[],n=0;n<e.length;n++)for(var r=n+1;r<e[n].length;r++)t.push([[n,r],Math.abs(e[n][r])]);return t}function Fe(e,t){return e[t]===t?t:e[t]=Fe(e,e[t])}function Te(e,t,n){var r=Fe(e,t),a=Fe(e,n);e[r]=a,Fe(e,t),Fe(e,n)}function Le(e,t){var n=t.map((function(){return!1})),r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done);r=!0)for(var s=i.value,u=0;u<t.length;u++){var l=t[u];"undefined"!==typeof s[l]&&""!==s[l]&&null!==s[l]&&(n[u]=!0)}}catch(f){a=!0,o=f}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}var m=t.filter((function(e,t){return n[t]}));return{fields:m,dataSource:e.map((function(e){var t={},n=!0,r=!1,a=void 0;try{for(var o,i=m[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var c=o.value;t[c]=e[c]}}catch(f){r=!0,a=f}finally{try{n||null==i.return||i.return()}finally{if(r)throw a}}return t}))}}function ze(e,t,n){var r=[],a=!0,o=!1,i=void 0;try{for(var c,s=e[Symbol.iterator]();!(a=(c=s.next()).done);a=!0){var u=c.value,l=!0,m=!0,f=!1,d=void 0;try{for(var p,v=t[Symbol.iterator]();!(m=(p=v.next()).done);m=!0){var g=p.value;"undefined"!==typeof u[g]&&""!==u[g]&&null!==u[g]||(l=!1)}}catch(C){f=!0,d=C}finally{try{m||null==v.return||v.return()}finally{if(f)throw d}}var y=!0,h=!1,b=void 0;try{for(var x,O=n[Symbol.iterator]();!(y=(x=O.next()).done);y=!0){"number"!==typeof u[x.value]&&(l=!1)}}catch(C){h=!0,b=C}finally{try{y||null==O.return||O.return()}finally{if(h)throw b}}l&&r.push(u)}}catch(C){o=!0,i=C}finally{try{a||null==s.return||s.return()}finally{if(o)throw i}}var j=!0,E=!1,S=void 0;try{for(var w,k=function(){var e=w.value;(function(e,t){return e.every((function(e){return!isNaN(e[t])||"undefined"===typeof e[t]||null===e[t]}))})(r,e)&&(we(r,e).length>20?r.forEach((function(t){t[e]=Number(t[e])||0})):r.forEach((function(t){t[e]=(Number(t[e])||0).toString()})))},N=t[Symbol.iterator]();!(j=(w=N.next()).done);j=!0)k()}catch(C){E=!0,S=C}finally{try{j||null==N.return||N.return()}finally{if(E)throw S}}return r}function Be(e){return["",null,void 0].includes(e)}function Ge(e,t){var n=new Map,r=new Map,a=!0,o=!1,i=void 0;try{for(var c,s=t[Symbol.iterator]();!(a=(c=s.next()).done);a=!0){var u=c.value;n.set(u,new Map),r.set(u,0)}}catch($){o=!0,i=$}finally{try{a||null==s.return||s.return()}finally{if(o)throw i}}var l=!0,m=!1,d=void 0;try{for(var p,v=e[Symbol.iterator]();!(l=(p=v.next()).done);l=!0){var g=p.value,y=!0,h=!1,b=void 0;try{for(var x,O=t[Symbol.iterator]();!(y=(x=O.next()).done);y=!0){var j=x.value,E=n.get(j);Be(g[j])||(E.has(g[j])||E.set(g[j],0),E.set(g[j],E.get(g[j])+1))}}catch($){h=!0,b=$}finally{try{y||null==O.return||O.return()}finally{if(h)throw b}}}}catch($){m=!0,d=$}finally{try{l||null==v.return||v.return()}finally{if(m)throw d}}var S=!0,w=!1,k=void 0;try{for(var N,C=n.keys()[Symbol.iterator]();!(S=(N=C.next()).done);S=!0){for(var P=N.value,M=n.get(P),D=Object(f.a)(M.entries()),F=0,T=0,L=0;L<D.length;L++){var z=D[L];z[1]>F&&(F=z[1],T=L)}r.set(P,D[T][0])}}catch($){w=!0,k=$}finally{try{S||null==C.return||C.return()}finally{if(w)throw k}}var B=Se(e),G=!0,K=!1,I=void 0;try{for(var q,A=B[Symbol.iterator]();!(G=(q=A.next()).done);G=!0){var W=q.value,R=!0,V=!1,J=void 0;try{for(var H,U=t[Symbol.iterator]();!(R=(H=U.next()).done);R=!0){var Y=H.value;Be(W[Y])&&(W[Y]=r.get(Y))}}catch($){V=!0,J=$}finally{try{R||null==U.return||U.return()}finally{if(V)throw J}}}}catch($){K=!0,I=$}finally{try{G||null==A.return||A.return()}finally{if(K)throw I}}return B}function Ke(e,t,n){var r=Se(e),a=!0,o=!1,i=void 0;try{for(var c,s=e[Symbol.iterator]();!(a=(c=s.next()).done);a=!0){var u=c.value,l=!0,m=!1,f=void 0;try{for(var d,p=t[Symbol.iterator]();!(l=(d=p.next()).done);l=!0){var v=d.value;Be(u[v])&&(u[v]="null")}}catch(j){m=!0,f=j}finally{try{l||null==p.return||p.return()}finally{if(m)throw f}}var g=!0,y=!1,h=void 0;try{for(var b,x=n[Symbol.iterator]();!(g=(b=x.next()).done);g=!0){var O=b.value;Be(u[O])&&(u[O]=0)}}catch(j){y=!0,h=j}finally{try{g||null==x.return||x.return()}finally{if(y)throw h}}}}catch(j){o=!0,i=j}finally{try{a||null==s.return||s.return()}finally{if(o)throw i}}return r}function Ie(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if(e.length<=t)return e;for(var n=e.slice(0,t),r=e.length,a=t+1;a<r;a++){var o=Math.round(Math.random()*a);o<t&&(n[o]=e[a])}return n}var qe=n(83),Ae=n.n(qe),We=n(340),Re=n(15),Ve=(n(128),function(e){var t=e.space,n=e.dimensions,r=void 0===n?[]:n,a=e.measures,o=void 0===a?[]:a,i=e.dimScores,u=void 0===i?[]:i,l=e.spaceList,d=void 0===l?[]:l,p=e.schema,v=Object(c.useState)(!1),g=Object(m.a)(v,2),y=g[0],h=g[1],b=Object(c.useMemo)((function(){return Object(f.a)(u).sort((function(e,t){return e[1]-t[1]}))}),[u]),x=Object(c.useMemo)((function(){if("undefined"!==typeof t){var e=!0,n=!1,r=void 0;try{for(var a,o=d[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var i=a.value;if(i.dimensions.some((function(e){return t.dimensions.includes(e)})))return i.dimensions.find((function(e){return t.dimensions.includes(e)}))}}catch(c){n=!0,r=c}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}}}),[]),O=Object(c.useMemo)((function(){if("undefined"!==typeof t){for(var e=t.measures.filter((function(e){return o.includes(e.name)})),n=1/0,r=0,a=0;a<e.length;a++)e[a].value<n&&(n=e[a].value,r=a);return e[r].name}}),[o,t]),j=Object(c.useMemo)((function(){var e=b.find((function(e){return r.includes(e[0])}));return e?e[0]:void 0}),[b,r]),E="\n  ".concat(p&&p.position?"Current chart mainly focus on the relationship between ***".concat(p.position[0],"*** and ***").concat(p.position[1],"***"):"","\n  ").concat(r.length>1?"+ DataSource is grouped by ***".concat(r.join(", "),"***, measures(indicators) will propose strong difference of distribution between each other."):"","\n  ").concat(o.length>1?"+ ***".concat(o.join(", "),"***are strongly related to each other"):"","\n  ").concat(j?"+ The distribution of member countings of ***".concat(j,"*** seems to contain more orders and patterns."):"","\n  ").concat(x?"+ ***".concat(x,"*** has great influence on aggregated measure values."):"","\n  ").concat(O?"+ ***".concat(O,"*** is more likely to have patterns according to its distribution."):"","\n  ``  ");return s.a.createElement("div",null,s.a.createElement(ce.a,{id:"vis-summary",text:"Summary",onClick:function(){h(!0)}}),y?s.a.createElement("div",null,s.a.createElement(We.a,{calloutProps:{directionalHint:Re.a.bottomCenter},isWide:!0,hasCloseIcon:!0,closeButtonAriaLabel:"Close",target:"#vis-summary",onDismiss:function(){h(!1)},headline:"Chart Description"},s.a.createElement(Ae.a,{source:E}))):null)}),Je=function(e){var t=e.space,n=e.dimensions,r=void 0===n?[]:n,a=e.measures,o=void 0===a?[]:a,i=e.dimScores,u=void 0===i?[]:i,l=e.spaceList,m=void 0===l?[]:l,d=e.schema,p=Object(c.useMemo)((function(){return Object(f.a)(u).sort((function(e,t){return e[1]-t[1]}))}),[u]),v=Object(c.useMemo)((function(){if("undefined"!==typeof t){var e=!0,n=!1,r=void 0;try{for(var a,o=m[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var i=a.value;if(i.dimensions.some((function(e){return t.dimensions.includes(e)})))return i.dimensions.find((function(e){return t.dimensions.includes(e)}))}}catch(c){n=!0,r=c}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}}}),[]),g=Object(c.useMemo)((function(){if("undefined"!==typeof t){for(var e=t.measures.filter((function(e){return o.includes(e.name)})),n=1/0,r=0,a=0;a<e.length;a++)e[a].value<n&&(n=e[a].value,r=a);return e[r].name}}),[o,t]),y=Object(c.useMemo)((function(){var e=p.find((function(e){return r.includes(e[0])}));return e?e[0]:void 0}),[p,r]),h="\n  ".concat(d&&d.position?"Current chart mainly focus on the relationship between ***".concat(d.position[0],"*** and ***").concat(d.position[1],"***"):"","\n  ").concat(r.length>1?"+ DataSource is grouped by ***".concat(r.join(", "),"***, measures(indicators) will propose strong difference of distribution between each other."):"","\n  ").concat(o.length>1?"+ ***".concat(o.join(", "),"***are strongly related to each other"):"","\n  ").concat(y?"+ The distribution of member countings of ***".concat(y,"*** seems to contain more orders and patterns."):"","\n  ").concat(v?"+ ***".concat(v,"*** has great influence on aggregated measure values."):"","\n  ").concat(g?"+ ***".concat(g,"*** is more likely to have patterns according to its distribution."):"","\n  ``  ");return s.a.createElement(Ae.a,{source:h})};function He(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?He(n,!0).forEach((function(t){Object(y.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):He(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ye=.2,$e=5;function Xe(e,t){var n=new Set([].concat(Object(f.a)(e),Object(f.a)(t))),r=new Set(e),a=new Set(t),o=[],i=[],c=!0,s=!1,u=void 0;try{for(var l,m=n[Symbol.iterator]();!(c=(l=m.next()).done);c=!0){var d=l.value;o.push(Number(r.has(d))),i.push(Number(a.has(d)))}}catch(g){s=!0,u=g}finally{try{c||null==m.return||m.return()}finally{if(s)throw u}}for(var p=0,v=0;v<o.length;v++)p+=o[v]*i[v];return p/=Math.sqrt(e.length)*Math.sqrt(t.length)}var _e=function(e){var t=e.viewSpaces,n=e.interestedViewSpace,r=e.fieldScores,a=e.dataSource,o=(e.visualConfig,Object(c.useMemo)((function(){var e=[],r=!0,a=!1,o=void 0;try{for(var i,c=function(){var t=i.value;t.dimensions.length>n.dimensions.length&&t.dimensions.length-n.dimensions.length<=2&&(n.dimensions.every((function(e){return t.dimensions.find((function(t){return e===t}))}))&&e.push(t))},s=t[Symbol.iterator]();!(r=(i=s.next()).done);r=!0)c()}catch(u){a=!0,o=u}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}return e}),[n,t])),i=Object(c.useMemo)((function(){var e=[],t=!0,r=!1,a=void 0;try{for(var i,c=o[Symbol.iterator]();!(t=(i=c.next()).done);t=!0){var s=i.value,u=Xe(n.measures,s.measures);u>Ye&&e.push(Ue({},s,{relatedScore:s.score/Math.sqrt(u)}))}}catch(l){r=!0,a=l}finally{try{t||null==c.return||c.return()}finally{if(r)throw a}}return e.sort((function(e,t){return e.relatedScore-t.relatedScore}))}),[o]);return Object(c.useMemo)((function(){return i.slice(0,$e).map((function(e){var t=r.filter((function(t){return e.dimensions.includes(t[0])||e.measures.includes(t[0])}));return Ue({},e,{schema:Me(t,a,e.dimensions,e.measures).schema})}))}),[i,r])};var Qe=function(e){var t=e.digDimensionProps,n=e.subspaceList,r=e.onSelectView,a=t.dataSource,o=t.visualConfig,i=t.fieldScores,c=_e(t),u=i.map((function(e){return e[3]}));return s.a.createElement("div",null,s.a.createElement("div",{className:"ms-Grid"},c.map((function(e,t){var c=n.find((function(t){return n=t.dimensions,r=e.dimensions,n.length===r.length&&n.every((function(e){return r.includes(e)}));var n,r}));return s.a.createElement("div",{key:"associate-row-".concat(t),className:"ms-Grid-row",style:{border:"solid 1px #bfbfbf",margin:"1em",padding:"1em"}},s.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md8 ms-lg9",style:{overflow:"auto"}},s.a.createElement(Ee,{aggregator:o.aggregator,defaultAggregated:!e.schema.geomType||!e.schema.geomType.includes("point"),defaultStack:o.defaultStack,dimensions:e.dimensions,measures:e.measures,dataSource:a,schema:e.schema,fieldFeatures:u})),s.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md4 ms-lg3",style:{fontSize:14,color:"#8a8886",overflow:"auto"}},s.a.createElement("div",null,s.a.createElement(ie.a,{tokens:{childrenGap:8},horizontal:!0},s.a.createElement(ae.a,{iconProps:{iconName:"Lightbulb"},title:"Interested",onClick:function(){r(e.index)}}))),c&&s.a.createElement(Je,{dimensions:e.dimensions,measures:e.measures,dimScores:i,space:c,spaceList:n,schema:e.schema})))}))))};function Ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function et(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ze(n,!0).forEach((function(t){Object(y.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ze(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var tt=function(e){var t=e.dataSource,n=e.summary,r=e.subspaceList,a=Object(c.useState)(0),o=Object(m.a)(a,2),i=o[0],u=o[1],l=Y(),d=Object(m.a)(l,2),p=d[0],v=d[1],g=ne({show:{insightBoard:!1,fieldConfig:!1,configPanel:!1,dataConfig:!1}}),y=Object(m.a)(g,2),h=y[0],b=y[1],x=Object(c.useState)(!1),O=Object(m.a)(x,2),j=O[0],E=O[1],S=Object(c.useState)({aggregator:"sum",defaultAggregated:!0,defaultStack:!0}),w=Object(m.a)(S,2),k=w[0],N=w[1],C=Object(c.useState)([]),P=Object(m.a)(C,2),M=P[0],D=P[1],F=Object(c.useState)({schema:{position:[],color:[],opacity:[],geomType:[]},fieldFeatures:[],aggData:[],dimensions:[],measures:[]}),T=Object(m.a)(F,2),L=T[0],z=T[1],B=function(e){u(e)};Object(c.useEffect)((function(){v((function(e){e.loading.gallery=!0})),function(e,t,n){return K.apply(this,arguments)}(p.maxGroupNumber,r.map((function(e){return{dimensions:e.dimensions,measures:e.measures,matrix:e.correlationMatrix}})),p.useServer).then((function(e){D(e),v((function(e){e.loading.gallery=!1}))}))}),[r,t,p.maxGroupNumber]);var G=Object(c.useMemo)((function(){return[].concat(Object(f.a)(n.origin),Object(f.a)(n.grouped)).map((function(e){return[e.fieldName,e.entropy,e.maxEntropy,{name:e.fieldName,type:e.type}]}))}),[n.origin,n.grouped]);Object(c.useEffect)((function(){var e=M[i];if(e){var n=e.dimensions,r=e.measures;try{var a=G.filter((function(e){return n.includes(e[0])||r.includes(e[0])})),o=Me(a,t,n,r).schema;z({schema:o,fieldFeatures:a.map((function(e){return e[3]})),aggData:t,dimensions:n,measures:r}),o.geomType&&(o.geomType.includes("point")||o.geomType.includes("density"))?N((function(e){return et({},e,{defaultAggregated:!1})})):N((function(e){return et({},e,{defaultAggregated:!0})}))}catch(c){console.log(c)}}}),[M,i]);var I=Object(c.useMemo)((function(){return r.find((function(e){return e.dimensions.join(",")===L.dimensions.join(",")}))}),[r,i,L]);return Object(c.useEffect)((function(){E(!1)}),[i]),s.a.createElement("div",{className:"content-container"},s.a.createElement(ye,{show:h.show.configPanel,config:k,onUpdateConfig:function(e){N(e),b((function(e){e.show.configPanel=!1}))},onClose:function(){b((function(e){e.show.configPanel=!1}))}}),s.a.createElement("div",{className:"card"},(p.loading.gallery||p.loading.subspaceSearching||p.loading.univariateSummary)&&s.a.createElement(re.a,{description:"calculating"}),s.a.createElement("h2",{style:{marginBottom:0}},"Visual Insights"," ",s.a.createElement(ae.a,{iconProps:{iconName:"Settings"},title:"Preference",ariaLabel:"preference",onClick:function(){b((function(e){e.show.configPanel=!0}))}}),s.a.createElement(ae.a,{iconProps:{iconName:"Lightbulb"},title:"Dig In",ariaLabel:"digIn",onClick:function(){E(!0)}})),s.a.createElement("p",{className:"state-description"},"Details of the recommendation process can be seen in ",s.a.createElement("b",null,"NoteBook")," ","Board. You can adjust some of the parameters and operators and see how it influence recommendation results."),s.a.createElement("p",{className:"state-description"},'Try to use the setting button beside the "visual insight" title to adjust the visualization settings to get a view you prefer better.'),s.a.createElement("div",{className:"ms-Grid",dir:"ltr"},s.a.createElement("div",{className:"ms-Grid-row"},s.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md8 ms-lg3",style:{overflow:"auto"}},s.a.createElement("div",{style:{marginBottom:"1rem"}},s.a.createElement(oe.a,{label:"Current Page",value:(i+1).toString(),min:0,max:M.length,step:1,iconProps:{iconName:"Search"},labelPosition:se.a.end,onValidate:function(e){B((Number(e)-1)%M.length)},onIncrement:function(){B((i+1)%M.length)},onDecrement:function(){B((i-1+M.length)%M.length)},incrementButtonAriaLabel:"Increase value by 1",decrementButtonAriaLabel:"Decrease value by 1"})),s.a.createElement("p",{className:"state-description"},"Page No. ",i+1," of ",M.length),s.a.createElement(ie.a,{horizontal:!0,tokens:{childrenGap:20}},s.a.createElement(ce.a,{text:"Last",onClick:function(){B((i-1+M.length)%M.length)},allowDisabledFocus:!0}),s.a.createElement(ce.a,{text:"Next",onClick:function(){B((i+1)%M.length)},allowDisabledFocus:!0})),s.a.createElement("h3",null,"Specification"),s.a.createElement("pre",null,JSON.stringify(L.schema,null,2)),s.a.createElement(Ve,{dimensions:L.dimensions,measures:L.measures,dimScores:G,space:I,spaceList:r,schema:L.schema})),s.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md4 ms-lg9",style:{overflow:"auto"}},s.a.createElement(Ee,{aggregator:k.aggregator,defaultAggregated:k.defaultAggregated,defaultStack:k.defaultStack,dimensions:L.dimensions,measures:L.measures,dataSource:L.aggData,schema:L.schema,fieldFeatures:L.fieldFeatures}))))),j&&s.a.createElement("div",{className:"card"},s.a.createElement("h2",null," Related Views "),s.a.createElement(Qe,{onSelectView:function(e){var t=M.findIndex((function(t){return t.index===e}));t>-1&&B(t)},subspaceList:r,digDimensionProps:{visualConfig:k,dataSource:t,viewSpaces:M,fieldScores:G,interestedViewSpace:M[i]}})))},nt=n(343),rt=n(333),at=n(331),ot=n(32),it=n(154),ct=n.n(it),st=n(7),ut=(n(8),n(6),n(164));function lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function mt(e,t){mt=function(e,t){return new o(e,void 0,t)};var n=Object(ut.a)(RegExp),r=RegExp.prototype,a=new WeakMap;function o(e,t,r){var o=n.call(this,e,t);return a.set(o,r||a.get(e)),o}function i(e,t){var n=a.get(t);return Object.keys(n).reduce((function(t,r){return t[r]=e[n[r]],t}),Object.create(null))}return Object(st.a)(o,n),o.prototype.exec=function(e){var t=r.exec.call(this,e);return t&&(t.groups=i(t,this)),t},o.prototype[Symbol.replace]=function(e,t){if("string"===typeof t){var n=a.get(this);return r[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+n[t]})))}if("function"===typeof t){var o=this;return r[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!==typeof e[e.length-1]&&e.push(i(e,o)),t.apply(this,e)}))}return r[Symbol.replace].call(this,e,t)},mt.apply(this,arguments)}var ft=function(e){var t=Object(c.useRef)(null),n=e.x,r=e.y,a=e.dataSource,o=e.fieldType;return Object(c.useEffect)((function(){if(t.current){var e=[],i=!1;e="ordinal"===o&&a.some((function(e){return/(\[|\()-?([0-9.]+|Infinity),\s*([0-9.]+|Infinity)(\]|\))/.test(e.memberName)}))?a.map((function(e){i=!0;var t=mt(/(\[|\()(\x2D?([\.0-9]+|Infinity)),[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*([\.0-9]+|Infinity)(\]|\))/,{left:2}).exec(e.memberName);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?lt(n,!0).forEach((function(t){Object(y.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):lt(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{index:null===t?e.name:Number(t.groups.left)})})):a;var c=void 0;"nominal"===o?c="-y":"ordinal"===o&&i&&(c={field:"index"}),Object(xe.a)(t.current,{background:"#fff",data:{values:e},height:120,width:200,mark:["quantitative","temporal"].includes(o)?"line":"bar",encoding:{x:{field:n,axis:a.length>16?null:void 0,type:o,sort:c},y:{field:r,type:"quantitative",aggregate:"sum"}}},{actions:!1})}}),[n,r,a]),s.a.createElement("div",{ref:t})},dt=(n(271),[{key:"fieldName",name:"fieldName",fieldName:"fieldName",minWidth:70,maxWidth:150},{key:"type",name:"type",fieldName:"type",minWidth:50},{key:"entropy",name:"entropy",fieldName:"entropy",minWidth:120},{key:"maxEntropy",name:"maxEntropy",fieldName:"maxEntropy",minWidth:120}]);function pt(e){switch(e){case"nominal":return"TextField";case"quantitative":return"NumberField";case"ordinal":return"Breadcrumb";case"temporal":return"EventDate";default:return""}}function vt(e){return(.299*e[0]+.587*e[1]+.114*e[2])/255>.5?[0,0,0]:[255,255,255]}var gt=function(e){var t=e.originSummary,n=e.groupedSummary,r=Object(c.useMemo)((function(){var e=t.map((function(e){return e.maxEntropy}));return[0,Math.max.apply(Math,Object(f.a)(e))]}),[t]),a=function(e){return s.a.createElement("div",{className:"field-hover-card"},s.a.createElement("h2",null,e.fieldName),s.a.createElement("div",null,"Field entropy is ",Number(e.entropy).toFixed(2)),s.a.createElement("div",{className:"chart-vertical-margin-container"},s.a.createElement(ft,{x:"memberName",y:"count",fieldType:e.type,dataSource:e.distribution})))},o=function(e){var t=e.fieldName,r=n.find((function(e){return e.fieldName===t+"(group)"}));return s.a.createElement("div",{className:"field-hover-card"},r?s.a.createElement("div",null,s.a.createElement("h3",null,r.fieldName),s.a.createElement("div",null,"Field entropy is ",Number(r.entropy).toFixed(2)),s.a.createElement("div",{className:"chart-vertical-margin-container"},s.a.createElement(ft,{x:"memberName",y:"count",fieldType:r.type,dataSource:r.distribution}))):s.a.createElement("div",null,"This field is not grouped."))};return s.a.createElement(at.a,{compact:!0,columns:dt,items:t,selectionMode:ot.b.none,onRenderItemColumn:function(e,t,i){if(void 0!==i){var c=e.fieldName,u=n.find((function(e){return e.fieldName===c+"(group)"})),l={onRenderCompactCard:a,onRenderExpandedCard:o,renderData:e,compactCardHeight:320,expandedCardHeight:u?320:40},m=e[i.fieldName],f=[255,255,255];switch(i.key){case"type":return s.a.createElement("div",null,s.a.createElement(nt.a,{iconName:pt(m)})," ",m);case"entropy":case"maxEntropy":v=e[i.key],g=r;vt(f=ct.a.scale("YlGnBu").domain([g[1],g[0]])(v).rgb());var d="rgb(".concat(f.join(","),")"),p="rgb(".concat(vt(f).join(","),")");return s.a.createElement(rt.a,{expandedCardOpenDelay:800,expandingCardProps:l,instantOpenOnClick:!0},s.a.createElement("div",{style:{boxShadow:"".concat(d," 0px 0px 0px 10px"),backgroundColor:d,color:p}},m));default:return s.a.createElement(rt.a,{expandedCardOpenDelay:800,expandingCardProps:l,instantOpenOnClick:!0},s.a.createElement("div",null,m))}}var v,g}})};function yt(e){return e.join(",")}var ht=function(e){var t=e.subspaceList,n=e.onSpaceChange,r=Object(c.useState)(0),a=Object(m.a)(r,2),o=a[0],i=a[1],u=Object(c.useRef)(null),l=Object(c.useRef)(null);Object(c.useEffect)((function(){var e=t.length-1;if(e>-1){var r=t[e];n(r.dimensions,r.measures.map((function(e){return e.name})),r.correlationMatrix),i(e)}}),[t]);var f=Object(c.useMemo)((function(){var e=0,n=1/0,r=!0,a=!1,o=void 0;try{for(var i,c=t[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){var s=i.value,u=!0,l=!1,m=void 0;try{for(var f,d=s.measures[Symbol.iterator]();!(u=(f=d.next()).done);u=!0){var p=f.value,v=(p.name,p.value);e=Math.max(e,v),n=Math.min(n,v)}}catch(g){l=!0,m=g}finally{try{u||null==d.return||d.return()}finally{if(l)throw m}}}}catch(g){a=!0,o=g}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return[n,e]}),[t]),d=Object(c.useMemo)((function(){for(var e=[],n=0;n<t.length;n++){var r=t[n],a=yt(r.dimensions),o=!0,i=!1,c=void 0;try{for(var s,u=r.measures[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var l=s.value,m=l.name,f=l.value,d={test:n,score:r.score,dimensions:a,measureName:m,measureValue:f};e.push(d)}}catch(p){i=!0,c=p}finally{try{o||null==u.return||u.return()}finally{if(i)throw c}}}return e}),[t,f]);return Object(c.useEffect)((function(){u.current&&t.length>0&&Object(xe.a)(u.current,{data:{values:d},vconcat:[{mark:"rect",selection:{dim:{type:"single",on:"click",encodings:["y"]}},encoding:{x:{field:"measureName",type:"nominal"},y:{field:"dimensions",type:"ordinal",sort:{field:"score"}},color:{field:"measureValue",type:"quantitative",aggregate:"mean",scale:{reverse:!0}},opacity:{condition:{selection:"dim",value:1},value:.72}}}]}).then((function(e){e.view.addEventListener("click",(function(e,r){if(r){var a=r.datum,o=t.findIndex((function(e){return yt(e.dimensions)===a.dimensions}));if(o>-1){var c=t[o];n(c.dimensions,c.measures.map((function(e){return e.name})),c.correlationMatrix),i(o)}}}))}))}),[t,d]),Object(c.useEffect)((function(){var e=t[o];if(l.current&&t.length>0&&e){for(var n=[],r=0;r<e.correlationMatrix.length;r++)for(var a=0;a<e.correlationMatrix[r].length;a++)n.push({x:e.measures[r].name,y:e.measures[a].name,correlation:e.correlationMatrix[r][a]});Object(xe.a)(l.current,{data:{values:n},mark:"rect",encoding:{x:{field:"x",type:"nominal"},y:{field:"y",type:"nominal"},color:{field:"correlation",type:"quantitative",aggregate:"mean",scale:{scheme:"redyellowgreen",domain:[-1,1]}}}})}}),[t,o]),s.a.createElement("div",null,s.a.createElement("div",{ref:u}),s.a.createElement("div",{ref:l}))},bt=function(e){var t=e.adjMatrix,n=e.measures,r=e.onFocusGroup,a=Y(),o=Object(m.a)(a,2),i=o[0],u=(o[1],Object(c.useRef)(null)),l=Object(c.useMemo)((function(){var e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=De(e);n.sort((function(e,t){return t[1]-e[1]}));var r=[],a=e.map((function(e,t){return t})),o=Object(f.a)(a),i=!1,c=!0,s=!1,u=void 0;try{for(var l,m=n[Symbol.iterator]();!(c=(l=m.next()).done);c=!0){var d=l.value;Fe(a,d[0][0])!==Fe(a,d[0][1])&&(Te(a,d[0][0],d[0][1]),r.push([d[0],d[1],i]));for(var p=0;p<a.length;p++)a[p]=Fe(a,p);var v=new Set(a);if(v.size<=t?i=!0:o=Object(f.a)(a),1===v.size)break}}catch(g){s=!0,u=g}finally{try{c||null==m.return||m.return()}finally{if(s)throw u}}return{edgesInMST:r,groups:o}}(t,i.maxGroupNumber);return{edgesInMST:e.edgesInMST,groups:e.groups}}),[t,i.maxGroupNumber]),d=Object(c.useMemo)((function(){for(var e=l.edgesInMST,t=l.groups,r=e.map((function(e){return{source:e[0][0],target:e[0][1],value:1/e[1],inCutEdge:e[2]}})),a=[],o=0;o<t.length;o++)a.push({name:n[o],index:o,value:1,group:t[o]});return{nodes:a,edges:r}}),[n,l]);return Object(c.useEffect)((function(){u.current&&n.length>0&&Object(xe.a)(u.current,{$schema:"https://vega.github.io/schema/vega/v5.json",width:700,height:500,padding:0,autosize:"none",signals:[{name:"cx",update:"width / 2"},{name:"cy",update:"height / 2"},{description:"State variable for active node fix status.",name:"fix",value:!1,on:[{events:"text:mouseout[!event.buttons], window:mouseup",update:"false"},{events:"text:mouseover",update:"fix || true"},{events:"[text:mousedown, window:mouseup] > window:mousemove!",update:"xy()",force:!0}]},{description:"Graph node most recently interacted with.",name:"node",value:null,on:[{events:"text:mouseover",update:"fix === true ? item() : node"}]},{description:"Flag to restart Force simulation upon data changes.",name:"restart",value:!1,on:[{events:{signal:"fix"},update:"fix && fix.length"}]}],data:[{name:"node-data",values:d.nodes},{name:"link-data",values:d.edges}],scales:[{name:"color",type:"ordinal",domain:{data:"node-data",field:"group"},range:{scheme:"tableau20"}},{name:"colorEdge",type:"quantize",domain:{data:"link-data",field:"value"},range:{scheme:"viridis"}}],marks:[{name:"nodes",type:"text",zindex:1,from:{data:"node-data"},on:[{trigger:"fix",modify:"node",values:"fix === true ? {fx: node.x, fy: node.y} : {fx: fix[0], fy: fix[1]}"},{trigger:"!fix",modify:"node",values:"{fx: null, fy: null}"}],encode:{enter:{fill:{scale:"color",field:"group"},text:{field:"name"},fontSize:{value:14},fontWeight:{value:600}},update:{cursor:{value:"pointer"}}},transform:[{type:"force",iterations:300,restart:{signal:"restart"},signal:"force",forces:[{force:"center",x:{signal:"cx"},y:{signal:"cy"}},{force:"collide"},{force:"nbody"},{force:"link",links:"link-data"}]}]},{type:"path",from:{data:"link-data"},interactive:!1,encode:{update:{stroke:{scale:"colorEdge",field:"value"},strokeWidth:{value:.8},opacity:{value:.5}}},transform:[{type:"linkpath",require:{signal:"force"},shape:"line",sourceX:"datum.source.x",sourceY:"datum.source.y",targetX:"datum.target.x",targetY:"datum.target.y"}]}]}).then((function(e){e.view.addEventListener("click",(function(e,t){if(t){var a=t.datum.group,o=n.filter((function(e,t){return l.groups[t]===a}));r(o)}}))}))}),[d,n]),s.a.createElement("div",{ref:u})},xt=n(347),Ot=n(348),jt=(n(272),function(e){var t=e.summary,n=e.subspaceList,r=e.dataSource,a=Y(),o=Object(m.a)(a,2),i=o[0],u=o[1],l=Object(c.useState)(!0),d=Object(m.a)(l,2),p=d[0],v=d[1],g=Object(c.useState)({measures:[],dimensions:[],matrix:[]}),y=Object(m.a)(g,2),h=y[0],b=y[1],x=Object(c.useState)([]),O=Object(m.a)(x,2),j=O[0],E=O[1],S=Object(c.useMemo)((function(){return[].concat(Object(f.a)(t.origin),Object(f.a)(t.grouped)).map((function(e){return[e.fieldName,e.entropy,e.maxEntropy,{name:e.fieldName,type:e.type}]}))}),[t.origin,t.grouped]),w=Object(c.useMemo)((function(){var e=h.dimensions;h.measures;try{var t=S.filter((function(t){return e.includes(t[0])||j.includes(t[0])}));return Me(t,r,e,j).schema}catch(n){return console.log(n),{position:[]}}}),[S,h,r,j]),k=Object(c.useMemo)((function(){return n.slice(0,Math.round(n.length*i.topK.subspacePercentSize))}),[n,i.topK.subspacePercentSize]);return Object(c.useEffect)((function(){u((function(e){e.maxGroupNumber=Math.round(i.cookedMeasures.length/4)}))}),[i.cookedMeasures]),s.a.createElement("div",null,s.a.createElement("h3",{className:"notebook header"},"Univariate Summary"),s.a.createElement("p",{className:"state-description"},"Hover your mouse over the fields and see the distails and entropy reducing strategy."),i.loading.univariateSummary&&s.a.createElement(re.a,{description:"analyzing"}),s.a.createElement("div",{className:"notebook content container"},s.a.createElement(gt,{originSummary:t.origin,groupedSummary:t.grouped})),s.a.createElement("h3",{className:"notebook header"},"Subspace Searching"),s.a.createElement("p",{className:"state-description"},"Try to choose one row(combination of dimensions) of the subspace and see the changes of the processes below."),i.loading.subspaceSearching&&s.a.createElement(re.a,{description:"analyzing"}),!i.loading.univariateSummary&&s.a.createElement(xt.a,{disabled:i.loading.subspaceSearching,value:100*i.topK.dimensionSize,label:"top k percent dimension used",max:100,valueFormat:function(e){return"".concat(e,"%")},showValue:!0,onChange:function(e){u((function(t){t.topK.dimensionSize=e/100,t.loading.subspaceSearching=!0}));var t=i.cookedDimensions.slice(0,Math.round(i.cookedDimensions.length*e/100));B(r,t,i.cookedMeasures,"sum",i.useServer).then((function(e){e&&u((function(t){t.subspaceList=e,t.loading.subspaceSearching=!1}))}))}}),!i.loading.univariateSummary&&s.a.createElement(xt.a,{disabled:i.loading.subspaceSearching,value:100*i.topK.subspacePercentSize,label:"top k percent subspace used",max:100,valueFormat:function(e){return"".concat(e,"%")},showValue:!0,onChange:function(e){u((function(t){t.topK.subspacePercentSize=e/100}))}}),s.a.createElement("div",{className:"notebook content center container"},s.a.createElement(ht,{subspaceList:k,onSpaceChange:function(e,t,n){b({dimensions:e,measures:t,matrix:n})}})),s.a.createElement("h3",{className:"notebook header"},"Measurement Clustering"),s.a.createElement("p",{className:"state-description"},"Try to choose one group to visualize them."),s.a.createElement(xt.a,{label:"Max Group Number",min:1,max:i.cookedMeasures.length||4,step:1,value:i.maxGroupNumber,showValue:!0,onChange:function(e){u((function(t){t.maxGroupNumber=e}))}}),s.a.createElement("div",{className:"notebook content center container"},s.a.createElement(bt,{adjMatrix:h.matrix,measures:h.measures,onFocusGroup:function(e){E(e),console.log("view in measures",e)}})),s.a.createElement("h3",{className:"notebook header"},"Visualization"),s.a.createElement("p",{className:"state-description"},"If there is no result here, try to click one group of measures in ",s.a.createElement("b",null,"Clustering")," process above."),s.a.createElement(Ot.a,{checked:p,label:"aggregate measures",defaultChecked:!0,onText:"On",offText:"Off",onChange:function(e,t){v(!!t)}}),s.a.createElement("div",{className:"notebook content center container"},s.a.createElement(Ee,{defaultAggregated:p,defaultStack:!0,aggregator:"sum",schema:w,fieldFeatures:S.map((function(e){return e[3]})),dataSource:r,dimensions:h.dimensions,measures:j})))}),Et=n(162),St=n(337),wt=n(332),kt=function(e){var t=e.dataSource,n=void 0===t?[]:t,r=e.fields,a=(void 0===r?[]:r).map((function(e){return{key:e.name,name:e.name,fieldName:e.name,minWidth:70,maxHeight:90}}));return s.a.createElement("div",{style:{maxHeight:400,overflow:"auto"}},s.a.createElement(at.a,{items:n,columns:a,selectionMode:ot.b.none}))},Nt=function(e){var t=e.show,n=void 0!==t&&t,r=e.onUpdateConfig,a=e.onClose,o=Object(c.useState)([]),i=Object(m.a)(o,2),u=i[0],l=i[1];Object(c.useEffect)((function(){l(e.fields)}),[e.fields]);return s.a.createElement(le.a,{isOpen:n,type:me.a.smallFixedFar,onDismiss:a,headerText:"Meta Config",closeButtonAriaLabel:"Close",onRenderFooterContent:function(){return s.a.createElement("div",null,s.a.createElement(ue.a,{onClick:function(){r(u),a()}},"Save"))}},s.a.createElement("div",null,u.map((function(e){return s.a.createElement(Ot.a,{key:e.name,checked:"dimension"===e.type,label:e.name,onText:"dimension",offText:"measure",onChange:function(t,n){!function(e,t){l((function(n){return n.map((function(n){return e.name===n.name?{name:e.name,type:t}:n}))}))}(e,n?"dimension":"measure")}})}))))};var Ct=[{key:"dropNull",text:"drop null records"},{key:"useMode",text:"replace null with mode"},{key:"simpleClean",text:"simple cleaning"}];function Pt(e,t,n){var r=Object(c.useMemo)((function(){return t.filter((function(e){return"dimension"===e.type})).map((function(e){return e.name}))}),[t]),i=Object(c.useMemo)((function(){return t.filter((function(e){return"measure"===e.type})).map((function(e){return e.name}))}),[t]),s=Object(c.useMemo)((function(){return e.map((function(e){var n={};return t.forEach((function(t){n[t.name]="dimension"===t.type?e[t.name]:a.transNumber(e[t.name])})),n}))}),[e,t]),u=Object(c.useMemo)((function(){return function(e,t,n,r){switch(r){case"dropNull":return o.dropNull(e,t,n);case"useMode":return o.useMode(e,t.concat(n));case"simpleClean":default:return o.simpleClean(e,t,n)}}(function(e){return JSON.parse(JSON.stringify(e))}(s),r,i,n)}),[r,i,s,n]);return[s,u]}var Mt,Dt=n(330);!function(e){e.none="none",e.reservoir="reservoir"}(Mt||(Mt={}));var Ft=[{key:Mt.none,text:"none"},{key:Mt.reservoir,text:"reservoir"}],Tt=function(e){var t=Y(),n=Object(m.a)(t,3),a=n[0],u=n[1],l=n[2],f=ne({show:{insightBoard:!1,fieldConfig:!1,configPanel:!1,dataConfig:!1}}),d=Object(m.a)(f,2),p=d[0],y=d[1],h=Object(c.useState)("dropNull"),b=Object(m.a)(h,2),x=b[0],O=b[1],j=Object(c.useState)(Mt.none),E=Object(m.a)(j,2),S=E[0],w=E[1],k=Object(c.useState)(.2),N=Object(m.a)(k,2),C=N[0],P=N[1],M=Object(c.useRef)(null),D=Object(c.useRef)(null),F=Pt(a.rawData,a.fields,x),T=Object(m.a)(F,2),L=T[0],z=T[1],B=Object(Dt.a)("labelElement");function G(){return(G=Object(g.a)(v.a.mark((function e(){var t,n,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===D.current||null===D.current.files){e.next=22;break}if(t=D.current.files[0],n=[],a=[],"text/csv"!==t.type&&"application/vnd.ms-excel"!==t.type){e.next=10;break}return e.next=7,r.csvLoader(t);case 7:a=e.sent,e.next=17;break;case 10:if("application/json"!==t.type){e.next=16;break}return e.next=13,r.jsonLoader(t);case 13:a=e.sent,e.next=17;break;case 16:throw new Error("unsupported file type=".concat(t.type," "));case 17:S===Mt.reservoir&&(a=i.reservoirSampling(a,Math.round(a.length*C))),a=o.dropNullColumn(a,Object.keys(a[0])).dataSource,n=Object.keys(a[0]).map((function(e){return{name:e,type:a.every((function(t){return!isNaN(t[e])||void 0===t[e]}))?"measure":"dimension"}})),u((function(e){e.fields=n,e.rawData=a})),y((function(e){e.show.dataConfig=!1}));case 22:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K=[{key:"upload",name:"Upload",iconProps:{iconName:"Upload"},onClick:function(){D.current&&D.current.click()}}];return s.a.createElement("div",{className:"content-container"},s.a.createElement(Nt,{fields:a.fields,show:p.show.fieldConfig,onUpdateConfig:function(e){u((function(t){t.fields=e}))},onClose:function(){y((function(e){e.show.fieldConfig=!1}))}}),s.a.createElement("div",{className:"card"},s.a.createElement(ie.a,{horizontal:!0},s.a.createElement(ue.a,{disabled:0===L.length,iconProps:{iconName:"Financial"},text:"Extract Insights",onClick:function(){l("extractInsights",{dataSource:z,fields:a.fields}),e.onExtractInsights()}}),s.a.createElement("div",{ref:M},s.a.createElement(ae.a,{iconProps:{iconName:"ExcelDocument"},title:"Upload",ariaLabel:"upload data",onClick:function(){y((function(e){e.show.dataConfig=!0}))}}),s.a.createElement(Et.a,{style:{maxWidth:300},className:"vi-callout-callout",role:"alertdialog",gapSpace:0,target:M.current,onDismiss:function(){y((function(e){e.show.dataConfig=!1}))},setInitialFocus:!0,hidden:!p.show.dataConfig},s.a.createElement("div",{className:"vi-callout-header"},s.a.createElement("p",{className:"vi-callout-title"},"Upload Your own dataset")),s.a.createElement("div",{className:"vi-callout-inner"},s.a.createElement("div",{className:"vi-callout-content"},s.a.createElement("p",{className:"vi-callout-subTex"},".csv, .json are supportted.")),s.a.createElement("div",null,s.a.createElement(fe.a,{id:B,required:!0},"Sampling"),s.a.createElement(St.a,{defaultSelectedKey:"B",options:Ft,selectedKey:S,onChange:function(e,t){t&&w(t.key)},ariaLabelledBy:B}),S!==Mt.none&&s.a.createElement(xt.a,{label:"sample size(percent)",min:0,max:1,step:.001,value:C,showValue:!0,valueFormat:function(e){return"".concat((100*e).toFixed(1),"%")},onChange:function(e){P(e)}})),s.a.createElement("div",{className:"vi-callout-actions"},s.a.createElement("input",{type:"file",ref:D,multiple:!0,accept:"*",style:{display:"none"},onChange:function(){return G.apply(this,arguments)}}),s.a.createElement(wt.a,{overflowButtonProps:{name:"More"},items:K}))))),s.a.createElement(ae.a,{iconProps:{iconName:"Settings"},title:"Field Setting",ariaLabel:"field setting",onClick:function(){y((function(e){e.show.fieldConfig=!0}))}})),s.a.createElement("div",{style:{margin:"20px 0px"}},s.a.createElement(de.a,{styles:{root:{maxWidth:"180px"}},selectedKey:x,label:"Clean Method",allowFreeform:!0,autoComplete:"on",options:Ct,onChange:function(e,t){t&&O(t.key)}})),s.a.createElement("p",{style:{fontSize:12,fontWeight:400,color:"#595959"}},"Remember to adjust the fields' types and cleaning strategy before extracting insights."),s.a.createElement("i",{style:{fontSize:12,fontWeight:300,color:"#595959"}},"Number of records ",z.length),s.a.createElement(kt,{fields:a.fields,dataSource:z})))},Lt=n(349),zt=n(338),Bt=n(155),Gt=n(157),Kt=n(156),It=n.n(Kt);function qt(){var e=Object(Bt.a)(["\n  display: inline-block;\n  padding: 1rem;\n  border: 1px solid #f5f5f5;\n  margin: 1rem;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB',\n  'Microsoft YaHei', 'Helvetica Neue', Helvetica, Arial, sans-serif, 'Apple Color Emoji',\n  'Segoe UI Emoji', 'Segoe UI Symbol';\n  .indicator-card.header {\n    color: #8c8c8c;\n    margin-top: 0px;\n    margin-bottom: 0px;\n    font-size: 20px;\n    line-height: 28px;\n    font-weight: 400;\n  }\n  .indicator-card.content {\n    color: #0078d4;\n    font-size: 56px;\n    line-height: 64px;\n    font-weight: 400;\n    margin: 0px;\n  }\n"]);return qt=function(){return e},e}var At=Gt.a.div(qt()),Wt=function(e){var t=e.dataSource,n=void 0===t?[]:t,r=e.measures,a=void 0===r?[]:r,o=e.operator,i=void 0===o?"sum":o,u=Object(c.useMemo)((function(){if(0===a.length||0===n.length)return"-";var e=0;try{e=It.a[i](n.map((function(e){return e[a[0]]})))}catch(t){console.log("operator does not exist or not in vega/datalib.")}return Math.abs(e-Math.round(e))>1e-5&&(e=Number(e.toFixed(2))),function(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")}(e)}),[n,a]);return s.a.createElement(At,null,s.a.createElement("h4",{className:"indicator-card header"},a[0]," ",i&&"(".concat(i,")")),s.a.createElement("h1",{className:"indicator-card content"},u))},Rt={interval:"bar",line:"line",point:"point",density:"rect"},Vt=function(e){var t=e.dashBoard,n=e.dataSource,r=e.dimScores,a=ne({}),o=Object(m.a)(a,2),i=o[0],u=o[1],l=Object(c.useState)([]),d=Object(m.a)(l,2),p=d[0],v=d[1];Object(c.useEffect)((function(){v(t.map((function(){return!1})))}),[t]);var g=Object(c.useMemo)((function(){for(var e=r.map((function(e){return e[0]})),t={},a=n.length,o=e.length,i=0;i<o;i++)if("quantitative"===r[i][3].type){var c=e[i];t[c]=[0,100];for(var s=1/0,u=-1/0,l=0;l<a;l++)s=Math.min(n[l][c],s),u=Math.max(n[l][c],u);t[c]=[s,u]}return t}),[n,r]),y=Object(c.useMemo)((function(){return t&&n&&r?t.map((function(e){var t=e.dimensions,a=e.measures,o=e.type,i=r.filter((function(e){return t.includes(e[0])||a.includes(e[0])})),c=Me(i,n,t,a).schema;return c.position=c.position||[],c.color=c.color||[],c.opacity=c.opacity||[],c.size=c.size||[],c.shape=c.shape||[],c.geomType=c.geomType||[],{dimensions:t,measures:a,type:o,schema:c}})):[]}),[t,n,r]),h=r.map((function(e){return e[3]}));function b(e){var t=h.find((function(t){return t.name===e}));return t?t.type:"nominal"}function x(e,t,n,r){if("point"===r)return!1;var a=b(e);return"rect"===r?"quantitative"!==a:!("quantitative"!==a||!n.includes(e))}var O=Object(c.useMemo)((function(){return y.map((function(e,t){e.dimensions;var n=e.measures,r=e.schema;if("target"===e.type&&1===n.length)return{type:"indicator",measures:n,operator:"sum"};var a=r.geomType[0]&&Rt[r.geomType[0]]?Rt[r.geomType[0]]:r.geomType[0],o=b(r.position[0]),i=b(r.position[1]),c=b(r.color[0]),s=x(r.position[0],0,n,a),u=x(r.position[1],0,n,a),l=r.color[0];"rect"===a&&(r.color[0]&&"quantitative"!==c?a="point":r.opacity[0]&&r.size[0]&&(l=r.size[0]||r.opacity[0]));var m="quantitative"===o&&"quantitative"===i&&"rect"!==a;return{data:{name:"dataSource"},autosize:{type:"pad"},mark:a,selection:{sl:{type:"bar"===a?"single":"interval",encodings:"bar"===a?["x"]:void 0}},encoding:{x:r.position[0]&&{field:r.position[0],type:b(r.position[0]),bin:"rect"===a&&"quantitative"===o&&{maxbins:30},aggregate:"rect"!==a&&s&&"sum",scale:m&&!s?{domain:g[r.position[0]]}:void 0},y:r.position[1]&&{field:r.position[1],type:b(r.position[1]),bin:"rect"===a&&"quantitative"===i&&{maxbins:30},aggregate:"rect"!==a&&u&&"sum",scale:m&&!u?{domain:g[r.position[1]]}:void 0},size:r.size[0]&&{field:r.size[0],type:b(r.size[0])},opacity:r.opacity[0]&&{field:r.opacity[0],type:b(r.opacity[0])},shape:r.shape[0]&&{field:r.shape[0],type:b(r.shape[0])},color:(l||"rect"===a)&&{field:l,aggregate:"rect"===a&&"quantitative"===b(l)&&(l?"sum":"count"),type:l&&b(l)}}}}))}),[y,g]),j=Object(c.useMemo)((function(){return{dataSource:n}}),[n,O,r]),E=Object(c.useMemo)((function(){return t.map((function(e,t){return{sl:function(e,n){p[t]&&u((function(e){if(0===Object.keys(n).length)for(var t in e)e[t]=[];else for(var r in n)e[r]=n[r]}))}}}))}),[t,p,r,O]),S=Object(c.useMemo)((function(){for(var e=[],r=Object.keys(i).map((function(e){return{fieldName:e,filter:i[e],isRange:2===i[e].length&&"number"===typeof i[e][0]&&"number"===typeof i[e][1]&&i[e][0]<i[e][1]}})),a=n.filter((function(e){return r.every((function(t){return 0===t.filter.length||(t.isRange?e[t.fieldName]>=t.filter[0]&&e[t.fieldName]<=t.filter[1]:t.filter.includes(e[t.fieldName]))}))})),o=0;o<t.length;o++)p[o]?e.push(j):e.push({dataSource:a});return e}),[t,i,n,p,O,j]);return s.a.createElement("div",null,s.a.createElement("div",null,O.filter((function(e){return"indicator"===e.type})).map((function(e,t){return s.a.createElement(Wt,{key:"ds-ind-chart-".concat(t),dataSource:S[t].dataSource,measures:e.measures})}))),s.a.createElement("div",null,O.filter((function(e){return"indicator"!==e.type})).map((function(e,t){return s.a.createElement("div",{key:"ds-chart-".concat(t),style:{display:"inline-block",padding:"4px",margin:"2px",height:"380px",overflowY:"auto"}},s.a.createElement("div",{style:{float:"left",minWidth:"300px",minHeight:"300px"}},s.a.createElement(zt.a,{data:S[t],spec:e,actions:!0,signalListeners:p[t]&&E[t]})),s.a.createElement("div",{style:{float:"left"}},s.a.createElement(ae.a,{title:"use as filter",ariaLabel:"use as filter",iconProps:{iconName:p[t]?"FilterSolid":"Filter"},onClick:function(){v((function(e){var n=Object(f.a)(e);return n[t]=!n[t],n[t]||u((function(e){for(var t in e)e[t]=[]})),n}))}})))}))))},Jt=function(e){var t=Y(),n=Object(m.a)(t,4),r=n[0],a=(n[1],n[2]),o=n[3],i=Object(c.useState)(0),u=Object(m.a)(i,2),l=u[0],f=u[1],d=r.subspaceList,p=r.cookedDataSource,v=r.cookedDimensions,g=r.cookedMeasures,y=r.dashBoardList,h=o.dimScores;return s.a.createElement("div",{className:"content-container"},s.a.createElement("div",{className:"card"},s.a.createElement(ue.a,{text:"Generate Dashboard",disabled:0===d.length,iconProps:{iconName:"AreaChart"},onClick:function(){a("getDashBoard",{dataSource:p,dimensions:v,measures:g})}}),r.loading.dashBoard&&s.a.createElement(re.a,{description:"generating dashboard"}),s.a.createElement(Lt.a,null,"current page no: ",l+1," of ",y.length),s.a.createElement(ie.a,{horizontal:!0,tokens:{childrenGap:20}},s.a.createElement(ce.a,{text:"Last",onClick:function(){f((function(e){return(e+y.length-1)%y.length}))},allowDisabledFocus:!0}),s.a.createElement(ce.a,{text:"Next",onClick:function(){f((function(e){return(e+1)%y.length}))},allowDisabledFocus:!0})),s.a.createElement("p",{className:"state-description"},"Double click the chart with selection to clear selection(filter)."),s.a.createElement("div",{style:{overflowX:"auto",margin:"1rem",border:"1px solid #e8e8e8"}},y[l]&&y[l].length>0&&s.a.createElement(Vt,{dataSource:p,dashBoard:y[l],dimScores:h}))))},Ht=n(166),Ut=function(e){var t=Object(c.useRef)(null),n=Object(c.useState)(!1),r=Object(m.a)(n,2),a=r[0],o=r[1],i=Y(),u=Object(m.a)(i,2),l=u[0],f=u[1];return s.a.createElement("div",null,s.a.createElement("div",{ref:t},s.a.createElement(Ht.a,{text:"Preference",iconProps:{iconName:"PlayerSettings"},onClick:function(){o(!0)}})),a&&s.a.createElement(Et.a,{target:t.current,directionalHint:Re.a.bottomLeftEdge,onDismiss:function(){o(!1)}},s.a.createElement("div",{style:{padding:"1rem"}},s.a.createElement(Ot.a,{label:"use server",checked:l.useServer,onText:"On",offText:"Off",onChange:function(e,t){f((function(e){e.useServer=t||!1}))}}))))},Yt=[{title:"DataSource",itemKey:"pivot-1"},{title:"NoteBook",itemKey:"pivot-2"},{title:"Explore",itemKey:"pivot-3"},{title:"DashBaord",itemKey:"pivot-4"}],$t=function(e){return e?"https://ch-rath.oss-ap-northeast-1.aliyuncs.com/assets/rath-glasses.png":"https://ch-rath.oss-ap-northeast-1.aliyuncs.com/assets/rath.png"};function Xt(){var e=Y(),t=Object(m.a)(e,1)[0],n=ne({show:{insightBoard:!1,fieldConfig:!1,configPanel:!1,dataConfig:!1},current:{pivotKey:Yt[0].itemKey}}),r=Object(m.a)(n,2),a=r[0],o=r[1];return s.a.createElement("div",null,s.a.createElement("div",{className:"header-bar"},s.a.createElement("div",{className:"ms-Grid-row"},s.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md4 ms-lg1"},s.a.createElement("a",{href:"https://github.com/ObservedObserver/visual-insights",className:"logo"},s.a.createElement("img",{src:$t(t.useServer),alt:"rath"}))),s.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md8 ms-lg8"},s.a.createElement($.a,{selectedKey:a.current.pivotKey,onLinkClick:function(e){e&&e.props.itemKey&&o((function(t){t.current.pivotKey=e.props.itemKey}))},headersOnly:!0},Yt.map((function(e){return s.a.createElement(X.a,{key:e.itemKey,headerText:e.title,itemKey:e.itemKey})})))),s.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md8 ms-lg3"},s.a.createElement("div",{className:"header-toolbar"},s.a.createElement(Ut,null))))),"pivot-3"===a.current.pivotKey&&s.a.createElement(tt,{subspaceList:t.subspaceList,dataSource:t.cookedDataSource,summary:t.summary}),"pivot-1"===a.current.pivotKey&&s.a.createElement(Tt,{onExtractInsights:function(){o((function(e){e.current.pivotKey="pivot-2",e.show.insightBoard=!0}))}}),"pivot-2"===a.current.pivotKey&&s.a.createElement("div",{className:"content-container"},s.a.createElement("div",{className:"card"},s.a.createElement(jt,{summary:t.summary,subspaceList:t.subspaceList,dataSource:t.cookedDataSource}))),"pivot-4"===a.current.pivotKey&&s.a.createElement(Jt,null))}var _t=n(161);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));Object(_t.a)(),l.a.render(s.a.createElement((function(){return s.a.createElement(U,null,s.a.createElement(Xt,null))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[173,1,2]]]);
//# sourceMappingURL=main.62fee929.chunk.js.map