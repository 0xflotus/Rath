(window.webpackJsonpfrontend=window.webpackJsonpfrontend||[]).push([[0],{113:function(e,t,n){},137:function(e,t,n){e.exports=n(238)},142:function(e,t,n){},144:function(e,t,n){},236:function(e,t,n){},237:function(e,t,n){},238:function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"csvLoader",(function(){return I})),n.d(r,"jsonLoader",(function(){return A}));var a={};n.r(a),n.d(a,"transNumber",(function(){return B}));var o={};n.r(o),n.d(o,"simpleClean",(function(){return je})),n.d(o,"dropNull",(function(){return be})),n.d(o,"useMode",(function(){return xe})),n.d(o,"dropNullColumn",(function(){return he}));var i=n(1),c=n.n(i),u=n(23),s=n.n(u),l=(n(142),n(11)),f=n(54),m=n(9),d=n.n(m),p=n(13),v=n(5);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(n,!0).forEach((function(t){Object(v.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var h="//lobay.moe:8443";function b(e,t){return O.apply(this,arguments)}function O(){return(O=Object(p.a)(d.a.mark((function e(t,n){var r,a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(h+"/api/service/fieldsSummary",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataSource:t,fields:n})});case 3:return r=e.sent,e.next=6,r.json();case 6:if(!0!==(a=e.sent).success){e.next=12;break}return o=a.data,e.abrupt("return",o);case 12:throw new Error("[fields summary failed]"+a.message);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.error(e.t0);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}function x(e,t){return j.apply(this,arguments)}function j(){return(j=Object(p.a)(d.a.mark((function e(t,n){var r,a,o,i,c,u;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(h+"/api/service/groupFields",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataSource:t,fields:n})});case 3:return r=e.sent,e.next=6,r.json();case 6:if(!0!==(a=e.sent).success){e.next=12;break}return o=a.data,i=o.groupedData,c=o.newFields,u=o.fields,e.abrupt("return",{groupedData:i,newFields:c,fields:u});case 12:throw new Error("[group fields failed]"+a.message);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.error(e.t0);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}function w(e,t,n,r){return E.apply(this,arguments)}function E(){return(E=Object(p.a)(d.a.mark((function e(t,n,r,a){var o,i,c;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,fetch(h+"/api/service/combineFields",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dataSource:t,dimensions:n,measures:r,operator:a})});case 3:return o=e.sent,e.next=6,o.json();case 6:if(!0!==(i=e.sent).success){e.next=12;break}return c=i.data,e.abrupt("return",c);case 12:throw new Error("[combine fields failed]"+i.message);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),console.error(e.t0);case 18:case"end":return e.stop()}}),e,null,[[0,15]])})))).apply(this,arguments)}function S(){return(S=Object(p.a)(d.a.mark((function e(t,n){var r,a,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],e.prev=1,e.next=4,fetch(h+"/api/service/clusterMeasures",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({maxGroupNumber:t,spaces:n})});case 4:return a=e.sent,e.next=7,a.json();case 7:if(!0!==(o=e.sent).success){e.next=12;break}r=o.data.map((function(e,t){return y({},e,{index:t})})),e.next=13;break;case 12:throw new Error("[cluster measures]"+o.message);case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(1),console.error(e.t0);case 18:return e.abrupt("return",r);case 19:case"end":return e.stop()}}),e,null,[[1,15]])})))).apply(this,arguments)}var k=function(){var e=Object(p.a)(d.a.mark((function e(t,n,r){var a,o,i,c,u,s,l,f,m,p,v,g,y,h;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.dataSource,o=r.fields,i=o.filter((function(e){return"dimension"===e.type})).map((function(e){return e.name})),c=o.filter((function(e){return"measure"===e.type})).map((function(e){return e.name})),e.prev=3,e.next=6,b(a,o.map((function(e){return e.name})));case 6:return u=e.sent,s=u?u.filter((function(e){return i.includes(e.fieldName)})).map((function(e){return{name:e.fieldName,type:e.type}})):[],e.next=10,x(a,s);case 10:return l=e.sent,m=(f=l||{groupedData:a,newFields:s}).groupedData,p=f.newFields,v=o.map((function(e){var t=p.find((function(t){return t.name===e.name+"(group)"}));return{name:t?t.name:e.name,type:e.type}})),g=v.filter((function(e){return"dimension"===e.type})).map((function(e){return e.name})),e.next=16,b(m,p);case 16:return y=e.sent,n((function(e){e.cookedDataSource=m,e.summary={origin:u||[],grouped:y||[]},e.loading.univariateSummary=!1})),h=(y||[]).concat(u||[]),e.abrupt("return",{groupedData:m,summary:h,newDimensions:g,measures:c});case 22:e.prev=22,e.t0=e.catch(3),n((function(e){e.loading.univariateSummary=!1}));case 25:case"end":return e.stop()}}),e,null,[[3,22]])})));return function(t,n,r){return e.apply(this,arguments)}}(),N=function(){var e=Object(p.a)(d.a.mark((function e(t,n,r){var a,o,i,c,u,s,l,f;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.groupedData,o=r.summary,i=r.dimensions,c=r.measures,u=r.operator,n((function(e){e.loading.subspaceSearching=!0})),s=[],(s=i.map((function(e){var t=o.find((function(t){return t.fieldName===e}));return{name:e,entropy:t?t.entropy:1/0}}))).sort((function(e,t){return e.entropy-t.entropy})),n((function(e){e.cookedDimensions=s.map((function(e){return e.name})),e.cookedMeasures=c})),l=s.map((function(e){return e.name})).slice(0,Math.round(s.length*t.topK.dimensionSize)),e.prev=7,e.next=10,w(a,l,c,u);case 10:(f=e.sent)&&n((function(e){e.subspaceList=f})),n((function(e){e.loading.subspaceSearching=!1})),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(7),n((function(e){e.loading.subspaceSearching=!1}));case 18:case"end":return e.stop()}}),e,null,[[7,15]])})));return function(t,n,r){return e.apply(this,arguments)}}(),C=function(){var e=Object(p.a)(d.a.mark((function e(t,n,r){var a,o,i,c,u,s,l;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=r.dataSource,o=r.fields,n((function(e){e.loading.gallery=!0})),e.prev=2,e.next=5,k(t,n,{dataSource:a,fields:o});case 5:if(!(i=e.sent)){e.next=10;break}return c=i.groupedData,u=i.summary,s=i.newDimensions,l=i.measures,e.next=10,N(t,n,{groupedData:c,summary:u,dimensions:s,measures:l,operator:"sum"});case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(2);case 14:return e.prev=14,n((function(e){e.loading.gallery=!1,e.loading.gallery=!1})),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[2,12,14,17]])})));return function(t,n,r){return e.apply(this,arguments)}}(),P={univariateSummary:k,subspaceSearch:N,extractInsights:C};Object(f.b)(!1);var M={currentPage:0,fields:[],rawData:[],cookedDataSource:[],cookedDimensions:[],cookedMeasures:[],loading:{univariateSummary:!1,subspaceSearching:!1,gallery:!1},topK:{subspacePercentSize:.3,dimensionSize:.72},maxGroupNumber:4,subspaceList:[],summary:{origin:[],grouped:[]},viewSpaces:[]},D=Object(i.createContext)(null);function F(e){var t=e.children,n=Object(i.useState)(M),r=Object(l.a)(n,2),a=r[0],o=r[1],u=function(e){o((function(t){return Object(f.a)(t,(function(t){return e(t)}))}))};return c.a.createElement(D.Provider,{value:[a,u,function(e,t){"function"===typeof P[e]&&P[e](a,u,t)}]},t)}function T(){return Object(i.useContext)(D)}var L=n(281),z=n(128),G=n(114),K=n.n(G);function I(e){return new Promise((function(t,n){K.a.parse(e,{complete:function(e,n){var r=e.data,a=r[0],o=r.slice(1).map((function(e){var t={};return a.forEach((function(n,r){t[n]=e[r]})),t}));t(o)},error:function(e,t){n(e)}})}))}function A(e){return new Promise((function(t,n){var r=new FileReader;r.readAsText(e),r.onload=function(e){if(e.target)try{var r=JSON.parse(e.target.result);t(r)}catch(a){n(a)}else n(e)},r.onerror=n}))}function B(e){return isNaN(e)?null:Number(e)}function R(e){var t=Object(i.useState)(e),n=Object(l.a)(t,2),r=n[0],a=n[1];return[r,function(e){var t=Object(f.a)(r,(function(t){return e(t)}));a(t)}]}n(144);var W=n(3),J=n(286),V=n(291),q=n(277),U=n(131),H=n(263),Y=n(279),$=n(18),X=n(283),_=n(278),Q=n(285),Z=function(){return{root:{marginTop:"10px"}}},ee=[{key:"sum",text:"Sum"},{key:"count",text:"Count"},{key:"mean",text:"Mean"}],te=function(e){var t=e.show,n=void 0!==t&&t,r=e.onUpdateConfig,a=e.onClose,o=e.config,u=Object(i.useState)("sum"),s=Object(l.a)(u,2),f=s[0],m=s[1],d=Object(i.useState)(!0),p=Object(l.a)(d,2),v=p[0],g=p[1],y=Object(i.useState)(!0),h=Object(l.a)(y,2),b=h[0],O=h[1];Object(i.useEffect)((function(){var e=o.aggregator,t=o.defaultAggregated,n=o.defaultStack;m(e),g(t),O(n)}),[o,n]);return c.a.createElement(Y.a,{isOpen:n,type:$.a.smallFixedFar,onDismiss:a,headerText:"Preference",closeButtonAriaLabel:"Close",onRenderFooterContent:function(){return c.a.createElement("div",null,c.a.createElement(H.a,{onClick:function(){r({aggregator:f,defaultAggregated:v,defaultStack:b})}},"Save"))}},c.a.createElement(X.a,null,"Preference"),c.a.createElement(q.a,{verticalFill:!0,tokens:{childrenGap:50,padding:6}},c.a.createElement(_.a,{selectedKey:f,label:"Aggregator",allowFreeform:!0,autoComplete:"on",options:ee,onChange:function(e,t){t&&m(t.key)}}),c.a.createElement(Q.a,{styles:Z,label:"measurement aggregation",checked:v,onChange:function(e,t){g(t||!1)}}),c.a.createElement(Q.a,{styles:Z,label:"measurement stack",checked:b,onChange:function(e,t){O(t||!1)}})))},ne=n(74),re=n.n(ne),ae=n(34);function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var ie={interval:"bar",line:"line",point:"point",density:"rect"},ce=function(e){var t=e.defaultAggregated,n=e.defaultStack,r=e.aggregator,a=e.dataSource,o=void 0===a?[]:a,u=e.dimensions,s=void 0===u?[]:u,l=e.measures,f=void 0===l?[]:l,m=e.schema,d=m.position,p=void 0===d?[]:d,g=m.color,y=void 0===g?[]:g,h=m.opacity,b=void 0===h?[]:h,O=m.size,x=void 0===O?[]:O,j=(m.shape,m.geomType),w=void 0===j?[]:j,E=m.facets,S=void 0===E?[]:E,k=m.page,N=void 0===k?[]:k,C=(m.filter,e.fieldFeatures),P=void 0===C?[]:C,M=Object(i.useRef)(null);function D(e){var t=P.find((function(t){return t.name===e}));return t?t.type:"nominal"}var F=f.map((function(e){return{op:r,field:e,as:"".concat(e,"_").concat(r)}})),T=t?re()({dataSource:o,dimensions:s,measures:f,operator:r,asFields:F.map((function(e){return e.as}))}):o;function L(e){if(t&&f.includes(e)){var n=F.find((function(t){return t.field===e}));return n?n.as:e}return e}function z(){console.log(M.current&&M.current.offsetWidth);var e={x:p[0],y:p[1],color:y[0],size:x[0],opacity:b[0],row:S[0],column:S[1]},r={width:600,data:{values:T}},a={width:600,mark:w[0]&&ie[w[0]]?ie[w[0]]:w[0],encoding:{}};for(var o in e)e[o]&&(a.encoding[o]={field:L(e[o]),type:D(e[o])},["x","y"].includes(o)&&"quantitative"===D(e[o])&&!n&&(a.encoding[o].stack=null));if(n||0!==b.length||(a.encoding.opacity={value:.7}),0===N.length)r=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(n,!0).forEach((function(t){Object(v.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},r,{},a);else if(N.length>0){a.transform=[{filter:{selection:"brush"}},t?{aggregate:F,groupby:s.filter((function(e){return e!==N[0]}))}:null].filter(Boolean);var i={width:600,mark:"tick",selection:{brush:{encodings:["x"],type:"interval"}},encoding:{x:{field:N[0],type:D(N[0])}}};r.vconcat=[a,i]}return r}return Object(i.useEffect)((function(){if(null!==M.current&&p.length>0&&w.length>0){var e=z();Object(ae.a)(M.current,e)}})),c.a.createElement("div",{ref:M})};function ue(e){return JSON.parse(JSON.stringify(e))}function se(e,t){var n=new Map,r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){var u=i.value[t];n.has(u)||n.set(u,0),n.set(u,n.get(u)+1)}}catch(s){a=!0,o=s}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return Object(W.a)(n.entries())}function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var fe={interval:[0,20],line:[21,1/0],area:[21,1/0],point:[0,1e7],path:[0,100],density:[1001,1/0]};function me(e,t){for(var n=t.length-1;n>=0;n--)if(t[n].type===e&&!t[n].choosen)return t[n];return!1}function de(e){for(var t={},n={position:2,color:1,size:1,shape:1,opacity:1,facets:2,page:1,filter:1,highFacets:1/0},r=e.map((function(e){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(n,!0).forEach((function(t){Object(v.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{choosen:!1})})),a=[["quantitative",["position","size","opacity","color","page","filter","hightFacets"]],["ordinal",["position","opacity","color","facets","size","page","filter","highFacets"]],["nominal",["position","color","facets","shape","page","filter","hightFacets"]],["temporal",["position","page","filter"]]],o=r.length,i=0;i<a.length&&o>0;i++)for(var c=a[i][0],u=a[i][1],s=0;s<u.length&&o>0;s++)for(var l=u[s],f=void 0;n[l]>0&&(f=me(c,r));)"undefined"===typeof t[l]&&(t[l]=[]),t[l].push(f.name),n[l]--,o--,f.choosen=!0;return t}var pe=function(e,t,n,r){var a=de(e.sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[3]})));if(2===a.position.length)if(n.includes(a.position[0])&&r.includes(a.position[1])||n.includes(a.position[1])&&r.includes(a.position[0])){var o=n.includes(a.position[0])?0:1,i=a.position[o],c=a.position[(o+1)%2];a.position=[i,c];var u=se(t,i);a.geomType=["interval","line","area"].filter((function(e){return u.length>=fe[e][0]&&u.length<=fe[e][1]}));var s=e.find((function(e){return e[0]===a.position[0]}))[3],l=e.find((function(e){return e[0]===a.position[1]}))[3];"nominal"!==s.type&&"nominal"!==l.type||(a.geomType=["interval"])}else a.geomType=["point","density"].filter((function(e){return t.length>=fe[e][0]&&t.length<=fe[e][1]}));return{schema:a,aggData:t}};function ve(e){for(var t=[],n=0;n<e.length;n++)for(var r=n+1;r<e[n].length;r++)t.push([[n,r],Math.abs(e[n][r])]);return t}function ge(e,t){return e[t]===t?t:e[t]=ge(e,e[t])}function ye(e,t,n){var r=ge(e,t),a=ge(e,n);e[r]=a,ge(e,t),ge(e,n)}function he(e,t){var n=t.map((function(){return!1})),r=!0,a=!1,o=void 0;try{for(var i,c=e[Symbol.iterator]();!(r=(i=c.next()).done);r=!0)for(var u=i.value,s=0;s<t.length;s++){var l=t[s];"undefined"!==typeof u[l]&&""!==u[l]&&null!==u[l]&&(n[s]=!0)}}catch(m){a=!0,o=m}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}var f=t.filter((function(e,t){return n[t]}));return{fields:f,dataSource:e.map((function(e){var t={},n=!0,r=!1,a=void 0;try{for(var o,i=f[Symbol.iterator]();!(n=(o=i.next()).done);n=!0){var c=o.value;t[c]=e[c]}}catch(m){r=!0,a=m}finally{try{n||null==i.return||i.return()}finally{if(r)throw a}}return t}))}}function be(e,t,n){var r=[],a=!0,o=!1,i=void 0;try{for(var c,u=e[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var s=c.value,l=!0,f=!0,m=!1,d=void 0;try{for(var p,v=t[Symbol.iterator]();!(f=(p=v.next()).done);f=!0){var g=p.value;"undefined"!==typeof s[g]&&""!==s[g]&&null!==s[g]||(l=!1)}}catch(C){m=!0,d=C}finally{try{f||null==v.return||v.return()}finally{if(m)throw d}}var y=!0,h=!1,b=void 0;try{for(var O,x=n[Symbol.iterator]();!(y=(O=x.next()).done);y=!0){"number"!==typeof s[O.value]&&(l=!1)}}catch(C){h=!0,b=C}finally{try{y||null==x.return||x.return()}finally{if(h)throw b}}l&&r.push(s)}}catch(C){o=!0,i=C}finally{try{a||null==u.return||u.return()}finally{if(o)throw i}}var j=!0,w=!1,E=void 0;try{for(var S,k=function(){var e=S.value;(function(e,t){return e.every((function(e){return!isNaN(e[t])||"undefined"===typeof e[t]||null===e[t]}))})(r,e)&&(se(r,e).length>20?r.forEach((function(t){t[e]=Number(t[e])||0})):r.forEach((function(t){t[e]=(Number(t[e])||0).toString()})))},N=t[Symbol.iterator]();!(j=(S=N.next()).done);j=!0)k()}catch(C){w=!0,E=C}finally{try{j||null==N.return||N.return()}finally{if(w)throw E}}return r}function Oe(e){return["",null,void 0].includes(e)}function xe(e,t){var n=new Map,r=new Map,a=!0,o=!1,i=void 0;try{for(var c,u=t[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var s=c.value;n.set(s,new Map),r.set(s,0)}}catch($){o=!0,i=$}finally{try{a||null==u.return||u.return()}finally{if(o)throw i}}var l=!0,f=!1,m=void 0;try{for(var d,p=e[Symbol.iterator]();!(l=(d=p.next()).done);l=!0){var v=d.value,g=!0,y=!1,h=void 0;try{for(var b,O=t[Symbol.iterator]();!(g=(b=O.next()).done);g=!0){var x=b.value,j=n.get(x);Oe(v[x])||(j.has(v[x])||j.set(v[x],0),j.set(v[x],j.get(v[x])+1))}}catch($){y=!0,h=$}finally{try{g||null==O.return||O.return()}finally{if(y)throw h}}}}catch($){f=!0,m=$}finally{try{l||null==p.return||p.return()}finally{if(f)throw m}}var w=!0,E=!1,S=void 0;try{for(var k,N=n.keys()[Symbol.iterator]();!(w=(k=N.next()).done);w=!0){for(var C=k.value,P=n.get(C),M=Object(W.a)(P.entries()),D=0,F=0,T=0;T<M.length;T++){var L=M[T];L[1]>D&&(D=L[1],F=T)}r.set(C,M[F][0])}}catch($){E=!0,S=$}finally{try{w||null==N.return||N.return()}finally{if(E)throw S}}var z=ue(e),G=!0,K=!1,I=void 0;try{for(var A,B=z[Symbol.iterator]();!(G=(A=B.next()).done);G=!0){var R=A.value,J=!0,V=!1,q=void 0;try{for(var U,H=t[Symbol.iterator]();!(J=(U=H.next()).done);J=!0){var Y=U.value;Oe(R[Y])&&(R[Y]=r.get(Y))}}catch($){V=!0,q=$}finally{try{J||null==H.return||H.return()}finally{if(V)throw q}}}}catch($){K=!0,I=$}finally{try{G||null==B.return||B.return()}finally{if(K)throw I}}return z}function je(e,t,n){var r=ue(e),a=!0,o=!1,i=void 0;try{for(var c,u=e[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var s=c.value,l=!0,f=!1,m=void 0;try{for(var d,p=t[Symbol.iterator]();!(l=(d=p.next()).done);l=!0){var v=d.value;Oe(s[v])&&(s[v]="null")}}catch(j){f=!0,m=j}finally{try{l||null==p.return||p.return()}finally{if(f)throw m}}var g=!0,y=!1,h=void 0;try{for(var b,O=n[Symbol.iterator]();!(g=(b=O.next()).done);g=!0){var x=b.value;Oe(s[x])&&(s[x]=0)}}catch(j){y=!0,h=j}finally{try{g||null==O.return||O.return()}finally{if(y)throw h}}}}catch(j){o=!0,i=j}finally{try{a||null==u.return||u.return()}finally{if(o)throw i}}return r}var we=n(76),Ee=n.n(we),Se=n(280),ke=n(14),Ne=(n(113),function(e){var t=e.space,n=e.dimensions,r=void 0===n?[]:n,a=e.measures,o=void 0===a?[]:a,u=e.dimScores,s=void 0===u?[]:u,f=e.spaceList,m=void 0===f?[]:f,d=e.schema,p=Object(i.useState)(!1),v=Object(l.a)(p,2),g=v[0],y=v[1],h=Object(i.useMemo)((function(){return Object(W.a)(s).sort((function(e,t){return e[1]-t[1]}))}),[s]),b=Object(i.useMemo)((function(){if("undefined"!==typeof t){var e=!0,n=!1,r=void 0;try{for(var a,o=m[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var i=a.value;if(i.dimensions.some((function(e){return t.dimensions.includes(e)})))return i.dimensions.find((function(e){return t.dimensions.includes(e)}))}}catch(c){n=!0,r=c}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}}}),[]),O=Object(i.useMemo)((function(){if("undefined"!==typeof t){for(var e=t.measures.filter((function(e){return o.includes(e.name)})),n=1/0,r=0,a=0;a<e.length;a++)e[a].value<n&&(n=e[a].value,r=a);return e[r].name}}),[o,t]),x=Object(i.useMemo)((function(){var e=h.find((function(e){return r.includes(e[0])}));return e?e[0]:void 0}),[h,r]),j="\n  ".concat(d&&d.position?"Current chart mainly focus on the relationship between ***".concat(d.position[0],"*** and ***").concat(d.position[1],"***"):"","\n  ").concat(r.length>1?"+ DataSource is grouped by ***".concat(r.join(", "),"***, measures(indicators) will propose strong difference of distribution between each other."):"","\n  ").concat(o.length>1?"+ ***".concat(o.join(", "),"***are strongly related to each other"):"","\n  ").concat(x?"+ The distribution of member countings of ***".concat(x,"*** seems to contain more orders and patterns."):"","\n  ").concat(b?"+ ***".concat(b,"*** has great influence on aggregated measure values."):"","\n  ").concat(O?"+ ***".concat(O,"*** is more likely to have patterns according to its distribution."):"","\n  ``  ");return c.a.createElement("div",null,c.a.createElement(U.a,{id:"vis-summary",text:"Summary",onClick:function(){y(!0)}}),g?c.a.createElement("div",null,c.a.createElement(Se.a,{calloutProps:{directionalHint:ke.a.bottomCenter},isWide:!0,hasCloseIcon:!0,closeButtonAriaLabel:"Close",target:"#vis-summary",onDismiss:function(){y(!1)},headline:"Chart Description"},c.a.createElement(Ee.a,{source:j}))):null)}),Ce=function(e){var t=e.space,n=e.dimensions,r=void 0===n?[]:n,a=e.measures,o=void 0===a?[]:a,u=e.dimScores,s=void 0===u?[]:u,l=e.spaceList,f=void 0===l?[]:l,m=e.schema,d=Object(i.useMemo)((function(){return Object(W.a)(s).sort((function(e,t){return e[1]-t[1]}))}),[s]),p=Object(i.useMemo)((function(){if("undefined"!==typeof t){var e=!0,n=!1,r=void 0;try{for(var a,o=f[Symbol.iterator]();!(e=(a=o.next()).done);e=!0){var i=a.value;if(i.dimensions.some((function(e){return t.dimensions.includes(e)})))return i.dimensions.find((function(e){return t.dimensions.includes(e)}))}}catch(c){n=!0,r=c}finally{try{e||null==o.return||o.return()}finally{if(n)throw r}}}}),[]),v=Object(i.useMemo)((function(){if("undefined"!==typeof t){for(var e=t.measures.filter((function(e){return o.includes(e.name)})),n=1/0,r=0,a=0;a<e.length;a++)e[a].value<n&&(n=e[a].value,r=a);return e[r].name}}),[o,t]),g=Object(i.useMemo)((function(){var e=d.find((function(e){return r.includes(e[0])}));return e?e[0]:void 0}),[d,r]),y="\n  ".concat(m&&m.position?"Current chart mainly focus on the relationship between ***".concat(m.position[0],"*** and ***").concat(m.position[1],"***"):"","\n  ").concat(r.length>1?"+ DataSource is grouped by ***".concat(r.join(", "),"***, measures(indicators) will propose strong difference of distribution between each other."):"","\n  ").concat(o.length>1?"+ ***".concat(o.join(", "),"***are strongly related to each other"):"","\n  ").concat(g?"+ The distribution of member countings of ***".concat(g,"*** seems to contain more orders and patterns."):"","\n  ").concat(p?"+ ***".concat(p,"*** has great influence on aggregated measure values."):"","\n  ").concat(v?"+ ***".concat(v,"*** is more likely to have patterns according to its distribution."):"","\n  ``  ");return c.a.createElement(Ee.a,{source:y})};function Pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pe(n,!0).forEach((function(t){Object(v.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pe(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var De=.2,Fe=5;function Te(e,t){var n=new Set([].concat(Object(W.a)(e),Object(W.a)(t))),r=new Set(e),a=new Set(t),o=[],i=[],c=!0,u=!1,s=void 0;try{for(var l,f=n[Symbol.iterator]();!(c=(l=f.next()).done);c=!0){var m=l.value;o.push(Number(r.has(m))),i.push(Number(a.has(m)))}}catch(v){u=!0,s=v}finally{try{c||null==f.return||f.return()}finally{if(u)throw s}}for(var d=0,p=0;p<o.length;p++)d+=o[p]*i[p];return d/=Math.sqrt(e.length)*Math.sqrt(t.length)}var Le=function(e){var t=e.viewSpaces,n=e.interestedViewSpace,r=e.fieldScores,a=e.dataSource,o=(e.visualConfig,Object(i.useMemo)((function(){var e=[],r=!0,a=!1,o=void 0;try{for(var i,c=function(){var t=i.value;t.dimensions.length>n.dimensions.length&&t.dimensions.length-n.dimensions.length<=2&&(n.dimensions.every((function(e){return t.dimensions.find((function(t){return e===t}))}))&&e.push(t))},u=t[Symbol.iterator]();!(r=(i=u.next()).done);r=!0)c()}catch(s){a=!0,o=s}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}return e}),[n,t])),c=Object(i.useMemo)((function(){var e=[],t=!0,r=!1,a=void 0;try{for(var i,c=o[Symbol.iterator]();!(t=(i=c.next()).done);t=!0){var u=i.value,s=Te(n.measures,u.measures);s>De&&e.push(Me({},u,{relatedScore:u.score/Math.sqrt(s)}))}}catch(l){r=!0,a=l}finally{try{t||null==c.return||c.return()}finally{if(r)throw a}}return e.sort((function(e,t){return e.relatedScore-t.relatedScore}))}),[o]);return Object(i.useMemo)((function(){return c.slice(0,Fe).map((function(e){var t=r.filter((function(t){return e.dimensions.includes(t[0])||e.measures.includes(t[0])}));return Me({},e,{schema:pe(t,a,e.dimensions,e.measures).schema})}))}),[c,r])};var ze=function(e){var t=e.digDimensionProps,n=e.subspaceList,r=e.onSelectView,a=t.dataSource,o=t.visualConfig,i=t.fieldScores,u=Le(t),s=i.map((function(e){return e[3]}));return c.a.createElement("div",null,c.a.createElement("div",{className:"ms-Grid"},u.map((function(e,t){var u=n.find((function(t){return n=t.dimensions,r=e.dimensions,n.length===r.length&&n.every((function(e){return r.includes(e)}));var n,r}));return c.a.createElement("div",{key:"associate-row-".concat(t),className:"ms-Grid-row",style:{border:"solid 1px #bfbfbf",margin:"1em",padding:"1em"}},c.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md8 ms-lg9",style:{overflow:"auto"}},c.a.createElement(ce,{aggregator:o.aggregator,defaultAggregated:!e.schema.geomType||!e.schema.geomType.includes("point"),defaultStack:o.defaultStack,dimensions:e.dimensions,measures:e.measures,dataSource:a,schema:e.schema,fieldFeatures:s})),c.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md4 ms-lg3",style:{fontSize:14,color:"#8a8886",overflow:"auto"}},c.a.createElement("div",null,c.a.createElement(q.a,{tokens:{childrenGap:8},horizontal:!0},c.a.createElement(V.a,{iconProps:{iconName:"Lightbulb"},title:"Interested",onClick:function(){r(e.index)}}))),u&&c.a.createElement(Ce,{dimensions:e.dimensions,measures:e.measures,dimScores:i,space:u,spaceList:n,schema:e.schema})))}))))};function Ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ge(n,!0).forEach((function(t){Object(v.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ge(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ie=function(e){var t=e.dataSource,n=e.summary,r=e.subspaceList,a=Object(i.useState)(0),o=Object(l.a)(a,2),u=o[0],s=o[1],f=T(),m=Object(l.a)(f,2),d=m[0],p=m[1],v=R({show:{insightBoard:!1,fieldConfig:!1,configPanel:!1,dataConfig:!1}}),g=Object(l.a)(v,2),y=g[0],h=g[1],b=Object(i.useState)(!1),O=Object(l.a)(b,2),x=O[0],j=O[1],w=Object(i.useState)({aggregator:"sum",defaultAggregated:!0,defaultStack:!0}),E=Object(l.a)(w,2),k=E[0],N=E[1],C=Object(i.useState)([]),P=Object(l.a)(C,2),M=P[0],D=P[1],F=Object(i.useState)({schema:{position:[],color:[],opacity:[],geomType:[]},fieldFeatures:[],aggData:[],dimensions:[],measures:[]}),L=Object(l.a)(F,2),z=L[0],G=L[1],K=function(e){s(e)};Object(i.useEffect)((function(){p((function(e){e.loading.gallery=!0})),function(e,t){return S.apply(this,arguments)}(d.maxGroupNumber,r.map((function(e){return{dimensions:e.dimensions,measures:e.measures,matrix:e.correlationMatrix}}))).then((function(e){D(e),p((function(e){e.loading.gallery=!1}))}))}),[r,t,d.maxGroupNumber]);var I=Object(i.useMemo)((function(){return[].concat(Object(W.a)(n.origin),Object(W.a)(n.grouped)).map((function(e){return[e.fieldName,e.entropy,e.maxEntropy,{name:e.fieldName,type:e.type}]}))}),[n.origin,n.grouped]);Object(i.useEffect)((function(){var e=M[u];if(e){var n=e.dimensions,r=e.measures;try{var a=I.filter((function(e){return n.includes(e[0])||r.includes(e[0])})),o=pe(a,t,n,r).schema;G({schema:o,fieldFeatures:a.map((function(e){return e[3]})),aggData:t,dimensions:n,measures:r}),o.geomType&&o.geomType.includes("point")?N((function(e){return Ke({},e,{defaultAggregated:!1})})):N((function(e){return Ke({},e,{defaultAggregated:!0})}))}catch(i){console.log(i)}}}),[M,u]);var A=Object(i.useMemo)((function(){return r.find((function(e){return e.dimensions.join(",")===z.dimensions.join(",")}))}),[r,u,z]);return Object(i.useEffect)((function(){j(!1)}),[u]),c.a.createElement("div",{className:"content-container"},c.a.createElement(te,{show:y.show.configPanel,config:k,onUpdateConfig:function(e){N(e),h((function(e){e.show.configPanel=!1}))},onClose:function(){h((function(e){e.show.configPanel=!1}))}}),c.a.createElement("div",{className:"card"},(d.loading.gallery||d.loading.subspaceSearching||d.loading.univariateSummary)&&c.a.createElement(J.a,{description:"calculating"}),c.a.createElement("h2",{style:{marginBottom:0}},"Visual Insights"," ",c.a.createElement(V.a,{iconProps:{iconName:"Settings"},title:"Preference",ariaLabel:"preference",onClick:function(){h((function(e){e.show.configPanel=!0}))}}),c.a.createElement(V.a,{iconProps:{iconName:"Lightbulb"},title:"Dig In",ariaLabel:"digIn",onClick:function(){j(!0)}})),c.a.createElement("p",{className:"state-description"},"Page No. ",u+1," of ",M.length),c.a.createElement("p",{className:"state-description"},"Details of the recommendation process can be seen in ",c.a.createElement("b",null,"NoteBook")," ","Board. You can adjust some of the parameters and operators and see how it influence recommendation results."),c.a.createElement("p",{className:"state-description"},'Try to use the setting button beside the "visual insight" title to adjust the visualization settings to get a view you prefer better.'),c.a.createElement("div",{className:"ms-Grid",dir:"ltr"},c.a.createElement("div",{className:"ms-Grid-row"},c.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md8 ms-lg3",style:{overflow:"auto"}},c.a.createElement(q.a,{horizontal:!0,tokens:{childrenGap:20}},c.a.createElement(U.a,{text:"Last",onClick:function(){K((u-1+M.length)%M.length)},allowDisabledFocus:!0}),c.a.createElement(U.a,{text:"Next",onClick:function(){K((u+1)%M.length)},allowDisabledFocus:!0})),c.a.createElement("h3",null,"Specification"),c.a.createElement("pre",null,JSON.stringify(z.schema,null,2)),c.a.createElement(Ne,{dimensions:z.dimensions,measures:z.measures,dimScores:I,space:A,spaceList:r,schema:z.schema})),c.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md4 ms-lg9",style:{overflow:"auto"}},c.a.createElement(ce,{aggregator:k.aggregator,defaultAggregated:k.defaultAggregated,defaultStack:k.defaultStack,dimensions:z.dimensions,measures:z.measures,dataSource:z.aggData,schema:z.schema,fieldFeatures:z.fieldFeatures}))))),x&&c.a.createElement("div",{className:"card"},c.a.createElement("h2",null," Related Views "),c.a.createElement(ze,{onSelectView:function(e){var t=M.findIndex((function(t){return t.index===e}));t>-1&&K(t)},subspaceList:r,digDimensionProps:{visualConfig:k,dataSource:t,viewSpaces:M,fieldScores:I,interestedViewSpace:M[u]}})))},Ae=n(282),Be=n(275),Re=n(273),We=n(28),Je=n(127),Ve=n.n(Je),qe=n(7),Ue=(n(8),n(6),n(132));function He(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ye(e,t){Ye=function(e,t){return new o(e,void 0,t)};var n=Object(Ue.a)(RegExp),r=RegExp.prototype,a=new WeakMap;function o(e,t,r){var o=n.call(this,e,t);return a.set(o,r||a.get(e)),o}function i(e,t){var n=a.get(t);return Object.keys(n).reduce((function(t,r){return t[r]=e[n[r]],t}),Object.create(null))}return Object(qe.a)(o,n),o.prototype.exec=function(e){var t=r.exec.call(this,e);return t&&(t.groups=i(t,this)),t},o.prototype[Symbol.replace]=function(e,t){if("string"===typeof t){var n=a.get(this);return r[Symbol.replace].call(this,e,t.replace(/\$<([^>]+)>/g,(function(e,t){return"$"+n[t]})))}if("function"===typeof t){var o=this;return r[Symbol.replace].call(this,e,(function(){var e=[];return e.push.apply(e,arguments),"object"!==typeof e[e.length-1]&&e.push(i(e,o)),t.apply(this,e)}))}return r[Symbol.replace].call(this,e,t)},Ye.apply(this,arguments)}var $e=function(e){var t=Object(i.useRef)(null),n=e.x,r=e.y,a=e.dataSource,o=e.fieldType;return Object(i.useEffect)((function(){if(t.current){var e=[],i=!1;e="ordinal"===o&&a.some((function(e){return/(\[|\()-?([0-9.]+|Infinity),\s*([0-9.]+|Infinity)(\]|\))/.test(e.memberName)}))?a.map((function(e){i=!0;var t=Ye(/(\[|\()(\x2D?([\.0-9]+|Infinity)),[\t-\r \xA0\u1680\u2000-\u200A\u2028\u2029\u202F\u205F\u3000\uFEFF]*([\.0-9]+|Infinity)(\]|\))/,{left:2}).exec(e.memberName);return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?He(n,!0).forEach((function(t){Object(v.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):He(n).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{index:null===t?e.name:Number(t.groups.left)})})):a;var c=void 0;"nominal"===o?c="-y":"ordinal"===o&&i&&(c={field:"index"}),Object(ae.a)(t.current,{background:"#fff",data:{values:e},height:120,width:200,mark:["quantitative","temporal"].includes(o)?"line":"bar",encoding:{x:{field:n,axis:a.length>16?null:void 0,type:o,sort:c},y:{field:r,type:"quantitative",aggregate:"sum"}}},{actions:!1})}}),[n,r,a]),c.a.createElement("div",{ref:t})},Xe=(n(236),[{key:"fieldName",name:"fieldName",fieldName:"fieldName",minWidth:70,maxWidth:150},{key:"type",name:"type",fieldName:"type",minWidth:50},{key:"entropy",name:"entropy",fieldName:"entropy",minWidth:120},{key:"maxEntropy",name:"maxEntropy",fieldName:"maxEntropy",minWidth:120}]);function _e(e){switch(e){case"nominal":return"TextField";case"quantitative":return"NumberField";case"ordinal":return"Breadcrumb";case"temporal":return"EventDate";default:return""}}function Qe(e){return(.299*e[0]+.587*e[1]+.114*e[2])/255>.5?[0,0,0]:[255,255,255]}var Ze=function(e){var t=e.originSummary,n=e.groupedSummary,r=Object(i.useMemo)((function(){var e=t.map((function(e){return e.maxEntropy}));return[0,Math.max.apply(Math,Object(W.a)(e))]}),[t]),a=function(e){return c.a.createElement("div",{className:"field-hover-card"},c.a.createElement("h2",null,e.fieldName),c.a.createElement("div",null,"Field entropy is ",Number(e.entropy).toFixed(2)),c.a.createElement("div",{className:"chart-vertical-margin-container"},c.a.createElement($e,{x:"memberName",y:"count",fieldType:e.type,dataSource:e.distribution})))},o=function(e){var t=e.fieldName,r=n.find((function(e){return e.fieldName===t+"(group)"}));return c.a.createElement("div",{className:"field-hover-card"},r?c.a.createElement("div",null,c.a.createElement("h3",null,r.fieldName),c.a.createElement("div",null,"Field entropy is ",Number(r.entropy).toFixed(2)),c.a.createElement("div",{className:"chart-vertical-margin-container"},c.a.createElement($e,{x:"memberName",y:"count",fieldType:r.type,dataSource:r.distribution}))):c.a.createElement("div",null,"This field is not grouped."))};return c.a.createElement(Re.a,{compact:!0,columns:Xe,items:t,selectionMode:We.b.none,onRenderItemColumn:function(e,t,i){if(void 0!==i){var u=e.fieldName,s=n.find((function(e){return e.fieldName===u+"(group)"})),l={onRenderCompactCard:a,onRenderExpandedCard:o,renderData:e,compactCardHeight:320,expandedCardHeight:s?320:40},f=e[i.fieldName],m=[255,255,255];switch(i.key){case"type":return c.a.createElement("div",null,c.a.createElement(Ae.a,{iconName:_e(f)})," ",f);case"entropy":case"maxEntropy":v=e[i.key],g=r;Qe(m=Ve.a.scale("YlGnBu").domain([g[1],g[0]])(v).rgb());var d="rgb(".concat(m.join(","),")"),p="rgb(".concat(Qe(m).join(","),")");return c.a.createElement(Be.a,{expandedCardOpenDelay:800,expandingCardProps:l,instantOpenOnClick:!0},c.a.createElement("div",{style:{boxShadow:"".concat(d," 0px 0px 0px 10px"),backgroundColor:d,color:p}},f));default:return c.a.createElement(Be.a,{expandedCardOpenDelay:800,expandingCardProps:l,instantOpenOnClick:!0},c.a.createElement("div",null,f))}}var v,g}})};function et(e){return e.join(",")}var tt=function(e){var t=e.subspaceList,n=e.onSpaceChange;console.log(t);var r=Object(i.useState)(0),a=Object(l.a)(r,2),o=a[0],u=a[1],s=Object(i.useRef)(null),f=Object(i.useRef)(null),m=Object(i.useMemo)((function(){var e=0,n=1/0,r=!0,a=!1,o=void 0;try{for(var i,c=t[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){var u=i.value,s=!0,l=!1,f=void 0;try{for(var m,d=u.measures[Symbol.iterator]();!(s=(m=d.next()).done);s=!0){var p=m.value,v=(p.name,p.value);e=Math.max(e,v),n=Math.min(n,v)}}catch(g){l=!0,f=g}finally{try{s||null==d.return||d.return()}finally{if(l)throw f}}}}catch(g){a=!0,o=g}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return[n,e]}),[t]),d=Object(i.useMemo)((function(){for(var e=[],n=0;n<t.length;n++){var r=t[n],a=et(r.dimensions),o=!0,i=!1,c=void 0;try{for(var u,s=r.measures[Symbol.iterator]();!(o=(u=s.next()).done);o=!0){var l=u.value,f=l.name,m=l.value,d={test:n,score:r.score,dimensions:a,measureName:f,measureValue:m};e.push(d)}}catch(p){i=!0,c=p}finally{try{o||null==s.return||s.return()}finally{if(i)throw c}}}return e}),[t,m]);return Object(i.useEffect)((function(){s.current&&t.length>0&&Object(ae.a)(s.current,{data:{values:d},vconcat:[{mark:"rect",selection:{dim:{type:"single",on:"click",encodings:["y"]}},encoding:{x:{field:"measureName",type:"nominal"},y:{field:"dimensions",type:"ordinal",sort:{field:"score"}},color:{field:"measureValue",type:"quantitative",aggregate:"mean",scale:{reverse:!0}},opacity:{condition:{selection:"dim",value:1},value:.72}}}]}).then((function(e){e.view.addEventListener("click",(function(e,r){if(r){var a=r.datum,o=t.findIndex((function(e){return et(e.dimensions)===a.dimensions}));if(o>-1){var i=t[o];n(i.dimensions,i.measures.map((function(e){return e.name})),i.correlationMatrix),u(o)}}}))}))}),[t,d]),Object(i.useEffect)((function(){var e=t[o];if(f.current&&t.length>0&&e){for(var n=[],r=0;r<e.correlationMatrix.length;r++)for(var a=0;a<e.correlationMatrix[r].length;a++)n.push({x:e.measures[r].name,y:e.measures[a].name,correlation:e.correlationMatrix[r][a]});Object(ae.a)(f.current,{data:{values:n},mark:"rect",encoding:{x:{field:"x",type:"nominal"},y:{field:"y",type:"nominal"},color:{field:"correlation",type:"quantitative",aggregate:"mean",scale:{scheme:"redyellowgreen",domain:[-1,1]}}}})}}),[t,o]),c.a.createElement("div",null,c.a.createElement("div",{ref:s}),c.a.createElement("div",{ref:f}))},nt=function(e){var t=e.adjMatrix,n=e.measures,r=e.onFocusGroup,a=T(),o=Object(l.a)(a,2),u=o[0],s=(o[1],Object(i.useRef)(null)),f=Object(i.useMemo)((function(){var e=u.maxGroupNumber,n=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=ve(e);n.sort((function(e,t){return t[1]-e[1]}));var r=[],a=e.map((function(e,t){return t})),o=Object(W.a)(a),i=!1,c=!0,u=!1,s=void 0;try{for(var l,f=n[Symbol.iterator]();!(c=(l=f.next()).done);c=!0){var m=l.value;ge(a,m[0][0])!==ge(a,m[0][1])&&(ye(a,m[0][0],m[0][1]),r.push([m[0],m[1],i]));for(var d=0;d<a.length;d++)a[d]=ge(a,d);var p=new Set(a);if(p.size<=t?i=!0:o=Object(W.a)(a),1===p.size)break}}catch(v){u=!0,s=v}finally{try{c||null==f.return||f.return()}finally{if(u)throw s}}return{edgesInMST:r,groups:o}}(t,e);return{edgesInMST:n.edgesInMST,groups:n.groups}}),[t,u.maxGroupNumber]),m=Object(i.useMemo)((function(){for(var e=f.edgesInMST,t=f.groups,r=e.map((function(e){return{source:e[0][0],target:e[0][1],value:1/e[1],inCutEdge:e[2]}})),a=[],o=0;o<t.length;o++)a.push({name:n[o],index:o,value:1,group:t[o]});return{nodes:a,edges:r}}),[n,f]);return Object(i.useEffect)((function(){s.current&&n.length>0&&Object(ae.a)(s.current,{$schema:"https://vega.github.io/schema/vega/v5.json",width:700,height:500,padding:0,autosize:"none",signals:[{name:"cx",update:"width / 2"},{name:"cy",update:"height / 2"},{description:"State variable for active node fix status.",name:"fix",value:!1,on:[{events:"text:mouseout[!event.buttons], window:mouseup",update:"false"},{events:"text:mouseover",update:"fix || true"},{events:"[text:mousedown, window:mouseup] > window:mousemove!",update:"xy()",force:!0}]},{description:"Graph node most recently interacted with.",name:"node",value:null,on:[{events:"text:mouseover",update:"fix === true ? item() : node"}]},{description:"Flag to restart Force simulation upon data changes.",name:"restart",value:!1,on:[{events:{signal:"fix"},update:"fix && fix.length"}]}],data:[{name:"node-data",values:m.nodes},{name:"link-data",values:m.edges}],scales:[{name:"color",type:"ordinal",domain:{data:"node-data",field:"group"},range:{scheme:"tableau20"}}],marks:[{name:"nodes",type:"text",zindex:1,from:{data:"node-data"},on:[{trigger:"fix",modify:"node",values:"fix === true ? {fx: node.x, fy: node.y} : {fx: fix[0], fy: fix[1]}"},{trigger:"!fix",modify:"node",values:"{fx: null, fy: null}"}],encode:{enter:{fill:{scale:"color",field:"group"},text:{field:"name"},fontSize:{value:14},fontWeight:{value:600}},update:{cursor:{value:"pointer"}}},transform:[{type:"force",iterations:300,restart:{signal:"restart"},signal:"force",forces:[{force:"center",x:{signal:"cx"},y:{signal:"cy"}},{force:"collide"},{force:"nbody"},{force:"link",links:"link-data"}]}]},{type:"path",from:{data:"link-data"},interactive:!1,encode:{update:{stroke:{signal:"datum.inCutEdge == true ? '#f5f5f5' : '#d9d9d9' "},strokeWidth:{value:.8}}},transform:[{type:"linkpath",require:{signal:"force"},shape:"line",sourceX:"datum.source.x",sourceY:"datum.source.y",targetX:"datum.target.x",targetY:"datum.target.y"}]}]}).then((function(e){e.view.addEventListener("click",(function(e,t){if(t){var a=t.datum.group,o=n.filter((function(e,t){return f.groups[t]===a}));r(o)}}))}))}),[m,n]),c.a.createElement("div",{ref:s})},rt=n(287),at=n(288),ot=(n(237),function(e){var t=e.summary,n=e.subspaceList,r=e.dataSource,a=T(),o=Object(l.a)(a,2),u=o[0],s=o[1],f=Object(i.useState)(!1),m=Object(l.a)(f,2),d=m[0],p=m[1],v=Object(i.useState)({measures:[],dimensions:[],matrix:[]}),g=Object(l.a)(v,2),y=g[0],h=g[1],b=Object(i.useState)([]),O=Object(l.a)(b,2),x=O[0],j=O[1],E=Object(i.useMemo)((function(){return[].concat(Object(W.a)(t.origin),Object(W.a)(t.grouped)).map((function(e){return[e.fieldName,e.entropy,e.maxEntropy,{name:e.fieldName,type:e.type}]}))}),[t.origin,t.grouped]),S=Object(i.useMemo)((function(){var e=y.dimensions;y.measures;try{var t=E.filter((function(t){return e.includes(t[0])||x.includes(t[0])}));return pe(t,r,e,x).schema}catch(n){return console.log(n),{position:[]}}}),[E,y,r,x]);return Object(i.useEffect)((function(){s((function(e){e.maxGroupNumber=Math.round(u.cookedMeasures.length/4)}))}),[u.cookedMeasures]),c.a.createElement("div",null,c.a.createElement("h3",{className:"notebook header"},"Univariate Summary"),c.a.createElement("p",{className:"state-description"},"Hover your mouse over the fields and see the distails and entropy reducing strategy."),u.loading.univariateSummary&&c.a.createElement(J.a,{description:"analyzing"}),c.a.createElement("div",{className:"notebook content container"},c.a.createElement(Ze,{originSummary:t.origin,groupedSummary:t.grouped})),c.a.createElement("h3",{className:"notebook header"},"Subspace Searching"),c.a.createElement("p",{className:"state-description"},"Try to choose one row(combination of dimensions) of the subspace and see the changes of the processes below."),u.loading.subspaceSearching&&c.a.createElement(J.a,{description:"analyzing"}),!u.loading.subspaceSearching&&c.a.createElement(rt.a,{value:100*u.topK.dimensionSize,label:"top k percent dimension used",max:100,valueFormat:function(e){return"".concat(e,"%")},showValue:!0,onChange:function(e){s((function(t){t.topK.dimensionSize=e/100}));var t=u.cookedDimensions.slice(0,Math.round(u.cookedDimensions.length*e/100));w(r,t,u.cookedMeasures,"sum").then((function(e){e&&s((function(t){t.subspaceList=e}))}))}}),!u.loading.subspaceSearching&&c.a.createElement(rt.a,{value:100*u.topK.subspacePercentSize,label:"top k percent subspace used",max:100,valueFormat:function(e){return"".concat(e,"%")},showValue:!0,onChange:function(e){s((function(t){t.topK.subspacePercentSize=e/100}))}}),c.a.createElement("div",{className:"notebook content center container"},c.a.createElement(tt,{subspaceList:n.slice(0,Math.round(n.length*u.topK.subspacePercentSize)),onSpaceChange:function(e,t,n){h({dimensions:e,measures:t,matrix:n})}})),c.a.createElement("h3",{className:"notebook header"},"Measurement Clustering"),c.a.createElement("p",{className:"state-description"},"Try to choose one group to visualize them."),c.a.createElement(rt.a,{label:"Max Group Number",min:1,max:u.cookedMeasures.length||4,step:1,value:u.maxGroupNumber,showValue:!0,onChange:function(e){s((function(t){t.maxGroupNumber=e}))}}),c.a.createElement("div",{className:"notebook content center container"},c.a.createElement(nt,{adjMatrix:y.matrix,measures:y.measures,onFocusGroup:function(e){j(e),console.log("view in measures",e)}})),c.a.createElement("h3",{className:"notebook header"},"Visualization"),c.a.createElement("p",{className:"state-description"},"If there is no result here, try to click one group of measures in ",c.a.createElement("b",null,"Clustering")," process above."),c.a.createElement(at.a,{checked:d,label:"aggregate measures",defaultChecked:!0,onText:"On",offText:"Off",onChange:function(e,t){p(!!t)}}),c.a.createElement("div",{className:"notebook content center container"},c.a.createElement(ce,{defaultAggregated:d,defaultStack:!0,aggregator:"sum",schema:S,fieldFeatures:E.map((function(e){return e[3]})),dataSource:r,dimensions:y.dimensions,measures:x})))}),it=n(130),ct=n(274),ut=function(e){var t=e.dataSource,n=void 0===t?[]:t,r=e.fields,a=(void 0===r?[]:r).map((function(e){return{key:e.name,name:e.name,fieldName:e.name,minWidth:70,maxHeight:90}}));return c.a.createElement("div",{style:{maxHeight:400,overflow:"auto"}},c.a.createElement(Re.a,{items:n,columns:a,selectionMode:We.b.none}))},st=function(e){var t=e.show,n=void 0!==t&&t,r=e.onUpdateConfig,a=e.onClose,o=Object(i.useState)([]),u=Object(l.a)(o,2),s=u[0],f=u[1];Object(i.useEffect)((function(){f(e.fields)}),[e.fields]);return c.a.createElement(Y.a,{isOpen:n,type:$.a.smallFixedFar,onDismiss:a,headerText:"Meta Config",closeButtonAriaLabel:"Close",onRenderFooterContent:function(){return c.a.createElement("div",null,c.a.createElement(H.a,{onClick:function(){r(s),a()}},"Save"))}},c.a.createElement("div",null,s.map((function(e){return c.a.createElement(at.a,{key:e.name,checked:"dimension"===e.type,label:e.name,onText:"dimension",offText:"measure",onChange:function(t,n){!function(e,t){f((function(n){return n.map((function(n){return e.name===n.name?{name:e.name,type:t}:n}))}))}(e,n?"dimension":"measure")}})}))))};var lt=[{key:"dropNull",text:"drop null records"},{key:"useMode",text:"replace null with mode"},{key:"simpleClean",text:"simple cleaning"}];function ft(e,t,n){var r=Object(i.useMemo)((function(){return t.filter((function(e){return"dimension"===e.type})).map((function(e){return e.name}))}),[t]),c=Object(i.useMemo)((function(){return t.filter((function(e){return"measure"===e.type})).map((function(e){return e.name}))}),[t]),u=Object(i.useMemo)((function(){return e.map((function(e){var n={};return t.forEach((function(t){n[t.name]="dimension"===t.type?e[t.name]:a.transNumber(e[t.name])})),n}))}),[e,t]),s=Object(i.useMemo)((function(){return function(e,t,n,r){switch(r){case"dropNull":return o.dropNull(e,t,n);case"useMode":return o.useMode(e,t.concat(n));case"simpleClean":default:return o.simpleClean(e,t,n)}}(function(e){return JSON.parse(JSON.stringify(e))}(u),r,c,n)}),[r,c,u,n]);return[u,s]}var mt=function(e){var t=T(),n=Object(l.a)(t,3),a=n[0],u=n[1],s=n[2],f=R({show:{insightBoard:!1,fieldConfig:!1,configPanel:!1,dataConfig:!1}}),m=Object(l.a)(f,2),v=m[0],g=m[1],y=Object(i.useState)("dropNull"),h=Object(l.a)(y,2),b=h[0],O=h[1],x=Object(i.useRef)(null),j=Object(i.useRef)(null),w=ft(a.rawData,a.fields,b),E=Object(l.a)(w,2),S=E[0],k=E[1];function N(){return(N=Object(p.a)(d.a.mark((function e(){var t,n,a;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===j.current||null===j.current.files){e.next=20;break}if(t=j.current.files[0],n=[],a=[],"text/csv"!==t.type&&"application/vnd.ms-excel"!==t.type){e.next=10;break}return e.next=7,r.csvLoader(t);case 7:a=e.sent,e.next=17;break;case 10:if("application/json"!==t.type){e.next=16;break}return e.next=13,r.jsonLoader(t);case 13:a=e.sent,e.next=17;break;case 16:throw new Error("unsupported file type=".concat(t.type," "));case 17:a=o.dropNullColumn(a,Object.keys(a[0])).dataSource,n=Object.keys(a[0]).map((function(e){return{name:e,type:a.every((function(t){return!isNaN(t[e])||void 0===t[e]}))?"measure":"dimension"}})),u((function(e){e.fields=n,e.rawData=a}));case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C=[{key:"upload",name:"Upload",iconProps:{iconName:"Upload"},onClick:function(){j.current&&j.current.click()}}];return c.a.createElement("div",{className:"content-container"},c.a.createElement(st,{fields:a.fields,show:v.show.fieldConfig,onUpdateConfig:function(e){u((function(t){t.fields=e}))},onClose:function(){g((function(e){e.show.fieldConfig=!1}))}}),c.a.createElement("div",{className:"card"},c.a.createElement(q.a,{horizontal:!0},c.a.createElement(U.a,{disabled:0===S.length,iconProps:{iconName:"Financial"},text:"Extract Insights",onClick:function(){s("extractInsights",{dataSource:k,fields:a.fields}),e.onExtractInsights()}}),c.a.createElement("div",{ref:x},c.a.createElement(V.a,{iconProps:{iconName:"ExcelDocument"},title:"Upload",ariaLabel:"upload data",onClick:function(){g((function(e){e.show.dataConfig=!0}))}}),c.a.createElement(it.a,{style:{maxWidth:300},className:"vi-callout-callout",role:"alertdialog",gapSpace:0,target:x.current,onDismiss:function(){g((function(e){e.show.dataConfig=!1}))},setInitialFocus:!0,hidden:!v.show.dataConfig},c.a.createElement("div",{className:"vi-callout-header"},c.a.createElement("p",{className:"vi-callout-title"},"Upload Your own dataset")),c.a.createElement("div",{className:"vi-callout-inner"},c.a.createElement("div",{className:"vi-callout-content"},c.a.createElement("p",{className:"vi-callout-subTex"},".csv, .json, .txt are supportted.")),c.a.createElement("div",{className:"vi-callout-actions"},c.a.createElement("input",{type:"file",ref:j,multiple:!0,accept:"*",style:{display:"none"},onChange:function(){return N.apply(this,arguments)}}),c.a.createElement(ct.a,{overflowButtonProps:{name:"More"},items:C}))))),c.a.createElement(V.a,{iconProps:{iconName:"Settings"},title:"Field Setting",ariaLabel:"field setting",onClick:function(){g((function(e){e.show.fieldConfig=!0}))}})),c.a.createElement("div",{style:{margin:"20px 0px"}},c.a.createElement(_.a,{styles:{root:{maxWidth:"180px"}},selectedKey:b,label:"Clean Method",allowFreeform:!0,autoComplete:"on",options:lt,onChange:function(e,t){t&&O(t.key)}})),c.a.createElement("p",{style:{fontSize:12,fontWeight:400,color:"#595959"}},"Remember to adjust the fields' types and cleaning strategy before extracting insights."),c.a.createElement("i",{style:{fontSize:12,fontWeight:300,color:"#595959"}},"Number of records ",k.length),c.a.createElement(ut,{fields:a.fields,dataSource:k})))},dt=[{title:"DataSource",itemKey:"pivot-1"},{title:"NoteBook",itemKey:"pivot-2"},{title:"Explore",itemKey:"pivot-3"}];function pt(){var e=T(),t=Object(l.a)(e,2),n=t[0],r=(t[1],R({show:{insightBoard:!1,fieldConfig:!1,configPanel:!1,dataConfig:!1},current:{pivotKey:dt[0].itemKey}})),a=Object(l.a)(r,2),o=a[0],i=a[1];return c.a.createElement("div",null,c.a.createElement("div",{className:"header-bar"},c.a.createElement("div",{className:"ms-Grid-row"},c.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md4 ms-lg1"},c.a.createElement("a",{href:"https://github.com/ObservedObserver/visual-insights",className:"logo"},c.a.createElement("img",{src:"https://chspace.oss-cn-hongkong.aliyuncs.com/logos/logo.png"}))),c.a.createElement("div",{className:"ms-Grid-col ms-sm6 ms-md8 ms-lg11"},c.a.createElement(L.a,{selectedKey:o.current.pivotKey,onLinkClick:function(e){e&&e.props.itemKey&&i((function(t){t.current.pivotKey=e.props.itemKey}))},headersOnly:!0},dt.map((function(e){return c.a.createElement(z.a,{key:e.itemKey,headerText:e.title,itemKey:e.itemKey})})))))),"pivot-3"===o.current.pivotKey&&c.a.createElement(Ie,{subspaceList:n.subspaceList,dataSource:n.cookedDataSource,summary:n.summary}),"pivot-1"===o.current.pivotKey&&c.a.createElement(mt,{onExtractInsights:function(){i((function(e){e.current.pivotKey="pivot-3",e.show.insightBoard=!0}))}}),"pivot-2"===o.current.pivotKey&&c.a.createElement("div",{className:"content-container"},c.a.createElement("div",{className:"card"},c.a.createElement(ot,{summary:n.summary,subspaceList:n.subspaceList,dataSource:n.cookedDataSource}))))}var vt=n(129);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));Object(vt.a)(),s.a.render(c.a.createElement((function(){return c.a.createElement(F,null,c.a.createElement(pt,null))}),null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[137,1,2]]]);
//# sourceMappingURL=main.2e2709d6.chunk.js.map