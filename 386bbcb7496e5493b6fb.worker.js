!function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r(r.s=6)}([function(t,e,r){"use strict";this&&this.__assign;Object.defineProperty(e,"__esModule",{value:!0});var n=r(2),a=r(5),o=r(1),i={sum:o.sum_unsafe,mean:o.mean,count:o.count};function u(t){var e=t.type,r=t.aggFunc,a=void 0===r?o.count:r,i=t.factTable,u=void 0===i?[]:i,l=t.dimensions,c=void 0===l?[]:l,f=t.measures,s=void 0===f?[]:f;switch(e){case"period":return new n.periodCube({aggFunc:a,factTable:u,dimensions:c,measures:s});case"moment":default:return new n.momentCube({aggFunc:a,factTable:u,dimensions:c,measures:s})}}e.createCube=u,e.default=function(t){var e=t.dimensions,r=t.measures,n=t.asFields,l=t.operator,c=t.dataSource,f=u({type:"moment",aggFunc:i[l]||o.count,dimensions:e,measures:r,factTable:c}),s=a.tree2Table({dimensions:e,measures:r,cube:f});return s.forEach((function(t){n.forEach((function(e,n){t[e]=t[r[n]]}))})),s},function(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}(r(1))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sum_unsafe=function(t,e){var r={};e.forEach((function(t){r[t]=0}));for(var n=function(n,a){e.forEach((function(e){r[e]+=t[n][e]}))},a=0,o=t.length;a<o;a++)n(a);return r},e.sum=function(t,e){var r={};e.forEach((function(t){r[t]=0}));for(var n=function(n,a){e.forEach((function(e){r[e]+=Number(t[n][e])||0}))},a=0,o=t.length;a<o;a++)n(a);return r},e.count=function(t,e){var r={};e.forEach((function(t){r[t]=0}));for(var n=0,a=t.length;n<a;n++)e.forEach((function(t){r[t]++}));return r},e.mean=function(t,e){var r={};e.forEach((function(t){r[t]=0}));for(var n=function(n,a){e.forEach((function(e){r[e]+=Number(t[n][e])||0}))},a=0,o=t.length;a<o;a++)n(a);return e.forEach((function(e){r[e]/=t.length})),r}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(3);e.periodCube=n.default;var a=r(4);e.momentCube=a.default},function(t,e,r){"use strict";var n=this&&this.__read||function(t,e){var r="function"===typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,a,o=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(u){a={error:u}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(a)throw a.error}}return i},a=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(n(arguments[e]));return t},o=this&&this.__values||function(t){var e="function"===typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"===typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.children=new Map,this._rawData=[],this.aggFunc=t,this.cache=!1}return t.prototype.push=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];(t=this._rawData).push.apply(t,a(e))},t.prototype.aggData=function(t){return void 0===t&&(t=[]),this.cache||(this._aggData=this.aggFunc(this.rawData,t),this.cache=!0),this._aggData},t.prototype.clearCache=function(){this.cache=!1},Object.defineProperty(t.prototype,"rawData",{get:function(){var t,e;if(!this.cache){if(0!==this.children.size){var r=this.children.values(),n=[];try{for(var a=o(r),i=a.next();!i.done;i=a.next()){var u=i.value,l=void 0,c=u.rawData,f=c.length;for(l=0;l<f;l++)n.push(c[l])}}catch(s){t={error:s}}finally{try{i&&!i.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}this._rawData=n}this.cache=!0}return this._rawData},enumerable:!0,configurable:!0}),t.prototype.getNode=function(t){return function e(r,a){var i,u;if(a===t.length)return r;var l=r.children.entries();try{for(var c=o(l),f=c.next();!f.done;f=c.next()){var s=n(f.value,2),h=s[0],d=s[1];if(h===t[a])return e(d,a+1)}}catch(y){i={error:y}}finally{try{f&&!f.done&&(u=c.return)&&u.call(c)}finally{if(i)throw i.error}}return null}(this,0)},t}(),u=function(){function t(t){this.aggFunc=t.aggFunc,this.factTable=t.factTable,this.dimensions=t.dimensions,this.measures=t.measures}return t.prototype.get=function(t){var e=this.tree,r=(this.aggFunc,this.measures);return function e(a,i){var u,l;if(i===t.length)return a.aggData(r);var c=a.children.entries();try{for(var f=o(c),s=f.next();!s.done;s=f.next()){var h=n(s.value,2),d=h[0],y=h[1];if(d===t[i])return e(y,i+1)}}catch(v){u={error:v}}finally{try{s&&!s.done&&(l=f.return)&&l.call(f)}finally{if(u)throw u.error}}return!1}(e,0)},t.prototype.getNode=function(t){return this.tree.getNode(t)},t.prototype.buildTree=function(){var t,e=new i(this.aggFunc),r=this.factTable.length;for(t=0;t<r;t++)this.insertNode(this.factTable[t],e,0);return this.tree=e,e},t.prototype.insertNode=function(t,e,r){if(e.push(t),e.cache=!1,r<this.dimensions.length){var n=t[this.dimensions[r]];e.children.has(n)||e.children.set(n,new i(this.aggFunc)),this.insertNode(t,e.children.get(n),r+1)}},t.prototype.aggTree=function(t){var e,r;void 0===t&&(t=this.tree);var n=t.children.values();try{for(var a=o(n),i=a.next();!i.done;i=a.next()){var u=i.value;this.aggTree(u)}}catch(l){e={error:l}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return t.aggData(this.measures),t},t.prototype.aggNode=function(t){var e,r;void 0===t&&(t=this.tree);var n=t.children.values();try{for(var a=o(n),i=a.next();!i.done;i=a.next()){var u=i.value;this.aggTree(u)}}catch(l){e={error:l}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return t.aggData(this.measures),t},t}();e.default=u},function(t,e,r){"use strict";var n=this&&this.__read||function(t,e){var r="function"===typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,a,o=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(u){a={error:u}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(a)throw a.error}}return i},a=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(n(arguments[e]));return t},o=this&&this.__values||function(t){var e="function"===typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"===typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.children=new Map,this.rawData=[]}return t.prototype.push=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];(t=this.rawData).push.apply(t,a(e))},t.prototype.aggData=function(t,e){return void 0===e&&(e=[]),this._aggData=t(this.rawData,e),this._aggData},t.prototype.getNode=function(t){return function e(r,a){var i,u;if(a===t.length)return r;var l=r.children.entries();try{for(var c=o(l),f=c.next();!f.done;f=c.next()){var s=n(f.value,2),h=s[0],d=s[1];if(h===t[a])return e(d,a+1)}}catch(y){i={error:y}}finally{try{f&&!f.done&&(u=c.return)&&u.call(c)}finally{if(i)throw i.error}}return null}(this,0)},t}();e.Node=i;var u=function(){function t(t){this.aggFunc=t.aggFunc,this.factTable=t.factTable,this.dimensions=t.dimensions,this.measures=t.measures,this.buildTree(),this.aggTree()}return t.prototype.get=function(t){var e=this.tree,r=this.aggFunc,a=this.measures;return function e(i,u){var l,c;if(u===t.length)return i.aggData(r,a);var f=i.children.entries();try{for(var s=o(f),h=s.next();!h.done;h=s.next()){var d=n(h.value,2),y=d[0],v=d[1];if(y===t[u])return e(v,u+1)}}catch(g){l={error:g}}finally{try{h&&!h.done&&(c=s.return)&&c.call(s)}finally{if(l)throw l.error}}return!1}(e,0)},t.prototype.getNode=function(t){return this.tree.getNode(t)},t.prototype.setData=function(t){var e=t.aggFunc,r=void 0===e?this.aggFunc:e,n=t.factTable,a=void 0===n?this.factTable:n,o=t.dimensions,i=void 0===o?this.dimensions:o,u=t.measures,l=void 0===u?this.measures:u;i!==this.dimensions||a!==this.factTable?(this.dimensions=i,this.factTable=a,this.measures=l,this.aggFunc=r,this.buildTree(),this.aggTree()):l===this.measures&&r===this.aggFunc||(this.measures=l,this.aggFunc=r,this.aggTree())},t.prototype.buildTree=function(){var t,e=new i,r=this.factTable.length;for(t=0;t<r;t++)this.insertNode(this.factTable[t],e,0);return this.tree=e,e},t.prototype.insertNode=function(t,e,r){if(r===this.dimensions.length)e.push(t);else{var n=t[this.dimensions[r]];e.children.has(n)||e.children.set(n,new i),this.insertNode(t,e.children.get(n),r+1)}},t.prototype.aggTree=function(t){var e,r;if(void 0===t&&(t=this.tree),t.children.size>0){t.rawData=[];var n=t.children.values();try{for(var a=o(n),i=a.next();!i.done;i=a.next()){var u=i.value,l=void 0,c=this.aggTree(u).rawData,f=c.length;for(l=0;l<f;l++)t.rawData.push(c[l])}}catch(s){e={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}}return t.aggData(this.aggFunc,this.measures),t},t}();e.default=u},function(t,e,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},a=this&&this.__values||function(t){var e="function"===typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"===typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(t,e){var r="function"===typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,a,o=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(u){a={error:u}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(a)throw a.error}}return i};Object.defineProperty(e,"__esModule",{value:!0}),e.tree2Table=function(t){var e=t.dimensions,r=(t.measures,t.cube),i=(r.aggFunc,[]);return function t(r,u,l){var c,f,s;if(0!==r.children.size)try{for(var h=a(r.children.entries()),d=h.next();!d.done;d=h.next()){var y=o(d.value,2),v=y[0];t(y[1],n(n({},u),((s={})[e[l]]=v,s)),l+1)}}catch(p){c={error:p}}finally{try{d&&!d.done&&(f=h.return)&&f.call(h)}finally{if(c)throw c.error}}else{var g=r._aggData;i.push(n(n({},u),g))}}(r.tree,{},0),i}},function(t,e,r){"use strict";r.r(e);var n={};function a(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function o(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function i(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function u(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?i(r,!0).forEach((function(e){a(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):i(r).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}r.r(n),r.d(n,"getFieldType",(function(){return w})),r.d(n,"getAllFieldTypes",(function(){return _})),r.d(n,"getFieldDistribution",(function(){return S})),r.d(n,"getAllFieldsDistribution",(function(){return x})),r.d(n,"getFieldEntropy",(function(){return O})),r.d(n,"getAllFieldsEntropy",(function(){return T})),r.d(n,"groupFields",(function(){return F}));var l=5;function c(t){return JSON.parse(JSON.stringify(t))}function f(t,e){return t.every((function(t){return"string"===typeof t[e]||"undefined"===typeof t[e]||null===t[e]}))}function s(t,e){return t.every((function(t){return"number"===typeof t[e]||"undefined"===typeof t[e]||null===t[e]}))}function h(t,e){return t.every((function(t){return!isNaN(Date.parse(t[e]))&&"string"===typeof t[e]&&/^[0-9]{0,4}[-/][0-9]{0,2}([-/][0-9]{0,2}$)?/.test(t[e])||"undefined"===typeof t[e]||null===t[e]}))}function d(t,e){var r=new Map,n=!0,a=!1,i=void 0;try{for(var u,l=t[Symbol.iterator]();!(n=(u=l.next()).done);n=!0){var c=u.value[e];r.has(c)||r.set(c,0),r.set(c,r.get(c)+1)}}catch(f){a=!0,i=f}finally{try{n||null==l.return||l.return()}finally{if(a)throw i}}return o(r.entries())}function y(t){for(var e=t.dataSource,r=t.field,n=t.newField,a=void 0===n?"".concat(r,"(con-group)"):n,i=t.groupNumber,u=e.map((function(t){return t[r]})),l=Math.max.apply(Math,o(u)),c=Math.min.apply(Math,o(u)),f=(l-c)/i,s=[],h=0;h<i;h++){var d=c+h*f,y=c+(h+1)*f;s.push([d,y])}s[0][0]=-1/0,s[s.length-1][1]=1/0;for(var v=Math.max(1,Math.log10(Math.abs(c))-Math.log10(f))+1,g=function(t){var n=e[t],o=s.findIndex((function(t){return t[0]<=n[r]&&n[r]<t[1]})),i=s[o];n[a]="undefined"!==typeof i?"".concat(o+1,":[").concat(Number(i[0].toPrecision(v)),", ").concat(Number(i[1].toPrecision(v)),")"):"null"},p=0;p<e.length;p++)g(p);return e}function v(t){var e=t.dataSource,r=t.field,n=t.newField,o=void 0===n?"".concat(r,"(cat-group)"):n,i=t.groupNumber,c=d(e,r);c.sort((function(t,e){return e[1]-t[1]}));var f=c.map((function(t){return t[1]}));i=c.length;for(var s=f.length-2;s>=0;s--)f[s]=f[s+1]+f[s];for(var h=0;h<c.length-2;h++)if(c[h][1]*l>=f[h+1]&&c[h+1][1]/l<f[h+2]){i=h+2;break}if(i===c.length)return e.map((function(t){return u({},t,a({},o,t[r]))}));for(var y=new Set,v=i-1;v<c.length;v++)y.add(c[v][0]);var g=!0,p=!1,m=void 0;try{for(var b,w=e[Symbol.iterator]();!(g=(b=w.next()).done);g=!0){var _=b.value;y.has(_[r])?_[o]="others":_[o]=_[r]}}catch(S){p=!0,m=S}finally{try{g||null==w.return||w.return()}finally{if(p)throw m}}return e}function g(t,e){return d(t,e).every((function(t){return 1===t[1]}))}function p(t){var e=0,r=!0,n=!1,a=void 0;try{for(var o,i=t[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var u=o.value;e+=u}}catch(l){n=!0,a=l}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}return t.map((function(t){return t/e}))}var m=function(t){var e=0,r=!0,n=!1,a=void 0;try{for(var o,i=t[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var u=o.value;e+=u*Math.log2(u)}}catch(l){n=!0,a=l}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}return-e};r(0);var b=25;function w(t,e){return h(t,e)?"temporal":s(t,e)?"quantitative":(f(t,e),"nominal")}function _(t,e){var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var l=i.value;r.push({name:l,type:w(t,l)})}}catch(c){a=!0,o=c}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}function S(t,e){return d(t,e).map((function(t){return{memberName:t[0],count:t[1]}}))}function x(t,e){var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var l=i.value;r.push({fieldName:l,distribution:S(t,l)})}}catch(c){a=!0,o=c}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}function O(t,e){var r=d(t,e),n=p(r.map((function(t){return t[1]})));return{fieldName:e,entropy:m(n),maxEntropy:Math.log2(r.length)}}function T(t,e){var r=[],n=!0,a=!1,o=void 0;try{for(var i,u=e[Symbol.iterator]();!(n=(i=u.next()).done);n=!0){var l=i.value;r.push(O(t,l))}}catch(c){a=!0,o=c}finally{try{n||null==u.return||u.return()}finally{if(a)throw o}}return r}function F(t,e){var r=c(t),n=[],a=!0,o=!1,i=void 0;try{for(var u,l=e[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var f=u.value,s="".concat(f.name,"(group)");"quantitative"===f.type&&d(t,f.name).length>2*b?g(t,f.name)||(r=y({dataSource:r,field:f.name,newField:s,groupNumber:8}),n.push({name:s,type:"ordinal"})):("ordinal"===f.type||"nominal"===f.type)&&d(t,f.name).length>b&&(g(t,f.name)||(r=v({dataSource:r,field:f.name,newField:s,groupNumber:8}),n.push({name:s,type:f.type})))}}catch(h){o=!0,i=h}finally{try{a||null==l.return||l.return()}finally{if(o)throw i}}return{groupedData:r,fields:e,newFields:n}}self.addEventListener("message",t=>{console.log("group fields worker");try{const{dataSource:e,fields:r}=t.data,a=n.groupFields(e,r);self.postMessage({success:!0,data:a})}catch(e){self.postMessage({success:!1,message:e.toString()})}},!1)}]);
//# sourceMappingURL=386bbcb7496e5493b6fb.worker.js.map