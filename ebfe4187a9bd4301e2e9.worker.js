!function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="/",r(r.s=6)}([function(t,e,r){"use strict";this&&this.__assign;Object.defineProperty(e,"__esModule",{value:!0});var n=r(2),a=r(5),o=r(1),i={sum:o.sum_unsafe,mean:o.mean,count:o.count};function u(t){var e=t.type,r=t.aggFunc,a=void 0===r?o.count:r,i=t.factTable,u=void 0===i?[]:i,s=t.dimensions,c=void 0===s?[]:s,l=t.measures,f=void 0===l?[]:l;switch(e){case"period":return new n.periodCube({aggFunc:a,factTable:u,dimensions:c,measures:f});case"moment":default:return new n.momentCube({aggFunc:a,factTable:u,dimensions:c,measures:f})}}e.createCube=u,e.default=function(t){var e=t.dimensions,r=t.measures,n=t.asFields,s=t.operator,c=t.dataSource,l=u({type:"moment",aggFunc:i[s]||o.count,dimensions:e,measures:r,factTable:c}),f=a.tree2Table({dimensions:e,measures:r,cube:l});return f.forEach((function(t){n.forEach((function(e,n){t[e]=t[r[n]]}))})),f},function(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}(r(1))},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.sum_unsafe=function(t,e){var r={};e.forEach((function(t){r[t]=0}));for(var n=function(n,a){e.forEach((function(e){r[e]+=t[n][e]}))},a=0,o=t.length;a<o;a++)n(a);return r},e.sum=function(t,e){var r={};e.forEach((function(t){r[t]=0}));for(var n=function(n,a){e.forEach((function(e){r[e]+=Number(t[n][e])||0}))},a=0,o=t.length;a<o;a++)n(a);return r},e.count=function(t,e){var r={};e.forEach((function(t){r[t]=0}));for(var n=0,a=t.length;n<a;n++)e.forEach((function(t){r[t]++}));return r},e.mean=function(t,e){var r={};e.forEach((function(t){r[t]=0}));for(var n=function(n,a){e.forEach((function(e){r[e]+=Number(t[n][e])||0}))},a=0,o=t.length;a<o;a++)n(a);return e.forEach((function(e){r[e]/=t.length})),r}},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(3);e.periodCube=n.default;var a=r(4);e.momentCube=a.default},function(t,e,r){"use strict";var n=this&&this.__read||function(t,e){var r="function"===typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,a,o=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(u){a={error:u}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(a)throw a.error}}return i},a=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(n(arguments[e]));return t},o=this&&this.__values||function(t){var e="function"===typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"===typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t){this.children=new Map,this._rawData=[],this.aggFunc=t,this.cache=!1}return t.prototype.push=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];(t=this._rawData).push.apply(t,a(e))},t.prototype.aggData=function(t){return void 0===t&&(t=[]),this.cache||(this._aggData=this.aggFunc(this.rawData,t),this.cache=!0),this._aggData},t.prototype.clearCache=function(){this.cache=!1},Object.defineProperty(t.prototype,"rawData",{get:function(){var t,e;if(!this.cache){if(0!==this.children.size){var r=this.children.values(),n=[];try{for(var a=o(r),i=a.next();!i.done;i=a.next()){var u=i.value,s=void 0,c=u.rawData,l=c.length;for(s=0;s<l;s++)n.push(c[s])}}catch(f){t={error:f}}finally{try{i&&!i.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}this._rawData=n}this.cache=!0}return this._rawData},enumerable:!0,configurable:!0}),t.prototype.getNode=function(t){return function e(r,a){var i,u;if(a===t.length)return r;var s=r.children.entries();try{for(var c=o(s),l=c.next();!l.done;l=c.next()){var f=n(l.value,2),h=f[0],d=f[1];if(h===t[a])return e(d,a+1)}}catch(v){i={error:v}}finally{try{l&&!l.done&&(u=c.return)&&u.call(c)}finally{if(i)throw i.error}}return null}(this,0)},t}(),u=function(){function t(t){this.aggFunc=t.aggFunc,this.factTable=t.factTable,this.dimensions=t.dimensions,this.measures=t.measures}return t.prototype.get=function(t){var e=this.tree,r=(this.aggFunc,this.measures);return function e(a,i){var u,s;if(i===t.length)return a.aggData(r);var c=a.children.entries();try{for(var l=o(c),f=l.next();!f.done;f=l.next()){var h=n(f.value,2),d=h[0],v=h[1];if(d===t[i])return e(v,i+1)}}catch(g){u={error:g}}finally{try{f&&!f.done&&(s=l.return)&&s.call(l)}finally{if(u)throw u.error}}return!1}(e,0)},t.prototype.getNode=function(t){return this.tree.getNode(t)},t.prototype.buildTree=function(){var t,e=new i(this.aggFunc),r=this.factTable.length;for(t=0;t<r;t++)this.insertNode(this.factTable[t],e,0);return this.tree=e,e},t.prototype.insertNode=function(t,e,r){if(e.push(t),e.cache=!1,r<this.dimensions.length){var n=t[this.dimensions[r]];e.children.has(n)||e.children.set(n,new i(this.aggFunc)),this.insertNode(t,e.children.get(n),r+1)}},t.prototype.aggTree=function(t){var e,r;void 0===t&&(t=this.tree);var n=t.children.values();try{for(var a=o(n),i=a.next();!i.done;i=a.next()){var u=i.value;this.aggTree(u)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return t.aggData(this.measures),t},t.prototype.aggNode=function(t){var e,r;void 0===t&&(t=this.tree);var n=t.children.values();try{for(var a=o(n),i=a.next();!i.done;i=a.next()){var u=i.value;this.aggTree(u)}}catch(s){e={error:s}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}return t.aggData(this.measures),t},t}();e.default=u},function(t,e,r){"use strict";var n=this&&this.__read||function(t,e){var r="function"===typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,a,o=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(u){a={error:u}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(a)throw a.error}}return i},a=this&&this.__spread||function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(n(arguments[e]));return t},o=this&&this.__values||function(t){var e="function"===typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"===typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.children=new Map,this.rawData=[]}return t.prototype.push=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];(t=this.rawData).push.apply(t,a(e))},t.prototype.aggData=function(t,e){return void 0===e&&(e=[]),this._aggData=t(this.rawData,e),this._aggData},t.prototype.getNode=function(t){return function e(r,a){var i,u;if(a===t.length)return r;var s=r.children.entries();try{for(var c=o(s),l=c.next();!l.done;l=c.next()){var f=n(l.value,2),h=f[0],d=f[1];if(h===t[a])return e(d,a+1)}}catch(v){i={error:v}}finally{try{l&&!l.done&&(u=c.return)&&u.call(c)}finally{if(i)throw i.error}}return null}(this,0)},t}();e.Node=i;var u=function(){function t(t){this.aggFunc=t.aggFunc,this.factTable=t.factTable,this.dimensions=t.dimensions,this.measures=t.measures,this.buildTree(),this.aggTree()}return t.prototype.get=function(t){var e=this.tree,r=this.aggFunc,a=this.measures;return function e(i,u){var s,c;if(u===t.length)return i.aggData(r,a);var l=i.children.entries();try{for(var f=o(l),h=f.next();!h.done;h=f.next()){var d=n(h.value,2),v=d[0],g=d[1];if(v===t[u])return e(g,u+1)}}catch(y){s={error:y}}finally{try{h&&!h.done&&(c=f.return)&&c.call(f)}finally{if(s)throw s.error}}return!1}(e,0)},t.prototype.getNode=function(t){return this.tree.getNode(t)},t.prototype.setData=function(t){var e=t.aggFunc,r=void 0===e?this.aggFunc:e,n=t.factTable,a=void 0===n?this.factTable:n,o=t.dimensions,i=void 0===o?this.dimensions:o,u=t.measures,s=void 0===u?this.measures:u;i!==this.dimensions||a!==this.factTable?(this.dimensions=i,this.factTable=a,this.measures=s,this.aggFunc=r,this.buildTree(),this.aggTree()):s===this.measures&&r===this.aggFunc||(this.measures=s,this.aggFunc=r,this.aggTree())},t.prototype.buildTree=function(){var t,e=new i,r=this.factTable.length;for(t=0;t<r;t++)this.insertNode(this.factTable[t],e,0);return this.tree=e,e},t.prototype.insertNode=function(t,e,r){if(r===this.dimensions.length)e.push(t);else{var n=t[this.dimensions[r]];e.children.has(n)||e.children.set(n,new i),this.insertNode(t,e.children.get(n),r+1)}},t.prototype.aggTree=function(t){var e,r;if(void 0===t&&(t=this.tree),t.children.size>0){t.rawData=[];var n=t.children.values();try{for(var a=o(n),i=a.next();!i.done;i=a.next()){var u=i.value,s=void 0,c=this.aggTree(u).rawData,l=c.length;for(s=0;s<l;s++)t.rawData.push(c[s])}}catch(f){e={error:f}}finally{try{i&&!i.done&&(r=a.return)&&r.call(a)}finally{if(e)throw e.error}}}return t.aggData(this.aggFunc,this.measures),t},t}();e.default=u},function(t,e,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)},a=this&&this.__values||function(t){var e="function"===typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"===typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(t,e){var r="function"===typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,a,o=r.call(t),i=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)i.push(n.value)}catch(u){a={error:u}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(a)throw a.error}}return i};Object.defineProperty(e,"__esModule",{value:!0}),e.tree2Table=function(t){var e=t.dimensions,r=(t.measures,t.cube),i=(r.aggFunc,[]);return function t(r,u,s){var c,l,f;if(0!==r.children.size)try{for(var h=a(r.children.entries()),d=h.next();!d.done;d=h.next()){var v=o(d.value,2),g=v[0];t(v[1],n(n({},u),((f={})[e[s]]=g,f)),s+1)}}catch(p){c={error:p}}finally{try{d&&!d.done&&(l=h.return)&&l.call(h)}finally{if(c)throw c.error}}else{var y=r._aggData;i.push(n(n({},u),y))}}(r.tree,{},0),i}},function(t,e,r){"use strict";function n(t){return function(t){if(Array.isArray(t)){for(var e=0,r=new Array(t.length);e<t.length;e++)r[e]=t[e];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}r.r(e);function a(t){var e=0,r=!0,n=!1,a=void 0;try{for(var o,i=t[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var u=o.value;e+=u}}catch(s){n=!0,a=s}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}return t.map((function(t){return t/e}))}var o=function(t){var e=0,r=!0,n=!1,a=void 0;try{for(var o,i=t[Symbol.iterator]();!(r=(o=i.next()).done);r=!0){var u=o.value;e+=u*Math.log2(u)}}catch(s){n=!0,a=s}finally{try{r||null==i.return||i.return()}finally{if(n)throw a}}return-e};var i=r(0),u=r.n(i),s=8;function c(t){var e=Math.min.apply(Math,n(t));return t.map((function(t){return t-e+1}))}function l(t){for(var e=0,r=0,n=t.length;r<n;r++)e+=t[r];return e}function f(t,e,r){var n=l(t.map((function(t){return t[e]})))/t.length,a=l(t.map((function(t){return t[r]})))/t.length;return l(t.map((function(t){return(t[e]-n)*(t[r]-a)})))/Math.sqrt(l(t.map((function(t){return Math.pow(t[e]-n,2)})))*l(t.map((function(t){return Math.pow(t[r]-a,2)}))))}function h(t,e,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"sum",l=[],h=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:t.length,a=[],o=function e(r,o,i){o.length!==i?r>=t.length||(e(r+1,[].concat(n(o),[t[r]]),i),e(r+1,o,i)):a.push(n(o))},i=e;i<=Math.min(r,s);i++)o(0,[],i);return a}(e),d=!0,v=!1,g=void 0;try{for(var y,p=h[Symbol.iterator]();!(d=(y=p.next()).done);d=!0){var m=y.value,b={},w=u()({dataSource:t,dimensions:m,measures:r,asFields:r,operator:i||"sum"}),_=!0,T=!1,x=void 0;try{for(var S,D=function(){var t=S.value,e=a(c(w.map((function(e){return e[t]})))),r=o(e);b[t]=r},F=r[Symbol.iterator]();!(_=(S=F.next()).done);_=!0)D()}catch(N){T=!0,x=N}finally{try{_||null==F.return||F.return()}finally{if(T)throw x}}for(var M=r.map((function(t){return r.map((function(t){return 0}))})),O=0;O<r.length;O++){M[O][O]=1;for(var j=O+1;j<r.length;j++){var E=f(w,r[O],r[j]);M[j][O]=M[O][j]=E}}l.push([m,b,M])}}catch(N){v=!0,g=N}finally{try{d||null==p.return||p.return()}finally{if(v)throw g}}return l}self.addEventListener("message",t=>{console.log("[combine fields]");try{const{dataSource:e,dimensions:r,measures:n,operator:a,topKPercent:o=1}=t.data;let i=h(e,r,n,a).map(t=>{let e=0;for(let r in t[1])e+=t[1][r];return{...t,score:e}});i.sort((t,e)=>t.score-e.score);let u=Math.round(o*i.length);self.postMessage({success:!0,data:i.slice(0,u).map(t=>({score:t.score,dimensions:t[0],measures:n.map(e=>({name:e,value:t[1][e]})),correlationMatrix:t[2]}))})}catch(e){self.postMessage({success:!1,message:e.toString()})}},!1)}]);
//# sourceMappingURL=ebfe4187a9bd4301e2e9.worker.js.map