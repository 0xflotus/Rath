!function(r){var n={};function t(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return r[e].call(i.exports,i,i.exports,t),i.l=!0,i.exports}t.m=r,t.c=n,t.d=function(r,n,e){t.o(r,n)||Object.defineProperty(r,n,{enumerable:!0,get:e})},t.r=function(r){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},t.t=function(r,n){if(1&n&&(r=t(r)),8&n)return r;if(4&n&&"object"===typeof r&&r&&r.__esModule)return r;var e=Object.create(null);if(t.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:r}),2&n&&"string"!=typeof r)for(var i in r)t.d(e,i,function(n){return r[n]}.bind(null,i));return e},t.n=function(r){var n=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(n,"a",n),n},t.o=function(r,n){return Object.prototype.hasOwnProperty.call(r,n)},t.p="./",t(t.s=0)}([function(r,n,t){"use strict";function e(r,n){for(var t=0;t<n.length;t++){var e=n[t];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(r,e.key,e)}}function i(r,n){(null==n||n>r.length)&&(n=r.length);for(var t=0,e=new Array(n);t<n;t++)e[t]=r[t];return e}function f(r,n){if(r){if("string"===typeof r)return i(r,n);var t=Object.prototype.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?i(r,n):void 0}}function a(r,n){var t;if("undefined"===typeof Symbol||null==r[Symbol.iterator]){if(Array.isArray(r)||(t=f(r))||n&&r&&"number"===typeof r.length){t&&(r=t);var e=0,i=function(){};return{s:i,n:function(){return e>=r.length?{done:!0}:{done:!1,value:r[e++]}},e:function(r){throw r},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){t=r[Symbol.iterator]()},n:function(){var r=t.next();return o=r.done,r},e:function(r){u=!0,a=r},f:function(){try{o||null==t.return||t.return()}finally{if(u)throw a}}}}function o(r,n){return function(r){if(Array.isArray(r))return r}(r)||function(r,n){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(r)){var t=[],e=!0,i=!1,f=void 0;try{for(var a,o=r[Symbol.iterator]();!(e=(a=o.next()).done)&&(t.push(a.value),!n||t.length!==n);e=!0);}catch(u){i=!0,f=u}finally{try{e||null==o.return||o.return()}finally{if(i)throw f}}return t}}(r,n)||f(r,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function u(r){return function(r){if(Array.isArray(r))return i(r)}(r)||function(r){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(r))return Array.from(r)}(r)||f(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(r){for(var n=1/0,t=-1/0,e=0;e<r.length;e++)r[e]>t&&(t=r[e]),r[e]<n&&(n=r[e]);return[n,t]}function c(r){var n=0,t=0;for(t=0;t<r.length;t++)n+=r[t]*Math.log2(r[t]);return-n}function s(r,n){for(var t=0,e=0;e<r.length;e++)for(var i=0;i<r[e].length;i++)t+=Math.pow(r[e][i]-n[e][i],2);return t/2}t.r(n);var h=16;function d(r,n,t){var e=(t-n)/h;if(0==e)return new Array(h).fill(r.length/h);for(var i=new Array(17).fill(0),f=0;f<r.length;f++){i[Math.floor((r[f]-n)/e)%17]++}return i[15]+=i[16],i.slice(0,h)}function v(r,n,t){var e=(t-n)/h;if(0==e)return r.map((function(n){return Math.round(Math.random()*(r.length-1))}));for(var i=[],f=0;f<r.length;f++){var a=Math.floor((r[f]-n)/e);a===h&&(a=15),i.push(a)}return i}function p(r){for(var n=0,t=[],e=0;e<r.length;e++)n+=r[e];for(var i=0;i<r.length;i++)t.push(r[i]/n);return t}function y(r,n){for(var t=0,e=o(l(n),2),i=e[0],f=e[1],a=c(p(d(n,i,f).filter((function(r){return 0<r})))),u=function(e){v=n.filter((function(n,t){return r[t]===e})),y=c(p(d(v,i,f).filter((function(r){return 0<r})))),v=v.length/n.length,t+=v*y},s=0;s<h;s++){var v,y;u(s)}return(a-t)/Math.log2(h)}function m(r,n){for(var t=0,e=o(l(n),2),i=e[0],f=e[1],a=c(p(d(n,i,f).filter((function(r){return 0<r})))),s=u(new Set(r)),v=[],y=function(t){g=n.filter((function(n,e){return r[e]===s[t]})),b=d(g,i,f),v.push({freq:g.length,bins:b})},m=0;m<s.length;m++){var g,b;y(m)}v.sort((function(r,n){return n.freq-r.freq}));for(var w={freq:0,bins:new Array(h).fill(0)},S=0;S<v.length;S++){var M=v[S],A=M.bins,T=M.freq;if(S<15){var q=c(p(A.filter((function(r){return 0<r}))));t+=T/n.length*q}else{w.freq+=T;for(var j=0;j<h;j++)w.bins[j]+=A[j]}}if(0<w.freq){var O=w.bins,P=w.freq,k=c(p(O.filter((function(r){return 0<r}))));t+=P/n.length*k}return(a-t)/Math.log2(Math.min(h,s.length))}function g(r){for(var n=-1/0,t=-1/0,e=1/0,i=1/0,f=0;f<r.length;f++)n=Math.max(r[f][0],n),t=Math.max(r[f][1],t),e=Math.min(r[f][0],e),i=Math.min(r[f][1],i);for(var a=(n-e)/h,o=(t-i)/h,u=new Array(17).fill(0).map((function(){return new Array(17).fill(0)})),l=0;l<r.length;l++){var c=Math.floor((r[l][0]-e)/a),s=Math.floor((r[l][1]-i)/o);u[c][s]++}for(var d=0;d<=h;d++)u[d][15]+=u[d][16],u[15][d]+=u[16][d];for(var v=new Array(h).fill(0).map((function(){return new Array(h).fill(0)})),p=0;p<h;p++)for(var y=0;y<h;y++)v[p][y]=u[p][y]/r.length;return v}function b(r,n){for(var t=new Array(9).fill(0).map((function(){return new Array(9).fill(0)})),e=(n[0][1]-n[0][0])/8,i=(n[1][1]-n[1][0])/8,f=0;f<r.length;f++){var a=Math.floor((r[f][0]-n[0][0])/e);t[Math.floor((r[f][1]-n[1][0])/i)][a]++}for(var o=0;o<9;o++)t[o][7]+=t[o][8];for(var u=0;u<8;u++)t[7][u]+=t[8][u];return t.slice(0,8).map((function(r){return r.slice(0,8)}))}function w(r,n){for(var t=0,e=function(r,n){for(var t=[],e=function(n){t.push(l(r.map((function(r){return r[n]}))))},i=0;i<n;i++)e(i);return t}(n,2),i=c(p(b(n,e).flatMap((function(r){return r})).filter((function(r){return 0<r})))),f=u(new Set(r)),a=[],o=function(t){h=n.filter((function(n,e){return r[e]===f[t]})),d=b(h,e).flatMap((function(r){return r})),a.push({freq:h.length,bins:d})},s=0;s<f.length;s++){var h,d;o(s)}a.sort((function(r,n){return n.freq-r.freq}));for(var v={freq:0,bins:new Array(64).fill(0)},y=0;y<a.length;y++){var m=a[y],g=m.bins,w=m.freq;if(y<15){var S=c(p(g.filter((function(r){return 0<r}))));t+=w/n.length*S}else{v.freq+=w;for(var M=0;M<64;M++)v.bins[M]+=g[M]}}if(0<v.freq){var A=v.bins,T=v.freq,q=c(p(A.filter((function(r){return 0<r}))));t+=T/n.length*q}return(i-t)/Math.log2(f.length)}function S(r,n){return n&&0!==n.length?r.filter((function(r){return n.every((function(n){return n.values.includes(r[n.field.fid])}))})):r}var M=function(){function r(n,t){!function(r,n){if(!(r instanceof n))throw new TypeError("Cannot call a class as a function")}(this,r),this.BIN_SIZE=16,this.dataSource=[],this.fields=[],this.patterns=[],this.dataSource=n,this.fields=t}var n,t,i;return n=r,(t=[{key:"init",value:function(r,n){this.dataSource=r,this.fields=n,this.patterns=[]}},{key:"recommandFilter",value:function(r){var n,t,e,i,f,o,c=this,s=r.fields.filter((function(r){return"dimension"===r.analyticType})),h=r.fields.filter((function(r){return"measure"===r.analyticType})),y=u(s),g=[];return 0<(y=void 0!==r.filters?s.filter((function(n){return!r.filters.find((function(r){return r.field.fid===n.fid}))})):u(s)).length&&function(){var s,b="",w=[],S=0,M=a(y);try{var A=function(){var r=s.value,n=c.dataSource.map((function(n){return n[r.fid]})),t=0;h.forEach((function(r){var e=c.dataSource.map((function(n){return n[r.fid]}));e=m(n,e),t+=e})),(t/=h.length)>S&&(S=t,b=r.fid,w=n)};for(M.s();!(s=M.n()).done;)A()}catch(O){M.e(O)}finally{M.f()}if(""!==b){var T,q=a(new Set(w).values());try{var j=function(){var s,y=T.value,m=[],w=[],S=[],M=a(r.fields);try{for(M.s();!(s=M.n()).done;)((n=s.value).fid===b?w:S).push(n)}catch(O){M.e(O)}finally{M.f()}if(0!==w.length){r.filters&&m.push.apply(m,u(r.filters));var A,q=0,j=a(h);try{var P=function(){var r=A.value;t=c.dataSource.map((function(n){return n[r.fid]})),e=l(t),i=p(d(t,e[0],e[1])),f=c.dataSource.filter((function(r){return r[b]===y})).map((function(n){return n[r.fid]})),o=p(v(f,e[0],e[1]));for(var n=0,a=0;a<i.length;a++)0<i[a]&&0<o[a]&&(n+=i[a]*Math.log2(i[a]/o[a]));q+=n*(f.length/t.length)};for(j.s();!(A=j.n()).done;)P()}catch(O){j.e(O)}finally{j.f()}q/=h.length,m.push({field:w[0],values:[y]}),g.push({imp:q,fields:S,filters:m})}};for(q.s();!(T=q.n()).done;)j()}catch(O){q.e(O)}finally{q.f()}}}(),g.sort((function(r,n){return n.imp-r.imp})),g}},{key:"searchPatterns",value:function(){for(var r=this,n=this.dataSource,t=this.fields.filter((function(r){return"measure"===r.analyticType})),e=function(e){var i=function(r){var n=o(l(r),2),t=n[0],e=(n[1]-t)/h;if(0==e)return new Array(h).fill(r.length/h);for(var i=new Array(17).fill(0),f=0;f<r.length;f++)i[Math.floor((r[f]-t)/e)%17]++;return i[15]+=i[16],i.slice(0,h)}(n.map((function(r){return r[t[e].fid]})));f=c(p(i.filter((function(r){return 0<r})))),r.patterns.push({fields:[t[e]],imp:f})},i=0;i<t.length;i++){var f;e(i)}return this.patterns.sort((function(r,n){return r.imp-n.imp})),this.patterns}},{key:"createHighOrderPatterns",value:function(r){for(var n=r.fields,t=S(this.dataSource,r.filters),e=this.fields.filter((function(r){return"measure"===r.analyticType})),i=[],f=function(f){if(!n.find((function(r){return r.fid===e[f].fid}))){var a=0;l=t.map((function(r){return r[e[f].fid]}));for(var c=function(r){"measure"===n[r].analyticType&&(o=t.map((function(t){return t[n[r].fid]})),a+=y(l,o))},s=0;s<n.length;s++)c(s);a/=n.length,i.push({fields:[].concat(u(n),[e[f]]),filters:r.filters,imp:a})}},a=0;a<e.length;a++){var o,l;f(a)}return i.sort((function(r,n){return n.imp-r.imp})),i}},{key:"firstPattern",value:function(){for(var r=this,n=this.fields.filter((function(r){return"measure"===r.analyticType})),t=new Array(n.length).fill(0).map((function(){return new Array(n.length).fill(0)})),e=function(e){for(var i=function(i){var c=o(l(f=r.dataSource.map((function(r){return r[n[e].fid]}))),2);a=c[0],u=c[1],f=v(f,a,u),a=r.dataSource.map((function(r){return r[n[i].fid]})),t[e][i]=y(f,a)},c=0;c<n.length;c++)i(c)},i=0;i<n.length;i++){var f,a,u;e(i)}return t}},{key:"fewatureSelectionForSecondPatternWithSpecifiedViews",value:function(r,n){var t=this.dataSource,e=r.fields.filter((function(r){return"measure"===r.analyticType})),i=n.fields.filter((function(r){return"measure"===r.analyticType})),f=S(t,r.filters),u=S(t,n.filters);if(2!==r.fields.length||2!==n.fields.length)throw new Error("View size Not supported yet!");for(var l=this.fields.filter((function(r){return"dimension"===r.analyticType})),c=f.map((function(r){return e.map((function(n){return r[n.fid]}))})),d=u.map((function(r){return i.map((function(n){return r[n.fid]}))})),v=0,p=-1,y=function(r){b=function(r,n,t,e,i){for(var f,u,l,c=s(g(n),g(e)),d=new Map,v=new Map,p=0;p<r.length;p++)d.has(r[p])||d.set(r[p],[]),d.get(r[p]).push(n[p]);for(var y=0;y<t.length;y++)v.has(t[y])||v.set(t[y],[]),v.get(t[y]).push(e[y]);var m,b=0,w=a(d.entries());try{for(w.s();!(m=w.n()).done;){var S=o(m.value,2);f=S[0];var M,A=(u=S[1]).length/i;0!=A&&(u.length<Math.pow(h,2)||!v.has(f)?b+=A:(M=v.get(f),b+=A*s(g(u),g(M))))}}catch(P){w.e(P)}finally{w.f()}var T,q=a(v.entries());try{for(q.s();!(T=q.n()).done;){var j=o(T.value,2);l=j[0];var O=j[1].length/i;0==O||d.has(l)||(b+=O)}}catch(P){q.e(P)}finally{q.f()}return c-b}(f.map((function(n){return n[l[r].fid]})),c,u.map((function(n){return n[l[r].fid]})),d,t.length),console.log(l[r].fid,b),b>v&&(v=b,p=r)},m=0;m<l.length;m++){var b;y(m)}return-1<p?{features:[l[p]],score:v}:null}},{key:"pureFeatureRecommand",value:function(r){var n=S(this.dataSource,r.filters),t=this.fields.filter((function(r){return"dimension"===r.analyticType})),e=r.fields.filter((function(r){return"measure"===r.analyticType})),i=r.fields.filter((function(r){return"dimension"===r.analyticType})),f=t.filter((function(r){return-1===i.findIndex((function(n){return n.fid===r.fid}))})),o=[];return f.forEach((function(t){var i=n.map((function(r){return r[t.fid]})),f=0;if(1===e.length){var l=e[0],c=m(i,n.map((function(r){return r[l.fid]})));f+=c}else if(1<e.length){var s,h=a(c=function(r){for(var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r.length,e=[],i=function n(t,i,f){i.length===f?e.push(u(i)):t>=r.length||(n(t+1,[].concat(u(i),[r[t]]),f),n(t+1,i,f))},f=n;f<=t;f++)i(0,[],f);return e}(e.map((function(r){return r.fid})),2,2));try{var d=function(){var r=s.value;v=w(i,n.map((function(n){return[n[r[0]],n[r[1]]]}))),f+=v};for(h.s();!(s=h.n()).done;){var v;d()}}catch(p){h.e(p)}finally{h.f()}f/=c.length}o.push({imp:f,fields:[].concat(u(r.fields),[t]),filters:r.filters})})),o.sort((function(r,n){return n.imp-r.imp})),o}}])&&e(n.prototype,t),i&&e(n,i),r}();function A(r){var n=r.task,t=r.props,e=r.dataSource,i=r.fields;try{if("univar"===n)return function(r,n,t){return new M(r,n).searchPatterns()}(e,i);if("patterns"===n)return function(r,n,t){var e=new M(r,n);return e.firstPattern(),e.createHighOrderPatterns(t)}(e,i,t);if("featureSelection"===n)return function(r,n,t){return new M(r,n).pureFeatureRecommand(t)}(e,i,t);if("comparison"===n)return function(r,n,t){return new M(r,n).fewatureSelectionForSecondPatternWithSpecifiedViews(t[0],t[1])}(e,i,t);if("filterSelection"===n)return function(r,n,t){return new M(r,n).recommandFilter(t)}(e,i,t)}catch(f){throw new Error("[footman][".concat(n,"]").concat(f,"\n").concat(f.stack))}}self.addEventListener("message",(function(r){try{const n=A(r.data);self.postMessage({success:!0,data:n})}catch(n){self.postMessage({success:!1,message:`[worker]${n}`})}}),!1)}]);